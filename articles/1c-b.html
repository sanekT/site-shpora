<div class="wrap">
   
    <h2 class="header-style">Основы программирования на 1с</h2>

    <ul class="list">
        <li><a href="#konst">Константы</a></li>
        <li><a href="#img">Картинки</a></li>
        <li><a href="#info">Справочники</a></li>
        <li><a href="#doc">Документы</a>
            <ul class="list2">
                <li><a href="#doc.1">Разные</a></li>
                <li><a href="#doc.2">Камков</a></li>
                <li><a href="#doc.3">Чистов 8.2</a></li>
                <li><a href="#doc.4">Чистов 8.3</a></li>
                <li><a href="#doc.5">Хрусталёва</a></li>
            </ul>
        </li>
    </ul>

    <hr>

    <ul class="list">
        <li><a href="#0">Основная конфигурация(Метаданные), Конфигурация БД.</a></li>
        <li><a href="#metadata">Что такое метаданные</a></li>
        <li><a href="#reg-img">Картинка виртуальных таблиц всех регистров конфигурации</a></li>
        <li><a href="#notes">Короткие заметки по 1С</a></li>
        <li><a href="#props">Свойства реквизитов объектов конфигурации</a></li>
        <li><a href="#moduls">Для чего нужны модуль формы, объекта, менеджера</a></li>
        <li><a href="#type-date">Типы данных и универсальные коллекции</a></li>
        <li><a href="#1a">Преобразование типов данных</a></li>
        <li><a href="#structure-module">Структура модуля</a></li>
        <li><a href="#2">Операции сравнения</a></li>
        <li><a href="#3">Функция <b>Формат()</b></a></li>
        <li><a href="#4">Часто используемые методы Глобального контекста</a></li>
        <li><a href="#4b">Проверка даты, строки, числа, реквизита с ссылочным типом на <b>пустоту</b></a></li>
        <li><a href="#pvh"><b>План видов характеристик</b></a></li>
        <li><a href="#interactiv">Процедуры и функции для взаимодействия с пользователем</a>
            <ul class="list2">
                <li><a href="#interactiv-1">Как показать пользователю текстовое сообщение</a></li>
                <li><a href="#interactiv-2">Модальное окно. Почему надо отказываться от модальности. Асинхронные методы.</a></li>
                <li><a href="#interactiv-3"></a></li>
                <li><a href="#interactiv-4"></a></li>
            </ul>
        </li>
        <li><a href="#enumeration-3">Произвольное составление представления ссылочного поля</a></li>
        <li><a href="#vrem-tab">Посмотреть что лежит во временной таблице в отладчике</a></li>
        <li><a href="#5">Условный оператор</a></li>
        <li><a href="#5a">Тройной оператор</a></li>
        <li><a href="#6">Циклы</a></li>
        <li><a href="#7">Процедуры и функции</a></li>
        <li><a href="#7a">Переменные передаются по ссылке в процедуры и функции. Оператор <b>Знач</b>.</a></li>
        <li><a href="#10">Не срабатывает метод Сообшить</a></li>
        <li><a href="#11">Объекты конфигурации</a></li>
        <li><a href="#unic-id">Методы Уникальный идентификатор() и ПолучитьСсылку()</a></li>
        <li><a href="#link">Контроль ссылочной целостности</a></li>
        <li><a href="#prop-root-config">Свойства корня конфигурации</a>
            <ul class="list2">
                <li><a href="#prop-root-config-1">"Режим управления блокировкой данных" во вкладке "Совместимость"</a></li>
                <li><a href="#prop-root-config-2"></a></li>
            </ul>
        </li>
        <li><a href="#konst">Работа с <b id="konst">константами</b></a>
            <ul class="list2">
                <li><a href="#konst1">Константа и её свойства</a></li>
                <li><a href="#konst2">Пример работы с константой</a></li>
            </ul>
        </li>
        <li><a href="#picture">Работа с <b id="img">картинками</b></a>
            <ul class="list2">
                <li>работу с файлами можно посмотреть в главе 3.18 книги "Разработка интерфейсов"</li>
                <li><a href="#picture1">Как просто открыть картинку в форме без сохранений в базе</a></li>
                <li><a href="#picture2">Как можно сохранить картинку во внешней обработке</a></li>
                <li><a href="#picture3">Добавляем картинку в ячейку макета рядом с текстом из кода</a></li>
                <li><a href="#picture4">Устанавливаем и удаляем <b>картинку</b> товара в форме элемента справочника "Номенклатура". События формы <b>"ПередЗаписью"</b> и <b>"ПередЗаписьюНаСервере"</b></a></li>
            </ul>
        </li>
        <li><a href="#spravochnik">Работа со <b id="info">справочником</b></a>
            <ul class="list2">
                <li><a href="#spravochnik-base">Что такое и для чего нужен справочник</a></li>
                <li><a href="#spravochnik-prop">Свойства реквизитов справочника</a></li>
                <li><a href="#spravochnik-dogovor">Подчинённый справочник. Реквизит "Владелец".</a></li>
                <li><a href="#spravochnik1">Типы данных у справочников</a></li>
                <li><a href="#spravochnik2">Получение данных справочника из базы объектным способом</a></li>
                <li><a href="#spravochnik3">Получение данных справочника по ссылке объектным способом и через запрос</a></li>
                <li><a href="#spravochnik4">Получение ссылки на элемент справочника</a></li>
                <li><a href="#spravochnik5">Метод <b>ПолучитьОбъект()</b> у разных типов данных справочника и документа</a></li>
                <li><a href="#spravochnik6">Метод <b>Создатьэлемент()</b> у менеджера справочника и перемещение созданного элемента в группу</a></li>
                <li><a href="#spravochnik7">Предопределенные элементы</a></li>
                <li><a href="#spravochnik8">Заполнение реквизитов автоматом при создании нового элемента. Тип данных - Список значений. Как автоматом ставить галочку в поле "Услуга" для новых создаваемых элементов справочника Номенклатура? Для новых элементов внутри группы Товары в поле Услуга ставится Ложь, а для новых элементов внутри группы Услуги - Истина. <b>Событие "ОбработкаЗаполнения"</b>.</a></li>
                <li><a href="#spravochnik9">Проверка заполнения реквизитов при записи в БД. <b>Событие "ОбработкаПроверкиЗаполнения". Свойство "Проверка заполнения". Пункт "Ещё" -> "Настроить список"</b>.</a></li>
                <li><a href="#enumeration-3">Произвольное представление ссылки.</a></li>
                <li><a href="#spravochnik10">Почему на этапе разработки не надо ставить галочку свойству <b>"Неотрицательное"</b> при установке реквизиту типа данных Число.</a></li>
                <li><a href="#spravochnik11">Определяем пол сотрудника по его отчеству</a></li>   
                <li><a href="#spravochnik13">Обработка заполняет реквизит "ВидНоменклатуры" у всех элементов справочника "Номенклатура" соответствующим значением перечисления</a></li>
            </ul>
        </li>
        <li><a href="#document">Работа с <b>документом</b> и не только</a>
            <ul class="list2">
                <li><b id="doc.1">Разные заметки:</b></li>
                <li><a href="#document-base">Что такое и для чего нужен документ</a></li>
                <li><a href="#document-types">Типы данных у документа</a></li>
                <li><a href="#document-prop">Свойства реквизитов документа</a>
                    <ul class="list2">
                        <li>Пержде чем вспоминать и читать про данные заполнения, стоит почитать об этом в книге "Разработка интерфейсов" тут в шпоре начиная с главы 3.10. Там более понятно написано что и как.</li>
                        <li><a href="#document-prop-1">Значение заполнения</a></li>
                        <li><a href="#">Заполнять из данных заполнения</a>. В 2х местах 2 примера с эти свойством - <a href="#spravochnik8">тут</a> и <a href="#document25-2">тут</a></li>
                    </ul>
                </li>
                <li><a href="#doc-prop">Свойства документа</a>
                    <ul class="list2">
                        <li><a href="#doc-prop-1">Свойство <b>"Проведение"</b> во вкладке "Движения"</a></li>
                        <li><a href="#doc-prop-2">Свойство <b>"Оперативное проведение"</b> во вкладке "Движения"</a></li>
                        <li><a href="#doc-prop-3">Свойство <b>"Удаление движений"</b> во вкладке "Движения"</a></li>
                    </ul>
                </li>
                <li><a href="#document-events">События модуля объекта</a>
                    <ul class="list2">
                        <li><a href="#document25">ОбработкаЗаполнения</a></li>
                        <li><a href="#spravochnik8">ОбработкаЗаполнения - другой пример</a></li>
                    </ul>
                </li>
                <li><a href="#document-events">События модуля менеджера</a>
                    <ul class="list2">
                        <li><a href="#"></a></li>
                    </ul>
                </li>
                <li><a href="#dop-document11">Пересчёт суммы в табличной части</a></li>
                <li><a href="#dop-document1">Метод <b>СоздатьДокумент()</b> у менеджера документа</a></li>
                <li><a href="#dop-document2">Разница между кнопкой <b>"Записать"</b> и <b>"Провести"</b> у документа</a></li>
                <li><a href="#dop-document3">Разница между событиями <b>"ПередЗаписью"</b>, <b>"ПриЗаписи"</b>, <b>"ОбработкаПроведения"</b>модулей объекта и формы и какой использовать для записи в реквизит "СуммаДокумента"</a></li>
                <li><a href="#dop-document4"><b>Практика</b>. В таб. части Товары документа "ПродажаТоваров" при выборе товара нужно подставить цену в поле Цена из реквизита справочника Номенклатура "ЦенаПродажи"</a></li>
                <li><a href="#dop-document5"><b>Практика</b>. В таб.части документа изменить поле Цена во всех строках таб. части при изменении реквизита Контрагент в шапке документа</a></li>
                <li><a href="#dop-document6">"Дополнительные свойства" документа</a></li>
                <li><a href="#dop-document7">Способ, как не добавляя реквизит "СуммаДокумента" в форму документа, видеть это поле с подсчитаным значением в форме списка документа.</a></li>
                <li><a href="#dop-document8"><b>Форма выбора. Динамический список.</b> При выборе товара в таб. части документа открывается форма выбора товара. Нужно чтобы в этой форме было доп. поле с остатками товаров</a></li>
                <li><a href="#dop-document9"><b>Передача параметра в форму. Форма выбора. Динамический список</b>. Дополнение к предыдущей записи про форму выбора. Нужно передать параметр в форму выбора справочника в запрос для динамического списка. Свойство <b>"Связи параметров выбора"</b>, свойство <b>"Параметры"</b> у формы</a></li>
                <li><a href="#dop-document10">Что такое "режим разделения итогов" (для поиска "разделение итогов")</a></li>
                <li><a href="#dop-document11">Что на самом деле делает свойство <b>"БлокироватьДляИзменения"</b></a></li>
                <li><a href="#dop-document12">Как происходит перепроведение, как я понял</a></li>
                <hr>

                <li><b id="doc.2">Курс Камкова. Решение оперативных задач. Видео с 4.1:</b></li>
                <li><a href="#kam-doc-1">(Курс Камкова). Что такое оперативный учёт?</a></li>
                <li><a href="#kam-doc-2">(Курс Камкова). Стандартная обработка "Управление итогами". Таблица итогов.</a></li>
                <li><a href="#kam-doc-3">(курс Камкова). Создание механизма <b>бронирования товара</b> при оперативном учёте. Делаем кнопку в форме документа(используем модуль объекта и запись в регистр с помощью свойства Движения) и в форме списка документа(используем модуль менеджера и запись в регистр без свойства Движения)</a></li>
                <li><a href="#kam-doc-4">(курс Камкова). Создание механизма <b>бронирования товара</b>. Другой способ записи в регистр. Создаём отдельно документ "БронированиеТоваров"</a></li>
                <li><a href="#kam-doc-5">(курс Камкова). Создание документа "Ручная коррекция задолженности" для создания, изменения, удаления записей регистра напрямую из формы</a></li>
                <li><a href="#kam-doc-6">(курс Камкова). Показываем остаток выделенного товара в табличной части документа "ПродажаТоварв". Событие <b>"ПриАктивизацииСтроки"</b></a></li>
                <li><a href="#kam-doc-7">(курс Камкова). <b>Контроль остатков</b> и расчёт <b>себестоимости</b> по средней в документе "ПродажаТоваров". Есть пару объяснений про оперативное проведение. Блокировка таблицы. С использованием склада. Старая методика.</a></li>
                <li><a href="#kam-doc-8">(курс Камкова). Контроль остатков(количества и суммы(себестоимости)) в документе "ПоступлениеТоваров". Объект <b>"Последовательности"</b>.</a></li>
                <li><a href="#kam-doc-9">(курс Камкова). Продажа товара и списание себестоимости методом <b>ФИФО</b> и ЛИФО</a></li>
                <hr>

                <li><b id="doc.2">Курс Камкова. Решение бух задач. Видео с 5.1:</b></li>
                <li><a href="#kam-buh-1">(Курс Камкова). </a></li>
                <li><a href="#kam-buh-2">(Курс Камкова). </a></li>
                <li><a href="#kam-buh-3">(Курс Камкова). </a></li>
                <li><a href="#kam-buh-4">(Курс Камкова). </a></li>
                <li><a href="#kam-buh-5">(Курс Камкова). </a></li>
                <hr>

                <li><b id="doc.3">Курс Чистова 8.2.</b></li>
                <li><a href="#document13">(Курс Чистова 8.2) <b>Контроль остатков</b> и расчёт <b>себестоимости</b> по средней в документе "ПродажаТоваров". Без использования склада. Старая методика.</a></li>
                <li><a href="#document14">(Курс Чистова 8.2) Как вести <b>многоскладской</b> учёт? <b>Формула себестоимости по средней, "Связи наборов данных".</b></a></li>
                <li><a href="#document15">(Курс Чистова 8.2) Партионный учёт, продажа товара и списание себестоимости методом <b>ФИФО</b> и ЛИФО</a></li>
                <li><a href="#document16">(Курс Чистова 8.2) <b>Последовательности</b>, что такое и для чего нужны.</a></li>
                <li><a href="#document18">Как <b>свернуть(сгруппировать)</b> одинаковые товары табличной части при записи их в регистр в обработке проведения документа "ПоступлениеТоваров". <span class="светло_красный">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document19"><b>"Кнопка выбора", событие "НачалоВыбора"</b>. Как для реквизита шапки/таб.части документа добавить кнопку выбора и открыть окно с результатом, который мы выберем из БД</a></li>
                <li><a href="#document20"><b>Бронирование товара</b>. Опишу тут немного другой способ бронирования товаров. На мой взгляд более правильный чем у Камкова. Решение задачи №8 из книги Чистова.</a></li>
                <li><a href="#enumeration-3">Произвольное представление ссылки.</a></li>
                <hr>

                <li><b id="doc.4">Курс Чистова 8.3.</b></li>
                <li><a href="#document21">(Курс Чистова 8.3) <b>Контроль остатков</b> и расчёт <b>себестоимости</b> по средней. Новая методика.</a></li>
                <li><a href="#document22">(Курс Чистова 8.3) Партионный учёт, продажа товара и списание себестоимости методом <b>ФИФО</b>. <span class="светло_красный">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document23">(Курс Чистова 8.3) Как правильно построить отчёт о продажах товара. Регистр накопления <b>"Продажи"</b>. <span class="светло_красный">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document24">(Курс Чистова 8.3) Бронирование товаров. <span class="светло_красный">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document25">(Курс Чистова 8.3) Ввод на основании. Событие модуля объекта "ОбработкаЗаполнения". Свойство "Заполнять из данных заполнения". Делаем ввод на основании вручную. Смотрим свойство <b>"Параметры"</b> у формы и передачу их в форму. <span class="светло_красный">Модуль формы</span></a></li>
                <hr>

                <li><b id="doc.5">Курс Хрусталёва 8.3.</b></li>
                <li><a href="#hrust">(Курс Пособие ... Хрусталёва). Обработка проведения, контроль остатков, вычисление себестоимости по средней</a></li>  
            </ul>
        </li>
        
    </ul>







    
    <h3 class="header-style2" id="0">Основная конфигурация(Метаданные), Конфигурация БД.</h3>
    <img src="../img/1С-1/2023-04-17_18-38-07.png" class="screen" alt="">
    <p>Мы можем наглядно это увидеть. Например, создадим в нашей рабочей(основной) конфигурации справочник любой и сохраним, но не обновляем БД, затем можно открыть конфигурацию БД в меню сверху - Конфигурация -> Конфигурация базы данных -> Открыть конфигурацию БД. Откроется в окне конфигурация БД и в ней если раскрыть дерево справочников, то там не увидем тот справочник, который мы создали в своей рабочей. Если образно, то наша рабочая конфа это черновик, а конфа БД это уже чистовик. Чтобы наш справочник появился в БД нажимаем бочёнок.</p>
    <p>Дополнительно про устройство информационной базы можно почитать в книге Хрусталёвой в последнем разделе "Теория" главы про справочники.</p>










    <h3 class="header-style2" id="metadata">Что такое метаданные</h3>
    <p>Пока оставлю ссылку на станицу, где рассказывается о метаданных, потом нужно переписать - <a href="https://www.1s-up.ru/metadannye-1s/">тут</a></p>












    <h3 class="header-style2" id="reg-img">Картинка виртуальных таблиц всех регистров конфигурации</h3>
    <img src="../img/1С-1/2025-02-27_07-17-34.png" class="screen" alt="">
    













    <h3 class="header-style2" id="notes">Короткие заметки по 1С</h3>
    <ul class="list">
        <li>У элементов справочников нужно оккуратно подходить к созданию таб. частей. Потому что при открытии в пользовательской части элемента справочника из базы подтягивается и его табличная часть. Допустим есть справочник "Содрудники" и у него в элементе справочника мы указываем реквизит "Сотрудник" и прочие реквизиты. И допустим нам нужно для каждого сотрудника указать его прошлые места работы. Как это указать? Можно сделать табличную часть "Прошлые работы" и туда заполнять, работ туда забить можно много, вдруг сотрудник много где поработал, тогда при открытии элемента справочника мы хотим просто поменять значение какого то реквизита, но в память помиму элемента загрузится вся его табличная часть с местами работы, которая нам сейчас вообще не нужна, но память эта таб. часть скушает. Поэтому часто хранят инфу в регистре сведений. Но что сделать таб. часть или регистр сведений решать нам. Если мы точно знаем что таб. часть будет маленькой, не более 10 строк, то можно и таб. часть создать, а если строк планируется значительно больше, то регистр сведений. Ну вот, например, у сотрудника нужно указать детей, вот тут можно таб. часть создать, потому что детей много не будет.</li>
        <li>Ещё один способ нагрузить элемент справочника помимо таб. части это размещение в нём реквизита с фото сотрудника. У реквизита можно указать тип данных "Хранилищезначений" и в него закачать фото большого размера. Так делать тоже нельзя. Нужно создать другой справочник специально для фото сотрудников и тогда из элемента сотрудника можно по ссылке открыть его фото из другого справочника. Хранение файлов помиом фото также выносятся на отдельные справочники.</li>
        <li>Важной особенностью языка запросов в системе 1С:Предприятие является то, что он обеспечивает доступ к данным ТОЛЬКО ДЛЯ ЧТЕНИЯ. Для ЗАПИСИ же информации используются конструкции на встроенном языке 1С:Предприятие, а именно типы данных ДокументОбъект.ИмяДокумента, СправочникОбъект.ИмяДокумента и другие подобные типы.</li>
        <li>Справочники/Документы – это коллекция менеджеров всех справочников/документов, содержащихся в конфигурации. Коллекция имеет тип данных СправочникиМенеджер/ДокументыМенеджер</li>
        <li><b>Макет</b> предназначен для хранения различных форм представления данных, которые могут потребоваться каким-либо объектам конфигурации или всему прикладному решению в целом. Макеты нужны для вывода данных из систему 1С. Если формы служат для ввода данных пользователем, то макеты представляют из себя шаблоны, которые позволят данные из системы вывести.</li>
        <li>Если у нас в справочнике заполнены какие то данные и с течением времени, какие то данные устарели(например, поменялся товар), то нежелательно их переписывать на другие данные, потому что потом в других документах и справочниках ссылающихся на данный справочник заменятся одни данные на другие и будет уже путаница. Вот если, например, мы написали в справочнике товар с опечаткой и потом написали кучу документов, которые ссылаются на этот справочник и позже заметили ошибку в слове, то можно в справочнике исправить имя товара и он исправиться во всех документах, такое можно делать. Но если имя товара меняется кардинально, например  с Шапка, на Пальто, то так не надо делать. Ну или мы хотим чуть подкорректировать адрес, то так можно делать. Главное чтобы суть оставалась прежней.</li>
        <li>В объекте документа, например, Покупка есть во вкладке Прочее - Модуль объекта. Этот модуль нужен для кода обработки по событиям, например проведения и записи документа. Также могут быть и просто экспортные процедуры и функции. А в модуле менеджера находятся вспомогательные процедуры и функции, например, как я помню там обрабатывается взаимодействие с макетом печатной формы документа.</li>
        <li>Чтобы очистить регистр накопления можно всем документам отменить проведение, которые в этот регистр делают записи.</li>
        <li>Условное проведение документа. Когда мы проводим документ, который делает приход товара, то там всё просто, мы делаем запись в регистре накопления, например, товар, его количество и цену или сумму. Такое проведение называется безусловным. Но когда мы потребляем товар, то на м нужно вычислить сколько стоит употреблённый товар, ведь мы можем купить один и тот же товар по разной цене. В этом случае есть 3 способа вычислить стоимость товара: 1) Высчитать среднеарифметическое, 2) 3). Также нам нужно проверить перед употреблением товара, а есть ли он на складе или в холодильнике. В общем такое проведение называется условным, т.е. более умным, с разными условиями.</li>
        <li>Когда есть процедура на клиенте и эта процедура вызывает процедуру на сервере, то данные шапки документа неявно передаются на сервер и доступны в сервеной процедуре. Данные табличной части надо передаваать самому. Ну это пока я так понял. А вообще слышал что все данные документа неявно передаются на сервер.</li>
        <li>Когда сотрудника на предприятии переводят в другое подразделение, то издаётся кадровый приказ о его переводе. В 1с должен быть документ о перемещении сотрудников на предприятии. Документ можно так и назвать "Кадровый приказ"</li>
        <li>Тонкий клиент это приложение на клиентской стороне, которая берёт на себя роль отображать данные и расчёт каких то алгоритмов тоже может выполнять. Непосредственно обработка данных и чтение их выполняются на серверной стороне.</li>
        <li>Толстый клиент содержит средство разработки - конфигуратор</li>
        <li>Веб клиент находится в браузере, подключаясь к веб серверу. Веб сервер через какие то компоненты взаимодействует с серверами(кластерами серверов) 1с предприятия.</li>
        <li>Во Вкладке Данные у справочника есть такой раздел как Основное представление и 2 выбора: 1)В виде кода, 2)В виде наименования. Так вот это представление ссылки какого то элемента справочника где то в другом объекте. Например в справочнике Еда есть поле с типом СправочникСссылка.Вкусы и выбирая из списка какой то вкус, система в это место записывает ссылку на элемент справочника Вкусы. Ссылка обычно выглядит примерно так - 12хlksd9033ij09w3ojir09uisd2903u2ht68sd, чтобы не пугать пользователя такой аброкадаброй мы и указываем как представлять ссылку? В виде наименования или в виде кода. В 1с предприятии 8.3 появилась возможность описать представление вообще как нам хочется.</li>
        <li>В таблицах документа в БД есть виртуальное поле - МоментВремени. Это поле содержит дату документа и представление ссылки, выглядит примерно так - "25.02.2022 0:00:00;Поступление товаров от 25.02.2022 0:00:00". Так как в одну секунду могут быть записаны несколько документов, чтобы их как то отделять создали такое поле и добавили к дате ссылку, по этому моменту и отличают документы записанные в промежутке одной секунды. Метод МоментВремени() есть у типов данных ДокументОбъект, ДокументСсылка. Также есть класс МоментВремени, в который можно передать дату и ссылку документа и он вернёт момент времени этого документа.</li>
        <li>В таблицах документа в БД есть виртуалное поле Представление, это представление ссылки в виде наименования(конечно если в настройках задано представление в виде наименования).</li>
        <li>В таблице БД РегистрНакопления есть поле Активность. Это поле говорит системе о том, будет ли запись, у которой Активность стоит ДА учавствовать в построении виртуальных таблиц этого регистра. Иногда проще поставить записи значение НЕТ в поле Активность  чем её удалять.</li>
        <li>Виртуальная таблица РегистрНакопления.Продажа.Обороты. В этой вирт. таблице есть 4 параметра - началоПериода, конецпериода, Периодичность и Условие. Мы можем задать отрезок времени, на который хотим получить оборот продаж. А можно задать переиодичность, например, Месяц и за каждый месяц нам выдаст обороты продаж. При периодичности появится новое поле в таблице с периодом, где будут помесячно показаны продажи товаров.</li>
        <li>ВАЖНО!!! Когда мы в конструкторе запросов пишем Условие для виртуальной таблицы, то часто бывает что в виртуальной таблице задаём такое условие: Товар В(&lt;тут вложенный запрос>). Чтобы руками не писать вложенный запрос, сделаем один отступ в нутри скобок и выделим этот пробел и правой кнопкой мыши можно будет открыть ещё один конструктор запроса для написания вложенного запроса.</li>
        <li>WebЦвета - коллекция цветов по их названиям.</li>
        <li>Символы - коллекция разных отступов. Например, Символы.ПС - это перенос строки.</li>
        <li>OLE-объектом называется любой документ, сформированный с использованием технологии OLE (Object Linking and Embedding). Многие программные приложения, работающие под управлением Windows, поддерживают данную технологию и формируют документы, которые могут быть переданы другому программному приложению в качестве объекта.</li>
        <li>Документ перед проведением сначала записывается в БД.</li>
        <li>Бывает такое явление как остатки записей в регистре с осатком суммы от товара. Поступили одинаковые товары, но с разной ценой, мы их посчитали и для каждого высчитали среднюю стоимость(среднюю стоимость мы высчитываем, потому что товар один , а цены разные и нам при списании одного товара нужно списать и его сумму, а как понять какая именно у него сумма, поэтому и расчитываем среднюю на все товары и при списании списываем эту среднюю цену) и округлили, затем при списании всех товаров, товары будут 0, а сумма может зависнуть как -0.01 или ещё как то. Это всё из за округления, потому что при округлении мы теряем какие то микро копейки и их потом уже будет не хватать или наоборот будет больше. Нужно как то выкручиваться и не допускать в таких случаях округления. Можно конечно не округлять и записывать прям так с большим числом после запятой, тогда всё будет нормально. Узнаю другие решения допишу.</li>
        <li>В документах продажи или покупки товаров часто указывают реквизит "СуммаДокумента". Это считается избыточным реквизитом, но польза от него есть и не маленькая. Например, этот реквизит хорошо видно в списке документов одного вида и не нужно заходить в сам документ, чтобы увидеть всю сумму стоимости товаров в его табличной части. Или сумму документа можно вынести в отдельную колонку(графу) в журнале документов, где также мы сразу в списке видем сумму.</li>
        <li>Если мы хотим получить из виртуальной таблицы "остатки" данные на какой то период времени, например на 22.03.2023 18:00:00 и у нас есть в записях БД данные на эту секунду, то мы не получим эти данные, потому что это особенность вирт. таб. "остатки". Чтобы получить эти данные нужно прибавить к дате секунду. Виртуальная таблица "обороты" работает по другому, на период от 22.03.2023 00:00:00 до 22.03.2023 18:00:00 мы получим все данные в этом периоде и даже те, которые находятся на этой секунде, т.е. не нужно как в остатках прибавлять секунду.</li>
        <li>У документов на закладке Движения есть такой пункт как Удалять движения и там по умолчанию выбрано "Удалять автоматически при отмене проведения". Но бывают случаи, когда мы провели документ и он записал в какой то регистр какие то данные и потом перепроводим этот документ снова. При проведении мы обращаемся за данными в этот регистр куда этот документ пишет записи и при перепроведении мы уже получим данные из регистра с учётом того, что этот документ уже изменил записи при первом проведении. Т.е. при первом проведении данные мы получали одни из регистра, а уже при повторном проведении этого документа данные уже другие(они изменились при первом проведении). Такое поведение нас не устраивает, мы хотим при повторном проведении получать данные как при первом, поэтому выберем другое значение у пункта "Удалять движения" на "Удалять автоматически". В этом случае при повторном проведении данные из регистра удаляться и запишутся снова при перепроведении. Есть разные способы решения этой проблемы. Описал самый простой способ.</li>
        <li>Стандартный реквизит "Наименование" у справочников имеет ограниченную длину(150 символов), поэтому используется для коротких именований чего то. Чтобы описать полное наименование, создаётся дополнительный реквизит.</li>
        <li>Есть справочник СтавкиНДС, в котором обозначенно несколько предопределённых элементов с именами НДС10 и НДС18. Чтобы получить из базы эти данные можно просто вызвать Справочники.СтавкиНДС.НДС18 или Справочники.СтавкиНДС.НДС10, т.е. мы не делаем запросов в объектной или табличной модели. Такое получение возможно только с предопределёнными данными.</li>
        <li>Если у нас есть переменная, в которой лежит ссылка с типом СправочникСсылка.ИмяСправочника или ДокументСсылка.ИмяДокумента, то на сервере мы через эту ссылку можем прочитать значения любых полей из объекта БД, на который указывает эта ссылка.</li>
        <li>ПредопределенноеЗначение() - на клиенте эта функция позволяет получить данные, из БД на сервере, объекта Перечисления. Пример, ПредопределенноеЗначение("Перечисление.СпособыОплаты.Безналичные") - вернёт значение Безналичные из таблицы Перечисление.СпособыОплаты. С этим значением можно сравнить значение реквизита в форме, выбранного пользователем. Если значение реквизита будет Безналичные с типом реквизита Перечисление.СпособыОплаты, то сравнение вернёт Истину.</li>
        <li>Как то не мог найти, как заблокировать колонку табличной части для изменений. Пытался через Элементы найти колонки в табличной части, заблокировать их при открытии формы, но не получалось. Оказалось просто нужно выбрать поле табличной части и в палитре свойств поставить галочку "Только просмотр".</li>
        <li>Бывает такой эффект как одинаковые коды в справочнике. Например, мы создали элемент справочника(000000001), а позже создали 2 предопределённые группы в этом справочнике. Предопределённые группы начинают отчёт тоже с начала и имеют коды (000000001 и 000000002). И получаемся у нас 2 элемента с одинаковым кодом.</li>
        <li>Есть документ "ПродажаТоваров" и в нём есть реквизит "СуммаДокумента". Нужно заполнять этот реквизит перед записью. Код можно написать в модуле формы, а можно в модуле объекта. И там и там есть событие "ПередЗаписью". Отличие в том, что если мы будем программно записывать документ, то событие формы "ПередЗаписью" не сработает, а событие "ПередЗаписью" в модуле объекта сработает. Вывод, лучше описывать заполнение реквизита "СуммаДокумента" в модуле объекта.</li>
        <li>Чтобы найти какой то код или объект конфы в конфигурации то Правка -> Глобальный поиск.</li>
        <li>В форме списка какого то объекта конфы есть основной реквизит Список, у этого реквизита в палитре свойств есть закладка "Объект" и в ней свойство "Основная таблица". Это свойство показывает какую таблицу из БД Список отображает на форме. Таблицу можно поменять или написать свой запрос, что отображать в этом списке.</li>
        <li>1С работает с переменнными как и JS по новому стандарту через "let". В 1С как и в JS(через let) при первом проходе разборщика по коду он определяет все переменные объявленные ниже по коду в значение Неопределено в начале кода, но это не значит что можно присваивать переменные друг в друга в начале кода до их объявления(объявление происходит через Перем или при присвоении значения), это можно сделать при объявлении в JS через "var". Но в отличии от JS в 1С видимость переменных объявленных где то в блоке(в скобках {}) видна и вне этого блока, в JS, если переменная объявлена где то в блоке, то она там и видна, вне блока нет такой переменной, в 1С есть.</li>
        <li>Сайт портал это такой сайт, который может пользователя перенаправлять по разным ссылкам на какие то конкретные площадки.</li>
        <li>Когда нужно обрабатывать ОШИБКИ? Если методы, например коллекций, возвращают значения типо Неопределено, а где то дальше по коду мы с вернувшимся значением производим операции, то такое значение всегда нужно обрабатываеть через условие, мол если вернулось неудачное значение, то то -то и то-то сделать, а если удачное, то продолжить операции.</li>
        <li>Файл базы данных(1Cv8.1CD) нужно периодически копировать на запасной носитель. Такие копии программисты называют "бэкап", от английского back up выполнять резервное копирование.</li>
        <li>Чтобы сделать какую то обработку данных в системе 1С используются обработки, но можно обойтись и без них, но скорее только в учебных целях(но это не точно). Можно использовать в модуле приложения(он выполняется только на клиенте) обработчик события "ПриНачалеРаботыСистемы", который будет вызывать процедуру из общего модуля. Общий модуль сделаем доступным только на сервере, для этого поставим галочку "Сервер" и чтобы можно было вызвать процедуру из общего модуля от клиентского модуля приложения нужно ещё поставить галочку "Вызов сервера"(это обязательно) в свойствах общего модуля. Затем в процедуре общего модуля пишем логику с изменениями каких то данных в БД и при запуске системы срабатывает событие "при начале работы системы" и запускается обработчик в модуле приложения, который запускает процедуру из общего модуля на сервере и что то меняет на сервере. Вот такой есть способ сделать обработку данных. Ну правда придётся перезапускать 1С предприятие, чтобы выполнить обработку.</li>
        <li>Изменять, удалять и записывать в БД может только тип СправочникОбъект.ИмяСправочника, ДокументОбъект.ИмяДокумента и прочие похожие объекты. У этих объектов есть свои модули с предопределёнными обработчиками событий, называется - модуль объекта. Так как эти объекты могут записывать в БД, то и события у них есть разные - "ПередЗаписью", "ПриЗаписи", "ПередУдалением" и прочие.</li>
        <li>Важно. Если мы делаем отчет, то в запросе для ссылок, если мы их выбираем, нужно также выбрать представление этих ссылок, иначе система где то в цикле будет делать мини запросы, чтобы для каждой ссылке получить представление. Если мы делаем обработку, которая не предполагает вывод ссылок на экран, а просто использет где то внутри себя данные, то там не нужно выбирать представление ссылок. Если запрос в СКД, то получать представление не нужно, СКД сама их получит</li>
        <li>Если мы создаём регистр накопления, то он всегда подчинён какому-то документу, значит в форме документа во вкладке "Командный интерфейс" в панели навигации "Перейти" появится запись с этим регистром и мы можем включить его видимость в панели навигации формы документа.</li>
        <li>Есть такая возможность как заполнение регистра вот таким способом. Создаём форму документа, из основного реквизита "Объект" перетаскиваем в элементы формы объект "Движения". Теперь в форме документа есть табличная часть которая отображает движения в регистре именно для этого документа. Можно добавлять новые записи в набор записей, как в обычную табличную часть и сохранять. Тоже самое можно делать и для других форм, у которых нет объекта "Движения" в основном реквизите "Объект". Для этого просто создаём реквизит формы и выбираем ему тип данных, например, "РегистрНакопленияНаборЗаписей.ОстаткиНоменклатуры" и также переносим в элементы формы этот реквизит и у нас в форме будет отображаться в виде таблицы формы указанный регистр.</li>
        <li></li>
    </ul>











    
    <h3 class="header-style2" id="props">Свойства реквизитов объектов конфигурации</h3>
    <ul class="list">
        <li><b>"Проверка заполнения"</b> - значение "Выдавать ошибку" заставляет пользователя ввести данные в поле</li>
        <li><b>"Связи параметров выбора"</b> - позволяет создать связь между реквизитами. Например, есть 2 реквизита - "Контрагенты" и "ДоговорыКонтрагентов" или "Контрагенты" и "КонтактныеЛица", 2й подчинён 1му. На форме мы указываем контрагента в реквизите "Контрагент", затем при указании договора в реквизите "ДоговорыКонтрагентов" нам откроется форма выбора со всеми договорами, а мы хотели бы чтобы договора были только те, которые относятся к выбранному контрагенту. Вот как раз через это свойство и настраивается связь этих реквизитов. В свойстве нужно будет выбрать поле Контрагенты и Отбор по Владельцу. Отбор по Владельцу обычно сам подставляется, но если у реквизита "ДоговорыКонтрагентов" составной тип, то нужно вручную выбрать Отбор по Владельцу. Другой пример свойства "Связи параметров выбора". Документ "ПродажаТоваров", у него есть таб. часть Товары, мы при создании новой строки в таб. части начинаем выбирать товар и если мы открываем форму выбора справочника Номенклатура(почему если, потому что можно и не открывать форму, можно сразу в подсказке выбрать нужный товар), то в эту форму можно передать параметр. Какой параметр и куда? Форма выбора справочника использует для отображения данных динамический список "Список", этот список можно настроить создав произвольный запрос к БД. В произвольном запросе мы пишем свой запрос, напрмер, к виртуальной таблице "Остатки" и в эту таблицу хотим передать параметр &Дата. Запрос составили, параметр обозначили, теперь надо как то передать этот параметр в этот запрос. Тут и поможет это свойство. Мы идём в документ и для реквизита Товар таб. части Товары в свойстве "Связи параметров выбора" в окне слева выбираем доступное нам свойство Дата и переносим вправо, в колонке Имя указываем имя для этого реквизита такое какое указали в запросе. "Связи параметров выбора" - это мы делаем связь текущих реквизитов документа с открывающейся формой выбора, т.е можно передать парметр только из реквизитов текущего документа, а "Параметры выбора" это можно передать в форму выбора любой параметр, какой захотим.</li>
        <li><b>"Параметры выбора"</b> - свойство позволяет задать параметры, по которым будет произведён запрос в БД и нам в форме выбора выдаст результат этого запроса. Можно задавать для реквизита в форме, тогда будет только для этой формы, а можно задать для реквизита объекта конфы, тогда будет работать для всех форм. Например, в табличной части Товары в колонке Товар мы выбираем товар и нам откроется форма выбора со всей номенклатурой(Товары, Услуги и прочее). Мы хотим, чтобы открывался список только товаров без услуг и прочего. В конфе для этой колонки и задаём в свойстве "Параметры выбора" те параметры, по которым и будут отбираться только товары. Что это за параметры зависит от того как мы обозначали, что товар это товар, а услуга это услуга. Например, в справочнике Номенклатура мы добавили реквизит "ВидНоменклатуры", тип у этого реквизита ПеречислениеСсылка.ВидНоменклатуры, это значит что мы создали объект конфы Перечисления "ВидНоменклатуры" и задали ему 2 значения - Товар и Услуга. И когда мы создаём товар в справочнике то указываем в реквизите "ВидНоменклатуры" из списка перечисления товар это или услуга. В этом примере мы обозначили товары и услуги вот так. Теперь, какие парметры нужно задать в свойстве "Параметры выбора", чтобы в табличной части Товары выбирать только товары? Идём в конфу и для реквизита Товар табличной части Товары(в каком нибудь документе) в палитре свойств открываем "Параметры выбора", в окне добавляем новый параметр и выбираем Отбор.ВидНоменклатуры, в значении выбираем что это ПеречислениеСсылка.ВидНоменклатуры и затем выбираем значение Товар.
        <b>Другой пример</b>. Обозначим товары и услуги теперь по другому. Добавим в справочник Номенклатура реквизит Услуга и дадим ему тип булево, это значит, что этот реквизит будет отображаться в виде галочки. Заходим в пользовательский режим и заполняем товары и услуги и для каждого указываем галочкой услуга это или нет. Для товарв ничего не ставим, а для услуг ставим эту галочку. Вот так обозначили где товар, а где услуга. Теперь опять идём в конфу и для реквизита Товар табличной части Товары в ствойстве "Параметры выбора" открываем окно и добавляем параметр Отбор.Услуга, а в значении указываем тип булево и выбираем значение Ложь. Т.е. у нас будет открываться список только товаров. Если же нам для колонки Товар надо открывать только услуги, то в значении параметра выбираем значение Истина для Отбор.Услуга.
        Ещё один пример, у нас есть справочник Сотрудники, в нём 2 предопределенных группы с именами - Работающие и Уволенные. В документе ПродажаТоваров есть поле Сотрудник и мы хотели бы при открытии формы выбора сотрудников видет там только работающих из папки Работающие. Также в форме документа для реквизита Сотрудник жмём на свойство "Параметры выбора" и добавляем новый параметр - Отбор.Родитель и в значении выбираем тип СправочникСсылка.Сотрудники и выбираем значение Работающие(т.к. группа является тоже элементом справочника, поэтому и тип такой).
        Вывод. "Праметры вывода" это параметры для запроса в БД, по которым будет отбираться результ.</li>
        <li><b>"ВыборГруппИЭлементов"</b> - метка <b>как отобрать группу в форме выбора</b>. Например есть реквизит и у него тип СправочникСсылка.&lt;Имя справочника>, т.е. при выборе значения из этого реквизита открывается форма выбора элементов справочника. Я хочу выбрать именно группу, но система скажет, что нельзя выбрать группу, нужно выбрать элемент справочника. Так вот чтобы появилась возможность выбирать только группу есть свойство у реквизита - "ВыборГруппИЭлементов". Для этого свойства нужно выбрать значение "Групп". Всё то же самое можно сделать и через свойство "ПараметрыВыбора", где создаём новый элемент отбора вида - "Отбор.ЭтоГруппа" -> Истина.</li>
        <li><b>"Поведение"</b> - можно добавить в форму обычную группу(с отображением) и в неё поместить какие то поля, зададим этой группе заголовок. Всё, теперь мы видим заголовок этой группы и помещённые в неё поля, но можно сделать так, чтобы по клику на заголовок группы содержимое скрывалось или показывалось. Для этого нужно настроить свойство "Поведение" и выбрать значение "Свертываемая".</li>
        <li><b>"Использование"</b> - есть такое свойство у реквизитов объектов конфигурации, у реквизитов форм такого не видел. Допустим у нас есть иерархический справочник Номенклатура с реквизитом ВидНоменклатуры и мы хотим обработкой заполнить этот реквизит значениями Перечисления - Товар, Услуга, Материал. Мы в форме обработки запросом получаем все элементы справочника и пытаемся в поле ВидНоменклатуры вставить значение, но вылезает ошибка - "Реквизит не доступен для группы". Это значит что при получении элементов справочника из БД мы получили и группы, в реквизит которых пытаемся записать значение, но стоит защита от такой записи для групп. Свойство "Использование" как раз и позволяет указать для каких эзаписей справочника доступна запись в реквизит. По умолчанию стоит "Для элемента", т.е не для группы. Но можно выбрать и для групп, хотя где это требуется пока не знаю.</li>
        <li><b></b></li>
    </ul>










    <h3 class="header-style2" id="moduls">Для чего нужны модуль формы, объекта, менеджера</h3>
    <p><b>Модуль формы</b></p>
    <p>Модуль формы нужен для описания реакций на действия пользователя. Также модуль формы определяет поведение формы и действия, выполняемые из неё, например, открытие других форм.</p>
    <p><b>Модуль объекта</b></p>
    <p>Модуль объекта в платформе 1С предназначен для реализации поведения конкретного экземпляра объекта, такого как справочник, документ или регистр сведений. Что такое экземпляр объекта? Когда мы создали справочник "Номенклатура", то этот справочник является объектом конфигурации(метаданных), а когда мы заполняем товарами в 1С:Предприятии, то каждый товар это и есть экземпляр, хотя и объектом его тоже называют, модуль же объекта называется.</p>
    <p>В этом модуле размещаются процедуры и функции, которые работают с данными объекта(экземпляра), включая и данные, которые ещё не сохранены в базе данных.</p>
    <p>Благодаря модулю объекта разработчики могут определять поведение объекта в различных ситуациях, таких как ввод, изменение и удаление данных.</p>
    <p><b>Модуль менеджера</b></p>
    <p>Модуль менеджера в 1С предназначен для управления объектом как объектом конфигурации. С его помощью можно создавать объекты(экземпляры), работать с формами и макетами. Т.е. в этом модуле можно работать с созданным экземпляром от прототипа (Справочники, Документы и т.д.), например, тот же справочник "Номенклатура" и со всеми его подчинёнными объектами конфигурации (реквизиты, таб. части, формы, макеты, команды).</p>
    <p>Основная задача модуля менеджера — расширить функциональность менеджеров, предоставляемых системой, за счёт написания процедур и функций на встроенном языке. Это позволяет описать методы для объекта конфигурации, которые относятся не к конкретному экземпляру объекта базы данных, а к самому объекту конфигурации.</p>
    <p>Например, в модуле менеджера справочника «Контрагенты» можно описать экспортную функцию «ПолучитьСписокДебиторов()», и тогда в тексте программы к ней можно будет обратиться следующим образом: Дебиторы = Справочники.Контрагенты.ПолучитьСписокДебиторов().</p>
    <p></p>











    <div class="type-date">
        <h3 class="header-style2" id="type-date">Типы данных</h3>

        <p>1. <b>Простые типы</b>:  1)Строка - "", 2)Число - 2, 3)Дата - '19610412'(ггггммдд), 4)Логический тип(Булево) - Истина или Ложь(Выводит Да или Нет), 5)Неопределено - когда объявили переменную, но ничего туда пока не положили, 6)Тип - используется для того, чтобы хранить в себе описание типа данных. Обычно используется в условных операторах при сравнении с каким то типом, например: Если ТипЗнч(Номенклатура) = Тип("СправочникСсылка.Номенклатура") Тогда ... , 7)NULL - то же самое что и Неопределено, но только для БД используется в запросах. Обозначает что нет вообще ничего, пустота.</p>
        <p>Подробнее о <a href="#string">строках</a></p>
        <p>Подробнее о <a href="#num">числах</a></p>
        <p>Подробнее о <a href="#date">датах</a></p>

        <p class="title-size16"><b>Сложные типы данных</b>.</p>
        <ul class="list">
            <li><b>Универсальные коллекции.</b>Большое количество коллекций нужно для решения своих каких то задач. В синтакс помошнике можно посмотреть справку по всем этим коллекциям в разделе "Универсальные коллекции значений"</li>
            <li>Любая универсальная коллекция это набор данных, которые где-то хранятся в оперативной памяти в течении одного сеанса или в течении жизни процедуры. Не хранятся в базе. Функциональность коллекций определена разработчиком системы и мы не можем туда добавлять свою, но мы можем пользоваться готовой функциональностью для разработчик конфигураций.</li>
            <li>Каждая коллекция это объект со своими свойствами и методами. Создаются с помощью оператора "Новый"</li>
            <li><b><a href="#array">Массив</a></b></li>
            <li><b><a href="#fix-array">Фиксированный массив</a></b></li>
            <li><b><a href="#structure">Структура</a></b></li>
            <li><b><a href="#accordance">Соответствие</a></b></li>
            <li><b><a href="#list">Список значений</a></b></li>
            <li><b><a href="#table">Таблица зачений</a></b>
                <ul class="list2">
                    <li><a href="#table">О таблице</a></li>
                    <li><a href="#table-1">Создаём таблицу значений</a></li>
                    <li><a href="#table-2">Добавляем колонки таблицы</a></li>
                    <li><a href="#table-3">Выгружаем колонку в список значений</a></li>
                    <li><a href="#table-4">Добавляем/Вставляем элементы</a></li>
                    <li><a href="#table-5">Получение количества элементов</a></li>
                    <li><a href="#table-6">Поиск элемента/элементов</a></li>
                    <li><a href="#table-7">Создание копии таблицы значений</a></li>
                    <li><a href="#table-8">Выполняем сортировку</a></li>
                    <li><a href="#table-9">Получение итогов по числовой колонке</a></li>
                    <li><a href="#table-10">Свёртывание(группировка) элементов</a></li>
                    <li><a href="#table-11">Заполнение значениями колонки таблицы</a></li>
                    <li><a href="#table-12">Заполняем пустую ТЗ значениями из другой ТЗ</a></li>
                    <li><a href="#table-13">Обход в цикле элементов таблицы</a></li>
                    <li><a href="#table-14">Удаление элемента</a></li>
                    <li><a href="#table-15">Очистка ТЗ</a></li>
                    <li><a href="#table-16">Особенности работы с ТЗ. Особенность 1</a></li>
                    <li><a href="#table-17">Особенности работы с ТЗ. Передача ТЗ как параметра в запрос</a></li>
                    <li><a href="#table-18">Отображение виртуальной таблицы регистра накопления Остатки в таблице значений формы внешней обработки, документа или ещё чего.</a></li>
                </ul>
            </li>
            <li><b><a href="#tree">Дерево значений(ещё не описан)</a></b></li>
            <li><b><a href="#table-doc">Табличный документ(ещё не описан)</a></b></li>
        </ul>
    </div>







    <h3 class="header-style2" id="1a">Преобразование типов данных</h3>
    <p>Чтобы преобразовывать типы есть встроенные методы. Например преобразовать другой тип в строку - <b>Строка(23)</b> -> "23". Или другой способ: "12" + 23 -> "1223". Наоборот уже не стработает - 23 + "12" -> 35(если левый операнд число, то правый операнд будет преобразован в число). И так тоже будет преобразовано в число - Истина + "12" -> 13(Истина преобразовалась к 1)</p>
    <p>Остальные методы - Число(), Булево(), Дата().</p>







    <h3 class="header-style2" id="structure-module">Структура модуля</h3>
    <p>Тут Чистов объясняет эту тему начиная с 32 минуты(спецкурс 002) - https://www.youtube.com/watch?v=woEuN_YkfME&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=57</p>
    <p>Код в модуле интерпритируется с предварительной компиляцией. Что это значит? Это значит то, что до интерпритации кода(построчное считывание и выполнение кода, как скрипты) система проходит по коду и компилирует его. Как мы значем структура модуля следующая:</p>
    <img src="../img/1С-1/2023-08-10_09-20-08.png" class="screen" alt="">
    <p>Предварительная компиляция модуля происходит при первом обращении к модулю.</p>
    <p>Так что же такое предварительная компиляция? Система проходит по структуре модуля и создаёт таблицы. Когда она в области описания переменных, то она создаёт таблицу переменных, затем проходит по области описания процедур и функций и также создаёт таблицу процедур и функций. Если в этих областях есть объявленные переменные и процедуры, то система кроме того что создала таблицы, она сразу заносит в эти таблицы найденные переменные и процедуры.</p>
    <img src="../img/1С-1/2023-08-12_09-55-25.png" class="screen" alt="">
    <p>Для чего создаются таблицы при предварительной компиляции? Допустим прошла компиляция таблицы с переменными и процедурами созданы, начинается интерпритация кода, т.е. построчное чтение и выполнение. Мы доходим до процедуры и заходим в неё для выполнения, в внутри этой процедуры вызов другой процедуры, которая по коду ниже расположена, и благодаря предварительной компиляции интерпритатор будет знать из таблицы, что есть такая процедура и он переходит на выполнение этой другой процедуры. Короче, предварительная компиляция помогает интерпритатору находить части программы, если они разнесены по разным местам модуля.</p>
    <p>После того как таблицы созданы, интерпритатор начинает работу, можно сказать, с области описания инициализации переменных.</p>
    <p>Переменная, объявленная в области описания переменых через ключевое слово "Перем", видна во всём модуле, даже в процедурах и функциях, т.е. будет глобальной, она будет браться из таблицы переменных. Если же переменную объявить и сразу ей присвоить значение в области инициализации переменых, то такая переменная не видна в процедурах и функциях, чтобы процедуры увидели такую переменную, её нужно передать в неё как параметр.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="зелёный">//вот так процедура не увидит переменную А</span>
            <span class="светло_красный">Процедура</span> МояПроцедура<span class="светло_красный">()</span>
                Сообщить<span class="светло_красный">(</span>А<span class="светло_красный">);
            КонецПроцедуры</span>      

            А <span class="светло_красный">=</span> 13<span class="светло_красный">;</span> 

            МояПроцедура<span class="светло_красный">();</span>

            <span class="зелёный">//а вот так увидит</span>
            <span class="светло_красный">Перем</span> А<span class="светло_красный">;</span>

            <span class="светло_красный">Процедура</span> МояПроцедура<span class="светло_красный">()</span>
                Сообщить<span class="светло_красный">(</span>А<span class="светло_красный">);
            КонецПроцедуры</span>      

            А <span class="светло_красный">=</span> 13<span class="светло_красный">;</span> 

            МояПроцедура<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p>Бывает такое, что в модуле будет пусто, а логика какя то отрабатывает. Это значит заранее модуль скомпилирован и находится в таком состоянии, а код, понятный человеку удалён.</p>



    




    <h3 class="header-style2" id="2">Операции сравнения</h3>
    <p>1. Равно - =, Не равно - &lt;>, Больше - >, Меньше - &lt;, Больше или равно - >=, Меньше или равно - &lt;=</p>
    <p>2. Операции сравнения со знаками > или &lt; можно производить только с одинаковыми примитивными типами. Например, нельзя сравнивать строку и число, число и дату и т.д.</p>





    <h3 class="header-style2" id="3">Функция Формат</h3>
    <p>Чтобы посмотреть в справке про разные сокращения форматной строки то открываем Справка - Поиск по справке, откроется окно поиска и там пишем "форматная строка", находим открываем и там будут обозначения формата.</p>
    <p>Часто приходится выводить(в те же отчёты) значения различных типов(строки, даты, числа, ...). У каждого из этих значений есть различные отображения. Например, одну и ту же дату('01.01.2005') можно представить в виде строки - "01.01.2005", "1 января 2005", "01.01.05". Всё это строки отображения одного и того же значения, для формировния которых используется функция <b>Формат()</b>. Что эта функция может:</p>
    <ul class="list">
        <li><b>Отключаем группировку разрядов</b> - нам нужно вывести число 10000, пишем Сообщить(10000); выводит 10 000. Так получилось, потому что 1С по умолчанию группирует по 3 цифры начиная справа и разделяет их пробелом. Чтобы отменить это правило напишем Сообщить(Формат(10000, "ЧГ=0")); выыведет 10000</li>
        <li><b>Выводим лидирующие нули</b> - часто нужно выводить лидирующие нули перед цифрой. Например, выведем лидирующий ноль перед цифрой 5 - в виде "05". пишем Сообщить(Формат(5, "ЧЦ=2; ЧВН=")); получим "05". Сообщить(Формат(5, "ЧЦ=3; ЧВН=")); получим "005". Более подробно описано в справке или тут на сайте - https://helpme1s.ru/vnutrennij-yazyk-programmirovaniya-1s-8-3-dlya-nachinayushhix-programmistov-urok-19-format-v-1s</li>
        <li><b>Меняем разделитель целой и дробной части</b> - выведем дробное число со звёздочкой вместо точки. Сообщить(Формат(100.38, "ЧРД=*")); получим 100*38</li>
        <li><b>Задаём разделитель групп</b>
            <ul class="list">
                <li>Формат(1000000, "ЧРГ=*");// 10*000*000</li>
            </ul>  
        </li>
        <li><b>Общее представлении даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДЛФ=Д");// <ins>01.01.2005</ins>.</li>
                <li>Формат('20050101', "ДЛФ=ДД");// <ins>1 января 2005</ins>.</li>
                <li>Покажем время - Формат('20050101', "ДЛФ=В");// <ins>20:01:03</ins>.</li>
                <li>Показ даты с временем - Формат('20050101', "ДЛФ=ДДВ");// <ins>1 января 2005 20:01:03</ins>.</li>
                <li>Показ даты с временем - Формат('20050101', "ДЛФ=ДВ");// <ins>01.01.2005 20:01:03</ins></li>
            </ul> 
        </li>
        <li><b>Отображение часа даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=ч");// 8</li>
                <li>Формат('20050101', "ДФ=чч");// 08</li>
                <li>Формат('20050101', "ДФ=Ч");// 20</li>
                <li>Формат('20050101', "ДФ=ЧЧ");// 20</li>
            </ul>
        </li>
        <li><b>Отображение минуты даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=м");// 1</li>
                <li>Формат('20050101', "ДФ=мм");// 01</li>
            </ul>
        </li>
        <li><b>Отображение секунды даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=с");// 3</li>
                <li>Формат('20050101', "ДФ=сс");// 03</li>
            </ul>
        </li>
        <li><b>Отображение дня недели даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=д");// 1</li>
                <li>Формат('20050101', "ДФ=дд");// 01</li>
                <li>Формат('20050101', "ДФ=ддд");// Сб</li>
                <li>Формат('20050101', "ДФ=дддд");// Суббота</li>
            </ul>
        </li>
        <li><b>Отображение месяца даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=М");// 1</li>
                <li>Формат('20050101', "ДФ=ММ");// 01</li>
                <li>Формат('20050101', "ДФ=МММ");// янв.</li>
                <li>Формат('20050101', "ДФ=ММММ");// Январь</li>
            </ul>
        </li>
        <li><b>Отображение года даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=г");// 5</li>
                <li>Формат('20050101', "ДФ=гг");// 05</li>
                <li>Формат('20050101', "ДФ=гггг");// 2005</li>
            </ul>
        </li>
        <li><b>Отображение квартала от года из даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=к");// 1</li>
            </ul>
        </li>
        <li><b>Округление дробной части через Формат()</b>
            <ul class="list">
                <li>Формат(125.368, "ЧДЦ=2"); // 125.37</li>
                <li>Формат(125.368, "ЧДЦ=1");// 125.4</li>
            </ul>
        </li>
        <li><b>Двигаем разряды числа</b>
            <ul class="list">
                <li>Формат(2, "ЧС=1");// 0.2</li>
                <li>Формат(2, "ЧС=-2");// 200</li>
            </ul>
        </li>
        <li><b>Задаём нулевое представление числа 0</b>
            <ul class="list">
                <li>Формат(0, "ЧН=ноль");// ноль</li>
            </ul>
        </li>
        <li><b>Задаём отображение булевого значения</b>
            <ul class="list">
                <li>Формат(Истина, "БЛ=""врёшь""");// врёшь</li>
                <li>Формат(Ложь, "БЛ=""правду говоришь""");// правду говоришь</li>
            </ul>
        </li>
    </ul>
    <div class="code-style">
        <pre>
            //примеры
            Пример1 = Формат(250.99, "ЧРД==");
            Сообщить(Пример1);//250=99

            Пример2 = Формат(5000, "ЧГ=0");
            Сообщить(Пример2);// 5000

            Пример3 = Формат(235325, "ЧРГ=*");
            Сообщить(Пример3);// 235*325

            Пример4 = Формат(3, "ЧЦ=2; ЧВН=");
            Сообщить(Пример4);// 03

            Пример5 = Формат(0, "ЧН=ноль");
            Сообщить(Пример5);// ноль

            Пример6 = Формат(1, "ЧС=3");
            Сообщить(Пример6);// 0,001

            Пример7 = Формат(10.567, "ЧДЦ=2");
            Сообщить(Пример7);// 10.57

            ПрописьЧисла1 = ЧислоПрописью(9999);
            Сообщить(ПрописьЧисла1);// девять тысяч девятсот девяносто девять 00

            ПрописьЧисла2 = ЧислоПрописью(25.99, ,"рубль,рубля,рублей,м,копейка,копейки,копеек,ж,2");
            Сообщить(ПрописьЧисла2);// двадцать пать рублей 99 копеек


            Квартал = Формат('20140101', "ДФ=к");
            Квартал = Строка(Квартал) + " квартал";
            Год = Формат('20140101', "ДФ=гггг");
            Итог = Квартал + " " + Год;
            Сообщить(Итог); // 1 квартал 2014
                    //или 2 способ
            ПК = ПредставлениеПериода(НачалоКвартала('20140101'),КонецКвартала('20140101'),"ФП=Истина");
            Сообщить(Пк);// 1 квартал 2014г.
            
            
            Пример8 = Формат('20140101', "ДЛФ=ДД");
            Сообщить(Пример8);// 1 января 2014г.

            Пример9 = Формат('20140101', "ДФ=дддд");
            Сообщить(Пример9);// среда

            Пример10 = Формат('20140101', "ДФ=ддд");
            Сообщить(Пример10);// Ср

            Пример11 = Формат('20140101', "ДФ=ММММ");
            Сообщить(Пример11);// Январь

            Пример12 = Формат('20140101', "ДФ=МММ");
            Сообщить(Пример12);// янв.

            Пример13 = Формат('20140101', "ДЛФ=Д");
            Сообщить(Пример13);// 01.01.2014

        </pre>
    </div>
    <div class="code-style">
        <pre>
            ДФ - Дата Формат 
            ДЛФ - Дата Локальный Формат


            ДФ = dd.MM.yyyy    ИЛИ  ДФ = дд.ММ.гггг   ->  15.05.2024
            ДЛФ = D            ИЛИ  ДЛФ = Д           ->  15.05.2024

            ДФ = dd.MM.yy      ИЛИ  ДФ = дд.ММ.гг     ->  15.05.24
            ДФ = d.M.yy        ИЛИ  ДФ = д.М.гг       ->  15.5.24
            ДФ = dd/MM/yy      ИЛИ  ДФ = дд/ММ/гг     ->  15/05/24
            ДФ = yyyy-MM-dd    ИЛИ  ДФ = гггг-ММ-дд   ->  2024-05-15
            ДФ = MMMM.yyyy     ИЛИ  ДФ = ММММ.гггг    ->  Май. 2024

            ДЛФ = DD           ИЛИ  ДЛФ = ДД          ->  15 мая 2024 г.
            ДЛФ = DT           ИЛИ                    ->  15.05.2024 19:19:40
            ДЛФ = DDT          ИЛИ                    ->  15 мая 2024 г. 19:19:40
            ДЛФ = T            ИЛИ                    ->  19:19:40
        </pre>
    </div>














    <h3 class="header-style2" id="4">Часто используемые методы Глобального контекста</h3>
    <p>. <span class="светло_синий"><b>ВвестиЧисло(ЧислоА = 0)</b></span> - метод просит ввести число, предварительно укажем переменную по умолчанию в этом методе - ЧислоА. Когда пользователь вводит число, то это число сохраняется в этой переменной и дальше мы можем использовать эту переменную в вычислениях.</p>
    <p>. <span class="светло_синий"><b>ВвестиCтроку(Строка = "")</b></span> - тоже самое только строку вводим</p>
    <p>. <span class="светло_синий"><b>ВвестиCтрокуАсинх(Строка = "")</b></span></p>
    <p>. <span class="светло_синий"><b>ВвестиДату(Дата = '19610412')</b></span> - тоже самое</p>
    <p>. <span class="светло_синий"><b>ОткрытьЗначение(...)</b></span> - показывает в диалоге переданное значение. Вид диалога зависит от типа переданного значения. Например можно вывести массив в виде списка в окне.</p>
    <p>. <span class="светло_синий"><b>Сообщить(...)</b></span> - метод при запуске программы выводит сообщение в него переданное.</p>
    <p>. <span class="светло_синий"><b>ТипЗнч(Переменная)</b></span> - метод покажет какой тип данных лежит в переменной(вывод такой - Строка, Число, Дата). Например, там лежит тип данных Число и если ещё раз посмотреть тип данных самого вывода Число, то тип данных будет Тип. Например в JS все типы данных выводятся в типе данных строка, а здесь в типе данных Тип.</p>
    <p>. <span class="светло_синий"><b>Тип("Строка")</b></span> - с результатом этого метода сравнивают типы данных. Например, нам неизвестен тип данных находящийся в переменной ТруЛяЛя, а там лежит строка "красный", тода мы в условии сравниваем:</p>
    <div class="code-style">
        <pre>
            ТруЛяЛя = "красный";
            Если ТипЗнч(ТруЛяЛя) = Тип("Строка") Тогда
                Сообщить("Тип данных в переменной ТруЛяЛя является трокой");
            КонецЕсли;
            //условие сработает и вывод будет виден на экране

            //сравнения такое не сработает
            ТруЛяЛя = "красный";
            Если ТипЗнч(ТруЛяЛя) = "Строка" Тогда
                Сообщить("Тип данных в переменной ТруЛяЛя является трокой");
            КонецЕсли;
            //это условие не сработает, так не сравнивают

            //тоже самое из js
            let someVar = 'красный';
            if(typeof someVar == 'строка'){
                console.log("Тип данных в переменной ТруЛяЛя является трокой")
            }
        </pre>
    </div>
    <p>. <span class="светло_синий"><b>ПоказатьОповещениеПользователя(Текст)</b></span> - методу передаём сообщение и он его показывает во всплывающем окне справа внизу угла экрана.</p>
    <p>. <span class="светло_синий"><b>ЗаполнитьЗначениеСвойств(&lt;Приемник>, &lt;Источник>, &lt;СписокСвойств>, &lt;ИсключаяСвойства>)</b></span> - 1й и 2й параметр обязательны. Будут заполнены свойства примемника одноимёнными свойствами источника. У приемника и источника тип произвольный.</p>
    <p>. <span class="светло_синий"><b>УстановитьКраткийЗаголовокПриложения("Мой заголовок");</b></span> - устанавливает указанный текст в заголовок всего прикладного решения. Можно указать этот метод в модуле приложения в обработчике события "ПриНачалеРаботыСистемы".</p>
    <p>. <span class="светло_синий"><b>СтрШаблон(&lt;Шаблон>, &lt;Значение1-Значение10>);</b></span> - параметр "Шаблон" обязателен, тип строка. Строка содержит пометки вида %1, %2, %3 до %10. После этого параметра идут параметры-значения по порядку, которые соответствуют пометкам в строке, т.е. если параметр-значение идёт после праметра "Шаблон", то это считается первый параметр-значение по счёту и он соответствует пометке %1, в примере параметр "лесу" это первый параметр-значение и он вставится вместо пометки %1 и т.д. Если что остальное смотреть в справке. Например:
    <div class="code-style">
        <pre>
            <span class="светло_синий">ПолученнаяСтрока <span class="светло_красный">=</span> СтрШаблон<span class="светло_красный">(</span><span class="серый">"Мы были в %1 %2го числа во %3"</span><span class="светло_красный">,</span> <span class="серый">"лесу"</span><span class="светло_красный">,</span> 8<span class="светло_красный">,</span> <span class="серый">"вторник"</span><span class="светло_красный">);</span>
            Сообщить<span class="светло_красный">(</span>ПолученнаяСтрока<span class="светло_красный">);</span> -> <span class="серый">"Мы были в лесу 8го числа во вторник"</span></span>
        </pre>
    </div>
    </p>
    <p>. <span class="светло_синий"><b>РеквизитФормыВЗначение(Строка);</b></span> - обязательно описать</p>
    <p>. <span class="светло_синий"><b>ЗначениеВРеквизитФормы(Объект, Строка);</b></span> - обязательно описать</p>
    <p>. <span class="светло_синий"><b>ПредопределенноеЗначение();</b></span> - обязательно описать</p>
    <p>. <span class="светло_синий"><b>ЗначениеЗаполнено();</b></span> - проверяет, заполнено ли значение.</p>
    <p>. <span class="светло_синий"><b>ПустаяСТрока(строка);</b></span> - проверяет строку на наличие в ней значащих символои(пробелы, табуляции и пр.) и символов. Если ничего в строке нет, вернётся Истина, иначе Ложь.</p>
    <p>. <span class="светло_синий"><b>ЧислоПрописью();</b></span> - </p>
    <p>. <span class="светло_синий"><b>ЗаполнитьЗначенияСвойств(приёмник, источник);</b></span> - по соответсвию колонок из источника заполняются поля в приёмнике. Например:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "..."

            <span class="светло_синий"> <span class="зелёный">//ДанныеЗаполнения.Товары это таб. часть из другого документа
            //Товары это таб. часть документа, в модуле которого мы находимся</span>
            <span class="светло_синий"><span class="светло_красный">Для каждого</span> СтрокаТабЧасти <span class="светло_красный">Из</span> ДанныеЗаполнения<span class="светло_красный">.</span>Товары <span class="светло_красный">Цикл</span>
                НоваяСтрока <span class="светло_красный">=</span> Товары<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                ЗаполнитьЗначенияСвойств<span class="светло_красный">(</span>НоваяСтрока<span class="светло_красный">,</span>СтрокаТабЧасти<span class="светло_красный">);
            КонецЦикла;</span></span></span>

            Также можно заполнить движение значениями из таблицы значений или
            движения из другого движения
        </pre>
    </div>
    <p>. <span class="светло_синий"><b>Символы.ПС;</b></span> - объект, содержащий разные отступы. ПС это перенос строки</p>
    <p>. <span class="светло_синий"><b>ПодключитьОбработчикОжидания(&lt;ИмяПроцедуры>, &lt;Интервал>, &lt;Однократно>)</b></span> - подобие функции SetTimeout() в JS. Статья про эти процедуры - https://life1c.ru/post/2115</p>
    <p>. <span class="светло_синий"><b>ОтключитьОбработчикОжидания(&lt;ИмяПроцедуры>) </b></span> – Отключает вызов процедуры, которая была подключена ранее с помощью ПодключитьОбработчикОжидания. Подобие ClearSetTimeout() в JS.</p>
    <p><b>Файлы</b></p>
    <p>. <span class="светло_синий"><b>НайтиФайлы(&lt;Путь>, &lt;Маска>, &lt;ИскатьВПодкаталогах>)</b></span> – осуществляет поиск файлов и каталогов по заданной маске, расположенных в заданном каталоге. 2й и 3й параметры не обязательны, но если не указать маску, то метод не вернёт массив файлов в указанной папке, он вернёт массив из одного файла самой папки. Так что если указываем папку, из которой нужно вернуть массив всех файлов, маску нужно указать, например - ".txt".</p>
    <p>. <span class="светло_синий"><b>КаталогВРеменныхФайлов()</b></span> – возвращает путь до временной папки на компьюторе в виде строки, например, "C:\Users\Professional\AppData\Local\Temp".</p>
    <p>. <span class="светло_синий"><b>СоздатьКаталог(Путь)</b></span> – метод создаёт папку по указанному пути, в пути создаваемая папка указывается.</p>
    <p>. <span class="светло_синий"><b>ОбработкаПрерыванияПользователя();</b></span> – предназначен для прерывания работы встроенного языка при нажатии пользователем клавиши Ctrl+Break.</p>
    <p>. <span class="светло_синий"><b>ОповеститьОбИзменении(Ссылка)</b></span> – уведомляет динамические списки на клиенте об изменении одного объекта базы данных или одной записи регистра.</p>


    <p>Вот ссылка на статью того же автора про работу со строками. Очень подробно всё показано. ОБРАТИТЬ ВНИМАНИЕ!!! - https://1c.alexcode.ru/stroki-v-1s-primery/</p>


    














    <h3 class="header-style2" id="4b">Проверка даты, строки, числа, реквизита с ссылочным типом на пустоту</h3>
    <p>Не забываем что в свойствах реквизитов в форме есть такой параметр как "Проверка заполнения", где можно указать выделять ли поле красным цветом если поле не заполнено.</p>

    <p class="title-size16"><b>Проверка даты</b></p>. <p>Бывает нужно проверить ввёл ли пользователь дату или нет. Для этого надо проверить поле с датой на пустоту. Если в поле Дата не ввести ничего, то система автоматом вставит туда дату '00010101 0:00:00' и в коде нужно проверять на сравнение с этой датой, если равно этой дате, то пользователь ничего не ввёл.</p>
    <p>Другой способ это через функцию глобального контекста <span class="светло_синий"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>.</p>

    <p class="title-size16"><b>Проверка строки</b>.</p> <p>Бывает мы хотим узнать пустая ли строка, например, ввёл ли пользователь в поле ввода что то, а вдруг он ввёл несколько пробелов и всё это пустая строка или нет? Для нас да это пустая строка, но тогда проверка ПолеВвода = "" не даст истину, потому что строка содержит пробелы и уже не считается пустой строкой. Для этого существует метод <span class="светло_синий"><b>Пустая строка(&lt;Значение>)</b></span>, он проверяет значение на наличие пробелов и табуляций и если кроме них ничего больше в строке нет, то он вернёт истину(строка пустая). Ну и собственно если строка равна "", то также вернёт истину. Как я понял то же самое для строки сделает и функция <span class="светло_синий"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>. ЗначениеЗаполнено() более всеобемлюющий метод, который проверяет на пустоту разные типы, а ПустаСтрока() конкретно для строки и соотвественно ПустаяСтрока() работает быстрее для строки.</p>

     <p class="title-size16"><b>Проверка числа</b>.</p> <p>Сравниваем с 0 или можно использовать функцию <span class="светло_синий"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>.</p>

     <p class="title-size16"><b>Проверка документа</b>.</p> <p>Есть поле "Документ" с типом ДокументСсылка.ИмяДокумента. Проверяем выбран ли в поле какой-то документ. Есть такая функция как <span class="светло_синий"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>, передадим в неё значение поля "Документ". Она проверяет отличается ли значение от значения по умолчанию того же типа, если нет, значит не заполнено. Значением по умолчанию для поля "Документ" будет пустая ссылка.</p>
     <p>Либо документ можно проверить используя метод менеджера - ПустаяСсылка():</p>
    <div class="code-style">
        <pre>
            Если Документ = Документы.ПриходнаяНакладная.ПустаяСсылка() Тогда
                ...
            КонецЕсли;
        </pre>
    </div>










    <h3 class="header-style2" id="pvh">План видов характеристик</h3>
    <p><span class="светло_красный">Пишу это уже после того как всё записал. Я был немного не прав в определениях и названиях объектов. Я думал что значения в плане видов характеристик это есть сами характеристики, т.е. думал что "цвет" это характеристика, "размер куртки" это характеристика, но это не совсем так. Это всё ВИДЫ характеристик. И не важно как мы назовёт план видов характеристик, значения в нём будут видами характеристик. "Цвет" это вид характеристики, "размер куртки", "размер штанов" это тоже виды характеристик.</span></p>
    <p><span class="светло_красный">А что же тогда характеристика? Это как раз то описание для какого-нибудь объекта. В нашем случае это описание товара. Например, "Размер куртки 48, цвет Белый" - вот эта строка и есть ХАРАКТЕРИСТИКА, а отдельные её составляющие, на которые мы разложим строку - "цвет", "размер" мы заносим в план видов характеритсик и они становятся видами характеристики. Поэтому когда буду читать ниже нужно сомтреть на это вот так как описал тут в красном абзаце. У меня ниже характеристики я назвал описание товара, а виды характеристик назвал характеристиками. Просто переделывать неохота. Вот немного картика описывающая обстановку:</span></p>
    <img src="../img/1С-ПВХ/2025-01-06_19-51-07.png" class="screen" alt="">
    <p>Здесь постараюсь коротко описать план видов характеристик, как я понял этот механизм.</p>
    <p>Частенько бывает нужно пользователю возможность своими словами описать характеристики товара. Например, есть справочник Товары и для каждого товара пользователь хочет описать его размер, цвет и т.д. Тут нет ничего сложного, добавляем дополнительный реквизит и в нём описываем товар, но этого мало. Нужно ещё иметь возможность анализировать товары, отбирать товары по характеристикам, а для этого нужно чтобы система понимала, что написано в описании товара. Для этого и пригодится такой объект конфигурации как "План видов характеристик".</p>
    <p>Сразу оговорюсь, что я даю свои названия справочникам, плану видов характеристик и остальным объектам конфигурации так как мне понятно.</p>
    <p>Итак, у нас есть справочник Товары, заполним пару товаров:</p>
    <img src="../img/1С-ПВХ/2025-01-04_19-35-41.png" class="screen-2" alt="">
    <p>Теперь нужно как то описать характеристики для каждого товара, ну чтобы была возможность пользователю написать строкой, что товар имеет размер такой то, цвет такой то. Можно было бы добавить доп. реквизит с типом строка и в нём описывать для каждого товара, но нас это не устраивает. Мы создадим ещё один справочник и назовём его "ОписаниеТоваров" и подчиним его справочнику "Товары", чтобы в каждом товаре появилась гиперссылка на справочник "ОписаниеТоваров". Перейдём в пользовательский режим и откроем созданный ранее товар, перейдём по гиперссылке в справочник "ОписаниеТоваров" и заполним описание для товара:</p>
    <img src="../img/1С-ПВХ/2025-01-04_19-46-21.png" class="screen" alt="">
    <p>Зададим пару описаний для куртки: "Размер 48, цвет Чёрный" и "Размер 50, цвет Белый". И пару описаний для штанов: "Размер L, цвет Серый" и "Размер M, цвет Синий". У нас есть описания товаров, сделанные пользователем, теперь создадим план видов характеристик и назовём его "ХарактеристикиТоваров". План видов характеристик это тот же справочник, только у него есть дополнительное поле "ТипРеквизита". Теперь пользователю виден этот план и он может в нём создать любую характеристику и указать для неё тип данных. А вот чтобы пользователь мог задать любой тип данных, нам нужно в конфигураторе предусмотреть все эти типы при создании плана. Откроем план в конфе и в окне выберем 4 простых типа данных:</p>
    <img src="../img/1С-ПВХ/2025-01-04_20-00-25.png" class="screen-2" alt="">
    <p>Сразу скажу, что этих 4 простых типов мало. Но представим, что пока только эти. Зайдём в предприятие и заполним в плане нахи характеристики. Из описания товаров мы видим только 2 характеристики: размер и цвет. Вот и внесём их в план. Первым пишем - Размер, в поле "Тип значения" будут сразу все 4 типа, которые мы указали, выберем тип Число, т.к. размеры для куртки это число, там же при выборе числа снизу можно указать длину числа. Точность будет недоступна, но это решается заходом в конфу и указываем в плане для типа числа Точность. И когда мы вернёмся в предприятие и выберем число, Точность уже будет доступна для изменения.</p>
    <p>Затем нам нужно вписать ещё раз характеристику Размер, но уже с другим типом, как мы помним у штанов размер указывался буквами. Какой тип выбрать тут? Ну вроде очевидно, что это будет строка. И вот тут нужно подумать. В будущем мы будем для каждой характеристики указывать значения, и что, мы будем каждый раз от руки писать значения? "L", "Белый", "Чёрный"? А если зделаем опечатку в слове? так не пойдёт. Такие значения нужно выбирать из списка. А что обычно делается в 1С, когда нужен список чего-то завести, правильно, надо создать справочник, который будет содержать все значения для разных характеристик. А чтобы мы могли отличать какие значения каким характеристикам принадлежат, мы подчиним этот справочник плану видов характеристик и в справочнике появится реквизит "Владелец", в котором будет видно характеристику, которой принадлежит значение. Назовём такой справочник "ЗначенияХарактеристикТоваров" и для плана добавим этот справочник 5м типом значения:</p>
    <img src="../img/1С-ПВХ/2025-01-04_20-36-39.png" class="screen" alt="">
    <p>Также укажем в свойстве плана "Дополнительные значения характеристик" этот справочник. Для чего это нужно пока не разобрался.</p>
    <p>Опять перейдём в предприятие и укажем все наши характеристики и зададим для них типы значений. Даже характеристике с типом Число тоже советуют задавать типом значения созданный нами справочник, но оставим числовым для примера:</p>
    <img src="../img/1С-ПВХ/2025-01-04_20-45-46.png" class="screen" alt="">
    <p>Теперь заполним справочник "ЗначенияХарактеристикТоваров" значениями, которые у нас указаны в описании товаров и укажем соответствующего владельца, т.е. характеристику:</p>
    <img src="../img/1С-ПВХ/2025-01-04_21-02-13.png" class="screen-2" alt="">
    <p>Дальше нужно как-то объяснить системе, что описание товара - "Размер 48, цвет Чёрный" соответствует характеристикам и значениям: Цвет - Чёрный и Размер - 48. Для этого нам нужна таблица, в которой мы сможем сопоставить описание товаров с характеристиками и их значениями. Можно сделать такую таблицу 2мя способами: через табличную часть и через регистр сведений. Мы будем делать через регистр сведений.</p>
    <p>Создадим регистр сведений и назовём его "СоответствияХарактеристикОписаниямТоваров"(ну вот так захотелось его назвать, чтобы было понятно), а то у Леонтьева слишком запутанные названия, похожие друг на друга и легко спутать, кто какой объект метаданных. Создадим 2 измерения: "ОписаниеТоваров" и "Характеристика". У первого тип данных это СправочникСсылка.ОписаниеТоваров, а у второго ПланВидовХарактеристикСсылка.ХарактеристикиТоваров. Также создадим один ресурс - "ЗначенияХарактеристик", тут тип данных нужно задать такой же как и для всех значений в плане, т.е. это 4 простых типа данных и СправочникСсылка.ЗначенияХарактеристикТоваров, но это у нас простой случай, в жизни же там гораздо больше типов и вот чтобы каждый тип не заполнять вручную система за нас уже побеспокоилась и собрала их в одном месте, выберем его:</p>
    <img src="../img/1С-ПВХ/2025-01-05_12-09-46.png" class="screen" alt="">
    <p>Все созданные объекты конфигурации (регистр сведений, справочники, план) видны пользователю, их нужно убрать, чтобы его не запутать. А как же тогда он будет их заполнять? Та просто, у нас появились гиперссылки внутри наших объектов и по ним будем проваливаться начиная с карточки товара. В предприятии зайдём в каждый товар и провалимся аж до регистра сведений, где нам нужно для каждого описания сопоставить нужную характеристику и значение, сделаем это. Открываем карточку товара, по ссылке проваливаемся в справочник с описанием товара. В этом справочнике будет гиперссылка на регистр сведений с соответсвиями, эта ссылка тут появилась, потому что мы поставили для измерений галочку "Ведущее". Проваливаемся в регистр и открываем заполнение записи регистра. В карточке записи поле описания товара будет уже заполнено, потому что мы перешли сюда из неё, осталось заполнить характеристику и её значение для этого описания. Выбираем характеристику и переходим к значению, но не видим тут справа от поля стрелочки вниз, которая указывает на то, что можно выбрать из списка какое то значение, вместо неё три точки, это значит что для начала нужно выбрать тип данных для значения и только потом выбрать само значение:</p>
    <img src="../img/1С-ПВХ/2025-01-05_12-24-58.png" class="screen" alt="">
    <p>Мы можем указать системе какой тип значений уже должен быть выбран после выбора характеристики. В конфе в регистре сведений для ресурса "ЗначениеХарактеристики" есть свойство "Связь по типу", которое позволяет указать реквизит от которого система будет брать тип данных и ставить в наш реквизит ресурс. Т.е. выбрали мы характеристику "Размер куртки", а тип данных у этой характеристики "Число", система возмём этот тип данных и присвоит нашему ресурсу такой же тип данных.</p>
    <p>Далее, когда поле "ЗначениеХарактеристики" будет само принимать тип данных как и у харакетристики, у нас при выборе характеристики теперь появится стрелочка вниз у поля "ЗначенияХарактеристик" ну или не появится при числовом типе. И по этой стрелочке уже будет открывать список доступных значений или можно открыть форму выбора значений, но значения будут в форме все что есть, нам же опять такое не подходит, желательно выдавать значения для конкретной характеристики. Мы уже значем как это делается. Идём в конфу опять открываем палитру свойств ресурса "ЗначениеХарактеристики" в регистре сведений и в свойстве "Связи параметров выбора" укажем реквизит, по которому мы хотим получит какой то отбор. Этим реквизитом будет измерение "Характеристика", выбираем его вправо и система сама определит, что нужно сделать отбор по владельцу, нас это устраивает. Теперь при выборе характеристики в поле "ЗначениеХарактеристики" нам будут доступны значения только для этой характеристики:</p>
    <img src="../img/1С-ПВХ/2025-01-06_08-48-18.png" class="screen" alt="">
    <p>У нас почти всё готово, чтобы в отчёте мы могли делать отборы по характеристикам. Создадим отчёт "ОстаткиТоваров", создадим схему, выберем набор данных - Запрос. Данные будем брать из вирт. таблицы Остатки регистра накопления "ОстаткиТоваров", выбираем все 3 поля. Далее всё по простому, в настройках выбираем показ детальных записей, выбираем все поля. Запустим отчёт и получился вот такой:</p>
    <img src="../img/1С-ПВХ/2025-01-06_09-37-34.png" class="screen" alt="">
    <p>И мы теперь хотим сделать отбор по товарам с чёрным цветом, откроем настройки по кнопке "Настройки..." и видим пустое окно, это потому что мы никаких отборов пользователю не выводили. В конфе на закладке "Настройки" и настроим так:</p>
    <img src="../img/1С-ПВХ/2025-01-06_09-41-36.png" class="screen" alt="">
    <p>Теперь у пользователя есть возможность настраивать отбор. Также открываем окно по кнопке "Настройки..." и видим возможность отбора, но как выбрать отбор по чёрному цвету:</p>
    <img src="../img/1С-ПВХ/2025-01-06_09-48-13.png" class="screen" alt="">
    <p>Мы видим, что в поле "Описание товара" нет ничего такого чтобы можно было указать цвет чёрный. Нужно сделать ещё одну настройку в конфе. Находим справочник "ОписаниеТоваров", откроем окно редактирования этого объекта и на вкладке "Данные" внизу справа увидим кнопку "Характеристики", жмём её. Откроется окно, слева нужно для нашего справоника указать где находятся виды характеристик, а справа где находятся значения характеристик. Виды характеристик у нас хранятся в плане видов характеристик, а значения хранятся в регистре сведений "СоответствияХарактеристикОписаниямТоваров". Вот так заполняем это окно:</p>
    <img src="../img/1С-ПВХ/2025-01-06_09-56-28.png" class="screen" alt="">
    <p>Единственное, нам нужно заполнить это поле значения справа, потому что оно всегда пустое, выбираем ресурс регистра сведений нём. Всё закрываем, идём в предприятие, открывает отчёт, открываем настройки и теперь поле "Описание товаров" содержит наши 3 характеристики, по которым мы теперь можем делать отбор:</p>
    <img src="../img/1С-ПВХ/2025-01-06_10-46-37.png" class="screen" alt="">
    <p>Как я понял такие характеристики мы увидим только в пользовательском режиме, в режиме конфигуратора в поле "Описание товаров" нет никаких характеристик.</p>














    <h3 class="header-style2" id="interactiv">Процедуры и функции для взаимодействия с пользователем</h3>
    <p>В синтакс помошнике про эти функции описано по пути Глобальный контекст -> Процедуры и функции для интерактивной работы. Если процедуры и функции взаимодействия с пользователем лежат в глобаном подтексте, это значит они доступны во всех модулях, наверно). Для тренировки я описываю их в форме обработки. Начнём.</p>
    <p id="interactiv-1"><b>1. Как показать пользователю текстовое сообщение.</b></p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//способ 1</span>
            Сообщить(&ltТекстСообщения> Обяз.,&ltСтатус>Необяз.)
            Статус это системное перечисление, обратиться мы можем к нему так - СтатусСообщения.Важное
            Через точку можно выбрать статус. Статусы видны в обычном приложении, а в управляемом указывать
            их особого смысла нет.
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span><span class="серый">"Текст сообщения"</span>, СтатусСообщения.ОченьВажное<span class="светло_красный">);</span></span>

            <span class="зелёный">//способ 2(рекомендуется использовать вместо метода Сообщить)</span>
            Можно написать в коде "сообщ" и нажать Ввод и развернётся шаблон объекта.
            В чём разница между методом Сообшить() и объектом Сообшить? Объект Сообшить позволяет привязать
            какое то сообщение к конкретному элементу формы. Например, создадим в форме реквизит "Результат"
            и расположим его в элементах. У объекта есть свойство Поле, в котором нужно указать путь к
            реквизиту формы в виде строки. Понятно, что надо объект Сообшить создавать в подтексте этой формы.
            Как видно на картинке у элемента формы "Результат" появляется отдельное окошко с сообщением.
            С помощью такого механизма можно пользователю указать, что нужно заполнить именно это поле.
            <span class="светло_синий">Сообщение <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span></span>
            <span class="светло_синий">Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Постание для поля Результат"</span><span class="светло_красный">;</span></span>
            <span class="светло_синий">Сообщение<span class="светло_красный">.</span>Поле <span class="светло_красный">=</span> <span class="серый">"Результат"</span><span class="светло_красный">;</span>
            Сообщение<span class="светло_красный">.</span>УстановитьДанные<span class="светло_красный">();</span></span>
            <span class="светло_синий">Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();</span></span>
            <img src="../img/1С-1/2023-01-24_08-44-57.png" alt="">

            <span class="зелёный">//способ 3</span>
            Предупреждение(&lt;ТекстПредупреждения>Обяз., &lt;Таймаут>Необяз., &lt;Заголовок>Необяз.).
            Выводит окно предупреждения. Выводится только при режиме использования модальности.
            <span class="светло_синий">Предупреждение<span class="светло_красный">(</span><span class="серый">"Текст сообщения", , "Заголовок"</span><span class="светло_красный">);</span></span>
            <span class="светло_синий">ПредупреждениеАсинх<span class="светло_красный">(</span><span class="серый">"Текст сообщения", , "Заголовок"</span><span class="светло_красный">);</span></span>
            <img src="../img/1С-1/2023-01-24_09-03-50.png" alt="">

            <span class="зелёный">//способ 4</span>
            ПоказатьОповещениеПользователя(&lt;Текст>, &lt;ДействиеПриНажатии>, &lt;Пояснение>, &lt;Картинка>, &lt;СтатусОповещенияПользователя>, &lt;КлючУникальности>);
            При задании только 1го параметра мы увидем окошко с оповещением внизу справа экрана.
            Во 2м параметре можно указать ссылку, если параметр строка, и когда появляется окошко, то при
            нажатии на него перейдём по ссылке.
            <span class="светло_синий">ПоказатьОповещениеПользователя<span class="светло_красный">(</span><span class="серый">"Текст сообщения"</span><span class="светло_красный">);</span></span>
        </pre>
    </div>

    <p id="interactiv-2"><b>Задать вопрос пользователю</b></p>
    <p>Это можно сделать с помощью процедуры Вопрос() или не модальный метод АсинхВопрос()/ПоказатьВопрос() глобального контекста, выводящего на экран окно с вопросом.</p>
    <div class="code-style">
        <pre>
            Процедура вввввв()
                Оповещение = Новый ОписаниеОповещения("ОбработкаВопроса", ОбщегоНазначения2);
                ПоказатьВопрос(Оповещение, "Вы хотите выйти?", РежимДиалогаВопрос.ДаНет);
            КонецПроцедуры

            --общий модуль ОбщегоНазначения2
            Процедура ОбработкаВопроса(РезультатВопроса, ДопПараметры) Экспорт
                Если РезультатВопроса = КодВозвратаДиалога.Нет Тогда
                    ...
                КонецЕсли;
            КонецПроцедуры
        </pre>
    </div>




    <p id="interactiv-2"><b>Модальное окно. Почему надо отказываться от модальности. Асинхронные методы.</b></p>
    <p>Выше мы уже описывали модальные методы(синхронные), например, метод Предупреждение, который открывает модальное окно. При разработке нужно придерживаться принципа отказа от модальности. Во встроенном языке для каждого модального(синхронного) метода есть соответствующий не модальный(асинхронный) метод. Для того же метода Предупреждение() есть соответствующий асинхронный метод ПоказатьПредупреждение(). Отличие их в том, что асинхронный метод по прежнему блокирует интерфейс пользователя, но не останавливает выполнение кода.</p>
    <p>Функции для вызова диалога ввода данных. Находятся в Глобальном контексте:</p>
    <p><span class="светло_красный">Модальные(синхронные)</span>.</p>
    <ul class="list">
        <li>ВвестиЗначение()</li>
        <li>ВвестиЧисло()</li>
        <li>ВвестиСтроку()</li>
        <li>ВвестиДату()</li>
    </ul>
    <p><span class="светло_синий">Не модальные(асинхронные)</span>.</p>
    <ul class="list">
        <li>ПоказатьВводЗначения()</li>
        <li>ВвестиЗначениеАсинх()</li>
        <li>ПоказатьВводЧисла()</li>
        <li>ВвестиЧислоАсинх()</li>
        <li>ПоказатьВводСтроки()</li>
        <li>ВвестиСтрокуАсинх()</li>
        <li>ПоказатьВводДаты()</li>
        <li>ВвестиДатуАсинх()</li>
    </ul>
    <p><span class="светло_красный">Синхронные методы</span></p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//все эти методы работают только если включён режим использования модальности</span>	
	
            <span class="зелёный">//ввод числа синхронно</span>
            <span class="светло_синий">ВведенноеЧисло <span class="светло_красный">=</span> Неопределено;
            ОтветЧисло <span class="светло_красный">=</span> ВвестиЧисло<span class="светло_красный">(</span>ВведенноеЧисло, <span class="серый">"Введите свой возраст"</span>, 3<span class="светло_красный">)</span>;
            <span class="зелёный">//Цифра 0 тоже считается числом</span>
            <span class="светло_красный">Если</span> ОтветЧисло <span class="светло_красный">Тогда</span>
                Сообщение <span class="светло_красный">=</span> Новый СообщениеПользователю;
                Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Ваш возраст:"</span> <span class="светло_красный">+</span> ВведенноеЧисло;
                Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">()</span>;
            <span class="светло_красный">КонецЕсли;</span>
            
            
            <span class="зелёный">//ввод строки синхронно</span>
            ВведённаяСтрока <span class="светло_красный">=</span> Неопределено;
            ОтветСтрока <span class="светло_красный">=</span> ВвестиСтроку<span class="светло_красный">(</span>ВведённаяСтрока, <span class="серый">"Введите ваше имя"</span>, 50<span class="светло_красный">)</span>;
            <span class="светло_красный">Если</span> ОтветСтрока  <span class="светло_красный">И НЕ</span> ПустаяСтрока<span class="светло_красный">(</span>ВведённаяСтрока<span class="светло_красный">)</span> <span class="светло_красный">Тогда</span>
                Сообщение <span class="светло_красный">=</span> Новый СообщениеПользователю;
                Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Ваше имя:"</span> <span class="светло_красный">+</span> ВведённаяСтрока;
                Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">()</span>;
            <span class="светло_красный">КонецЕсли;</span> 
            
            
            <span class="зелёный">//ввод даты синхронно</span>
            ВведённаяДата <span class="светло_красный">=</span> Неопределено;
            <span class="зелёный">//ЧастиДаты это системное перечисление, через точку имет 3 свойства: Дата, Время, ДатаВремя(по умолчанию)</span>
            ОтветДата <span class="светло_красный">=</span> ВвестиДату<span class="светло_красный">(</span>ВведённаяДата, <span class="серый">"ВведитеДату"</span>, ЧастиДаты.Дата<span class="светло_красный">)</span>;
            <span class="светло_красный">Если</span> ОтветДата <span class="светло_красный">Тогда</span>
                Сообщение <span class="светло_красный">=</span> Новый СообщениеПользователю;
                Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Вы ввели дату: "</span> <span class="светло_красный">+</span> ВведённаяДата;
                Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">()</span>;
            <span class="светло_красный">КонецЕсли;</span> 
            
            
            <span class="зелёный">//ввод значения синхронно. Значение это не простой тип(число, строка), а это например, ссылка на элемент справочника или документа</span>  
            ВыбраннаяНоменклатура <span class="светло_красный">=</span> Неопределено;
            <span class="зелёный">//3й параметр вводим либо Тип(), либо ОписаниеТипов</span>
            ОтветНоменклатура <span class="светло_красный">=</span> ВвестиЗначение<span class="светло_красный">(</span>ВыбраннаяНоменклатура, <span class="серый">"ВыберитеТовар"</span>, Тип(<span class="серый">"СправочникСсылка.Номенклатура"</span>)<span class="светло_красный">)</span>;
            <span class="светло_красный">Если</span> ОтветНоменклатура <span class="светло_красный">Тогда</span>
                Сообщение <span class="светло_красный">=</span> Новый СообщениеПользователю;
                Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Вы ввели товар: "</span> <span class="светло_красный">+</span> ВыбраннаяНоменклатура;
                Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">()</span>;
            <span class="светло_красный">КонецЕсли;</span></span>

            <span class="зелёный">//синхронный метод Вопрос()</span>
            <img src="../img/1С-1/2023-01-28_19-50-43.png" class="screen-3" alt="">
        </pre>
    </div>
    <p><span class="светло_синий">Асинхронные методы с использованием функций отложенного вызова(с колбеками)</span>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ОбработкаАсинхронныхМетодов1<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>    
                <span class="зелёный">//отличие от синхронных методов в том, что теперь добавлен ещё 1 параметр
                //этот параметр соответствует функции отложенного вызова в JS(колбек)
                //тут это немножко по другому сделано. Тут мы создаём объект  ОписаниеОповещения, 
                //в котором описываем имя процедуры и текущий модуль.  Процедура будет вызвана по 
                //по окончанию ввода пользователем данных в модальном окне
                //Процедура должна быть экспортная.
                //Судя по справке, то асинхронные методы ничего не возвращают, всё делает 
                //процедура вызванная оповещением, в которую и передаются данные от пользователя
                
                
                //ввод числа асинхронно</span>
                ВведенноеЧисло <span class="светло_красный">=</span> 0;
                Оповещение <span class="светло_красный">= Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ПослеВводаЧисла"</span>, ЭтотОбъект<span class="светло_красный">)</span>;
                ПоказатьВводЧисла<span class="светло_красный">(</span>Оповещение, ВведенноеЧисло, <span class="серый">"Сколько вам лет?"</span>, 3<span class="светло_красный">)</span>; 
                
                
                <span class="зелёный">//ввод строки асинхронно</span>
                ВведеннаяСтрока <span class="светло_красный">=</span> "";
                Оповещение <span class="светло_красный">= Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ПослеВводаСтроки"</span>, ЭтотОбъект<span class="светло_красный">)</span>;
                ПоказатьВводСтроки<span class="светло_красный">(</span>Оповещение, ВведеннаяСтрока, <span class="серый">"Ваше имя?"</span>, 50<span class="светло_красный">)</span>; 
            
            
                <span class="зелёный">//показ Предупреждения асинхронного. 1й параметр с оповещением можно опустить
                //потому что нам не требуется обрабатывать ответ</span>
                ПоказатьПредупреждение<span class="светло_красный">(</span> , <span class="серый">"Какой то текст"</span><span class="светло_красный">)</span>; 
            КонецПроцедуры

            <span class="светло_красный">&НаКлиенте
            Процедура</span> ПослеВводаЧисла<span class="светло_красный">(</span>Число, Параметры<span class="светло_красный">) Экспорт</span> 
                <span class="зелёный">//в отличии от синхронного метода ввода числа, тут уже надо написать такое условие чтобы и 0 тоже выводился
                //всё из за того что переменная Число тут не булево значение имеет, а числовое</span>
                <span class="светло_красный">Если НЕ</span> Число <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                    Сообщение <span class="светло_красный">= Новый</span> СообщениеПользователю;
                    Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Вам " <span class="светло_красный">+</span> Число <span class="светло_красный">+</span> " лет"</span>;
                    Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">()</span>;	
                <span class="светло_красный">КонецЕсли;
            КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ПослеВводаСтроки<span class="светло_красный">(</span>Строка, Параметры<span class="светло_красный">) Экспорт</span> 
                <span class="зелёный">//в отличии от синхронного метода ввода числа, тут уже надо написать такое условие чтобы и 0 тоже выводился
                //всё из за того что переменная Число тут не булево значение имеет, а числовое</span>
                <span class="светло_красный">Если НЕ</span> Строка <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                    Сообщение <span class="светло_красный">= Новый</span> СообщениеПользователю;
                    Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Ваше имя "</span> <span class="светло_красный">+</span> Строка;
                    Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">()</span>;	
                <span class="светло_красный">КонецЕсли;
            КонецПроцедуры;</span></span>




            <span class="зелёный">//асинхронный метод Вопрос()</span>
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ЗадатьВопросАсинхронно<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>
                <span class="зелёный">//вопрос со стандартными кнопками</span>
                Оповещение <span class="светло_красный">= Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ПослеОтветаНаВопросСоСтандартнымиКнопками"</span>, ЭтотОбъект<span class="светло_красный">)</span>; 
                <span class="зелёный">//РежимДиалогаВопрос это системное перечисление, которое позволяет выбрать 
                //надписи на кнопках и их количество. Кнопки можно самом делать</span>
                ПоказатьВопрос<span class="светло_красный">(</span>Оповещение, <span class="серый">"Вы хотите удалить этот блок?"</span>, РежимДиалогаВопрос<span class="светло_красный">.</span>ДаНет<span class="светло_красный">)</span>;


                <span class="зелёный">//вопрос со своими кнопками</span>
                Оповещение <span class="светло_красный">= Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ПослеОтветаНаВопросСоСвоимиКнопками"</span>, ЭтотОбъект<span class="светло_красный">)</span>; 
                <span class="зелёный">//мы хотим создать свои кнопки. Пусть у 1й кнопки будет текст "Создать новый документ" 
                //у 2й "Открыть форму существующего документа" и 3я "Отмена" 
                //чтобы создать эти кнопки будем использовать СписокЗначений</span>
                СписокКнопок <span class="светло_красный">= Новый</span> СписокЗначений;
                СписокКнопок<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"СоздатьНовый"</span>, <span class="серый">"Создать новый документ"</span><span class="светло_красный">)</span>;
                СписокКнопок<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"ОткрытьФорму"</span>, <span class="серый">"Открыть форму существующего документа"</span><span class="светло_красный">)</span>;
                СписокКнопок<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Отмена"</span>, <span class="серый">"Отмена"</span><span class="светло_красный">)</span>;
                ПоказатьВопрос<span class="светло_красный">(</span>Оповещение, <span class="серый">"Выберите действие"</span>, СписокКнопок<span class="светло_красный">)</span>;
            <span class="светло_красный">КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПослеОтветаНаВопросСоСтандартнымиКнопками<span class="светло_красный">(</span>Ответ, Параметры<span class="светло_красный">) Экспорт</span> 
                <span class="зелёный">//в Ответ будет лежать разные значения в зависимости от того, кнопки создавали мы или 
                //использовали РежимДиалогаВопрос. Если 2е, то в ответе будет КодВозвратаДиалога</span>
                <span class="светло_красный">Если</span> Ответ <span class="светло_красный">=</span> КодВозвратаДиалога<span class="светло_красный">.</span>Да <span class="светло_красный">Тогда</span>
                    Сообщение <span class="светло_красный">= Новый</span> СообщениеПользователю;
                    Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Хорошо, удаляем"</span>;
                    Сообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">()</span>;		
                <span class="светло_красный">КонецЕсли;
            КонецПроцедуры  

            &НаКлиенте
            Процедура</span> ПослеОтветаНаВопросСоСвоимиКнопками<span class="светло_красный">(</span>Ответ, Параметры<span class="светло_красный">) Экспорт</span> 
                <span class="зелёный">//в Ответ теперь будет лежать выбранное значение списка кнопок, 
                //не представлениеЮ а именно значение</span>
                <span class="светло_красный">Если</span> Ответ <span class="светло_красный">=</span> <span class="серый">"СоздатьНовый"</span> <span class="светло_красный">Тогда</span>
                    <span class="зелёный">//делаем что то</span>
                <span class="светло_красный">ИначеЕсли</span> Ответ <span class="светло_красный">=</span> <span class="серый">"ОткрытьФорму"</span> <span class="светло_красный">Тогда</span>
                    <span class="зелёный">//делаем что то</span>
                <span class="светло_красный">Иначе</span>
                    <span class="зелёный">//делаем что то</span>		
                <span class="светло_красный">КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>









    <h3 class="header-style2" id="vrem-tab">Посмотреть что лежит во временной таблице запроса</h3>
    <p><span class="светло_синий">Запрос.МенеджерВременныхТаблиц.Таблицы[0].ПолучитьДанные().Выгрузить();</span></p>











    <h3 class="header-style2" id="5">Условный оператор</h3>
    <p>Условный оператор описывается в 1с так:</p>
    <div class="code-style">
        <pre>
            <span class="светло_красный">Если</span> <span class="светло_синий">логическое выражение</span> <span class="светло_красный">Тогда</span>
                Различные команды;
            <span class="светло_красный">ИначеЕсли</span> <span class="светло_синий">логическое выражение</span> <span class="светло_красный">Тогда</span>
                Различные команды;
            <span class="светло_красный">Иначе</span>
                Различные команды;
            <span class="светло_красный">КонецЕсли;</span>
        </pre>
    </div>







    <h3 class="header-style2" id="5a">Тройной оператор</h3>
    <p>Есть такой оператор, заменяющий в некоторых случаях условный оперратор:</p>
    <div class="code-style">
        <pre>
            //тройной оператор обязательно должен быть в выражении, сам по себе не используется
            Буква = ?(2 >3, "А", "Б"); 
            Сообщить(Буква);// "А"
        </pre>
    </div>








    <h3 class="header-style2" id="6">Циклы</h3>
    <p>В 1С бывает 3 цикла: <b>Цикл Для</b>, <b>Цикл Пока</b> и <b>Для каждого</b>.</p>
    <p class="title-size16"><b>Цикл Для</b>. Синтаксис цикла выглядит так:</p>
    <div class="code-style">
        <pre>
            <span class="светло_красный">Для</span> <span class="светло_синий">Имя</span> <span class="светло_красный">=</span> <span class="светло_синий">Начальное число</span> <span class="светло_красный">По</span> <span class="светло_синий">Конечное число</span> <span class="светло_красный">Цикл</span>
                <span class="светло_синий">Команда1<span class="светло_красный">();</span></span>
                <span class="светло_синий">Команда2<span class="светло_красный">();</span></span>
                <span class="светло_красный">...</span>
            <span class="светло_красный">КонецЦикла;</span>

            <span class="зелёный">//пример</span>
            <span class="светло_красный">Для</span> <span class="светло_синий">Шаг</span> <span class="светло_красный">=</span> <span class="светло_синий">1</span> <span class="светло_красный">По</span> <span class="светло_синий">5</span> <span class="светло_красный">Цикл</span>
                <span class="светло_синий">Сообщить<span class="светло_красный">("Круг " + <span class="светло_синий">Шаг</span>);</span></span>
            <span class="светло_красный">КонецЦикла;</span>
            Вывод: 
                Круг 1
                Круг 2
                Круг 3
                Круг 4
                Круг 5
            <span class="зелёный">//Шаг увеличивается на 1 каждый круг самостоятельно и сравнивается с конечным числом оператором &lt;=</span>
        </pre>
    </div>
    <p class="title-size16"><b>Цикл Пока</b>. Команды заключённые между словами Цикл и ЦонецЦикла выполняются пока Логическое выражение равно Истине. Синтаксис цикла выглядит так:</p>
    <div class="code-style">
        <pre>
            <span class="светло_красный">Пока</span> <span class="светло_синий">Логическое выражение</span> <span class="светло_красный">Цикл</span>
                <span class="светло_синий">Команда1<span class="светло_красный">();</span></span>
                <span class="светло_синий">Команда2<span class="светло_красный">();</span></span>
                <span class="светло_красный">...</span>
            <span class="светло_красный">КонецЦикла;</span>

            <span class="зелёный">//пример</span>
            <span class="светло_синий">Шаг = 1</span>
            <span class="светло_красный">Пока</span> <span class="светло_синий">Шаг</span> <span class="светло_красный">&lt;=</span> <span class="светло_синий">5</span> <span class="светло_красный">Цикл</span>
                <span class="светло_синий">Сообщить<span class="светло_красный">(<span class="светло_синий">Шаг</span>);</span></span>
                <span class="светло_синий">Шаг<span class="светло_красный"> = </span><>Шаг<span class="светло_красный"> + </span>1</span><span class="светло_красный">;</span>
            <span class="светло_красный">КонецЦикла;</span>
            Вывод: 
                Шаг 1
                Шаг 2
                Шаг 3
                Шаг 4
                Шаг 5
            <span class="зелёный">//этот цикл по своей структуре очень похож на цикл while() из js</span>
            <span class="зелёный">//в этом цикле как я понял уже можно менять и занк сравнения и указывать шагам увеличиваться им или уменьшаться в отличии от первого цикла</span>
        </pre>
    </div>
    <p class="title-size16"><b>Цикл для каждого</b>. Этот цикл перебирает все коллекции.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">МассивЧисел <span class="светло_красный">= Новый</span> Массив<span class="светло_красный">(</span>4<span class="светло_красный">);</span></span>
            <span class="светло_синий">МассивЧисел[0]<span class="светло_красный"> = 9;</span></span>
            <span class="светло_синий">МассивЧисел[1]<span class="светло_красный"> = "Строка";</span></span>
            <span class="светло_синий">МассивЧисел[2]<span class="светло_красный"> = Истина;</span></span>
            <span class="светло_синий">МассивЧисел[3]<span class="светло_красный"> = 23;</span></span>
            <span class="светло_красный">Для каждого</span> <span class="светло_синий">ЗначениеМассива</span> <span class="светло_красный">Из</span> <span class="светло_синий">МассивЧисел</span> <span class="светло_красный">Цикл</span>
                <span class="светло_синий">Сообщить<span class="светло_красный">(</span>ЗначениеМассива<span class="светло_красный">);</span></span>
            <span class="светло_красный">КонецЦикла;</span>
            Вывод: 
                9
                Строка
                Да
                23
        </pre>
    </div>






    <h3 class="header-style2" id="string">Тип данных - строки</h3>
    <p>Тут подробно работа со строками - https://helpme1s.ru/stroki-v-yazyke-1s-8-v-primerax</p>
    <p>Чтобы написать имя фирмы вот такое - ООО "Блины со сгущонкой" в строке нужно экранировать двойные кавычки внутри строки, т.к. строка сама по себе обозначается двойными кавычками, то экранирование в 1С происходит также двойными кавычками, вот пример - НазваниеФирмы = "ООО ""Блины со сгущонкой""". Ну по крайней мере с названием фирмы так, как там далее обстоят дела узнаем дальше.</p>
    <p><b>СЛОЖЕНИЕ СО СТРОКОЙ</b> будет только если строка находится слева, справо число преобразуется в строку и строки складываются. Если слева число, а справа строка "яблоко", то будет ошибка, но если справа строка "100", то она преобразуется в число 100. Если слева число всё же надо сложить со строкой, то приводим число слева к строке и слаживаем - <span class="светло_красный">Строка(25)</span> + "10"</p>
    <p><b>Привести к строке число</b> - Число = 12; Стр = <span class="светло_красный">Строка(Число)</span>; <span class="светло_красный">Сообщить(ТипЗнч(Стр));</span> - Строка</p>
    <p><b>Ввод строки от поль-ля</b> - Строка= ""; <span class="светло_красный">ВвестиСтроку(Строка)</span>;</p>
    <p><b>Из чего состоит строка</b> - строка состоит из символов и мы можем обращаться к ним также как и к элементам массива, но у строки обращение к начальному символу начинается не 0, а с 1.</p>
    <p><b>Узнать кол-во символов с строке</b> - Строка = "привет"; <span class="светло_красный">СтрДлина(Строка)</span>; вернёт 6, поэтому обходить строку можно в обычном цикле по счётчику.</p>
    <p><b>Получить подстроку в строке</b> - для этого есть не одна функция, вот пример одной из них. Функция <span class="светло_красный">Сред(стр, номер, кол-во)</span>; стр - это сама строка из котрой мы получаем подстроку; номер - это начальная позиция символа/ов, который/е хотим получить; кол-во - это кол-во символов, котрое хотим получить. Как я понял, все 3 параметра обязательны.</p>
    <p><b>Что представляет из себя символ</b> - каждому символу соответствует числовое значение, его код. Зачем может понадобится код символа? Ответ - для шифрования и дешифрования текстов. За перевод символа в числовой код отвечает функция <span class="светло_красный">КодСимвола(строка, позицияСимвола)</span>. За перевод обратно числовго кода в символ отвечает функция <span class="светло_красный">Символ(код)</span></p>
    <p><b>Поиск в строке</b> - чтобы найти подстроку в строке есть функция <span class="светло_красный">СтрНайти(строка, подстрока)</span>. параметров в ней больше, но обязательны эти 2. Функция возвращает 0 если позиция не найдена и позицию, если позиция найдена. Функция ищет только первое вхождение подстроки в строку.</p>
    <p><b>Замена в строке</b> - за замену одной подстроки на другую в строке отвечает функция <span class="светло_красный">СтрЗаменить(строка, искомаяСтрока, заменяемаяСтрока)</span>. Функция возвращает новую строку, полученную в результате замены, старая строка остаётся неизменной. Если замена не удаласьЮ но возвращается старая строка, насколько я понял. Функция заменяет все вхождения в строку.</p>
    <p><b>Верхний и нижний регистр</b> - строки тут сравниваются через знак равенства =, наверно точно также как и в js. Верхний и нижний регистры имеют разные коды. Чтобы привести строку в разные регистры есть 2 функции - <span class="светло_красный">Нрег(строка); - нижний регистр и Врег(строка); - верхний регистр</span>. Потому что разные регистры имеют разные коды, мы не найдём в строке - "какое счастье просыпаться по утрам" слово "Счастье", поэтому мы приводим всё к нижнему регистру и ищем.</p>
    <p>Тут приведено далеко не все функции работы со строками, по ходу дела буду добавлять их сюда с примерами.</p>
    <p>Многострочный режим строки:</p>
    <img src="../img/1С-1/2023-01-25_18-22-20.png" alt="">
    <p>Вот видео по некоторым строковым функциям - https://www.youtube.com/watch?v=obnnPujOmj4</p>






    <h3 class="header-style2" id="num">Тип данных - числа</h3>
    <p>Подробнее о <b>числах</b>. Рассмотрим наиболее часто используемые функции для чисел.</p>
    <p>Чтобы убрать минус у числа перемножим это число на -1</p>
    <ul class="list">
        <li><span class="светло_синий"><b>Окр(число, разрядность, режим округления)</b></span> - например возмём дробное число 100.384 и округлим до первого дробного знака - Окр(100.384, 1);, получим 100.4, почему 100.4, а не 100.3, потому что округление идёт до ближайшего целого. Есть правило, что когда мы округляем до N знака(в нашем случае 3), то смотрим на N + 1 знак(8) и если он меньше 5, то N знак оставляем как есть, а если >= 5, то увеличиваем на 1.   8 больше 5, значит 3 увеличиваем на 1. Также есть 3й параметр у этой функции - режим округления, по умолчанию стоит Окр15как20(можно обозначать цифрой 1), а кр15как10(можно обозначать цифрой 0). Этот режим будет работат только если после 3 идёт 5, а за 5 стоят все нули, тогда этим режимом можно регулировать в большую или в меньшую округлить 3. Например, Окр(100.350, 1, РежимОкругления.Окр15как20); будет округлено в большую сторону, т.е. получим 100.4, а если Окр(100.350, 1, РежимОкругления.Окр15как10) то коруглится в меньшую сторону - 100.3. Ещё раз внимание. 3й параметр влияет только тогда когда - 1)Округляем до N знака, 2)N + 1 равен 5, 3)а все знаки с N + 2 равны 0.</li>
        <li><span class="светло_синий"><b>Цел(100.384);</b></span> - получим целую часть - 100.</li>
        <li><span class="светло_синий"><b>Pow(10, 3);</b></span> - возведём число в степень -  получим 1000</li>
        <li><span class="светло_синий"><b>Sqrt(25);</b></span> - извлечём квадратный корень из числа -  получим 5</li>
        <li><span class="светло_синий"><b>Макс(25, 12, 4, -2);</b></span> - получим наибольшее число - 25</li>
        <li><span class="светло_синий"><b>Мин(2, -4, 545, -8)</b></span> - получим наименьшее число - -8</li>
        <li><span class="светло_синий"><b>ГСЧ = Новый ГенераторСлучайныхЧисел; Сообщить(ГСЧ.СлучайноеЧисло(0, 2));</b></span> - создание случайного числа от заданных параметров, включая эти параметры.</li>
        <li><span class="светло_синий"><b>ЧислоРописью(&lt;Число>, &lt;ФорматнаяСтрока>, &lt;ПараметрыПредметаИсчисления>)</b></span> - формирует представление переданного числа прописью в соответствии с заданными форматной строкой и параметрами предмета исчисления.
        <div class="code-style">
            <pre>
                <span class="зелёный">//форматная строка задаёт параметры, перечисляемые через ;
                //Л - означает код локализации, по умолчанию стоит тот, который в винде
                //ДП - дробную часть выводить прописью если Истина, по умолчанию - Ложь(Числом);
                //остальные параметры в синтакс помошнике</span>
                <span class="светло_синий">ФормСтрока <span class="светло_красный">=</span> "Л = ru_RU; ДП = Истина"<span class="светло_красный">;</span></span>

                <span class="зелёный">//строка ПарПредмета передаёт в падежах название денежной ценности
                //м - мужской род, ж - женский род
                //2 - кол-во разрядов дробной части, по умолчанию 2, можно не указывать</span>
                <span class="светло_синий">ПарПредмета <span class="светло_красный">=</span> "рубль,рубля,рублей,м,копейка,копейки,копеек,м,2"<span class="светло_красный">;</span></span>

                <span class="светло_синий">ПрописьЧисла <span class="светло_красный">=</span> ЧислоПрописью<span class="светло_красный">(</span>2341.56, ФормСтрока, ПарПредмета<span class="светло_красный">)</span><span class="светло_красный">;</span></span>
                Сообщить(ПрописьЧисла);-> две тысячисорок один рубль пятьдесят шесть копеек

                <span class="зелёный">//ещё пример</span>
                <span class="светло_синий">ПрописьЧисла <span class="светло_красный">=</span> ЧислоПрописью<span class="светло_красный">(</span>123.65<span class="светло_красный">)</span><span class="светло_красный">;</span></span>
                Сообщить(ПрописьЧисла);-> сто двадцать три 65

                <span class="зелёный">//ещё пример</span>
                <span class="светло_синий">ПрописьЧисла <span class="светло_красный">=</span> ЧислоПрописью<span class="светло_красный">(</span>123.65, "рубль, рубля, рублей, м, копейка, копейки, копеек, ж, 2"<span class="светло_красный">)</span><span class="светло_красный">;</span></span>
                Сообщить(ПрописьЧисла);-> сто двадцать три рубля 65 копеек
            </pre>
        </div>
        </li>
        <li></li>
        <li></li>
    </ul>








    <h3 class="header-style2" id="date">Тип данных - дата</h3>
    <p>Подробнее о <b>датах</b>.</p>
    <p>Дата во строенном языке должна задаваться в одинарных кавычках  - '20220405090000' - год, месяц, день. Также можно продолжить и дописать часы, минуты, секунды.</p>
    <p>А может задаваться и так - '2022.04.05 09:00:00'. Главное чтобы соблюдалась очерёдность - год, месяц, день, часы , минуты и секунды.</p>
    <p>Также можно задать и просто время, например, нужно указать просто время 9:00. Это можно сделать так - '0001 01 01 09 00 00'</p>
    <p>К датам можно прибавлять и отнимать. Чтобы прибавить к дате сутки нужно прибавить кол-во секунд. Например, ЗавтрашняяДата = '20230412' + 3600 * 24; или наоборот отнять сутки - ВчерашняяДата = '20230412' - 3600 * 24;</p>
    <p>Даты можно вычитать друг из друга, результатом будет кол-во секунд. Получить из какой то даты количество секунд нельзя, я так понимаю, что тут у дат нету отсчёта от какого то времени. Чтобы вычислить секунды, надо вычислять самостоятельно от какой то даты, например, от текущей даты или от какой то другой даты путём вычитания и сложения.</p>
    <p>Нет, получить секунды можно. Отсчёт дат идёт с  01.01.0001 00:00:00. можно взять нужную нам дату и отнять от неё начало отсчёта и получм количество секунд, например количество секунд прошедших до сегодняшней даты: ТекущаяДата() - '01.01.0001 00:00:00'</p>
    <p class="title-size16"><b>Текущая дата</b> - </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Сегодня <span class="светло_красный">=</span> ТекущаяДата<span class="светло_красный">();</span></span> 
            <span class="светло_синий">Сегодня <span class="светло_красный">=</span> ТекущаяДата<span class="светло_красный">()<span class="светло_синий"> + 1</span>;</span></span> <span class="зелёный">// прибавили секунду</span>
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Сегодня<span class="светло_красный">);</span></span> <span class="зелёный">// 14.10.2022 18:40:34</span>
        </pre>
    </div>
    <p class="title-size16"><b>Получаем день конца месяца</b> - </p>
    <div class="code-style">
        <pre>
            День(КонецМесяца(дата));
        </pre>
    </div>
    <p class="title-size16"><b>Получение года, месяца и дня из даты</b> - </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">МояДата<span class="светло_красный">=</span> '19610412'<span class="светло_красный">;</span></span> 
            <span class="светло_синий">Г <span class="светло_красный">=</span> Год<span class="светло_красный">(</span>МояДата<span class="светло_красный">);</span></span><span class="зелёный">// 2013</span> 
            <span class="светло_синий">М <span class="светло_красный">=</span> Месяц<span class="светло_красный">(</span>МояДата<span class="светло_красный">);</span></span> <span class="зелёный">// 7</span>
            <span class="светло_синий">Д <span class="светло_красный">=</span> День<span class="светло_красный">(</span>МояДата<span class="светло_красный">);</span></span> <span class="зелёный">// 24</span>
            <span class="светло_синий">Ч <span class="светло_красный">=</span> Час<span class="светло_красный">(</span>МояДата<span class="светло_красный">);</span></span> <span class="зелёный">// 13</span>
            <span class="светло_синий">Ми <span class="светло_красный">=</span> Минута<span class="светло_красный">(</span>МояДата<span class="светло_красный">);</span></span> <span class="зелёный">// 25</span>
            <span class="светло_синий">С <span class="светло_красный">=</span> Секунда<span class="светло_красный">(</span>МояДата<span class="светло_красный">);</span></span> <span class="зелёный">// 6</span>
        </pre>
    </div>
    
    <p class="title-size16"><b>Добавление месяца к дате</b> - </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>ДобавитьМесяц<span class="светло_красный">(</span>ТекущаяДата<span class="светло_красный">(),</span> 1<span class="светло_красный">));</span></span><span class="зелёный">// прибавили месяц</span>
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>ДобавитьМесяц<span class="светло_красный">(</span>ТекущаяДата<span class="светло_красный">(),</span> - 1<span class="светло_красный">));</span></span><span class="зелёный">// отняли месяц</span>
        </pre>
    </div>

    <p class="title-size16"><b>Другие функции</b> - </p>
    <img src="../img/1С-1/2022-10-26_20-25-04.png" class="screen" alt="">

    <p class="title-size16"><b>Коструктор Дата()</b> - можно задать дату через встроенный конструктор Дата() - </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">ПервыйДеньЛета <span class="светло_красный">=</span> Дата<span class="светло_красный">(</span>2022, 06, 01<span class="светло_красный">);</span></span> 
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>ПервыйДеньЛета<span class="светло_красный">);</span></span> <span class="зелёный">// 01.06.2022 00:00:00</span>
        </pre>
    </div>
    <p>Также можно через встроенную функцию ВвестиДату() запросить у пользователя ввод даты.</p>

    <p class="title-size16"><b>Переводим строку с датой в дату</b> - </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">МояДата <span class="светло_красный">=</span> Дата<span class="светло_красный">(</span>"20130724"<span class="светло_красный">);</span></span> <span class="зелёный">// 24.07.2013</span>
        </pre>
    </div>

    <p class="title-size16"><b>Указываем в дате часы, минуты и секунды</b> - </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">МояДата <span class="светло_красный">=</span> '20130724132506'<span class="светло_красный">;</span></span> <span class="зелёный">// 24 июля 2013 г. 13 ч. 25 мин. 6 сек</span>
        </pre>
    </div>
    <p class="title-size16"><b>Задача</b></p>
    <p>Сообщите на какой день недели выпадает 31 декабря в ближайшие 10 лет. Название дня недели нужно выдать в текстовом виде, например – понедельник, вторник, …</p>
    <p>Решение</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Дата <span class="светло_красный">=</span> <span class="серый">'20231231'</span><span class="светло_красный">;</span> 
            ДниНедели <span class="светло_красный">= Новый</span> Соответствие<span class="светло_красный">();</span> 
            ДниНедели<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>1<span class="светло_красный">,</span> <span class="серый">"Понедельник"</span><span class="светло_красный">);</span>
            ДниНедели<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>2<span class="светло_красный">,</span> <span class="серый">"Вторник"</span><span class="светло_красный">);</span>
            ДниНедели<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>3<span class="светло_красный">,</span> <span class="серый">"Среда"</span><span class="светло_красный">);</span>
            ДниНедели<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>4<span class="светло_красный">,</span> <span class="серый">"Четверг"</span><span class="светло_красный">);</span>
            ДниНедели<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>5<span class="светло_красный">,</span> <span class="серый">"Пятница"</span><span class="светло_красный">);</span>
            ДниНедели<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>6<span class="светло_красный">,</span> <span class="серый">"Суббота"</span><span class="светло_красный">);</span>
            ДниНедели<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>7<span class="светло_красный">,</span> <span class="серый">"Воскресенье"</span><span class="светло_красный">);</span>
            <span class="светло_красный">Для</span> Шаг <span class="светло_красный">=</span> 1 <span class="светло_красный">По</span> 10 <span class="светло_красный">Цикл</span>
                <span class="светло_красный">Если</span> Шаг <span class="светло_красный">=</span> 1 <span class="светло_красный">Тогда</span>
                    День <span class="светло_красный">=</span> ДеньНедели<span class="светло_красный">(</span>Дата<span class="светло_красный">);
                Иначе</span>
                    <span class="зелёный">//вот таким образом увеличиваю год</span>
                    День <span class="светло_красный">=</span> ДеньНедели<span class="светло_красный">(</span>ДобавитьМесяц<span class="светло_красный">(</span>Дата<span class="светло_красный">,</span> 12 <span class="светло_красный">*</span> Шаг<span class="светло_красный">));
                КонецЕсли;</span>
                Сообщить<span class="светло_красный">(</span>ДниНедели<span class="светло_красный">[</span>День<span class="светло_красный">]);	
            КонецЦикла</span></span>

            <span class="зелёный">//вот ещё способ увеличить год</span>
            КонецГода = КонецГода(ТекущаяДата()); - это начальная дата
            КонецГода = КонецГода(КонецДня(КонецГода) + 1); - а это в цикле будет прибавляться на год
        </pre>
    </div>















    <h3 class="header-style2" id="array">Тип данных - Массив</h3>
    <img src="../img/1С-1/2022-10-21_10-03-43.png" class="screen" alt="">
    <p>Массив доступен и на клиенте и на сервере. </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">МойМассив<span class="светло_красный"> = Новый</span> Массив<span class="светло_красный">();</span></span>
            <span class="серый">Результат: МойМассив -> []</span>

            <span class="зелёный">//попытаемся <span class="фиолетовый"><b>обратиться</b></span> к его первому элементу</span>
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>МойМассив<span class="светло_красный">[</span>0<span class="светло_красный">]</span><span class="светло_красный">);</span></span>//<span class="зелёный">Ошибка! Массив пока не содержит элементов</span>
            <span class="зелёный">//то же самое</span>
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>МойМассив<span class="светло_красный">.</span>Получить<span class="светло_красный">(</span>0<span class="светло_красный">));</span></span>//<span class="зелёный">Ошибка! Массив пока не содержит элементов</span>


            <span class="зелёный">//<span class="фиолетовый"><b>добавление в конец</b></span> массива значения</span>
            <span class="светло_синий">МойМассив<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Иванов"</span><span class="светло_красный">);</span></span>
            <span class="светло_синий">МойМассив<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Петров"</span><span class="светло_красный">);</span></span>
            <span class="серый">Результат: МойМассив -> ["Иванов", "Петров"]</span>

            <span class="зелёный">//можно <span class="фиолетовый"><b>вставить</b></span> элемент в любое место массива, если вставка между элементами, то
            //вставляемый элемент расталкивает другие элементы, заставляя их передвигаться на новые позиции</span>
            <span class="светло_синий">МойМассив<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>1<span class="светло_красный">,</span> <span class="серый">"Сидоров"</span><span class="светло_красный">);</span></span>
            <span class="серый">Результат: МойМассив -> ["Иванов", "Сидоров", "Петров"]</span>
            <span class="светло_синий">МойМассив<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>5<span class="светло_красный">,</span> <span class="серый">"Герасимов"</span><span class="светло_красный">);</span></span>
            <span class="серый">Результат: МойМассив -> ["Иванов", "Сидоров", "Петров", Неопределено, Неопределено, "Герасимов"]</span>

            <span class="зелёный">//мы можем <span class="фиолетовый"><b>заменить</b></span> элемент массива на другой, для это есть метод Установить(). 
            //Если этому методу указать индекс, которого нет в массиве, то будет ошибка</span>
            <span class="светло_синий">МойМассив<span class="светло_красный">.</span>Установить<span class="светло_красный">(</span>0<span class="светло_красный">,</span> <span class="серый">"Николаев"</span><span class="светло_красный">);</span></span>
            <span class="зелёный">//делает то же самое</span>
            <span class="светло_синий">МойМассив<span class="светло_красный">[</span>0<span class="светло_красный">] = </span> <span class="серый">"Николаев"</span><span class="светло_красный">;</span></span>
            <span class="серый">Результат: МойМассив -> ["Николаев", "Сидоров", "Петров", Неопределено, Неопределено, "Герасимов"]</span>

            <span class="зелёный">//<span class="фиолетовый"><b>поиск</b></span> элемента в массиве
            //если нашёл, вернёт индекс, если нет - Неопределено</span>
            <span class="светло_синий">ЗначениеПоиска <span class="светло_красный">=</span> МойМассив<span class="светло_красный">.</span>Найти<span class="светло_красный">(</span><span class="серый">"Иванов"</span><span class="светло_красный">);</span></span>
            <span class="серый">Результат: ЗначениеПоиска -> Неопределено</span>

            <span class="зелёный">//есть такой метод как <span class="фиолетовый"><b>ВГраница()</b></span> он
            //возвращает наибольший индекс элемента массива</span>
            <span class="зелёный">//это то же самое что МойМассив.Количество() - 1</span>
            <span class="зелёный">//но если массив пуст, то ВГраница() вернёт -1</span>
            <span class="светло_синий">НаибольшийИндекс <span class="светло_красный">=</span> МойМассив<span class="светло_красный">.</span>ВГраница<span class="светло_красный">();</span></span>
            <span class="серый">Результат: НаибольшийИндекс -> 5</span>

            <span class="зелёный">//<span class="фиолетовый"><b>Удаление</b></span> элемента из массива</span>
            <span class="светло_синий">Индекс <span class="светло_красный">=</span> МойМассив<span class="светло_красный">.</span>Найти<span class="светло_красный">(</span><span class="серый">"Сидоров"</span><span class="светло_красный">);</span>
            <span class="светло_красный">Если НЕ</span> Индекс <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                <span class="светло_синий">МойМассив<span class="светло_красный">.</span>Удалить<span class="светло_красный">(</span>Индекс<span class="светло_красный">)</span>;</span>    
            <span class="светло_красный">КонецЕсли;</span></span>
            <span class="серый">Результат: МойМассив -> ["Николаев", "Петров", Неопределено, Неопределено, "Герасимов"]</span>
            
            <span class="зелёный">//если объявляем массив с заранее известным числом элементов, то заполняем так</span>
            <span class="светло_синий">МассивРазныхТипов<span class="светло_красный"> = Новый</span> Массив<span class="светло_красный">(</span>3<span class="светло_красный">);</span></span>
            <span class="светло_синий">МассивРазныхТипов<span class="светло_красный">[</span>0<span class="светло_красный">]</span><span class="светло_красный"> =</span> 9<span class="светло_красный">;</span></span>
            <span class="светло_синий">МассивРазныхТипов<span class="светло_красный">[</span>1<span class="светло_красный">]</span><span class="светло_красный"> =</span> "Строка"<span class="светло_красный">;</span></span>
            <span class="светло_синий">МассивРазныхТипов<span class="светло_красный">[</span>2<span class="светло_красный">]</span><span class="светло_красный"> =</span> Истина<span class="светло_красный">;</span></span>
            <span class="зелёный">//если захотим добавить 4й элемент, то через
            //квадратные скобки не получится, но получится через методы
            //Добавить() и Вставить()
            //Вообще, если заранее известно количество элементов в массиве
            //то лучше создать такой массив с заранее заданными ячейками
            //потому что метод Добавить() создаёт новый массив, копирует из старого
            //в него все элементы и добавляет текущий элемент.
            //На больших массивах это будет чувствительной операцией</span>
            <span class="серый">Результат: МассивРазныхТипов -> [9, "Строка", Истина]</span>


            <span class="зелёный">//чтобы узнать <span class="фиолетовый"><b>количество</b></span> элементов в массиве(длину массива)</span>
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>МассивРазныхТипов<span class="светло_красный">.</span>Количество<span class="светло_красный">()</span><span class="светло_красный">);</span></span>//<span class="зелёный">3</span>

            <span class="зелёный">//<span class="фиолетовый"><b>Очищение</b></span> массива</span>
            <span class="светло_синий">МассивРазныхТипов<span class="светло_красный">.</span>Очистить<span class="светло_красный">();</span></span>
            <span class="серый">Результат: МассивРазныхТипов -> []</span>

            <span class="зелёный">//<span class="фиолетовый"><b>обход массива</b></span> в цикле
            //цикл Для каждого
            //в переменную Элемент попадает значение элемента массива, а не ключ</span>
            <span class="светло_синий">МассивЗначений <span class="светло_красный">= Новый</span> Массив<span class="светло_красный">(</span>4<span class="светло_красный">);</span></span>
            <span class="светло_синий">МассивЗначений<span class="светло_красный">[</span>0<span class="светло_красный">]</span><span class="светло_красный"> =</span> 9<span class="светло_красный">;</span></span>
            <span class="светло_синий">МассивЗначений<span class="светло_красный">[</span>1<span class="светло_красный">]</span><span class="светло_красный"> =</span> "Строка"<span class="светло_красный">;</span></span>
            <span class="светло_синий">МассивЗначений<span class="светло_красный">[</span>2<span class="светло_красный">]</span><span class="светло_красный"> =</span> Истина<span class="светло_красный">;</span></span>
            <span class="светло_красный">Для каждого</span> <span class="светло_синий">Элемент</span> <span class="светло_красный">Из</span> <span class="светло_синий">МассивЗначений</span> <span class="светло_красный">Цикл</span>
                <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Элемент<span class="светло_красный">);</span></span>
            <span class="светло_красный">КонецЦикла;</span>
            Вывод: 
                9
                Строка
                Да

            <span class="зелёный">//цикл Для
            //вместо МассивЗначений.Количество() - 1 можно писать МассивЗначений.ВГраница(). Это одно и то же</span>
            <span class="светло_синий"><span class="светло_красный">Для</span> Шаг <span class="светло_красный">=</span> 0 <span class="светло_красный">По</span> МассивЗначений<span class="светло_красный">.</span>Количество<span class="светло_красный">() - </span>1 <span class="светло_красный">Цикл</span>
                Сообщить<span class="светло_красный">(</span>МассивЗначений<span class="светло_красный">[</span>Шаг<span class="светло_красный">]</span><span class="светло_красный">);</span>
            <span class="светло_красный">КонецЦикла;</span></span>

            <span class="зелёный">//цикл Пока</span>
            <span class="светло_синий">Шаг <span class="светло_красный">=</span> 0<span class="светло_красный">;</span>
            <span class="светло_красный">Пока</span> Шаг <span class="светло_красный">&lt;=</span> МассивЗначений<span class="светло_красный">.</span>ВГраница<span class="светло_красный">() Цикл</span>
                Сообщить<span class="светло_красный">(</span>МассивЗначений<span class="светло_красный">.</span>Получить<span class="светло_красный">(</span>Шаг<span class="светло_красный">));</span>
                Шаг <span class="светло_красный">=</span> Шаг <span class="светло_красный">+</span> 1<span class="светло_красный">;
            КонецЦикла;</span></span>

            <span class="зелёный">//Обход массива в обратном порядке</span>
            <span class="светло_синий">Шаг <span class="светло_красный">=</span> МассивЗначений<span class="светло_красный">.</span>ВГраница<span class="светло_красный">();</span>
            <span class="светло_красный">Пока</span> Шаг <span class="светло_красный">>=</span> 0 <span class="светло_красный">Цикл</span>
                Сообщить<span class="светло_красный">(</span>МассивЗначений<span class="светло_красный">[</span>Шаг<span class="светло_красный">]);</span>
                Шаг <span class="светло_красный">=</span> Шаг <span class="светло_красный">-</span> 1<span class="светло_красный">;
            КонецЦикла;</span></span>


            <span class="зелёный">//<span class="фиолетовый"><b>передача массива в качестве параметра</b></span>. Массив это изменяемый
            //объект. Если передать его в функцию или процедуру и внутри функции изменить переданный массив,
            //то он изменится и снаружи, потому что передан не сам массив, а ссылка на него.
            //Если же использовать ключевое слово "Знач", то тогда массив будет скопирован.</span>


            <span class="зелёный">//<span class="фиолетовый"><b>ОБРАБОТКА ОШИБОК</b></span>. Хорошим тоном считается обрабатывать не только успешные действия
            //но и ошибочные. Например метод Найти() возвращает индекс найденного элемента, либо Неопределено.
            //Так вот мы не всегда знаем, какие есть элементы в массиве, а каких нет, поэтому метод может 
            //вернуть Неопределено и чтобы потом не производить опреции с этим типом и не вызвать ошибок мы и 
            //будм обрабатывать её.</span>
            <span class="светло_синий">ИндексЗначенияСтрока <span class="светло_красный">=</span> МассивЗначений<span class="светло_красный">.</span>Найти<span class="светло_красный">(</span><span class="серый">"Строка"</span><span class="светло_красный">);

            Если</span> ИндексЗначенияСтрока <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                ПоказатьПредупреждение<span class="светло_красный">(,</span> <span class="серый">"Значение Строка не найдено"</span><span class="светло_красный">);
                Возврат;
            КонецЕсли;</span>

            Сообщить<span class="светло_красный">(</span>ИндексЗначенияСтрока<span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p>Если что то по массивам будет не хватать, то во тут побольше описано - https://helpme1s.ru/massivy-v-yazyke-1s-8-v-primerax</p>
    <p class="title-size16"><b>Типовые ошибки массивов</b></p>
    <img src="../img/1С-1/2022-10-21_10-03-43-2.png" class="screen" alt="">
    <p>В первом случае ошибка говорит о том, что нет такого индекса в массиве. И поэтому лучше делать условные проверки на наличии в массиве количество значений, а уже потом делать обращение к массиву, дабы избежать ошибок. Во втором случае похожая картина, но только встречается она когда пытаются удалить из массива несуществующий индекс. И опять же нужно проверять на наличие такого индекса, а потом удалять.</p>









    <h3 class="header-style2" id="fix-array">Тип данных - Фиксированный массив</h3>
    <p>Эта такая коллекция предназначенная для того, чтобы запретить пользователю изменять её. Если такой массив один раз создали, то затем нельзя туда добавить, удалить, изменить элементы.</p>
    <p>Зачем нам вообще фиксированный массив? Такой массив используется внутри системы в качестве параметров между разными методами.</p>
    <p>Допустим если посмотреть в справке, то метод Содержимое() у объекта ОкноКлиентскогоПриложения вернёт фиксированный массив всех форм, открытых в этом окне и так далее.</p>
    <p>Создаётся такой массив из обычного массива.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">ОбычныйМассив <span class="светло_красный">= Новый</span> Массив<span class="светло_красный">;</span>
            ФиксированныйМассив <span class="светло_красный">= Новый</span> ФиксированныйМассив<span class="светло_красный">(</span>ОбычныйМассив<span class="светло_красный">);</span>

            <span class="зелёный">//Преобразовываем обратно в обычный массив</span>
            НовыйОбычныйМассив <span class="светло_красный">= Новый</span> Массив<span class="светло_красный">(</span>ФиксированныйМассив<span class="светло_красный">);</span></span>
        </pre>
    </div>









    <h3 class="header-style2" id="structure">Тип данных - Структура(объект)</h3>
    <img src="../img/1С-1/2022-10-21_10-04-58.png" class="screen" alt="">
    <p>Структура доступна и на клиенте и на сервере. В ключе свойства структуры в строковом идентификаторе не допустимы пробелы, а вот в соотвествии такие ключи возможны. Структура в отличии от массива позволяет использовать строковый ключ. Эта строка должна начинаться со знака "_", либо с буквы. </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">   

            <span class="зелёный">//как <span class="фиолетовый"><b>создать</b></span> структуру(1й способ)</span>
            ЛичныеДанные<span class="светло_красный"> = Новый</span> Структура<span class="светло_красный">;</span>


            <span class="зелёный">//(2й способ). Удобен при небольшом количестве известных ключей</span>
            Время<span class="светло_красный"> = Новый</span> Структура<span class="светло_красный">(</span><span class="серый">"Часы,Минуты,Секунды"</span>, 12, 45, 33<span class="светло_красный">);</span>
            Сообщить<span class="светло_красный">(</span><span class="серый">"Время "</span> <span class="светло_красный">+</span> Время<span class="светло_красный">.</span>Часы<span class="светло_красный"> + <span class="серый">":"</span> + </span>Время<span class="светло_красный">.</span>Минуты<span class="светло_красный">);</span>//<span class="зелёный">Время 12:45</span>



            <span class="зелёный">//(3й способ)</span>
            Человек<span class="светло_красный"> = Новый</span> Структура<span class="светло_красный">(<span class="серый">"Фамилия, Имя, Отчество"</span>);</span>
            <span class="зелёный">//заполняем эти свойства</span>
            Человек<span class="светло_красный">.</span>Фамилия<span class="светло_красный"> = </span>"Пупкин"
            Человек<span class="светло_красный">.</span>Имя<span class="светло_красный"> = </span>"Василий"
            Человек<span class="светло_красный">.</span>Отчество<span class="светло_красный"> = </span>"Иванович"
            Сообщить<span class="светло_красный">(</span>Человек<span class="светло_красный">.</span>Отчество<span class="светло_красный">);</span>//<span class="зелёный">Иванович</span>


            <span class="зелёный">//как <span class="фиолетовый"><b>вставить</b></span> значение и он же перезапишет(1й способ)</span>
            Человек<span class="светло_красный">.</span>Вставить<span class="светло_красный">(<span class="серый">"Фамилия"</span>, <span class="серый">"Сидоров"</span>);</span>
            
            
            <span class="зелёный">//(2й способ)</span>
            Человек<span class="светло_красный">.</span>Фамилия<span class="светло_красный"> = </span>"Сидоров"
            Человек<span class="светло_красный">[<span class="серый">"Фамилия"</span>] = </span>"Сидоров"



            <span class="зелёный">//узнаём <span class="фиолетовый"><b>количество</b></span> свойств в структуре</span>
            Сообщить<span class="светло_красный">(</span>Человек<span class="светло_красный">.</span>Количество()<span class="светло_красный">);</span>//<span class="зелёный">4</span>



            <span class="зелёный">//как <span class="фиолетовый"><b>получить значение</b></span> в структуре 1й</span>
            Имя <span class="светло_красный">=</span> Человек<span class="светло_красный">[<span class="серый">"Имя"</span>];</span>

            <span class="зелёный">//как получить значение в структуре 2й</span>
            Имя <span class="светло_красный">=</span> Человек<span class="светло_красный">.</span>Имя<span class="светло_красный">;</span>

            <span class="зелёный">//3й способ это метод <span class="фиолетовый"><b>Свойство()</b></span> ищет ключ в структуре по заданному имени. 
            //Если нашёл, то в переменную НайденноеЗначение помещает значение этого ключа и возвращает Истина
            //Если не нашёл, то в переменной НайденноеЗначение остаётся Неопределено, а метод вернёт Ложь</span>
            НайденноеЗначение <span class="светло_красный">=</span> Неопределено<span class="светло_красный">;</span>
            Человек<span class="светло_красный">.</span>Свойство<span class="светло_красный">(</span>"Имя", НайденноеЗначение<span class="светло_красный">);</span>//<span class="зелёный">Да</span>
            Сообщить<span class="светло_красный">(</span>НайденноеЗначение<span class="светло_красный">);</span>//<span class="зелёный">Василий</span>
            <span class="зелёный">//говорят, что этот способ хорош для получения значения свойства по ключу, потому как
            //если по ключу ничего не будет, то ошибки не будет, просто в НайденноеЗначение запишется Неопределено
            //а вот если получать значение так Человек.Имя или так Человек["Имя"], то если по ключу ничего нет
            //то выдаст ошибку и надо будет делать дополнительные проверки
            //но на практике всё же чаще пользуются получением через точку и скобки</span>

            <span class="зелёный">//Обработка ОШИБОК! Хотя даже если мы используем метод Свойство() и ничего не нашлось по ключу
            //то в переменной НайденноеЗначение останется значение Неопределено, а значит с этим значением где то может 
            //дальше по коду могут проводится разные операции, что вызовет опять же ошибку, так что неудачные 
            //значения нужно обрабатывать</span>



            <span class="зелёный">//очищаем структуру польностью</span>
            Человек<span class="светло_красный">.</span>Очистить<span class="светло_красный">();</span>
            Сообщить<span class="светло_красный">(</span>Человек<span class="светло_красный">.</span>Количество()<span class="светло_красный">);</span>//<span class="зелёный">0</span>



            <span class="зелёный">//удаляем свойство из структуры</span>
            Человек<span class="светло_красный">.</span>Удалить<span class="светло_красный">(<span class="серый">"Отчество"</span>);</span>
            Сообщить<span class="светло_красный">(</span>Человек<span class="светло_красный">.</span>Отчество<span class="светло_красный">);</span><span class="зелёный">//Ошибка! Поле объекта не обнаружено</span>


            <span class="зелёный">//обход элементов структуры в цикле
            //заметим, что в переменную Элемент попадает не значение элемента структуры, а объект
            //у которого есть 2 свойства - Ключ и Значение и вызваем то что нам нужно</span>
            <span class="светло_красный">Для Каждого</span> Элемент <span class="светло_красный">Из</span> ЛичныеДанные <span class="светло_красный">Цикл</span>
                Сообщить<span class="светло_красный">(</span>Элемент<span class="светло_красный">.</span>Ключ <span class="светло_красный">+</span> " " <span class="светло_красный">+</span> Элемент<span class="светло_красный">.</span>Значение</span><span class="светло_красный">);</span>
            <span class="светло_красный">КонецЦикла;</span>

            <span class="зелёный">//В отличии от массива, который в элементах содержит простые типы(строка, число, булево),
            //в структуре элемент это объект с типом "КлючИЗначение", этот объект связывает ключ и его значение
            //и можно получить из него имя ключа или значение, что и видно в цикле выше.</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Типовые ошибки связанные со структурой</b>.</p>
    <img src="../img/1С-1/2022-10-21_10-04-58-2.png" class="screen" alt="">
    <p<b>В первом случае</b> ошибка возникает при неправильном имени ключа, например, назвали "1Сотрудник", это неправильно, потому что первыми символами должны быть буквы или подчёркивания, имя не должно начинаться с цифр. Приведём пример, часто бывает нужно перевести данные из одной коллекции в другую. Переведём данные из массива в структуру, массив содержит набор чисел:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">
            МассивЧисел = Новый Массив;
            Для Число = 1 По 2000 Цикл
                МассивЧисел.Добавить(Число);
            КонецЦикла;

            СтруктураЧисел = Новый Структура;
            Для каждого Элемент Из МассивЧисел Цикл
                ИмяКлюча = "Число_" + МассивЧисел.Найти(Элемент);
                СтруктураЧисел.Вставить(ИмяКлюча, Элемент);
            КонецЦикла; 
            </span>
        </pre>
    </div>
    <p>Вроде бы всё правильно и должны получить структуру вида: "Число_0: 1", "Число_1: 2", "Число_2: 3" и т.д., но будет ошибка из первого случая, потому что подойдя до 1000 система автоматом разделяет такие числа по 3 символа пробелами и на этом числе у нас будет имя ключа такое - "Число_1 000", а пробелы недопустимы в имени. Исправить ошибку можно форматом чисел, который убирает эти пробелы - Формат(МассивЧисел.Найти(Элемент), "ЧГ=0").</p>
    <p>Представим мы не знаем в чём проблема и на каком круге цикла вознакает проблема. Нам может помочь такая конструкция языка как Попытка ... Исключение. Мы в Попытка вставляем код, где в структуру добавляются ключи с значениями и если добавление какого то ключа вдруг вызовет ошибку, то конструкция сразу перейдёт к выполнению кода в Исключение:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">
            МассивЧисел = Новый Массив;
            Для Число = 1 По 2000 Цикл
                МассивЧисел.Добавить(Число);
            КонецЦикла;

            СтруктураЧисел = Новый Структура;
            Для каждого Элемент Из МассивЧисел Цикл
                ИмяКлюча = "Число_" + МассивЧисел.Найти(Элемент);
                Попытка
                    СтруктураЧисел.Вставить(ИмяКлюча, Элемент);
                Исключение
                    Сообщить(МассивЧисел.Найти(Элемент));
                КонецПопытки;
            КонецЦикла; 
            </span>
        </pre>
    </div>
    <p>Этот код начнёт нам выдавать сообщения начиная с 1 000</p>
    <p<b>Ну и второй случай</b> это когда обращаемся к ключу, которого нет, а значит опять же нужно делать проверки.</p>
















    <h3 class="header-style2" id="accordance">Соответствие(Map)</h3>
    <img src="../img/1С-1/2022-10-21_10-05-59.png" class="screen" alt="">
    <p>В отличии от Структуры в коллекции Соответствие в ключах можно использовать любые типы данных(число, строка, дата, ссылка и т.д.). Дата и ссылка частые ключи для соответствия. В ключе даже можно использовать строку внутри с пробелами, чего нельзя делать в ключе Структуры. Точно также как и массив и структура, соответствие доступно и на клиенте и на сервере. В Соответствии тяжелей получить ошибку в работе с элементами.</p>
    <p>Соответствие иногда встречается в качестве параметров методов платформы 1С, а также в качестве возвращаемого значения. Например, КлючСтрокиДинамическогоСписка можно создать на основании соответствия, а метод ИнтернетПочта.ПолучитьФлагиСообщений возвращает соответствие идентификаторов почтовых сообщений и их флагов (новое, отвеченное, прочитанное и т.п.)</p>
    <p>Но гораздо чаще соответствие используется разработчиками для реализации собственных алгоритмов. Например, можно в соответствие записать в качестве ключа ссылку на документ, а в качестве значения – печатную форму этого документа, или сопоставить дате название праздника, или сопоставить URL-адресу сервера настройки подключения к нему, и т.д.</p>
    <p><b>Создание Соответствия</b>. В отличии от Массива и Структуры создание Соответствия происходит одним способом указаном ниже в примере.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СоответствиеРазмеров <span class="светло_красный">= Новый</span> Соответствие;</span>
        </pre>
    </div>
    <p class="title-size16"><b>Вставить ключ с значением</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СоответствиеРазмеров<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>36, <span class="серый">"XS"</span><span class="светло_красный">);</span></span>
            <span class="светло_синий">СоответствиеРазмеров<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>38, <span class="серый">"S"</span><span class="светло_красный">);</span></span>
            <span class="светло_синий">СоответствиеРазмеров<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>40, <span class="серый">"М"</span><span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Количество элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">КоличествоЭлементов <span class="светло_красный">=</span> СоответствиеРазмеров<span class="светло_красный">.</span>Количество<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p><b>Получить элемент</b>. Если элемент не найден по ключу, то вернёт Неопределено. Желательно делать проверку на Неопределено и выводить уже затем ответ. Ошибки не будет, если по ключу ничего не найдено.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Размер36 <span class="светло_красный">=</span> СоответствиеРазмеров<span class="светло_красный">.</span>Получить<span class="светло_красный">(</span>36<span class="светло_красный">);</span><span class="зелёный">// XS</span>
            <span class="светло_красный">Если</span> Размер36 <span class="светло_красный">&lt;></span> Неопределено <span class="светло_красный">Тогда</span>
                Сообщить<span class="светло_красный">(</span>Размер36<span class="светло_красный">)</span>;
            <span class="светло_красный">КонецЕсли;</span></span>
            <span class="зелёный">//или</span>
            <span class="светло_синий">Размер40 <span class="светло_красный">=</span> СоответствиеРазмеров<span class="светло_красный">[</span>40<span class="светло_красный">];</span></span><span class="зелёный">// M</span>
        </pre>
    </div>
    <p class="title-size16"><b>Изменить элемент</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СоответствиеРазмеров<span class="светло_красный">[</span>40<span class="светло_красный">] =</span> <span class="серый">"MM"</span><span class="светло_красный">;</span></span>
        </pre>
    </div>
    <p><b>Обход элементов</b>. Из за того что в ключе могут быть любые типы, то при сложении со строкой ключа следует перерд ним указать строку - ("" +) или ключ привести к строке. Тут также как и в структуре в переменную Элемент попадает тип КлючИЗначение, т.е. содержит и ключ и значение.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">Для Каждого</span> Элемент <span class="светло_красный">Из</span> СоответствиеРазмеров <span class="светло_красный">Цикл</span></span>
                <span class="светло_синий">Сообщить<span class="светло_красный">(</span>"" + Элемент<span class="светло_красный">.</span>Ключ <span class="светло_красный">+</span> " " <span class="светло_красный">+</span> Элемент<span class="светло_красный">.</span>Значение</span><span class="светло_красный">);</span></span>
            <span class="светло_красный">КонецЦикла;</span>
        </pre>
    </div>
    <p class="title-size16"><b>Удалить элемент</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СоответствиеРазмеров<span class="светло_красный">.</span>Удалить<span class="светло_красный">(</span>36<span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Очистить коллекцию</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СоответствиеРазмеров<span class="светло_красный">.</span>Очистить<span class="светло_красный">(</span><span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Узнать тип коллекции</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">Если</span> ТипЗнч<span class="светло_красный">(</span>СоответствиеРазмеров<span class="светло_красный">)</span> <span class="светло_красный">=</span> Тип<span class="светло_красный">(</span><span class="серый">"Соответствие"</span><span class="светло_красный">)</span> <span class="светло_красный">Тогда</span>
                Сообщить<span class="светло_красный">(</span><span class="серый">"Это коллекция Соответствие"</span><span class="светло_красный">)</span>;
            <span class="светло_красный">КонецЕсли;</span></span>
        </pre>
    </div>
    <p>Если тут также обратиться к ключу, которого нет в соответствии, как и в структуре, то ошибки тут не будет, в отличии от структуры. Просто выведет пустое значение, а тип будет Неопределено.</p>
    <p><span class="светло_красный">Один из приёмов использования соответсвия. Например, у нас есть перечисление "СпособыОплаты"(наличные, картой) и перечисление "ТипОплаты"(наличные, безналичные). Нам нужно определить какой тип оплаты произошёл:</span></p>
    <div class="code-style">
        <pre>
            Процедура ...()
                ТипОплаты = ОпределитьТип(СпособОплаты);
            КонецПроцедуры

            Функция ОпределитьТип(СпособОплаты)
                Соответствие = Новое Соответствие;
                Соответствие.Вставить(Перечисления.СпособыОплаты.Наличные, Перечисления.ТипОплаты.Наличные);
                Соответствие.Вставить(Перечисления.СпособыОплаты.Картой, Перечисления.ТипОплаты.Безналичные);
                Соответствие.Вставить(Перечисления.СпособыОплаты.Бартер, Перечисления.ТипОплаты.Безналичные);

                Возврат Соответствие[СпособОплаты];
            КонецФункции
        </pre>
    </div>














    <h3 class="header-style2" id="list">Тип данных - Список значений</h3>
    <img src="../img/1С-1/2022-10-21_10-01-13.png" class="screen" alt="">
    <p>Если чего то тут нет, может будет тут - https://helpme1s.ru/spisok-znachenij-v-yazyke-1s-8-v-primerax</p>
    <p>Список значений уместно использовать вместо массива в случаях, когда требуется взаимодействие с пользователем в части выбора элементов из этого списка в окне и если требуются какие-то особые возможности(например, сортировка). Доступен и на клиенте и на сервере. Так как он нужен и для работы с пользователем, то тогда надо использовать на клиенте.</p>
    <p class="title-size16"><b>Создание списка</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СписокДней<span class="светло_красный"> = Новый</span> СписокЗначений<span class="светло_красный">;</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Задать тип данных для значений</b>.</p>
    <p>Для чего задавать тип значений? Пока я встретил только один случай такого применения. Когда решал задачу нахождения наибольшего количества повторений букв в тексте, то можно все буквы с их количеством записать в список значений и потом использовать этот список как таблица для запроса, чтобы в запросе можно было сгруппировать и отсортировать буквы. Так вот просто так запрос не примет список значений, он будет ругаться на то, что тип значений не задан, вот тут то и нужно задать тип значений, какой мы собираемся хранить. Если что пример можно найти в разделе 1С -> Примеры задач -> Работа со строками -> Найти в тексте букву повторяющуюся больше всех.</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//задаём для значений элементов списка тип число. Как я понимаю, другие типы уже нельзя добавить в список, только числа</span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>ТипДанных<span class="светло_красный"> = Новый</span> ОписаниеТипов<span class="светло_красный">(</span><span class="серый">"Число"</span><span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p><b>Добавлениеи и вставка элементов</b>. При добавлении элемент ставится в конец списка, при вставке по индексу элементы справа сдвигаются вправо. Важно также помнить, что в ключах у списка мы тоже можем писать разные типы данных.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">&lt;Значение></span><span class="светло_красный">,</span> <span class="серый">&lt;Представление></span><span class="светло_красный">,</span> <span class="серый">&lt;Пометка></span><span class="светло_красный">,</span> <span class="серый">&lt;Картинка></span><span class="светло_красный">);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span><span class="серый">&lt;Индекс></span><span class="светло_красный">,</span> <span class="серый">&lt;Значение></span><span class="светло_красный">,</span> <span class="серый">&lt;Представление></span><span class="светло_красный">,</span> <span class="серый">&lt;Пометка></span><span class="светло_красный">,</span> <span class="серый">&lt;Картинка></span><span class="светло_красный">);</span></span>

            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Пн", "Понедельник"<span class="светло_красный">);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Вт", "Вторник"<span class="светло_красный">);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Ср", "Среда"<span class="светло_красный">);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Чт", "Четверг"<span class="светло_красный">);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Пт", "Пятница"<span class="светло_красный">);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Сб", "Суббота"<span class="светло_красный">);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Вс", "Воскресенье"<span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p>Вот так выглядить список занчений в отладчике, который мы только создали:</p>
    <img src="../img/1С-1/2023-01-17_13-44-56.png" class="screen" alt="">
    <p class="title-size16"><b>Добавление картинки</b>.</p>
    <p>Чтобы добавить картинку будем пользоваться стандартными картинками, которые можно получить из глобального подтекста через объект <span class="светло_синий">БибилиотекаКартинок</span>. Ставим точку после этого объекта и нам вылетет целый список с названиями стандартных картинок:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ЗапуститьСписокЗначений(Команда)
                СписокДней = Новый СписокЗначений;
                СписокДней.Добавить("Пн", "Понедельник", , БиблиотекаКартинок.АктивироватьЗадачу);
                СписокДней.Добавить("Вт", "Вторник", , БиблиотекаКартинок.БизнесПроцесс);
                СписокДней.Добавить("Ср", "Среда", , БиблиотекаКартинок.АктивныеПользователи);
                СписокДней.Добавить("Чт", "Четверг", , БиблиотекаКартинок.БизнесПроцессОбъект);
                СписокДней.Добавить("Пт", "Пятница", , БиблиотекаКартинок.ВводНаОсновании);
                СписокДней.Добавить("Сб", "Суббота", , БиблиотекаКартинок.ВидРасчета);
                СписокДней.Добавить("Вс", "Воскресенье", , БиблиотекаКартинок.ВложеннаяТаблица); 
                
                ВыбранныйЭлемент = СписокДней.ВыбратьЭлемент("Выберите день");
            КонецПроцедуры
        </pre>
    </div>
    <img src="../img/1С-1/2023-01-18_10-16-24.png" alt="">
    <p class="title-size16"><b>Количество элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">КоличествоЭлементов <span class="светло_красный">=</span> СписокДней<span class="светло_красный">.</span>Количество<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Поиск элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>НайтиПоЗначению<span class="светло_красный">(</span>"Пн"<span class="светло_красный">);</span></span><span class="зелёный">// ЭлементСпискаЗначений</span>
            <span class="зелёный">// ЭлементСпискаЗначений это как бы объект, который содержит все поля выбранного элемента</span>
            <span class="зелёный">// это и индекс и значение и представление и пометка и картинка</span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>НайтиПоИдентификатору<span class="светло_красный">(</span>2<span class="светло_красный">);</span></span><span class="зелёный">// ЭлементСпискаЗначений</span>

            <span class="зелёный">// если вывести через Сообщить() или ОткрытьЗначение(), то автоматом будет </span>
            <span class="зелёный">// вызвано свойство Представление и мы увидим Понедельник в 1м случае и Среда во втором</span>
        </pre>
    </div>
    <p class="title-size16"><b>Получение элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Получить<span class="светло_красный">(3);</span></span><span class="зелёный">// Четверг</span>
            <span class="светло_синий">СписокДней<span class="светло_красный">[</span>3<span class="светло_красный">];</span></span><span class="зелёный">// Четверг</span>
            <span class="светло_синий">СписокДней<span class="светло_красный">[</span>3<span class="светло_красный">].</span>Значение<span class="светло_красный">;</span></span><span class="зелёный">// Чт</span>
        </pre>
    </div>
    <p class="title-size16"><b>Обход в цикле</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_красный">Для каждого</span> <span class="светло_синий">Элемент</span> <span class="светло_красный">Из</span> <span class="светло_синий">СписокДней</span> <span class="светло_красный">Цикл</span>
                    <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Элемент<span class="светло_красный">.</span>Значение<span class="светло_красный">);</span></span>
                    <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Элемент<span class="светло_красный">.</span>Представление<span class="светло_красный">);</span></span>
                    <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Элемент<span class="светло_красный">.</span>Пометка<span class="светло_красный">);</span></span>
                    <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Элемент<span class="светло_красный">.</span>Картинка<span class="светло_красный">);</span></span>
            <span class="светло_красный">КонецЦикла;</span>
        </pre>
    </div>
    <p>В обычном массиве в переменной Элемент лежали бы сразу значения элемента, но в списке значений в переменной Элемент лежит объект с полями(Значение(может иметь произвольный тип) и Представление(тип Строка)), Пометка и Картинка.</p>
    <p><b>Метод ВыбратьЭлемент() для выбора одного значения</b>. В этом и состоит главное отличие от массива. Это делает список значений удобным для взаимодействия с пользователем. Список с помощью метода ВыбратьЭлемент() выводит пользователю окно со списком событий описанных в сво-ве Представление(2й парметр при добавлении события), выбирая событие метод возвращает объект с типом "ЭлементСпискаЗначений" или возвращает Неопределено при отмене:</p>
    <div class="code-style">
        <pre>
            Список = Новый СписокЗначений;
            Список.Добавить(1861, "Отмена рабства");
            Список.Добавить(1961, "Полёт в космос");

            <span class="светло_красный">//при использовании модальности в конфигурации</span>
            ВыбранныйЭлемент = <span class="светло_синий">Список<span class="светло_красный">.</span>ВыбратьЭлемент<span class="светло_красный">(</span>"Выберите событие"<span class="светло_красный">);</span></span>

            Если ВыбранныйЭлемент &lt;> Неопределено Тогда
                Сообщить("Это событие произошло в " + ВыбранныйЭлемент.Значение);
            КонецЕсли;

            //<span class="зелёный">ответом при выборе одного из событий будет год, но год выведется так - 1 961, это из за форматирования чисел по умолчанию, 1С ставит пробел через каждые 3 разряда, начиная справа</span>
            //<span class="зелёный">можно исправить так</span>
            Если ВыбранныйЭлемент &lt;> Неопределено Тогда
                Сообщить("Это событие произошло в " + Формат(ВыбранныйЭлемент.Значение, "ЧГ=0"));
            КонецЕсли;


            <span class="светло_красный">//при НЕ использовании модальности у конфигурации</span>
            <span class="зелёный">//что тут ниже просиходит можно посмотреть в этом видео https://www.youtube.com/watch?v=RU2LyuhgWNo&t=3526s с 01:23:00</span>
            ЧтоДелатьПослеВыбора = Новый ОписаниеОповещения("ПослеВыбораЗначения", ЭтотОбъект);
            ВыбранныйЭлемент = Список.ПоказатьВыборЭлемента(ЧтоДелатьПослеВыбора, "Выберите событие");

            <span class="зелёный">//эта процедура выполнится если запущен способ при НЕ использовании модальности у конфигурации</span>
            &НаКлиенте
            Процедура ПослеВыбораЗначения(ВыбранныйЭлемент, ДополнительныеПараметры)
                Если ВыбранныйЭлемент = Неопределено Тогда
                    Возврат;
                КонецЕсли;
                Сообщить("Это событие случилось в " + ВыбранныйЭлемент + " году");
            Конецпроцедуры
        </pre>
    </div>
    <p class="title-size16"><b>Метод ОтметитьЭлементы() для выбора нескольких элементов</b>. </p>
    <div class="code-style">
        <pre>
            <span class="светло_красный">//этот модальный</span>
            <span class="зелёный">//для выбора нескольких элементов из списка пользователю предоставляет метод ОтметитьЭлементы()
            //очень важно!!! метод ОтметитьЭлементы() не возвращает список отмеченных элементов
            //он возвращает булево значение - Истина, если отмечен хоть 1 элемент и Ложь при не отмеченных или Отмене
            //но перебирать же что то надо, чтобы понять что выбрано, а перебирать будем наш Список
            //при переборе проверяем Элемент.Пометка, вот в этом сво-ве и будет стоять пометка выбран он или нет</span>
            ВыбранныеЭлементы = Список.ОтметитьЭлементы("Выберите несколько событий");
            ГодаВыбранныхСобытий = "";
            Если ВыбранныеЭлементы &lt;> Неопределено Тогда
                Для каждого Элемент из Список Цикл
                    Если Элемент.Пометка Тогда							
                        ГодаВыбранныхСобытий = ГодаВыбранныхСобытий + Элемент.Значение + " ";		
                    КонецЕсли;		
                КонецЦикла;
                Сообщить("Выбранные события случились в " + ГодаВыбранныхСобытий + " годах");
            КонецЕсли;


            <span class="светло_красный">//а это не модальный</span>
            <span class="зелёный">//ЧтоДелатьПослеОтметки = Новый ОписаниеОповещения("ПослеОтметкиЗначения", ЭтотОбъект);
            //ВыбранныйЭлемент = Список.ПоказатьВыборЭлемента(ЧтоДелатьПослеОтметки, "Выберите несколько событий");</span>
            &НаКлиенте
            Процедура ПослеОтметкиЗначения(Список, ДополнительныеПараметры)
                Если Список = Неопределено Тогда
                    Возврат;
                КонецЕсли;
                ГодаВыбранныхСобытий = "";
                Для каждого Элемент из Список Цикл
                    Если Элемент.Пометка Тогда							
                        ГодаВыбранныхСобытий = ГодаВыбранныхСобытий + Элемент.Значение + " ";		
                    КонецЕсли;		
                КонецЦикла;
                Сообщить("Выбранные события случились в " + ГодаВыбранныхСобытий + " годах");
            Конецпроцедуры

        </pre>
    </div>
    <p class="title-size16"><b>Удаление и очищение элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Удалить<span class="светло_красный">(2);</span></span>
            <span class="светло_синий">СписокДней<span class="светло_красный">.</span>Очистить<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p>Так выглядит список значений у пользователя:</p>
    <img src="../img/1С-1/2023-01-18_09-17-58.png" class="screen" alt="">

    <p class="title-size16"><b>Список значений можно использовать в качестве реквизита формы</b>.</p>
    <p>Это нужно, чтобы пользователь видел сам этот список у себя в 1с предприятии. Сделаем, например, форму у любого прикладного объекта, у той же внешней обработки и создадим у него реквизит "ДниНедели" с типом "Список значений". После этого сразу реквизит станет списком со своими свойствами, можно нажать на "+" и посмотреть свойства. Перенесём этот реквизит в элементы формы слева куда нам надо и система спросит нас как отображать этот список: таблицей или полем. Выберем сначало Таблица. Видим появиласт таблица похожая на табличную часть с 2мя кнопками "Добавить" и "Подбор". Кнопка "Добавить" понятно что делает, добавляет новое значение, а кнопка "Подбор" будет работать только если у нас есть значения ссылочного типа, когда нужно будет подобрать значения из справочника, документов и т.д. Также можно перетащить ещё раз этот реквизит, теперь уже в виде поля.В поле спрва будет кнопка с ..., по нажатию на которую откроется список со значениями и можно выбирать их там.</p>
    <p>Если в пользовательской части попробовать добавить значение, то выведется список типов нового значения из него выбираем какой тип нам нужен, а можно в форме реквизиту зразу задать "Тип значения" какой нам нужен, например выбор из какого-нибудь справочника(СправочникСсылка.Имя). Тепер при добавлении значения откроется список элементов из установленного справочника. И теперь кнопка "Подбор" также заработае, она позволяет не закрывая справочник выбирать много элементов тыкая по ним и они один за другим добавляются в наш список значений. Вот показан один из способов заполнить список значений, можно заполнять список и программно.</p>
    
    <p><b>Умеет сортировать</b>. Список может сам отсортировать свои значения - <span class="светло_синий">Список.СортироватьПоЗначению(НаправлениеСортировки.Возр/НаправлениеСортировки.Убыв);</span>. Как я заметил отсортируются по возрастанию лет, указанных 1м параметром при добавлении. В случае с обычным массивом нам бы пришлось делать сортировку по алгоритму "пузырёк".</p>
    <p><b>Умеет искать</b>. Также как и массив, список умеет сам искать свои элементы. Например, мы хотим выяснить, присутствует ли введёное пользователем число в нашем списке:</p>
    <div class="code-style">
        <pre>
            Список = Новый СписокЗначений;
            Список.Добавить(1861, "Отмена рабства");
            Список.Добавить(1961, "Полёт в космос");

            Число = 0;
            ВвестиЧисло(Число);

            <span class="светло_синий"></span>НайденныйЭлемент <span class="светло_красный">=</span> Список<span class="светло_красный">.</span>НайтиПоЗначению<span class="светло_красный">(</span>Число<span class="светло_красный">);</span></span>

            Если <span class="светло_синий">НайденныйЭлемент</span> = <span class="светло_красный">Неопределено</span> Тогда
                ОткрытьЗначение("Список не содержит такое число");
            Иначе
                ОткрытьЗначение("Число " + Число + " присутствует в списке. Вот оно: " + <span class="светло_синий">НайденныйЭлемент<span class="светло_красный">.</span>Значение</span>);
            КонецЕсли;
        </pre>
    </div>
    <p><b>Поддерживает вставку и удаление</b>. Список также как и массив поддерживает вставку и удаление элементов:</p>
    <div class="code-style">
        <pre>
            //<span class="зелёный">втавляем 1000 в начало списка</span>
            <span class="светло_синий">Список<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>0, 1000<span class="светло_красный">);</span></span>

            //<span class="зелёный">и тут же удаляем её из списка</span>
            <span class="светло_синий">Список<span class="светло_красный">.</span>Удалить<span class="светло_красный">(</span>0<span class="светло_красный">);</span></span>

            //<span class="зелёный">вставляем 13 в конец списка</span>
            <span class="светло_синий">Список<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>Список<span class="светло_красный">.</span>Количество<span class="светло_красный">(), </span>13<span class="светло_красный">);</span></span>

            //<span class="зелёный">выводим последний элемент списка</span>
            <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Список<span class="светло_красный">[</span>Список<span class="светло_красный">.</span>Количество<span class="светло_красный">()</span> - 1<span class="светло_красный">]</span><span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p><b>Поддерживает квадратные скобки</b>. Нумерация элементов списка также идёт с нуля и мы можем обратиться к любому элементу по его индексу через квадратные скобки:</p>
    <div class="code-style">
        <pre>
            Сообщить(Список[1].Значение);

            //мы также можем пробежаться по элемента списка через цикл для:
            Для А = 0 По Список.Количество() - 1 Цикл
                Сообщить(Список[А].Значение);
            КонецЦикла;
        </pre>
    </div>
    <p><b>Умеет создавать свою копию</b>. У списка значений есть просто отличная возвожность создавать свою копию.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">КопияСписка <span class="светло_красный">=</span> Список<span class="светло_красный">.</span>Скопировать<span class="светло_красный">();</span></span>

            //<span class="зелёный">теперь у нас есть копия КопияСписка, мы можем делать с ней что хотим, при этом оригинал не изменится</span>
        </pre>
    </div>
    <p><b>Умеет превращаться в массив</b>. Мы можем легко выгрузить все значения элементов списка в массив:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">МассивЧисел <span class="светло_красный">=</span> Список<span class="светло_красный">.</span>ВыгрузитьЗначения<span class="светло_красный">();</span></span>
            //<span class="зелёный">теперь МассивЧисел является массивом</span
        </pre>
    </div>
    <p><b>Умеет загружать массив</b>. Мы можем загрузить в список значений, например, колонку из таблицы значений, для этого у ТЗ есть метод ВыгрузитьКолонку("Имя колонки"), этот метод возвращает массив, как раз то, что и нужно на вход в список значений:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
            ТЗ <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">();</span>
            
            СЗ <span class="светло_красный">= Новый</span> СписокЗначений<span class="светло_красный">;</span>
            СЗ<span class="светло_красный">.</span>ЗагрузитьЗначения<span class="светло_красный">(</span>ТЗ<span class="светло_красный">.</span>ВыгрузитьКолонку<span class="светло_красный">(</span><span class="серый">"СрокГодности"</span><span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Использование списка значений на форме, начинается в видео с 01:35:00</b></p>











    
    <h3 class="header-style2" id="table">Таблица значений</h3>
    <img src="../img/1С-1/2023-01-18_11-16-33.png" class="screen" alt="">
    <p>Таблица значений используется в том случае если нужно в коде работать с табличными данными. Например, запрос к виртуальным таблицам через объектную модель запроса вернёт таблицу с типом "ТаблицаЗначений" и т.д. Например, "РегистрНакопления.ОстаткиТоваров.Остатки()" или "РегистрСведений.ЦеныПоставщиков.СрезПоследних()".</p>
    <p>При создании таблицы значений нужно определить какие колонки в этой таблице будут. Имя колонки указываются в виде строки. У каждой строки есть индекс, а в значениях колонок может быть произвольный тип данных. Таблица значений как коллекция довольна тяжела в смысле использования ею ресурсов компьютера, поэтому она <b>не доступна на клиенте</b>, поэтому когда я для тренировки создавал внешнюю обработку с формой и на форме размещал кнопку для запуска примеров с таблицей значений, то действие для этой кнопки будет процедура на клиенте с запуском процедуры на сервере. Таблица значений это как массив содержащий структуры. Рассмотрим как работать с таблицей значений.</p>
    <p>Таблицу значений можно получить выгрузив из результата запроса данные с помощью метода Выгрузить(). Также таблицу значений можно получить выгрузив данные из табличной части опять с помощью метода Выгрузить(). И ещё можно получить её выгрузив из набора записей регистра и т.д. Для более подробных сведений смотреть синтакс помошник.</p>
    <p>Будем создавать таблицу с товарами, в которой будут поля Артикул, Наименование, Количество, ЦенаЗакупки, ЦенаПродажи и Сумма.</p>

    <p><b id="table-1">Создаём таблицу значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный"> = Новый</span> ТаблицаЗначений<span class="светло_красный">;</span></span>
        </pre>
    </div>

    <p><b id="table-2">Добавляем колонки таблицы</b>.</p> 
    <p>У созданной таблицы есть свойство Колонки, это свойство содержит коллекцию колонок данной таблицы(что то типо набора записей у регистра). Эта коллекция колонок имеет ряд методов работы с колонками. Нам нужно добавить колонки:</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//все параметры метода Добавить необязательны</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>&lt;Имя><span class="светло_красный">,</span>&lt;Тип><span class="светло_красный">,</span>&lt;Заголовок><span class="светло_красный">,</span>&lt;Ширина><span class="светло_красный">)</span>;</span>

            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Группа"</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Артикул"</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Наименование"</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Количество"</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"ЦенаЗакупки"</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"ЦенаПродажи"</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Сумма"</span><span class="светло_красный">)</span>;</span>
        </pre>
    </div>
    <p><span class="светло_красный">Важно!!!</span>. Для колонок обязательно нужно установить 2м параметром тип колонок, как это делать описано <a href="#typeColumn">ниже</a>.</p>

    <p><b id="table-3">Выгружаем колонку в список значений</b>. 
    <div class="code-style">
        <pre>
            <span class="светло_синий">РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
            ТЗ <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">();</span>
            
            СЗ <span class="светло_красный">= Новый</span> СписокЗначений<span class="светло_красный">;</span>
            СЗ<span class="светло_красный">.</span>ЗагрузитьЗначения<span class="светло_красный">(</span>ТЗ<span class="светло_красный">.</span>ВыгрузитьКолонку<span class="светло_красный">(</span><span class="серый">"СрокГодности"</span><span class="светло_красный">);</span></span>
        </pre>
    </div>

    <p><b id="table-4">Добавляем/вставляем элементы(строки) в таблицу значений</b>.</p> 
    <p>Метод Добавить() добавляет строку в конец таблицы, не имеет параметров и возвращает объект с типом "СтрокаТаблицыЗначений"</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//добавляем первую строку</span>
            <span class="светло_синий">НоваяСтрока <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Группа <span class="светло_красный">=</span> <span class="серый">"Компьютерные комплектующие"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Артикуль <span class="светло_красный">=</span> <span class="серый">"А12344"</span>;</span> <span class="зелёный">//или</span> <span class="светло_синий">НоваяСтрока<span class="светло_красный">[</span>"Артикуль"<span class="светло_красный">]</span> <span class="светло_красный">=</span> <span class="серый">"А12344"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Наименование <span class="светло_красный">=</span> <span class="серый">"Мышь Logitec"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> 3;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>ЦенаЗакупки <span class="светло_красный">=</span> 120;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>ЦенаПродажи <span class="светло_красный">=</span> 350;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> 1050;</span>

            <span class="зелёный">//добавляем вторую строку</span>
            <span class="светло_синий">НоваяСтрока <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Группа <span class="светло_красный">=</span> <span class="серый">"Компьютерные комплектующие"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Артикуль <span class="светло_красный">=</span> <span class="серый">"А32112"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Наименование <span class="светло_красный">=</span> <span class="серый">"Клавиатура Logitec"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> 1;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>ЦенаЗакупки <span class="светло_красный">=</span> 2000;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>ЦенаПродажи <span class="светло_красный">=</span> 4500;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> 4500;</span>

            <span class="зелёный">//добавляем третью строку</span>
            <span class="светло_синий">НоваяСтрока <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="светло_красный">)</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Группа <span class="светло_красный">=</span> <span class="серый">"Микрофоны"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Артикуль <span class="светло_красный">=</span> <span class="серый">"Б36712"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Наименование <span class="светло_красный">=</span> <span class="серый">"Микрофон Rode NT-32"</span>;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> 2;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>ЦенаЗакупки <span class="светло_красный">=</span> 3000;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>ЦенаПродажи <span class="светло_красный">=</span> 5500;</span>
            <span class="светло_синий">НоваяСтрока<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> 11000;</span>

            <span class="зелёный">//добавление строк конечно нужно делать в цикле</span>
        </pre>
    </div>

    <p><b id="table-5">Получение количества элементов(строк) в таблице значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">КоличествоСтрок <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>Количество<span class="светло_красный">(</span><span class="светло_красный">)</span>;</span>
        </pre>
    </div>

    <p><b id="table-6">Поиск элемента/элементов(строки/строк) в таблице значений</b>.</p> 
    <p>Для этого есть 2 метода Найти(&lt;Значение>, &lt;Колонки>), который ищет один элемент таблицы, и НайтиСтроки(&lt;ПараметрыОтбора>) ищущий несколько строк. Метод Найти() возвращает объект строки с типом "СтрокаТаблицыЗначений", либо Неопределено.</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//найдём одну строку с наименованием "Мышь logitec"</span>
            <span class="светло_синий">Мышь <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>Найти<span class="светло_красный">(</span>"Мышь logitec", "Наименование"<span class="светло_красный">)</span>;
            <span class="светло_красный">Если</span> Мышь <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                Сообщить<span class="светло_красный">(</span>"Товар Мышь не найдена в таблице"<span class="светло_красный">)</span>;
            <span class="светло_красный">КонецЕсли;</span></span>

            <span class="зелёный">//если мы пытаемся найти по значению колонки и это значение повторяется
            //у нескольких строк, то будет возвращена строка найденая первая с таким значением
            //ну например мы ищем по значению "Компьютерные комплектующие" колонки "Группа"
            //такое значение колонки есть у нескольких строк, поэтому чтобы получить все строки с таким значением
            //нужно использовать другой метод НайтиСтроки(). Этот метод принимает ПараметрОтбора
            //в виде структуры. Структура вообще часто выступает параметром отбора для разных методов,
            //потому что у неё удобное хранение данных(Ключ-Значение) для таких отборов</span>
            <span class="светло_синий">ПараметрОтбора <span class="светло_красный">= Новый</span> Структура<span class="светло_красный">(</span><span class="серый">"Группа"</span><span class="светло_красный">,</span> <span class="серый">"Компьютерные комплектующие"</span><span class="светло_красный">)</span>;
            ВсеКомплектующие <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>НайтиСтроки<span class="светло_красный">(</span>ПараметрОтбора<span class="светло_красный">)</span>;</span>
            <span class="зелёный">//метод НайтиСтроки() возвращает массив объектов с типом 
            //"СтрокаТаблицыЗначений"</span>
            <span class="светло_синий"><span class="светло_красный">Если</span> ВсеКомплектующие<span class="светло_красный">.</span>Количество<span class="светло_красный">() =</span> 0 <span class="светло_красный">Тогда</span>
                Сообщить<span class="светло_красный">(</span><span class="серый">"Элементов таблицы не найдены с таким значением"</span><span class="светло_красный">)</span>;
            <span class="светло_красный">КонецЕсли;</span>
            <span class="светло_красный">Для каждого</span> СтрокаТаблицы <span class="светло_красный">Из</span> ВсеКомплектующие <span class="светло_красный">Цикл</span>
                <span class="зелёный">//в переменной СтрокаТаблицы на каждом круге будет объект
                //у этого объекта доступны все колонки таблицы через точку или скобки</span>
                Сообщить<span class="светло_красный">(</span>СтрокаТаблицы<span class="светло_красный">.</span>Артикул<span class="светло_красный">)</span>;
            <span class="светло_красный">КонецЦикла;</span></span>
        </pre>
    </div>

    <p><b id="table-7">Создание копии таблицы значений</b>.</p> 
    <p>Ну например нам нужно с пришедшей таблицей что то сделать, но при этом не трогая исходную таблицу. Для этого есть 2 способа копирования: 1)Целиком вместе с данными, 2)Можно копировать в части описания колонок, без данных. Для первого случая есть метод Скопировать(&lt;Строки>, &lt;Колонки>), этот метод может даже отфильтровать какие строки мы можем скопировать, например мы хотим не всю таблицу скопировать, а только те строки, где есть значения "Компьютерные комплектующие" колонки Группа. В параметр &ltСтроки> нужно передать массив строк, выше мы уже отобрали такие строки и они лежат в переменной ВсеКомплектующие, вот их и передадим для копирования. Если ничего не передавать, будут скопированы все строки. Также если вторым параметром указать в строке перечисленные названия колонок, то будут добавлены только эти колонки, а не все. Давайте добавим только колонку Наименования скопированных комплектующих.</p>
    <p>Для второго случая есть метод СкопироватьКолонки(&lt;Колонки>), тут указываются в виде строки названия колонок, копирование идёт без значений колонок.</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//1й способ</span>
            <span class="светло_синий">ТаблицаКомплектующих <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>Скопировать<span class="светло_красный">(</span>ВсеКомплектующие, "Наименование, ЦенаПродажи"<span class="светло_красный">)</span>;</span>

            <span class="зелёный">//2й способ</span>
            <span class="светло_синий">ПолнаяКопияБезДанных <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>СкопироватьКолонки<span class="светло_красный">(</span><span class="светло_красный">)</span>;</span>
            <span class="зелёный">//теперь в переменной ПолнаяКопияБезДанных лежит таблица значений, у которой
            //есть свойство Колонки(КоллекцияКолонокТаблицыЗначений), эта коллекция содержит объекты колонок
            //из этих объектов колонок можно получить имена колонок и т.д.
            //для чего такая копия нужна пока не знаю. 
            </span>
        </pre>
    </div>

    <p><b id="table-8">Выполняем сортировку в таблице значений</b>.</p> 
    <p>Если мы запросили остатки товаров, то к нам приходит ТаблицаЗначений, вот мы её можем на месте отсортировать по убыванию или возрастанию, если это не сделано в запросе. Для этого есть метод Сортировать(&lt;Колонки>, &lt;ОбъектСравнения>). Второй параметр используется не часто, чаще первый. У нас есть скопированная таблица комплектующих с 2мя колонками - Наименование и ЦенаПродажи, отсортируем по ЦенаПродажи по убыванию:</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//по возрастанию ЦенаПродажи, стоит по умолчанию</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Сортировать<span class="светло_красный">(</span>"ЦенаПродажи"<span class="светло_красный">)</span>;</span>

            <span class="зелёный">//по убыванию ЦенаПродажи</span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Сортировать<span class="светло_красный">(</span>"ЦенаПродажи Убыв"<span class="светло_красный">)</span>;</span>
        </pre>
    </div>

    <p><b id="table-9">Получение итогов по числовой колонке</b>.</p> 
    <p>Для этих целей есть метод Итог(&lt;Колонка>). В параметр передаётся имя колонки, по которой необходимо посчитать итог. Можно конечно и в цикле обойти строки и просуммировать значения колонки, но есть способ проще, просто метод Итог():</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//как помним в ТаблицаКомплектующих лежит скопированная таблица строк
            //только комплектующих товаров с 2 мя колонками "Наименование" и "ЦенаПродажи"
            </span>
            <span class="светло_синий">ИтогЦеныПродажи<span class="светло_красный"> = </span>ТаблицаКомплектующих<span class="светло_красный">.</span>Итог<span class="светло_красный">(</span>"ЦенаПродажи"<span class="светло_красный">)</span>;</span>
        </pre>
    </div>

    <p><b id="table-10">Свёртывание(Группировка) строк таблицы значений</b>.</p> 
    <p>Есть метод Свернуть(), он такой же как в запросах мы групируем по одному полю и например суммируем по другому. Насколько я заметил, то тут есть одно отличие от группировки в запросах. Мы укажем по какой колонке надо свернуть, а другая колонка, ну например Договор из картинки ниже сама исчезнет из результатирующей таблицы. В запросах я точно не помню, но там если есть такое поле как Договор, то с ним тоже надо что то делать, сам по себе он не пропадёт, его надо будет тоже в группирующее поле помещать.</p>
    <img src="../img/1С-1/2023-01-19_10-41-18.png" class="screen" alt="">
    <div class="code-style">
        <pre>
            <span class="зелёный">//важно помнить, что мы сворачиваем основную таблицу товаров и после
            //свёртки она изменится, ну во-первых колонки останутся только 2(Группа, Сумма) 
            //и второе они будут свёрнуты
            </span>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Свернуть<span class="светло_красный">(</span><span class="серый">"Контрагент"</span><span class="светло_красный">,</span> <span class="серый">"Сумма"</span><span class="светло_красный">)</span>;</span>
        </pre>
    </div>

    <p><b id="table-11">Заполнение зачениями колонки таблицы</b>.</p>
    <p>Допустим мы хотим к таблице добавить колонку, добавляем её, даём имя и надо чем то заполнить в каждой строке эту колонку. Для этого есть метод ЗаполнитьЗначениями(), 1й параметр это значение, второй параметр имя колонки, в которую заполняем:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">);</span>
            ТаблицаТоваров<span class="светло_красный">.</span>ЗаполнитьЗначения<span class="светло_красный">(</span>Склад<span class="светло_красный">,</span> <span class="серый">"Склад"</span><span class="светло_красный">);</span>
        </pre>
    </div>
    <p>В переменной Склад, например, лежит слово Основной, значит во всех строках этой колонки заполнится значение Основной.</p>

    <p><b id="table-12">Хотим заполнить пустую таблицу значений значениями из другой таблицы значений</b></p>
    <p><a href="https://helpf.pro/faq8/view/512.html">Вот тут</a></p>

    <p><b id="table-13">Обход всех строк(элементов) таблицы значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//из за того что мы выше свернули основную таблицу и поля в ней урезались
            //то часто быввает что об этом забывают и пытаются при переборе получить поля, которых нет
            //об этом надо помнить, либо копировать всю таблицу и уже копированнную свёртывать
            //чтобы основная была не тронута
            </span>
            <span class="светло_красный">Для каждого</span> <span class="светло_синий">СтрокаТаблицы</span> <span class="светло_красный">Из</span> <span class="светло_синий">ТаблицаТоваров</span> <span class="светло_красный">Цикл</span>
                <span class="светло_синий">Сообщить<span class="светло_красный">(</span>Элемент<span class="светло_красный">.</span>Значение<span class="светло_красный">);</span></span>
            <span class="светло_красный">КонецЦикла;</span>
        </pre>
    </div>

    <p><b id="table-14">Удалить строку из таблицы значений</b>.</p> 
    <p>Есть 2 способа удаления: 1)по объекту, указываем в параметре объект строку, 2)по индексу, указываем индекс.</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//1й способ по объекту. При удалении по объекту нужно найти этот объект
            //ещё раз напомню основная таблица свёрнута и не имеет поля Наименование
            </span>
            <span class="светло_синий">Мышь <span class="светло_красный">=</span> ТаблицаТоваров<span class="светло_красный">.</span>Найти<span class="светло_красный">(</span><span class="серый">"Мышь logitec"</span><span class="светло_красный">,</span> <span class="серый">"Наименование"</span><span class="светло_красный">)</span>;
            <span class="светло_красный">Если</span> Мышь <span class="светло_красный">&lt;></span> Неопределено <span class="светло_красный">Тогда</span>
                <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Удалить<span class="светло_красный">(</span>Мышь<span class="светло_красный">)</span>;</span>
            <span class="светло_красный">КонецЕсли;</span>

            <span class="зелёный">//удаление по индексу, важно тоже проверять на наличие удаляемого      
            //индекса, можно проверить количеством строк
            </span>

            <span class="зелёный">//Как правильно удалять несколько строк из таблицы значений?
            //Первое, нужно сначала собрать все строки для удаления в массиве и потом при переборе
            //массива удалить строки из ТЗ. Если мы будем сразу перебирать ТЗ и удалять, то будут ошибки
            //Всё потому, что если в цикле Для каждого для ТЗ удалить строку, то строки не перестроятся</span>
            ТаблицаТоваров = Новый ТаблицаЗначений;
            ТаблицаТоаров.Колонки.Добавить("Колонка1");
            ТаблицаТоаров.Колонки.Добавить("Колонка2");

            //добавление строк

            <span class="зелёный">//Хотим удалить все строки, где в колонке "Колонка1" есть значение 1</span>
            ПараметрыОтбора = Новый Структура("Колонка1", 1);
            МассивСтрок = ТаблицаТоваров.НайтиСтроки(ПараметрыОтбора);

            Для каждого УдаляемаяСтрока Из МассивСтрок Цикл
                ТаблицаТоваров.Удалить(УдаляемаяСтрока);
            КонецЦикла;

            <span class="зелёный">//А вот в цикле Для с счётчиком можно удалять строки из ТЗ, строки будут перестраиваться</span>
            КоличествоСтрок = ТаблицаТоваров.Количество();
            Для Сч = 0 По КоличествоСтрок - 1 Цикл
                Если ТаблицаТоваров[Сч].Колонка1 = 1 Тогда
                    ТаблицаТоваров.Удалить(Сч);
                    Сч = Сч - 1;
                    КоличествоСтрок = КоличествоСтрок - 1;
                КонецЕсли;
            КонецЦикла;</span>
        </pre>
    </div>

    <p><b id="table-15">Очиска таблицы значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Очистить<span class="светло_красный">(</span><span class="светло_красный">)</span>;</span>
        </pre>
    </div>

    <p><b>Особенности работы с таблицей значений</b>.</p> 
    <p><b id="table-16">1 особенность</b></p>
    <p>Часто таблицы значений могут быть большими(1000, 10000, 1000000 строк) и поиск по такой таблице может затянуться. Чтобы избежать затяжного поиска у таблицы есть свойство Индексы. Это свойство содержит коллекцию индексов таблицы значений. Что это такое? Возьмём например толстую книгу и нам нужно найти какой то текст в этой книге, мы можем листая каждую страницу просматривать на совпадение с искомым текстом, это займёт очень много времени. А можно просто посмотреть в оглавление и узнать на какой странице наш искомый текст. Вот также работает свойство Индексы. У этой коллекции есть методы Добавить(&lt;Колонки>), Удалить(), Количество() и Очистить(). Мы например знаем по каким колонкам мы будем искать, пусть мы ищем по Артикулам, значит нам надо перед поиском провести индексацию по полю Артикул:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">ТаблицаТоваров<span class="светло_красный">.</span>Индексы<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>"Артикул"<span class="светло_красный">)</span>;</span>

            <span class="зелёный">//ну и далее уже можно искать</span>
        </pre>
    </div>
    <p><b id="table-17">2 особенность. Передача таблицы значений как параметра в запрос</b></p>
    <p><span class="светло_красный">Как то пытался передать ТЗ параметром в запрос, но вылетала ошибка, связанная с типом данных. Оказалось, когда я создавал ТЗ вручную и задавал колонки, то нужно для колонок обязательно задать типы данных, которые будут в них храниться, иначе не заработает.</span></p>
    <p id="typeColumn">Работа с таблицей значений, созданной в тексте программы, в запросе. Часто бывают ситуации, когда нашу таблицу значений, лежащей в оперативной памяти нужно перенести в запрос, для того чтобы в запросе выполнить соединение нашей таблицы с таблицей из запроса. Открываем к коде конструктор запросов и выше центральной колонки есть кнопка "Создать описание временной таблицы", как я понял это кнопка служит для того чтобы в конструктор ввести описание внешней таблицы для помещения её во временную таблицу и эта таблица уже будет доступна в конструкторе для дальнейшей работы с ней. Итак открываем окно описания и вносим имя таблицы "ТаблицаТоваров" и также вносим все поля, которые у нас есть в таблице значений - Артикул, Наименование, Количество, ЦенаЗакупки, ЦенаПродпжи, Сумма. Нажимаем ОК и у нас в центральной колонке появилась наша таблица, из неё выносим получение полей в правую колонку и теперь надо поместить её во временную таблицу на вкладке Дополнительно. Дадим имя временной таблице ВТ_Товары и далее во вкладке "Пакет запросов" жмём создать второй запрос по плюсику и уже можно писать новый запрос используя временную нашу таблицу. Мы можем соединить нашу временную таблицу с таблицей из БД и т.д. Когда конструктор собрал запрос и мы увидели этот запрос в тексте программы, то запрос пока ещё не понимает как ему взять в запрос нашу таблицу значений ТаблицаТоваров, для этого нужно указать в запросе, что ТаблицаТоваров это параметр и надо дописать строку с установкой параметра для ТаблицыТоваров, на примере будет всё понятно:</p>
    <img src="../img/1С-1/2023-01-20_09-28-19.png" class="screen" alt="">
    <p>На запрос особо нечего засматриваться, там ничего интересного, просто показано как таблицу из кода внести в запрос для работы.</p>
    <p><span class="светло_красный">Ошибка!!!</span>. Если запустить этот код, то будет ошибка, что поле Артикул не может быть найдено, это происходит потому, что наши колонки в таблице значений не типизированны, а у них должно быть обязательно указаны типы, иначе такой запрос ситема выполнить не моджет. Выход следующий, когда мы добавляли колонки в таблицу, то 2й параметр у метода Добавить() это Тип, нужно добавить типы колонок. Чтобы описать тип используется объект <span class="светло_синий">ОписаниеТипов</span>. В этом видео про это рассказывается с 02:25:00 - https://www.youtube.com/watch?v=RU2LyuhgWNo&list=PLnhTnXRFDQ7en_MVaepKmkL2g23zOXQMx&index=8:</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//опишем тип число
            //квалификаторы какого то типа это, например для числа это описание лоп. настроек как 
            //длина, точность, отрицательное или нет</span>
            <span class="светло_синий">
            КвалификаторыЧисла = Новый КвалификаторыЧисла(10, 2);
            ОписаниеТипаЧисло = Новый ОписаниеТипов("Число", , , КвалификаторыЧисла)</span>

            <span class="зелёный">//опишем тип строка
            //квалификаторы для строки такие как длина строки, допустимая длина
            //важно заметить что квалификатор для строки в описании типов будет стоять 5м параметром
            </span>
            <span class="светло_синий">
            КвалификаторыСтроки = Новый КвалификаторыСтроки(100);
            ОписаниеТипаСтрока = Новый ОписаниеТипов("Строка", , , , КвалификаторыСтроки)</span>

            <span class="зелёный">//когда мы создаём какой то объект конфигурации, то там мы указываем типы и квалификаторы
            //для реквизитов просто выбирая из списка типов или ставя галочки, вот тут то же самое
            //только в программном виде</span>
        </pre>
    </div>
    <p>Мы создали типы для наших колонок, вот их и надо добавить 2м параметом в метод Добавить() коллекции Колонки -> ТаблицаТоваров.Колонки.Добавить("Артикуль", ОписаниеТипаСтрока); и так далее для всех колонок.</p>
    <p>Колонки должны быть типизированы, если мы хотим использовать нашу таблицу значений в запросе.</p>
    <img src="../img/1С-1/2023-01-20_10-14-22.png" class="screen" alt="">

    <p><b id="table-18">Работа с таблицей значений на форме</b>. Точно так как и список значений мы можем разместить на форме реквизит с типом "ТаблицаЗначений". Например создадим реквизит "ТаблицаОстатки" и укажем ей этот тип. Как только мы этому реквизиту указали тип "ТаблицаЗначений", то сверху в панельке кнопок стала доступка кнопка "Добавить колонку реквизита". Нажав на неё внутри реквизита появится колонка реквизит, ей зададим имя такое как и у регистра накопления называются измерения и русурс. Мы хотим показывать в этой таблице какую нибудь таблицу регистра накопления "ОстаткиНоменклатуры". У регистра есть 2 измерения Товар и Склад и ресурс Количество, значит называем реквизит колонку Товар с типом СправочникСсылка.Номенклатура, затем добавим реквизит колонку Склад, с типом СправочникСсылка.Склад и колонку Количество с типом Число. Перетаскиваем реквизит "ТаблицаОстатки" влево на элементы формы. Смотрим что получилось, пока это просто таблица, в которую можно добавлять товары и склады из справочников. Мы же хотим при открытии этой формы заполнения остатками из регистра. Для этого для события формы "ПриСозданииНаСервере" напишем обработчик. В обработчике конструируем запрос из таблицы регистра накопления ОстаткиНоменклатуры.Остатки. Обход результата запроса нам не нужен, а нужен метод РезультатЗапроса.Выгрузить();. Как известно этот метод выгружает результат в таблицы. Но просто так выгрузить в реквизит "ТаблицаОстатки" не получится, потому что у реквизита с типом таблица значений есть свой метод Загрузить(). Поэтому сначала выгружаем из результата во временную переменную, а потом в "ТаблицаОстатки" загружаем из этой временной переменной.</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)	
                Запрос = Новый Запрос;
                Запрос.Текст = 
                    "ВЫБРАТЬ
                    |	ОстаткиНоменклатурыОстатки.Номенклатура КАК Номенклатура,
                    |	ОстаткиНоменклатурыОстатки.Склад КАК Склад,
                    |	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество
                    |ИЗ
                    |	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки";
                
                РезультатЗапроса = Запрос.Выполнить();
                ТаблицаЗапроса = РезультатЗапроса.Выгрузить();
                ТаблицаОстатки.Загрузить(ТаблицаЗапроса);
            КонецПроцедуры
        </pre>
    </div>
    <p>Хотя если посмотреть в форме какой тип показывает у реквизита "ТаблицаОстатки", то там в скобках написано (ТаблицаЗначений), если в таких скобках, значит это не совсем таблица значений, хотя методы у неё такие как и у таблицы занчений, но не все, например, метода Свернуть() нет. Посмторел в отладчике, тип на самом деле у этого реквизита  - ДанныеФормыКоллекция. Чтобы получить таблицу значений из этого реквизита, есть такой метод как <span class="светло_синий">РеквизитФормыВЗначение("ТаблицаОстатки")</span> аернёт таблицу значений.</p>
    <p>Таким не хитрым способом можно отображать регистры(и не только) в формах обработки, документа или ещё где то.</p>










    <h3 class="header-style2" id="tree">Дерево занчений</h3>
    <p>Дерево значений это коллекция, которая позволяет хранить данные почти в таком же виде как и таблица значений, за исключением того, что в таблице значений у нас все строки равнозначны. Дерево же значений позволяет работать со строками таблицы в режиме подчинения одной строки другой, т.е. присутствие иерархии. У нас появилось новое поле "Родитель", которое указывает на строку-родитель текущей строки. На картинке ниже строка с индексом 0 является родителем строк с индексами 1 и 2. Пример дерева значений это справочник Номенклатура с иерархией по группам и элементам. Даже в пользовательской части при просмотре этого справочника есть возможность включить режим просмотра "Дерево". Вот это и есть дерево значений. Теперь нужно научиться программно такое создавать. Дерево значений доступно только на сервере.</p>
    <img src="../img/1С-1/2023-01-21_08-29-27.png" class="screen" alt="">
    <p>На примере создадим дерево значений хранящее данные об остатках товаров.</p>
    <div class="code-style">
        <pre>
            <span class="светло_красный">Создание</span>
            ДеревоОстатки = Новый ДеревоЗначений;

            <span class="светло_красный">Добавление колонок в дерево значений</span>
            ДеревоОстатки.Колонки.Добавить("Товар");
            ДеревоОстатки.Колонки.Добавить("Склад");
            ДеревоОстатки.Колонки.Добавить("Количество");

            <span class="светло_красный">Добавление элементов(строк) в дерево значений</span>
            <span class="зелёный">//у дерева значений есть свойство Строки, это свойство содержит КоллекциюСтрокДереваЗначений
            //только 1го уровня, остальные уровни строк можно получить обращаясь к уже имеющимся строкам
            //создадим 1й уровень строк остатки по складам</span>
            <span class="зелёный">//добавим 1го уровня по основному складу</span>
            ОстаткиПоОсновномуСкладу = ДеревоОстатки.Строки.Добавить();
            ОстаткиПоОсновномуСкладу.Склад = "Основной";
            ОстаткиПоОсновномуСкладу.Количество = 160;

            <span class="зелёный">//Далее добавляем детальные строки по складу Основной. Эти строки уже имеют 2й уровень</span>
            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Основной";
            ДетальнаяСтрока.Товар = "Груши";
            ДетальнаяСтрока.Количество = 10;

            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Основной";
            ДетальнаяСтрока.Товар = "Яблоки";
            ДетальнаяСтрока.Количество = 50;

            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Основной";
            ДетальнаяСтрока.Товар = "Арбуз";
            ДетальнаяСтрока.Количество = 100;

            <span class="зелёный">//добавим 1го уровня по доп. складу</span>
            ОстаткиПоДопСкладу = ДеревоОстатки.Строки.Добавить();
            ОстаткиПоДопСкладу.Склад = "Дополнительный";
            ОстаткиПоДопСкладу.Количество = 100;

            <span class="зелёный">//Далее добавляем детальные строки по складу Дополнительный. Эти строки уже имеют 2й уровень</span>
            ДетальнаяСтрока = ОстаткиПоДопСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Дополнительный";
            ДетальнаяСтрока.Товар = "Арбуз";
            ДетальнаяСтрока.Количество = 30;

            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Дополнительный";
            ДетальнаяСтрока.Товар = "Апельсины";
            ДетальнаяСтрока.Количество = 70;

            <span class="светло_красный">Получение количества строк в дереве значений. Тут немного всё по сложней</span>
            <span class="зелёный">//общее количество не так просто получить, потому что нет метода Количество()
            //у дерева значений, но есть такой метод у строк</span>
            КоличествоСтрокВерхнегоУровня = ДеревоОстатки.Строки.Количество(); -> 2(Основной, Дополнительный)
            КоличествоСтрокОсновногоСклада = ОстаткиПоОсновномуСкладу.Строки.Количество(); -> 2(детальные)
            КоличествоСтрокДопСклада = ОстаткиПоДопСкладу.Строки.Количество(); -> 2(детальные)
            <span class="зелёный">//в сумме получается 6 строк. Но как правило получать общее количество
            //и не нужно, хватает понимания количества на каком то конкретном уровне</span>

            <span class="светло_красный">Находим один элемент в дереве значений</span>
            <span class="зелёный">//есть метод Найти(&lt;Значение>,&lt;Колонки>,&lt;ВключатьПодчиненные>)
            //не у дерева, а у строк. В Значение указывем Что иы ищем, а в Колонки - Где, ВключатьПодчиненные
            //это Истина или Ложь, указываем искать во вложенных строках или нет
            //найдём, например, строку с товаром Арбуз
            //вернёт Неопределено, потому что Арбуз находится в подчиненных строках
            //а параметр ВключатьПодчиненные по умолчанию стоит в положении Ложь</span>
            СтрокаСАрбузом = ДеревоОстатки.Строки.найти("Арбуз", "Товар");

            <span class="зелёный">//а так вернёт объект СтрокаДереваЗначений у которого через точку можно получить товар
            //так как у нас есть 2 товара арбуз на разных складах, то этот метод найдёт первую попавшую строку
            </span>
            СтрокаСАрбузом = ДеревоОстатки.Строки.Найти("Арбуз", "Товар", Истина);
            Если СтрокаСАрбузом &lt;> Неопределено Тогда
                Сообщить(СтрокаСАрбузом.Товар);
                Сообщить(СтрокаСАрбузом.Количество);
            Иначе
                Сообщить("Такой строки нет");
            КонецЕсли;

            <span class="светло_красный">Находим все строки дерева значений, которые удовлетворяют условию поиска</span>
            <span class="зелёный">//для этого есть метод у строк НайтиСтроки(&lt;ПараметрыОтбора>, &lt;ВключатьПодчиненные>)
            //параметр Параметрыотбора это структура, 2й параметр уже известено что значит. Метод возвращает массив</span>
            Отбор = Новый Структура("Товар", "Арбуз");
            ВсеСтрокиСАрбузами = ДеревоОстатки.Строки.НайтиСтроки(Отбор, Истина);
            Если ВсеСтрокиСАрбузами.Количество() &lt;> 0 Тогда
                Сообшить("Найдено строк: " + ВсеСтрокиСАрбузами.Количество());
            КонецЕсли;

            <span class="светло_красный">Создаём копию дерева значений с данными</span>
            <span class="зелёный">//ни у самого дерева значений, ни у его строк нет метода, который бы копировал
            //всю таблицу, поэтому чтобы сделать копию придётся создать новую таблицу дерево значений 
            //и в цикле обойти всю таблицу и перекопировать все строки</span>



            <span class="светло_красный">Удаление строки дерева значений</span>
            <span class="зелёный">//удаление есть у строк и их 2 способа</span>
            <span class="зелёный">//метод Удалить(&lt;Строка>). Чтобы удалить, строку нужно найти. Удалим, например 
            //строку с товаром Арбуз, выше в примере мы уже находили эту строку и объект этой строки лежит
            //в переменной СтрокаСАрбузом, в которой лежит первая попавшаяся строка с товаром Арбуз
            //Важно!!! Удалить можно только строку из того же уровня данной коллекции строк
            //т.е. удалить из коллекции строк 1 уровня нельзя строку 2 уровня</span>
            ОстаткиПоОсновномуСкладу.Строки.Удалить(СтрокаСАрбузом);

            <span class="зелёный">//у нас есть 2 товара Арбуз в разных складах. А что если мы хотим удалить
            //не первый попавшийся, а конкретную строку товара Арбуз? Тогда используем метод НайтиСтроки()
            //чем он нам поможет? А тем, что мы в него можем передавать Отбор, а в отборе мы можем указать
            //товар и склад. Из за того, что метод возвращает массив, обходим в цикле и удаляем
            //тут также, раз мы нашли товар в коллекции ОстаткиПоДопСкладу, то и удалять нужно из этой коллекции
            </span>
            Отбор = Новый Структура("Товар, Склад", "Арбуз", "Дополнительный");
            АрбузСДопСклада = ДеревоОстатки.Строки.НайтиСтроки(Отбор, Истина);
            Для каждого Строка Из АрбузСДопСклада Цикл
                ОстаткиПоДопСкладу.Строки.Удалить(Строка);
            КонецЦикла;

            <span class="светло_красный">Сортировка в дереве значений</span>
            <span class="зелёный">//для этого есть метод Сортировать(&lt;СтрокаСортировки>, &lt;ВключатьПодчиненные>, &lt;ОбъектСравнения>)
            //1й параметр это список имен колонок, разделенных запятыми</span>
            ДеревоОстатки.Строки.Сортировать("Количество Убыв", Истина);

            <span class="светло_красный">Обход элементов дерева значений</span>
            <span class="зелёный">//из-за того, что мы заранее не знаем сколько уровней в дереве нам сложно определить
            //как в цикле обойти всё дерево, поэтому тут логично использовать такой цикл как рекурсия
            //сделаем отдельно процедуру, которой передадим строки верхнего уровня, а внутри процедура
            //будет проверять есть ли что то в строке верхнего уровня и если да, то для неё опять запускается
            //эта же процедура</span>
            ОбходДереваЗначений(ДеревоОстатки.Строки);
            
            <span class="светло_красный">Очистка дерева значений</span>
            ДеревоОстатки.Строки.Очистить();


            Процедура ОбходДереваЗначений(КоллекцияСтрок)
                Для каждого Строка Из КоллекцияСтрок Цикл
                    <span class="зелёный">//у строки есть метод Уровень(), который покажет в виде числа уровень строки
                    //важно, не у коллекции строк есть такой метод, а у отдельной строки
                    //уровень мы будем показывать просто для того чтобы показать обход всех строк</span>
                    Сообщить("Уровень: " + Строка.Уровень() + "; " + Строка.Товар + "; " + Строка.Склад + "; " + Строка.Количество);
                    <span class="зелёный">//проверяем, есть ли в строке подчинённые строки</span>
                    Если Строка.Строки.Количество() > 0 Тогда
                        ОбходДереваЗначений(Строка.Строки);
                    КонецЕсли;
                КонецЦикла;
            КонецПроцедуры
        </pre>
    </div>

    <p class="title-size16"><b>Работа с деревом значений на форме</b>. Как правило создавать дерево значений с нуля нужно не часто, обычно его получают в результате какого то метода. И самый частый способ получения такого дерева это запрос. В форме создадим реквизит "ДеревоОстатков" в типом "ДеревоЗначений" и в него будем выводить остатки Товаров подчинённые складам. Также как и для таблицы значений вверху используем кнопку добавления колонок для реквизита. Добавим 3 колонки - Товар(с типом СправочникСсылка.Номенклатура), Склад(с типом справочникСсылка.Склады) и Количество(с типом число и квалификаторами длина 15, точность 3). Переносим реквизит "ДеревоОстатков" влево куда нам нужно.</p>
    <p>Также будем использовать обработчик события формы "ПриСозданииНаСервере". В нём напишем запрос к виртуальной таблице регистра накопления Остатки по номенклатуре. Нам нужны подсчёты количества товаров по складам, поэтому в запросе будем использовать итоги. В конструкторе создали запрос и вывели в код. В метод Выбрать() из результата запроса конструктор подставил параметр "ОбходРезультатаЗапроса.ПоГруппировкам". Этот параметр, как я понял, в выборку добавляет записи с группой помимо детальных. Чтобы выгрузить данные из запроса в наше дерево значений используем метод Выгрузить() и передаём также в него ТипОбхода такой же, как и для выборки. Здесь будет отличие в выгрузке в дерево значений от выгрузки в таблицу значений. Как мы видим в форме в окне реквизитов, ДеревоОстатков имет тип в скобках (ДеревоЗначений), что нам говорит о том, что это её не настоящий тип, настоящий тип <b>ДанныеФормыДерево</b>. Если для реквизита "ТаблицаОстатки", с ненастоящим типом (ТаблицаЗначений), был метод Загрузить(), он загружал выгруженную таблицу с данными запроса в этот реквизит, то для реквизита "ДеревоОстатки" такого метода нет. Если мы напрямую выгрузим в этот рекизит результат запроса, то будет ошибка, потому что выгрузка из результата запроса будет иметь настоящий тип "ДеревоЗначений", а реквизит "ДеревоОстатков" имеет тип ДанныеФормыДерево. Тут нужно вспомнить метод РеквизитФормыВЗначение(), переведём реквизит "ДеревоОстатков" в настоящий тип "ДеревоЗначений", запишем в него данные запроса и переведём обратно в ДанныеФормыДерево</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)		
                Запрос = Новый Запрос;
                Запрос.Текст = 
                    "ВЫБРАТЬ
                    |	ОстаткиНоменклатурыОстатки.Номенклатура КАК Товар,
                    |	ОстаткиНоменклатурыОстатки.Склад КАК Склад,
                    |	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество
                    |ИЗ
                    |	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки
                    |ИТОГИ
                    |	СУММА(Количество)
                    |ПО
                    |	Склад";
                
                РезультатЗапроса = Запрос.Выполнить(); 
                ДеревоОбъект = РеквизитФормыВЗначение("ДеревоОстатков");
                ДеревоОбъект = РезультатЗапроса.Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкам);
                ЗначениеВРеквизитФормы(ДеревоОбъект, "ДеревоОстатков");
            КонецПроцедуры
        </pre>
    </div>
    <p>Ctrl + Shift + Плюс - развернуть дерево значений в пользовательском режиме, + Минус - свернуть.</p>
















    <h3 class="header-style2" id="table-doc">Табличный документ</h3>
    <p>Пока накидаю то что не забыл. Создаётся от класса ТабличныйДокумент. Можно реквизиту формы задать тип "ТабличныйДокумент", это как будто мы создали объект от класса и присвоили полю этот тип данных. Табличный документ можно показать только на клиенте, а заполнить данными только на сервере. Если мы создавали объект от класса и заполнили его на сервере, то на клиенте его нужно показать через метод Показать(). А если мы используем реквизит формы с типом данных "ТабличныйДокумент", то достаточно просто через метод Вывести() вывести данные в этот реквизит и он сам их покажет. В метод Паказать() можно перетать строковый текст, который будет заголовком табличного документа.</p>














    <h3 class="header-style2" id="7">Процедуры и функции</h3>
    <div class="code-style">
        <pre>
            <span class="светло_красный">Процедура <span class="светло_синий">ИмяПроцедуры</span>()
                //код...
            КонецПроцедуры
            </span>

            <span class="светло_красный">Функция <span class="светло_синий">ИмяФункции</span>()
                <span class="светло_синий">ЧислоА = 12;
                ЧислоБ = 4;
                СуммаЧисел = ЧислоА + ЧислоБ;</span>
                Возврат <span class="светло_синий">СуммаЧисел</span>;
            КонецФункции
            </span>

            <span class="светло_синий">Результат <span class="светло_красный">=</span> ИмяФункции<span class="светло_красный">(</span><span class="светло_красный">);</span></span>
        </pre>
    </div>
    <p>Задача процедуры как и функции обернуть в себя какой то код и вызывать его в любом месте программы. Функция в отличии от процедуры может возвращать результат выполнения функции через оператор <b>Возврат</b>. Процедуры тоже могут использовать оператор Возврат, но только для досрочного завершения процедуры, ничего возвращать из процедуры они не могут, а используются одиночно.</p>
    <p>Если в процедуре или в функции объявлены параметры, то при вызове их нужно обязательно передавать эти параметры, иначе ошибка. Здесь построже чем в js, там можно и не передавать параметры, просто там параметрам присвоится undefined и всё. Но можно и не передавать праметры в функцию если в этой функции параметрам заранее прописать значения по умолчанию, они здесь задаются также как и в js. Те параметры, которым не указалось значения по умолчанию, должны быть переданы:</p>
    <div class="code-style">
        <pre>
            Функция ПосчитатьЗначения(Парам1, Парам2 = 2, Парам3 = 5)
                СуммаЧисел = Парам1 + Парам2 + Парам3;
                Возврат СуммаЧисел;
            КонецФункции

            Сообщить(ПосчитатьЗначения(53)); // 60
        </pre>
    </div>
    <p>Те параметры, которые передаются пишем левее, а с значениями по умолчанию пишем правее. Мы можем передать все 3 параметра и тогда они станут в то значение, которые им присвоится при передаче, а не то, которое у них стоит по умолчанию.</p>
    <p>Парметр по умолчанию часто используеся при доработке чужой функции, она уже имеет какие то параметры и во многих местах вызывается с этими параметрами, а нам нужно ввести ещё какой то параметр, тут то мы в функцию и дописываем свой параметр и стаим ему значение по умолчанию и внутри самой функции например добавляем наш параметр в какую-нибудь формулу, и она отработает спокойно не переделывая её полностью. Если мы поставим свой параметр не по умолчанию, то он станет обязательным и вот тогда может всё нарушиться.</p>








    <h3 class="header-style2" id="7a">Переменные передаются по ссылке в процедуры и функции. Оператор</h3>
    <p>Есть такой код:</p>
    <div class="code-style">
        <pre>
            Процедура ПроверитьЧисло(Число)
                Если  Число > 0 Тогда
                    Сообщить("Число положительное");
                Иначе
                    Сообщить("Число отрицательное"); 
                КонецЕсли;  
                Число = 1;
            КонецПроцедуры  

            А = -1;

            ПроверитьЧисло(А);
            Сообщить(А);
            ПроверитьЧисло(А);

            //ответом будет 3 сообщения
            Число отрицательное
            1
            Число положительное

            //Как видно в первую процедуру мы передали переменную по ссылке, теперь А и Число ссылаются на одну и ту же переменную
            //Число проверяется и выводится результат, затем в Число пишется новое значение, а значит по ссылке А также теперь ссылается
            //на новое значение 1. Короче точно так же как в JS объекты передаются по ссылке, а не копируются.
            //Если често то это вводит немного в ступор, вот так легко можно поменять глобальную переменную А внутри процедуры и не заметить этого.
        </pre>
    </div>
    <p>Может быть далее по изучению я узнаю почему так сделано. Узнал. Оказывается в параметр процедуры рядом можно вписать слово Знач и теперь переменная А будет копироваться в переменную Число не по ссылке, а именно копироваться и теперь поведение будет как в JS. Официально слово Знач означает запрет на изменение передаваемой переменной А:</p>
    <div class="code-style">
        <pre>
            Процедура ПроверитьЧисло(<span class="светло_синий">Знач</span> Число)
                Если  Число > 0 Тогда
                    Сообщить("Число положительное");
                Иначе
                    Сообщить("Число отрицательное"); 
                КонецЕсли;  
                Число = 1;
            КонецПроцедуры 

            А = -1;

            ПроверитьЧисло(А);
            Сообщить(А);
            ПроверитьЧисло(А);

            //ответом будет 3 сообщения
            Число отрицательное
            -1
            Число отрицательное
        </pre>
    </div>












    <h3 class="header-style2" id="10">Не срабатывает метод Сообщить</h3>
    <p>Если в нашей программе вызывается одна из следующих команд ВвестиЧисло, ВвестиДату, ВвестиСтроку, то следующие команды Сообщить мы просто не успеваем увидеть. Вызов перечисленных команд приводит к тому, что перед пользователем появляется отдельное окно (для ввода информации), которое ломает стандартный механизм вывода сообщений через команду Сообщить. В этом случае результаты команды Сообщить выводятся не в главное, а в диалоговое окно, которое закрывается сразу после ввода значения.</p>
    <p class="title-size16"><b>Простой способ решения</b></p>
    <p>Если в нашем коде встречается одна из команд ВвестиЧисло, ВвестиДату, ВвестиСтроку, вместо Сообщить используем команду ОткрытьЗначение.</p>
    <p class="title-size16"><b>Правильный способ решения</b></p>
    <p>Поместите в модуль управляемого приложения событие ПриНачалеРаботыСистемы и пишите весь код в нём. Это событие вызывается уже после того как создано главное окно 1С.</p>
    <div class="code-style">
        <pre>
            Процедура ПриНачалеРаботыСистемы()
                //код;
            КонецПроцедуры
        </pre>
    </div>
















    <h2 class="header-style" id="11">Объекты конфигурации</h2>
    <p class="title-size16"><b>Виды данных</b>.</p>
    <ul class="list">
        <li><b>"Общие" - "Подсистемы"</b> - на основе подсистем платформа создаёт командный интерфейс прикладного решения и разделяет функциональность программы на различные разделы. Подсистемы могут иметь иерархическую структуру, т.е. есть подчинённые подсистемы:
        <img src="../img/1С-1/2024-04-19_08-56-34.png" class="screen" alt=""></li>
        <li><b>"Общие" - "Общие модули"</b> - Общие модули это те модули, в которые мы добавляем свои процедуры и функции с указанием ключевого слова "Экспорт". Получается своеобразная библиотека, процедуры и функции которой в дальнейшем можно вызывать из различных мест конфигурации. Создадим общий модуль и назовём его, например, "Библиотека" и напишем там процедуру, затем из любого места конфигурации вызываем эту процедуру - <span class="светло_синий"><b>Бибилиотека.НазваниеПроцедуры();</b></span></li>
        <li><b>"Общие" - "Роли"</b> - с помощью этого объекта разработчик описывает набор прав для выполнения тех или иных действий над каждым объектом конфигурации или над конфигурацией в целом. Как правило роли создаются для каждого вида деятельности. Каждому пользователю системы ставится одна или несколько ролей. В современной конфигурации на базе БСП существует множество ролей. В 1С:Предприятии эти роли объединяются в профили, а профили добавляются в группы, таким образом можно быстро и легконазначить пользователю целый набор ролей.</li>
        <li><b>"Общие" - "Подписка на события"</b> - предназначена для размещения в общих модулях внешних обработчиков, которые будут исполняться после выполнения определённого обработчика события в модуле объекта или в модуле менеджера. Подписки на события на практике очень удобно использовать, когда не хочется менять типовой код конфигурации, но при этом есть необходимость дополнить те или иные события, возникающие, например, при проведении документа или перед записью справочника.</li>
        <li><b>"Общие" - "Регламентные задания"</b> - позволяет запускать на выполнение какое-либо конкретное действие по заранее настроенному расписанию. При добавлении регламентного задания в его свойстве "Имя метода" указывается модуль, конкретная процедура или функция, которые собственно и будут исполняться в миг запуска регламентного задания. На этой картинке видно список регламентных заданий из базы 1С:ERP:
        <img src="../img/1С-1/2024-04-19_09-17-17.png" class="screen" alt=""></li>
        <li><b>"Общие" - "Функциональные опции"</b> - позволяют разработчику выделить некоторую часть прикладного решения, которую можно включать или выключать. Более подробну можно почитать <a href="#func_options">тут</a>.</li>
        <li><b>Константы</b> - один из самых простых объектов конфигурации, который позволяет сохранить в инфобазе какое-то одно постоянное или условно-постоянное значение. Например, создадим постоянное значение и назовём его "НазваниеОрганизации", в режиме предприятия появится команда "Сервис", в котрой мы найдём название, котрое ввели, кликнем по нему и откроется форма для ввода названия организации. Ну или например можно добавить постоянное значение "ИНН", чтобы вводить ИНН организации или "ДатаРегистрации" и т.д.</li>
        <li><b>"Справочники"</b> - Справочники позволяют хранить данные, имеющие одинаковую структуру и списочный характер. Это может быть, например, список сотрудников, перечень товаров, список поставщиков или покупателей. Каждый элемент справочника в обязательном порядке имеет поля КОД и НАИМЕНОВАНИЕ, но к ним могут добавляться и любые другие поля.</li>
        <li><b>"Документы"</b> - Документы позволяют хранить информацию о совершённых операциях или о событиях, произошедших в "жизни" предприятия вообще. Это могут быть, например, приходные накладные, приказы о приёме на работу, счета, платёжные поручения и т.д. Каждый документ в обязательном порядке имеет поля НОМЕР, ДАТА и ВРЕМЯ</li>
        <li><b>"Отчёты"</b> - Отчёты обрабатывают и выводят накопленную информацию в удобном для просмотра и анализе виде. Это может быть отчёт, который выводит остатки товара на складе или продажи за период. Каждый отчёт в обязательном порядке имеет некоторую печатную форму, которую можно не только посмотреть, но и вывести на принтер.</li>
        <li><b>"Обработки"</b> - Обработки предназначены для выполнения различных действий над информацией в базе. Например, с их помощью можно выполнить удаление из системы устаревших данных, импорт информации из других систем и многое другое. В результате действия обработки информация, хранящаяся в системе, претерпевает какие-либо изменения.</li>
        <li><b>"Перечисления"</b> - Перечисления - это прикладной объект, это особенный объект. В отличии от справочников и документов все возможные значения перечислений задаются на этапе конфинурирования и не могут быть в дальнейшем изменены в пользовательском режиме. Неизменность - это их главный козырь. Это своего рода константы БД. И если программист в режиме конфигурирования создал перечисление с именем Пол и значениями Мужской и Женский, то при написании программыон может быть уверен, что в дальнейшем значения этого перечисления не изменятся. Поэтому он может смело обращаться к этим значениям из кода. Представьте, что будет, если он для этого использует справочник? Во первых пользователь может легко изменить значения справочника, а другой пользователь может удалить один из полов. Программа от этого сломается. Вот для этого и существуют перечисления, чтобы один раз на этапе конфигурирования жёстко задать все возможные варианты значений и в дальнейшем использовать их в коде программы.
        В конфигурации перечисления, как правило, используются не самостоятельно, а в совокупности с другими типами данных. Так, перечисления применяются для ввода ограниченного количества значений реквизитов справочников и документов.</li>
        <li><b>Регистры накопления</b> - слово регистр переводится как запись, записаться, отметиться. Я бы перевёл его как объект записывальщик данных в данном случае для их накопления. 
        </li>
    </ul>










    <h3 class="header-style" id="unic-id"><b>Методы Уникальный идентификатор() и ПолучитьСсылку()</b></h3>
    <p>Уникальный идентификатор это реквизит "Ссылка" на любой элемент справочника или документа в базе. Всегда мы видим эту ссылку в виде представления этой ссылке. Платформа сама подставляет вместо идентификатора наименование элемента. Но можно и посмотреть как на самом деле выглядет ссылка через метод у этой ссылки: "УникальныйИдентификатор".</p>
    <p>Допустим есть обработка где есть 2 реквизита формы: "Товар" с типом "СправочникСсылка.Товары" и ИД с типом строка. Также есть команда "ПолучитьИД", по которой мы будем у ссылки получать идентификатор:</p>
    <div class="code-style">
        <pre>
            --модуль формы обработки

            &НаКлиенте
            Процедура ПолучитьИД(Команда)
                ИД = ПолучитьИДНаСервере(Товар);
            КонецПроцедуры

            &НаСервереБезКонтекста
            Функция ПолучитьИДНаСервере(Ссылка)
                Возврат Ссылка.УникальныйИдентификатор();	
            КонецФункции
        </pre>
    </div>
    <p>В поле "Товар" мы выберем из списка выбора или из формы выбора какой нибудь товар. Этот товар и будет ссылкой, но выглядеть будет в виде представления ссылки. Получаем на сервере у этой ссылки её идентификатор и присваеваем в реквизит "ИД":</p>
    <img src="../img/1С-1/2024-04-19_18-59-06.png" class="screen" alt="">
    <p><b>ПолучитьСсылку()</b></p>
    <p>Если в метод ничего не передавать, то получаем новую пустую ссылку на тот элемент базы данных, у кого вызван этот метод. А метод вызывается у менеджера справочника или документа: "СправочникМенеджер.Товары.ПолучитьСсылку()" или "ДокументМенеджер.ПродажаТоваров.ПолучитьСсылку()". А если передать уникальный идентификатор в этот метод, то мы получим ссылку в виде представления этой ссылки. Продолжим верхний пример, там мы получали идентификатор ссылки, теперь наоборот из идентификатора получим представление ссылки:</p>
    <div class="code-style">
        <pre>
            --модуль формы обработки

            &НаКлиенте
            Процедура ПолучитьИзИД(Команда)
                ТоварИзИД = ПолучитьИзИДНаСервере(ИД);
            КонецПроцедуры

            &НаСервереБезКонтекста
            Функция ПолучитьИзИДНаСервере(ИДСтроковый)
                ИД = Новый УникальныйИдентификатор(ИДСтроковый);
                Возврат Справочники.Номенклатура.ПолучитьСсылку(ИД);
            КонецФункции
        </pre>
    </div>















    <h3 class="header-style" id="link"><b>Контроль ссылочной целостности</b></h3>
    <p>Вот видео, где рассказывается про этот контроль - <a href="https://www.youtube.com/watch?v=oktbtbRQJHo">тут</a></p>










    <h3 class="header-style" id="prop-root-config"><b>Свойства корня конфигурации</b></h3>

    <p class="title-size16"><b id="prop-root-config-1">"Режим управления блокировкой данный"</b></p>
    <p>Передумал записывать, слишком много. На экзамене можут встретится вопрос про это свойство, поэтому знать нужно. Посмотреть можно в этом видео - https://www.youtube.com/watch?v=GlgVZfDPvoU&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=43.   Там Чистов объясняет эту тему начиная с 00:59:30. Это видео с названием "СпецКурс. 012"</p>














    <h3 class="header-style" id="konst"><b>Работа с константами</b></h3>
    <p class="title-size16"><b id="konst1">Константа и её свойства</b></p>
    <p>Константы намного проще других объектов конфигурации. В них хранятся условно-постоянные записи - названия организации, ставка налога, название основного склада нашего предприятия и т.д.</p> 
    <p>Например, создадим и будем хранить в константе название организации. Почему именно в константе? Мы могли бы указывать название нашей организации в печатях или в других местах кода прям вписывая строкой название, но потом когда нужно будет сменить название, то запаримся бегать по разным местам и переименовывать. Проще хранить название где то в одном месте и использовать значение этой константы в разных местах, в тех же печатях. Разработчик указывает константу где то в коде, а пользователь сам задаёт название организации и она подставляется автоматом.</p>
    <p>При создании константы указываем в свойствах её Имя и Синоним, тип Строка и Длину. Если указать Неограниченная длина, то значение константы будет храниться не в таблице констант, а в другой таблице, в которой будет 3 колонки: в 1й хранится ссылка на элемент константы для которой мы сохраняем значение, во 2й сохраняется значение индекса записи(сколько требуется строк для хранения значения), а в 3й колонке содержится само значение(длина 100 знаков, если значение константы имеет 115 знаков, значит для хранения значения будет отведено 2 строки(записи), эта цифра 2 как раз и будет во 2й колонке в виде индекса). Записи константы с неограниченной длиной не индексируются никак. И при попытке вытащить данные из БД система скажет что нужно обязательно данные типизировать, привести к конкретной строке.</p>
    <img src="../img/1С-1/2023-08-14_10-41-13.png" class="screen" alt="">
    <p>Каждая константа хранится в своей отдельной таблице и в общей таблице Константы. Вообще если посмотреть в БД, то там вот так хранятся в таблицах константа "НазваниеОрганизации" и константа "Адрес Организации":</p>
    <img src="../img/1С-1/2023-08-14_20-25-12.png" class="screen-2" alt="">
    <p>Можно выбрать как одну таблицу со всеми константами, так и по отдельности.</p>
    <p>Константы по отдельности это новая версия хранения. Когда у нас одна таблица и в ней хранятся все константы, то это старый способ. При обращении к одной константе мы блокируем запись с нужной константой в общей таблице, но т.к. в этой записи находятся и остальные константы, то они также блокируются, что сильно замедляет работу при многопользовательском обращении. Поэтому и было решение разнести константы каждая в свою таблицу. </p>
    <img src="../img/1С-1/2024-09-19_16-15-58.png" class="screen" alt="">
    <p>После создания константы система помещает команду открытия этой константы в меню "Сервис", куда обычно помещаются обработки. Может система и создаёт маленькую обработку, которая при открытии показывает стандартную форму с уже созданными кнопками записи константы в базу.</p>
    <p>В палитре свойств есть свойство <i style="text-decoration: underline;">"Допустимая длина"</i>. Это свойство имеет 2 значения: переменная и фиксированная. Когда мы для константы задали тип "Строка" с длиной 60, то при значении "Переменная" мы получим из БД значение константы длиной такой какая есть у значения константы. Например, в значении константы у нас название фирмы "1С", а длина задана 60, мы получим из БД значение в 2 символа - "1С". А вот при значении фиксированная мы получим из БД все 60 символов, т.е. "1С" и 58 пробелов. Это увидить в пользовательском режиме трудно, но вот программно получив и замерив длину можно увидеть разницу при разных значениях этого свойства. </p>
    <p>Для чего нужно значение "Фиксированная"? Как я понял, в печатных документах есть такие поля с пробелами, куда вписывается ручкой что-то. И при значении "Фиксированная" мы в документ подставляем константу с заранее заданной длиной и не нужно потом от руки добивать пробелами до нужной длины. Что-то в этом роде. Но это довольно редко используется.</p>
    <p>У константы есть 2 модуля: <i style="text-decoration: underline;">модуль менеджера</i> и <i style="text-decoration: underline;">модуль менеджера значения</i>. Модуль менеджера значения позволяет отледить событие записи константы. Например меняется ставка НДС и мы хотим что то в системе поменять при смене этой ставки.</p>
    <p><b>Закладка "Представление"</b></p>
    <p>В свойствах есть закладка "Представление". Свойства этой закладки указывают как будет отображаться константа в пользовательском интерфейсе. Галочка у свойства <i style="text-decoration: underline;">"Использовать стандартные команды"</i> говорит о том, что система сама создаст команду в стандартной группе "Сервис" для открытия формы с этой константой.</p>
    <p>Свойство <i style="text-decoration: underline;">"Расширенное представление"</i> говорит о том, как будет называться команда вызова константы, по умолчанию берётся из синонима.</p>
    <p>Свойство <i style="text-decoration: underline;">"Подсказка"</i> будет показвать тот текст, который мы в нём укажем, при наведении мыши на команду открытия константы.</p>
    <p>Свойство <i style="text-decoration: underline;">"Многострочный режим"</i> позволяет пользователю вводить знаки переноса строки.</p>
    <p>Свойство <i style="text-decoration: underline;">"Расширенное редактирование"</i> позволит включить поиск по значению константы через комбинацию клавиш Ctrl + F.</p>

    <p class="title-size16"><b id="konst2">Пример работы с константами</b></p>
    <p>В модуле приложения в предопределённом обработчике "ПриНачалеРаботыСистемы" вызовем функцию из обшего модуля, которая получит из базы значение константы "Название организации" и вернёт его, и если значение пустое, то сообщим это пользователю, мол пусть заполнит название:</p>
    <div class="code-style">
        <pre>
            --модуль приложения
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ПриНачалеРаботыСистемы<span class="светло_красный">()</span>
                <span class="светло_красный">Если НЕ</span> ЗначениеЗаполнено<span class="светло_красный">(</span>Тренирововчная<span class="светло_красный">.</span>ПолучитьКонстанту<span class="светло_красный">()) Тогда</span>
                    Сообщить<span class="светло_красный">(</span><span class="серый">"Заполните название организации, оно сейчас пустое"</span><span class="светло_красный">);
                КонецЕсли; 
            КонецПроцедуры</span></span>


            --общий модуль Тренирововчная
            <span class="светло_синий"><span class="светло_красный">Функция</span> ПолучитьКонстанту<span class="светло_красный">() Экспорт
                Возврат</span> Константы<span class="светло_красный">.</span>НазваниеОрганизации<span class="светло_красный">.</span>Получить<span class="светло_красный">();	
            КонецФункции</span></span>
        </pre>
    </div>













    <h3 class="header-style" id="picture"><b>Работа с картинками</b></h3>

    <p class="title-size16"><b id="picture1">Как просто открыть картинку в форме без сохранения в базе</b></p>
    <p>Допустим есть внешняя обработка и в её форме я хочу открыть картику без всяких сохранений, просто открыть. Для этого создаётся реквизит(пусть с именем "АдресКартинки") формы с типом "Строка", переносится в элементы формы, этому элементу форму задаётся вид "Поле картинки".</p>
    <p>Есть несколько способов открыть картинку в форме, опишу тут один. Чтобы картинка открылась, нужно в реквизит "АдресКартинки" формы с типом "Строка" поместить адрес из временного хранилища, куда помещается картинка. Поместить картинку во временное хранилище можно 2мя способами, известными мне. Первый это через методы <b>НачатьПомещениеФайлаНаСервер()</b>, <b>НачатьПомещениеФайловНаСервер()</b>. Подробности их параметров можно посмотреть в помощнике. Итак вот код:</p>
    <div class="code-style">
        <pre>
            --модуль формы внешней обработки

            <span class="светло_синий"><span class="зелёный">//обработка кнопки "ВыберитеКартинки"</span>
            <span class="светло_красный">&НаКлиенте
            Процедура</span> ВыберитеКартинки<span class="светло_красный">(</span>Команд<span class="светло_красный">)</span>
                Оповещение <span class="светло_красный">= Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ОбработатьЗавершение"</span><span class="светло_красный">,</span> ЭтотОбъект<span class="светло_красный">);</span>
                
                <span class="зелёный">//есть 3 разновидности синтаксиса этого метода. По 5му параметру система понимает, какой синтаксис используется
                //Если ничего в него не передавать, то будет с диалогом выбора файла</span>
                НачатьПомещениеФайлаНаСервер<span class="светло_красный">(</span>Оповещение<span class="светло_красный">,,,,,</span> УникальныйИдентификатор<span class="светло_красный">);  
            КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="светло_красный">(</span>Описание<span class="светло_красный">,</span> ДопПараметры<span class="светло_красный">) Экспорт </span> 
                <span class="зелёный">//если метод с выбором одного файла, то в параметре Описание
                //содержатся все свойства с данными о загруженном файле  
                //если же метод с выбором нескольких файлов, то Описание 
                //будет массивом.
                
                //метод поместил картинку во временное хранилище формы
                //и в объект Описание поместил вместе со всеми данными 
                //и адрес картинки во временном хранилище</span>
                АдресКартинки <span class="светло_красный">=</span> Описание<span class="светло_красный">.</span>Адрес<span class="светло_красный">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Второй способ это через метод <b>ПоместитьВоВременноеХранилище()</b>. Этот метод сам уже не вызывает диалог выбора файла, нужно его самим делать. Метод доступен и на клиенте и на сервере.</p>
    <div class="code-style">
        <pre>
            --модуль формы внешней обработки

            <span class="зелёный">//это обработчик события "Нажатие" у поля картинки, только нужно свойство "Гиперссылка"
            //указать в Истина. Получается мы открываем картинку по нажатию на её поле    
            </span>
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> АдресКартинкиНажатие<span class="светло_красный">(</span>Элемент<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                СтандартнаяОбработка <span class="светло_красный">=</span> Ложь<span class="светло_красный">;</span>	
            
                ДиалогОткрытия <span class="светло_красный">= Новый</span> ДиалогВыбораФайла<span class="светло_красный">(</span>РежимДиалогаВыбораФайла<span class="светло_красный">.</span>Открытие<span class="светло_красный">);</span>

                Фильтр <span class="светло_красный">=</span> <span class="серый">"Файл Png (*.png)|*.png"</span><span class="светло_красный">;</span> 
                ДиалогОткрытия<span class="светло_красный">.</span>Фильтр <span class="светло_красный">=</span> Фильтр<span class="светло_красный">;</span>

                ДиалогОткрытия<span class="светло_красный">.</span>МножественныйВыбор <span class="светло_красный">=</span> Ложь<span class="светло_красный">;</span>

                ДиалогОткрытия<span class="светло_красный">.</span>Заголовок <span class="светло_красный">=</span> <span class="серый">"Выберете файл для загрузки"</span><span class="светло_красный">;</span>

                ОписаниеОповещения <span class="светло_красный">= Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ПослеЗагрузкиФайла"</span><span class="светло_красный">,</span>ЭтаФорма<span class="светло_красный">);</span> 
                ДиалогОткрытия<span class="светло_красный">.</span>Показать<span class="светло_красный">(</span>ОписаниеОповещения<span class="светло_красный">);
            КонецПроцедуры        


            &НаКлиенте 
            Процедура</span> ПослеЗагрузкиФайла<span class="светло_красный">(</span>ВыбранныйФайл<span class="светло_красный">,</span> ДопПараметр<span class="светло_красный">) Экспорт</span> 
                <span class="светло_красный">Если</span> ВыбранныйФайл <span class="светло_красный">= Неопределено Тогда 
                    Возврат; 
                КонецЕсли; </span>

                <span class="зелёный">//в параметре "ВыбранныйФайл" лежит массив с одним элементом.
                //В элементе просто путь до файла на компьютере в виде строки.
                //Этот путь нужно перевестив в двоичные данные, для этого используем
                //конструктор картинки. Далее с помощью функции помещаем данные во 
                //временное хранилище и она вернёт адрес места, где лежат эти данные</span>
                АдресКартинки <span class="светло_красный">=</span> ПоместитьВоВременноеХранилище<span class="светло_красный">(Новый</span> Картинка<span class="светло_красный">(</span>ВыбранныйФайл<span class="светло_красный">[</span>0<span class="светло_красный">]),</span> УникальныйИдентификатор<span class="светло_красный">); 
            КонецПроцедуры</span></span>
        </pre>
    </div>


    <p class="title-size16"><b id="picture2">Как можно сохранить картинку во внешней обработке</b></p>
    <p>Нашёл такой способ сохранения картинки во внешней обработке, используя макет обработки. Создаём макет, задаём тип макета "Двоичные данные", внизу окна появится сразу поле загрузки картинки для сохранения её в макете в виде двоичных данных. Затем в коде получаем макет обработки, считываем из неё данные и помещаем их в метод ПоместитьВоВременноеХранилище():</p>
    <div class="code-style">
        <pre>
            --модуль формы обработки

            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="светло_красный">()</span>
                ЗагрузитьКартинкуНаСервере<span class="светло_красный">(</span>Ложь<span class="светло_красный">);	
            КонецПроцедуры


            &НаСервере
            Процедура</span> ЗагрузитьКартинкуНаСервере<span class="светло_красный">()</span>
                ОбъектОбработки <span class="светло_красный">=</span> РеквизитФормыВЗначение<span class="светло_красный">(</span><span class="серый">"Объект"</span><span class="светло_красный">);</span>
                МакетОбработки <span class="светло_красный">=</span> ОбъектОбработки<span class="светло_красный">.</span>ПолучитьМакет<span class="светло_красный">(</span><span class="серый">"МакетСКартинкой"</span><span class="светло_красный">);</span>	
                АдресКартинки <span class="светло_красный">=</span> ПоместитьВоВременноеХранилище<span class="светло_красный">(Новый</span> Картинка<span class="светло_красный">(</span>МакетОбработки<span class="светло_красный">),</span> УникальныйИдентификатор<span class="светло_красный">);    

                <span class="зелёный">//можно и без использования конструктора картинки, потому что макет и так
                //возвращает двоичные данные картинки
                //АдресКартинки = ПоместитьВоВременноеХранилище(МакетОбработки, УникальныйИдентификатор); </span>
            КонецПроцедуры</span></span>
        </pre>
    </div>


    <p class="title-size16"><b id="picture3">Добавляем картинку в ячейку макета рядом с текстом из кода</b></p>
    <p>Допустим мы делаем печатную форму для документа и нам нужно в ячейку рядом с текстом добавить картинку по размеру текста. Вот так:</p>
    <img src="../img/1С-1/2024-01-31_09-41-16.png" class="screen" alt="">
    <p>Для этого выделяем ячейку, переходим в её свойства на закладку "Макет" и видим там свойство "ПараметрКартинки". Это тоже самое, когда мы для ячейки задаём "Заполнение" - "Параметр" и пишем в ячейке имя параметра или в свойстве "Параметр" пишем имя параметра. Так и здесь, только пишем в нём имя параметра картинки. Далее из кода мы обращаясь к области можем вставить в этот параметр картинку.</p>
    <p>Итак, напишем имя параметра картинки - "ПараметрКартинкиТовар":</p>
    <img src="../img/1С-1/2024-01-31_09-49-16.png" class="screen-2" alt="">
    <p>Затем загрузим в библиотеку картинку. Для этого нужно в этих же свойствах ячейки перейти на закладку "Картинка" и в свойстве "Картинка" выбрать из компьютера картинку и даём ей имя, теперь имя, под которым она будет лежать в библиотеке, например, "МояКартинкаТовара". Выбрали, теперь у нас в библиотеке есть эта картинка. Обращаемся в наборе указаний к этой библиотеке и ищем там нашу картинку по заданному имени и вставляем её в параметр:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">МояКартинка <span class="светло_красный">=</span> БиблиотекаКартинок<span class="светло_красный">.</span>МояКартинкаТовара<span class="светло_красный">;</span>
            ОбластьТовары<span class="светло_красный">.</span>Параметры<span class="светло_красный">.</span>ПараметрКартинкиТовар <span class="светло_красный">=</span> МояКартинка<span class="светло_красный">;</span></span>
        </pre>
    </div>
    <p>Есть одно замечание. Когда мы добавили картинку в библиотеку с помощью свойства "Картинка" на заклдаке "Картинка", то нужно очистить в этом свойстве выбранную картинку. Нам нужно, чтобы она просто была в библиотеке, иначе картинка тут же отобразится рядом с текстом, а нам нужно отображать из набора указаний(из кода).</p>






    <p class="title-size16"><b id="picture4">Устанавливаем картинку товара в форме элемента справочника "Номенклатура".</b></p>
    <p>Если нужно решение Камкова по установке картинки, то оно описано в форме элемента справочника Номенклатура в базе Камкова "Основные объекты". Здесь опишу как делал Чистов по видео "24 СпецКурс. 015.2"</p>
    <p><span class="светло_синий">Ключевые слова используемые в статье.</span></p>
    <ul class="list">
        <li><i style="text-decoration: underline;">Модифицированность</i> - программное свойство формы для удаления или добавления признака изменения(звёздочка рядом с названием элемента справочника) формы.</li>
        <li><i style="text-decoration: underline;">События "ПередЗаписью" и "ПередЗаписьюНаСервере"</i> - рассказывается разница между этими событиями и какое нам нужно для установки картинки.</li>
        <li></li>
        <li></li>
    </ul>
    <p>Устанавливать картинки можно для разных целей, например, фотографии сотрудников, изображения товаров и т.д. Возникает самый первый вопрос, где хранить картинку? Сопособов её хранить есть несколько, одни из этих способов правильные другие не очень. Начнём от первого не совсем правильного до 4го правильного, но все эти способы имеют право на жизнь:</p>
    <ul class="list">
        <li>Первый способ хранить в файле. Просто указываем ссылку где-то в форме и по этой ссылке загружается картинка. Но этот способ не очень хороший. Потому что пользователи могут работать в разных операционных системах, с разных устройств. Вот например, мы открыли 1С:Предприятие по ссылке через интернет в обозревателе у себя на компьюторе или телефоне. У меня то на устройстве нет этой картинки, значит путь к картинке уже работать не будет. Это ещё не самый страшный способ, можно конечно хранить картинку и в файле, но могут возникнуть другие трудности, удалили файл, поменяли или ещё чего-то. Ну и картинка как-бы не связана никак с объектом конфигурации.</li>
        <li>Второй способ, более правильный и пример ниже будет по этому способу. Мы можем хранить картинку в реквизите справочника, ну не в самом конечно реквизите, а в БД будет храниться двоичный код на картинку, реквизит лишь будет получать эти данные из БД и через элемент формы отображать в форме. Здесь уже картинка становится частью элемента справочника и это хорошо. Из минусов это то, что картинка теперь как-бы всё время с элементом справочника, а вдруг нам нужно как-то передать или показать элемент справочника по быстрому кому-то или где-то, желательно без картинки, то тут уже никуда без неё. Описал как понял из объяснения Чистова.</li>
        <li>Третий способ более правильный чем второй. Сохранить картинки можно в отдельном справочнике или в регистре сведений. Тут тоже есть плюсы и минусы. Плюсы какие? Во-первых при обмене данными, когда из одной базы мы передаём товары в другую базу, то передача будет без картинок, что увеличивает скорость передчи. Без картинок, потому что картинки лежат в другой структуре(справочнике или регистре)</li>
        <li>Ну и последний способ, который очень часто применяется. Это когда картинки лежат в другой базе данных. Конечно, тут нарушается принцип связи элемента справочника с картинкой, но когда мы будем делать резервное копирование своей базы, то картинки тут будут отсутствовать и база будет намного быстрей копироваться.</li>
    </ul>
    <p>Пример будет по 2му способу. Почему по второму, просто Чистов хотел показать не только как хранить картинку, но и как работает передача данных формы от клиента к серверу и обратно. И как передаётся картинка.</p>
    <p>Итак, нам нужен реквизит в справочнике "Номенклатура", назовём его "ДанныеКартинки" и укажем тип "ХранилищеЗначения". Этот тип позволяет хранить двоичные данные. А как известно картинки хранятся в двоином коде в виде цифр и букв(каждая цифра или буква это двоичный код вида "00100111"). Кстати в этот реквизит можно загрузить вообще всё что угодно, потому что всё передаётся через двоичный код, а двоичный код преобразуется в строку и передаётся от сервера к клиенту и обратно.</p>
    <p>Создаём форму элемента справочника и в реквизитах раскроем основной реквизит "Объект". Там увидим наш реквизит "ДанныеКартинки", но в типах данных будет написано "ХранилищеЗначения(не доступен в данных формы)". Это говорит о том, что картинки не передаются с данными формы. Всё как в браузере, с сервера передаётся html, в самом html есть теги картинок с указанием ссылки на картинку. Браузер начинает парсить html и отображать на экране, как толкьо браузер увидет тег картинки с ссылкой, он отправит паралельно запрос на сервер на получение этой картинки. Это делается для того, чтобы пользователю быстро вывести письменную информацию на сайте, а картинку уже будут подгружаться после. Также и тут, пользователю нужно быстро показать форму с данными, а картинку он подгрузит либо сам по кнопке, либо система, но после того как форма придёт на клиента. Поэтому такая надпись и видна нам, что картинка одновременно с данными формы к нам не передаётся.</p>
    <p>Чтобы пользователю показать картинку создадим реквизит формы "АдресКартинки" с типом "Строка" и перетащим в элементы формы. В элементах формы создастя элемент "Поле" с видом "Поле ввода" и свяжется с созданным реквизитом "АдресКартинки" через свойство "ПутьКДанным". Но нам нужен вид не "Поле ввода", а "Поле картинки", поменяем вид в свойствах элемента формы. Вот этот элемент формы с видом "Поле картинки" это то же самое, что тег img в html:</p>
    <img src="../img/1С-1/2023-09-18_10-22-10.png" class="screen" alt="">
    <p>Внесём временно некоторые изменения в свойствах корневого объекта конфигурации. В палитре свойств на заклдаке "Совместимость" для свойств "Режим использования модальности" и "Режим использования синхронных вызовов" установим значения "Использовать", позже поясним, что мы сделали:</p>
    <img src="../img/1С-1/2023-09-18_10-29-32.png" class="screen-2" alt="">
    <p>Дальше создадим команду "ЗагрузитьКартинку", перенесём в элементы формы. Система сама создаст элемент формы "Кнопка" с видом "Обычная кнопка" и свяжет этот элемент с командой через свойство "ИмяКоманды".</p> 
    <img src="../img/1С-1/2023-09-18_21-24-38.png" class="screen" alt="">
    <p>Обработчик для команды создаём на клиенте. Так как метод ПоместитьФайл() уже видимо выпилили разработчики, поэтому использую метод НачатьПомещениеФайлаНаСервер(), он работает через оповещения. Этот метод доступен на клиенте, на сервере вроде нет его. <span class="светло_красный">Делаю с этим методом самостоятельно, никто не показывает как с ним работать. И чистов и Камков показывают с методом ПоместитьФайл(), поэтому нет уверенности что делаю правильно, но работать будет</span>:</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span> 
                <span class="зелёный">//в оповещении первый параметр это имя процедуры, которую нужно вызвать при определённом событии
                //второй параметр это модуль, из которого нужно вызвать эту процедуру. Указав ЭтотОбъект, мы
                //говорим, что нужно вызвать процедуру из модуля данной формы</span>
                Оповещение  <span class="светло_красный">=  Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ОбработатьЗавершение"</span><span class="светло_красный">,</span> ЭтотОбъект<span class="светло_красный">);</span>

                <span class="зелёный">//скорее всего этот метод внутри себя создаёт объект от класса ДиалогВыбораФайла
                //и через метод Показать() пользователю откроется окно выбора файла.
                //Выбираем в диалоговом окне картинку и дальше метод помещает картинку во временное хранилище
                //на сервере. Этот метод первым параметром принимает объект оповещения, по завершении
                //загрузки файла во временное хранилище, метод запускает процедуру связанную с этим оповещением.
                //Процедура называется "ОбработатьЗавершение", также в объект оповещения, в параметр "Описание" 
                //метод добавляет информацию о помещённом файле 
                //Последний параметр, если он указан, говорит о том, что мы связываем
	            //эту форму со временным хранилищем, удалится объект формы - исчезнет и хранилище</span>  
                НачатьПомещениеФайлаНаСервер<span class="светло_красный">(</span>Оповещение<span class="светло_красный">,,,,,</span> УникальныйИдентификатор<span class="светло_красный">);
            КонецПроцедуры </span> 

            <span class="светло_красный">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="светло_красный">(</span>Описание<span class="светло_красный">,</span> ДопПараметры<span class="светло_красный">) Экспорт</span>
                <span class="зелёный">//2й параметр "ДопПараметры" передаётся из описания оповещения, если мы там его задали

                //В параметре "Описание" хранится вся информация о помещённом файле.
                //В свойстве Адрес будет лежат адрес файла во временном хранилище,
                //но адрес не такой как путь до файла на компе, а адрес именно
                //до временного хранилища.
                //Если мы этот адрес присвоим в реквизит АдресКартинки, то тут же 
                //пользователь увидит картинку в элементе формы "АдресКартинки"
                //Система как и браузер увидев адрес тут же сделает запрос на его получение</span> 
                АдресКартинки <span class="светло_красный">=</span> Описание<span class="светло_красный">.</span>Адрес<span class="светло_красный">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Итак, что выше мы написали? С помощью метода мы выбрали картинку и поместили в созданное временное хранилище на сервере. Метод передал в оповещение инфу о картинке и мы в процедуре оповещения вставили адрес картинки во временном хранилище в реквизит "АдресКартинки". Система как и браузер увидев адрес тут же запросила данные по нему и в результате отобразилась картинка в элементе формы. Если закрыть элемент справоника и опять открыть, то картинки не будет, потому что при открытии реквизит "АдресКартинки" будет пустой. Значит нам нужно как то сохранить данные картинки в базе.</p> 
    <p>При вставке картинки система даже не покажет признака изменения формы(звёздочка рядом с названием формы). Чтобы признак изменения появился, у команды в палитре свойств есть свойство "Изменяет сохраняемые данные" и установим галочку:</p>
    <img src="../img/1С-1/2023-09-19_10-11-12.png" class="screen-2" alt="">
    <p>Но нам нужно чтобы признак изменения формы появлялся только после того, как картинка будет помещена во временное хранилище, а не просто по нажатию на кнопку. Ведь картинка может и не поместиться в хранилище или пользватель отменит выбор картинки, а признак появится, если поставить галочку. Поэтому опишем появление признака программно в обработке оповещения.</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            //1
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span> 
                Оповещение  <span class="светло_красный">=  Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ОбработатьЗавершение"</span><span class="светло_красный">,</span> ЭтотОбъект<span class="светло_красный">);</span>

                НачатьПомещениеФайлаНаСервер<span class="светло_красный">(</span>Оповещение<span class="светло_красный">);
            КонецПроцедуры </span> 

            //2
            <span class="светло_красный">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="светло_красный">(</span>Описание<span class="светло_красный">,</span> ДопПараметры<span class="светло_красный">) Экспорт</span>
                <span class="зелёный">//добавим появление признака изменения данных формы(звёздочка рядом с названием формы)
                //Для этих целей у кнопки есть свойство "Изменяет сохраняемые данные",
                //но нам нужно не по нажатию кнопки показывать признак, а по добавлению
                //файла во временное хранилище, поэтому добавим признак программно
                //При отмене выбора картинки пользователем параметр Описание будет иметь
                //значение Неопределено, значит не нужно добавлять признак изменения</span>
                <span class="светло_красный">Если НЕ</span> Описание <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                    Модифицированность <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                КонецЕсли;</span>

                АдресКартинки <span class="светло_красный">=</span> Описание<span class="светло_красный">.</span>Адрес<span class="светло_красный">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Для чего мы беспокоимся о признаке изменения данных формы? А потому что мы картинку записывать в базу будем со всеми остальными данными формы, а не отдельно. Например, в курсе Камкова, мы сохраняли картинку тут же при нажатии кнопки "ЗагрузитьКартинку", но, как я понял, это не совсем правильно. Например, пользователю может не понравится картинка и он захочет другую поставить, а мы зря будем в фоне делать запись её в базу. Пусть лучше уже выберет 100% и сохранит её вместе со всеми данными в базу через кнопку "Записать" или "Записать и закрыть". Хотя как по мне обы способа имеют право быть.</p>
    <p>Короче трудно разобраться в событиях расширений формы(в данном случае расширение справочника) таких как "ПередЗаписью", "ПередЗаписьюНаСервере". Вот картинка как события срабатывают:</p>
    <img src="../img/1С-1/711482603b57870b07da914cedca25a9.jpg" class="screen" alt="">
    <p>Вот, например, событие "ПередЗаписью" у формы элемента справочника. При создании обработчика этого события вылетает окошко выбора директивы запуска процедур и выбора только 2: "Создать на клиенте" и "Создать на клиенте и процедуру на сервере". Как видно из картинки, то начинается это событие на клиенте. Как это происходит мне не совсем понятно. Если выбрать 2ю директиву, то будет такая запись процедур:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаСервереБезКонтекста
            Процедура</span> ПередЗаписьюНаСервере<span class="светло_красный">()</span>
                Сообщить<span class="светло_красный">(</span>"Я отработал на сервере"<span class="светло_красный">);
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПередЗаписью<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> ПараметрыЗаписи<span class="светло_красный">)</span>
                Сообщить<span class="светло_красный">(</span>"Я отработал на клиенте"<span class="светло_красный">)</span>;
                ПередЗаписьюНаСервере<span class="светло_красный">();
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Открыв форму элемента справочника в пользовательском режиме, внесём какие-нибудь данные и нажмём кнопку "Записать", сработает событие "ПередЗаписью" на клиенте и вызовется сообщение, которое я написал и затем сработает это событие на сервере из модуля формы и появится 2е сообщение. Всё как по картинке выше с событиями. Но как записать картинку в базу не понятно с этим событием? Где вообще объект справочника с данными? Объект справочника конечно же записался в базу, но картинку же никто не записал. Мне нужно вмешаться в этот процесс, получить адрес картинки из временного хранилища и записать данные картинки в реквизит, но мне не доступен объект справочника. Конечно можно конвертировать данные формы в объект(метод РеквизитФормыВЗначение("Объект")) и так записать, но тогда получится двойная запись. Я запишу, потом система ещё раз сама запишет.</p>
    <p>Если посмотреть второе событие "ПередЗаписьюНаСервере", то там есть 2й параметр "ТекущийОбъект", это как раз и будет объект(элемент) справочника с типом "СправочникОбъект.Номенклатура", в который мы и добавляли картинку. То что нам и нужно. Теперь в обработчике этого события нам нужно из временного хранилаща по адресу получить значение(двоичные данные) картинки и поместить их в реквизит "ДанныеКартинки":</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            //1
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span> 
                Оповещение  <span class="светло_красный">=  Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ОбработатьЗавершение"</span><span class="светло_красный">,</span> ЭтотОбъект<span class="светло_красный">);</span>

                НачатьПомещениеФайлаНаСервер<span class="светло_красный">(</span>Оповещение<span class="светло_красный">);
            КонецПроцедуры </span> 

            //2
            <span class="светло_красный">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="светло_красный">(</span>Описание<span class="светло_красный">,</span> ДопПараметры<span class="светло_красный">) Экспорт</span>
                <span class="светло_красный">Если НЕ</span> Описание <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                    Модифицированность <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                КонецЕсли;</span>

                АдресКартинки <span class="светло_красный">=</span> Описание<span class="светло_красный">.</span>Адрес<span class="светло_красный">;
            КонецПроцедуры</span>

            //3
            <span class="светло_красный">&НаСервере
            Процедура</span> ПередЗаписьюНаСервере<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> ТекущийОбъект<span class="светло_красный">,</span> ПараметрыЗаписи<span class="светло_красный">)</span>
                <span class="зелёный">//получаем двоичные данные картинки из временного хранилища</span>
                ДвоичныеДанные <span class="светло_красный">=</span> ПолучитьИзВременногоХранилища<span class="светло_красный">(</span>АдресКартинки<span class="светло_красный">);</span>
                
                <span class="зелёный">//и запишем двоичные данные картинки в реквизит элемента справочника
                //"ДанныеКартинки"</span>
                ТекущийОбъект<span class="светло_красный">.</span>ДанныеКартинки <span class="светло_красный">= Новый</span> ХранилищеЗначения<span class="светло_красный">(</span>ДвоичныеДанные<span class="светло_красный">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вот этот алгоритм описан схематично:</p>
    <img src="../img/1С-1/2023-09-21_21-24-45.png" class="screen" alt="">
    <p>Ну и теперь нужно при открытии формы показать картинку из базы ранее записанную в неё, но вставить двоичный код в реквизит формы "АдресКартинки" нельзя, система такое не понимает, ей нужна опять ссылка на картинку. Но временного хранилища уже нет, ссылку оттуда не взять, но система умеет создать ссылку на то место где лежит значение картинки в базе. Сейчас у нас двоичные данные картинки лежат в базе в реквизите "ДанныеКартинки", вот на данные этого реквизита и сделаем ссылку:</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            //1
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span> 
                Оповещение  <span class="светло_красный">=  Новый</span> ОписаниеОповещения<span class="светло_красный">(</span><span class="серый">"ОбработатьЗавершение"</span><span class="светло_красный">,</span> ЭтотОбъект<span class="светло_красный">);</span>

                НачатьПомещениеФайлаНаСервер<span class="светло_красный">(</span>Оповещение<span class="светло_красный">);
            КонецПроцедуры </span> 

            //2
            <span class="светло_красный">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="светло_красный">(</span>Описание<span class="светло_красный">,</span> ДопПараметры<span class="светло_красный">) Экспорт</span>
                <span class="светло_красный">Если НЕ</span> Описание <span class="светло_красный">=</span> Неопределено <span class="светло_красный">Тогда</span>
                    Модифицированность <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                КонецЕсли;</span>

                АдресКартинки <span class="светло_красный">=</span> Описание<span class="светло_красный">.</span>Адрес<span class="светло_красный">;
            КонецПроцедуры</span>

            //3
            <span class="светло_красный">&НаСервере
            Процедура</span> ПередЗаписьюНаСервере<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> ТекущийОбъект<span class="светло_красный">,</span> ПараметрыЗаписи<span class="светло_красный">)</span>
                <span class="зелёный">//Первый способ решения проблемы мой </span>     
                <span class="светло_красный">Попытка</span>
                    <span class="зелёный">//получаем двоичные данные картинки из временного хранилища
                    //Если возникает ошибка получение их временного хранилища
                    //это может значит, что форма уже была закрыта и хранилище
                    //уничтожено и мы пытаемся повторно открыть форму
                    //в этом случае на не нужно получать никакие адреса,
                    //а просто завершить выполнение процедуры.</span>
                    ДвоичныеДанные<span class="светло_красный"> =</span> ПолучитьИзВременногоХранилища<span class="светло_красный">(</span>АдресКартинки<span class="светло_красный">);</span> 
                <span class="светло_красный">Исключение
                    Возврат;
                КонецПопытки;</span>
            
                <span class="зелёный">////Второй способ решения проблемы от Чистова
                //Если ЭтоАдресВременногоХранилища(АдресКартинки) Тогда
                //    ДвоичныеДанные = ПолучитьИзВременногоХранилища(АдресКартинки);
                //Иначе	
                //    Возврат;
                //КонецЕсли;</span>
                
                <span class="зелёный">//и запишем двоичные данные картинки в реквизит элемента справочника
                //"ДанныеКартинки"</span>
                ТекущийОбъект<span class="светло_красный">.</span>ДанныеКартинки <span class="светло_красный">= Новый</span> ХранилищеЗначения<span class="светло_красный">(</span>ДвоичныеДанные<span class="светло_красный">);
            КонецПроцедуры</span>

            //4
            <span class="светло_красный">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                <span class="зелёный">//теперь нужно при открытии формы элемента справочника показать 
                //пользователю картинку, которая сохранена в виде двочного кода
                //в реквизите "ДанныеКартинки". Просто так двоичный код нельзя вставить 
                //в реквизит формы "АдресКартинки", там нужен именно адрес(ссылка) на
                //на данные картинки. Для этого есть спец метод</span>
                АдресКартинки <span class="светло_красный">=</span> ПолучитьНавигационнуюСсылку<span class="светло_красный">(</span>Объект<span class="светло_красный">.</span>Ссылка<span class="светло_красный">,</span> <span class="серый">"ДанныеКартинки"</span><span class="светло_красный">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вот алгоритм описания открытия формы и получения картинки из базы по ссылке:</p>
    <img src="../img/1С-1/2023-09-22_09-58-48.png" class="screen" alt="">
    <p>Ну и сделаем <b>удаление картинки</b>:</p>
    <div class="code-style">
        <pre>
            --модуль формы элемента справочника Номенклатура

            //удаление картинки
            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Процедура</span> УдалитьКартинкуНаСервере<span class="светло_красный">()</span>
                СправочникОбъект <span class="светло_красный">=</span> РеквизитФормыВЗначение<span class="светло_красный">(</span><span class="серый">"Объект"</span><span class="светло_красный">);</span>
                СправочникОбъект<span class="светло_красный">.</span>ДанныеКартинки <span class="светло_красный">=</span> <span class="серый">""</span><span class="светло_красный">;</span>
                СправочникОбъект<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span> 
                ЗначениеВРеквизитФормы<span class="светло_красный">(</span>СправочникОбъект<span class="светло_красный">,</span> <span class="серый">"Объект"</span><span class="светло_красный">);</span>
                АдресКартинки <span class="светло_красный">=</span> <span class="серый">""</span><span class="светло_красный">;	
            КонецПроцедуры


            &НаКлиенте
            Процедура</span> УдалитьКартинку<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>
                УдалитьКартинкуНаСервере<span class="светло_красный">(); 
            КонецПроцедуры</span></span>
        </pre>
    </div>








    






    <h3 class="header-style" id="spravochnik">Работа со справочником</h3>
    <p class="title-size16"><b id="spravochnik-base">Что такое и для чего нужен справочник</b></p>
    <p>Объект конфигурации Справочник предназначен для работы со списками данных. Как правило, в работе любой фирмы используются списки сотрудников, списки товаров, списки клиентов, поставщиков и т.д. Свойства и структура этих списков описываются в объектах конфигурации Справочник, на основе которых платформа создает в базе данных таблицы для хранения информации из этих справочников.</p>
    <p>Справочник состоит из <i style="text-decoration: underline;">элементов</i>. Например, для справочника сотрудников элементом является сотрудник, для справочника товаров – товар и т.д</p>
    <p>В базе данных каждый элемент справочника представляет собой отдельную запись в основной таблице, хранящей информацию из этого справочника и называется объектом данных.</p>
    <p>Каждый элемент справочника, как правило, содержит некоторую дополнительную информацию, которая подробнее описывает этот элемент. Например, все элементы справочник Товары могут содержать дополнительную информацию о производителе, сроке годности и др. Набор такой информации является одинаковым для всех элементов справочника, и для описания такого набора используются реквизиты объекта конфигурации Справочник, которые также, в свою очередь, являются объектами конфигурации.</p>
    <p>Большинство реквизитов разработчик создает самостоятельно, однако у каждого объекта конфигурации Справочник по умолчанию существует набор стандартных реквизитов: <i style="text-decoration: underline;">Код</i> и <i style="text-decoration: underline;">Наименование</i> и пр. Причем доступность стандартных реквизитов зависит от свойств справочника. Например, если справочник иерархический, у него будет доступен стандартный реквизит Родитель. Если справочник подчинен другом объекту конфигурации, у него будет доступен реквизит Владелец.</p>
    <p>Если установить длину стандартного реквизита Код равной нулю, то у справочника будет недоступен этот реквизит. То же самое относится к реквизиту Наименование. Однако как минимум либо Код, либо Наименование должны присутствовать в реквизитах справочника, иначе такой справочник не имеет смысла.</p>
    <p>Таким образом, в базе данных справочник хранится в виде таблицы, в строках которой расположены элементы списка, а каждому реквизиту (стандартному или созданному разработчиком) в этой таблице соответствует отдельный столбец.</p>
    <p>Кроме этого, каждый элемент справочника может содержать некоторый набор информации, которая одинакова по своей структуре, но различна по количеству и предназначена для разных элементов справочника.</p>
    <p>Так, например, каждый элемент справочника Сотрудники может содержать информацию о составе семьи сотрудника. Для одного сотрудника это будет только супруга, а у другого семья может состоять из супруги, сына и дочери. Для описания подобной информации могут быть использованы табличные части объекта конфигурации Справочник, являющиеся подчиненными ему объектами конфигурации. В этом случае в базе данных будут созданы дополнительные таблицы для хранения табличных частей, подчиненных конкретному элементу справочника.</p>
    <p>Для удобства использования элементы справочника могут быть сгруппированы пользователем по какому-либо принципу.</p>
    <p>Например, в справочнике Товары могут быть созданы следующие группы: Холодильники, Телевизоры, Стиральные машины и т.д. Возможность создания таких групп в справочнике задается свойством <i style="text-decoration: underline;">Иерархический</i> объекта конфигурации Справочник. В этом случае элемент справочника, представляющий собой группу, будет являться родителем для всех элементов и групп, входящих в эту группу. Такой вид иерархии называется <i style="text-decoration: underline;">иерархией групп и элементов</i>.</p>
    <p>Возможен и другой вид иерархии – <i style="text-decoration: underline;">иерархия элементов</i>. В этом случае в качестве родителя выступает не группа элементов справочника, а непосредственно один из его элементов. Например, такой вид иерархии можно использовать при создании справочника Подразделения, когда одно подразделение является родителем для нескольких других, входящих в его состав.</p>
    <p>Элементы одного справочника могут быть подчинены элементам или группам другого справочника. Например, справочник ЕдиницыИзмерения может быть подчинен справочнику Товары. Тогда для каждого элемента справочника Товары мы сможем указать единицы измерения, в которых этот товар поступает на склад.</p>
    <p>Порой возникают ситуации, когда необходимо, чтобы в справочнике некоторые элементы существовали всегда, независимо от действий пользователя. Допустим, логика бизнес-процессов на предприятии такова, что все товары сначала поступают на основной склад, а затем по мере надобности перемещаются на другие склады. В этом случае в справочнике Склады всегда должен существовать склад Основной, иначе приходование товаров будет выполнено неправильно. Объект конфигурации Справочник позволяет описать любое количество таких элементов справочника. Они называются предопределенными элементами справочника.</p>
    <p>Предопределенные элементы отличаются от обычных тем, что они создаются в конфигураторе и что к ним можно обращаться из встроенного языка. </p>
    <p><b>Код и наименование справочника</b></p>
    <p>Откроем окно редактирования объекта конфигурации Справочник и нажмём на закладку Данные. Здесь для нас представляют интерес длина кода и длина наименования. Длина кода – важное свойство справочника. Как правило, код справочника используется для идентификации элементов справочника и содержит уникальные для каждого элемента справочник  значения. Платформа может сама контролировать уникальность кодов и поддерживать автоматическую нумерацию элементов справочника. Поэтому от длины кода будет зависеть количество элементов, содержащихся в справочнике.</p>
    <p>Мы можем изменить синоним стандартного реквизита Наименование.</p>

    <p class="title-size16"><b id="spravochnik-prop">Свойства реквизитов справочника</b></p>
    <p><b>Свойство "Быстрый выбор"</b></p>
    <p>К примеру у нас есть справочник склады и там всего 3 склада. Позже мы в поле некоторой формы выбираем склад и обычно открывается форма выбора справочника Склады и в этой форме мы выбираем склад, но можно сделать так, чтобы не открывать форму выбора, а просто выдать небольшой выпадающий список. Чтобы такое сделать нужно в редакторе объекта справочника Склады на вкладке "Поле ввода" поставить галочку у свойства "Быстрый выбор". Эта отметка скажет системе, что не нужно открывать форму выбора, а выдавать склады в виде списка. Такое можно желать когда справочник небольшой и имеет несколько значений.</p>
    <p><b>Свойство "Маска" в закладке "Представление"</b></p>
    <p>Приведу пока один пример как сделать маску для номера телефона у нас по России - +7(918)123-45-67. В значении свойства "Маска" так и пишем шаблон, вместо любой цифры выступает цифра 9 - +9(999)999-99-99. Всё, при заполнении этого реквизита в пользовательской части мы просто пишем цифры, а система сама по маске расставляет их.</p>
    <p><b>Свойство "Использование" в закладке "Использование"</b></p>
    <p>Это свойство указывает, где будет отображаться значение текущего реквизита. По умолчанию стоит "Для элемента", это значит значение реквизита будет только для элемента, а для групп не будет видно. Можно поставить только для групп, а можно и для того и другого.</p>
    <p><b>Свойство "Значение заполнения"</b></p>
    <p><a href="#document-prop-1">Тут</a>.</p>

    <p class="title-size16"><b id="spravochnik-dogovor">Подчинённый справочник. Реквизит "Владелец"</b></p>
    <p>Хочу описать тут пару моментов связанных с этим справочником. При наличии справочника "Контрагенты" мы создаём подчинённый справочник "Договора" справочнику "Контрагенты". Первое, при таком подчинении система сама добавляет в элементы справочника "Контрагенты" в панель навигации стандартную параметризуемую команду "Договора", которая будет открывать договора с отбором по текущему элементу справочника "Контрагенты". Второе, при удалении элемента справочника "Контрагенты" удаляется и привязанный к нему договор, по типу как свойство "Ведущее".</p>

    <p class="title-size16"><b id="spravochnik1">Типы данных у справочника</b></p>
    <p>Пока не создан ни один справочник есть толко один тип это СправочникиМенеджер. Как только создали справочник, например, Номенклатура, так и создались объекты встроенного языка:</p>
    <ul class="list">
        <li><b>СправочникМенеджер.Номенклатура</b> - нужен для того, чтобы создавать новые элементы,находить существующие элементы, выбирать все или некоторые элементы справочника. Если образно, то это облочка над всеми элементами-объектами(СправочникОбъект.Номенклатура) созданного справочника, которая командует ими.</li>
        <li><b>СправочникСсылка.Номенклатура</b> - нужен для того, чтобы отображать элементы справочника в интерфейсе: в списках, в полях ввода. Также он нужен для того, чтобы указывать на конкретный элемент справочника.</li>
        <li><b>СправочникОбъект.Номенклатура</b> - нужен для того, чтобы получать, изменять, удалять элемент справочника. </li>
        <li><b>СправочникВыборка.Номенклатура</b> - нужен для того, чтобы последовательно, друг задругом, перебирать те элементы, которые были выбраны из базы данных, с помощью объектной модели запроса(Выборка = СправочникМенеджер.Номенклатура.Выбрать())</li>
        <li><b>СправочникСписок.Номенклатура</b> - это наследие прошлых версий платформы, которое сейчас практически нигде не используется.</li>
    </ul>
    <p>Почему эти типы появляются только при создании какого то справочника? Потому что заполняются они только при создании конкретного справочника его значениями(реквизитами, табличными частями, настройками свойств и прочим).</p>
    <p>Графическая схема:</p>
    <img src="../img/1С-1/2023-05-27_22-09-22.png" class="screen" alt="">

    <p class="title-size16"><b id="spravochnik2">Получение данных справочника из базы через объектную модель</b></p>
    <p><i>Пример первый.</i></p>
    <p>Для примера создадим внешнюю обработку. В форме сделаем кнопку, перетащим её в элементы формы и назовём, например, ОбъектнаяМодель. Далее нужно задать действие для этой кнопки. При создании обработчика выберем в открывшемся окошке "Создать на клиенте и процедуру на сервере", откроется модуль с 2мя процедурами, одна на клиенте, вторая на сервере. Итак опишем серверную процедуру, которая получает данные из Справочника "Сотрудники". Для доступа к данным справочника используется управляющий(тот самый СправочникиМенеджер), доступ к которому осуществляется так: Управляющий = Справочники.Сотрудники; "Управляющий" это просто переменная и имя может быть любым, она просто отражает то, что возвращает Справочники.Сотрудники. В переменную "Управляющий" возвращаются ещё не сами данные справочника, а некоторый программный объект, через который мы можем что-либо делать со справочником. Управляющий объект справочника это как бы прослойка между нашим кодом и данными справочника. И получается, что, если мы хотим прочитать все элементы справочника, то мы не можем сделать это напрямую. Мы можем только поросить об этом нашу прослойку между нами и справочником. Чтобы сделать это - необходимо вызвать встроенный в управляющий объект метод "Выбрать". Вызывается он через точку после имени переменной "Управляющий" и возвращает коллекцию элементов справочника:</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//в выборку возвращается объект с типом "СпрвочникВыборка.&lt;ИмяСправочника>"</span>
            <span class="светло_синий">Выборка <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Сотрудники<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span></span>

            <span class="зелёный">//также есть метод ВыбратьИерархически(), который позволяет выбрать записи внутри указанной группы(папки)</span>
            <span class="светло_синий">Выборка <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Сотрудники<span class="светло_красный"></span>.ВыбратьИерархически<span class="светло_красный">(</span><span class="серый">&lt;Группа></span><span class="светло_красный">);</span></span>
            <span class="зелёный">//параметр Группа должен иметь тип СправочникСсылка.&lt;Имя спрвочника>, как получить такую группу
            //допустим у нас есть поле ввода, поле имеет тип СправочникСсылка.&lt;Имя спрвочника>, мы выбираем из списка
            //имя группы из справочника(не эелемента) и передаём это имя в метод. Чтобы иметь возможность выбрать группу из списка
            //для этого поля в форме в свойствах нужно указать в параметре ВыборГруппИЭлементов значение Группа
            //потому что по умолчанию нельзя выбирать группы, только элементы</span>
        </pre>
    </div>
    <p>Что представляет из себя выборка? Выборка представляет из себя коллекцию, но не такую, как массив или список значений. Выборка представляет из себя опять объект. Особенность этого объекта в том, что он умеет перебирать элементы нужного нам справочника. Причём перебирает он их динамически. Это означает, что считывание элементов справочника происходит не сразу, а порциями из базы данных. Такой подход позволяет быстро обходить большие списки справочников, не загружая в память компьютера все сразу.
    Чтобы получить очередную порцию данных из выборки, надо вызывать у выборки встроенный метод "Следующий". Получение порций данных(одна порция соответствует одному элементу справочника) обычно происходит в цикле. Когда данные(элементы справочника) в выборке закончатся, метод "Следующий" вернёт Ложь и цикл остановится. После каждого вызова метода "Следующий"(если он вернул Истина) выборка будет содержать в себе все поля с данными только что считанного элемента справочника:</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">//бывает, что в выборку попадают элементы группы
            //и при переборе в цикле группа будет засчитываться как элемент
            //а значит Выборка.Слудующий() вернёт Истина при проходе по самой папке
            //но папка не содержит полей, а значит все поля вернут пустоту
            //для этого делаем проверку Выборка.ЭтоГруппа, если вернёт Истина
            //просто пишем оператор Продолжить и пропускаем круг цикла</span>
            <span class="светло_синий"><span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>ЭтоГруппа <span class="светло_красный">Тогда
                    Продолжить
                КонецЕсли;</span>
                Сообщение <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                Сообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    Выборка<span class="светло_красный">.</span>Наименование <span class="светло_красный">+</span> <span class="серый">" "</span> <span class="светло_красный">+</span> 
                    Выборка<span class="светло_красный">.</span>ДатаРождения <span class="светло_красный">+</span> <span class="серый">" "</span> <span class="светло_красный">+</span>
                    Выборка<span class="светло_красный">.</span>НомерПаспорта <span class="светло_красный">+</span> <span class="серый">" "</span> <span class="светло_красный">+</span>
                    Выборка<span class="светло_красный">.</span>СерияПаспорта <span class="светло_красный">+</span> <span class="серый">" "</span> <span class="светло_красный">+</span>
                    Выборка<span class="светло_красный">.</span>Должность <span class="светло_красный">+</span> <span class="серый">" "</span><span class="светло_красный">;</span>
                Сообщение<span class="светло_красный">.</span>Сообшить<span class="светло_красный">();
            КонецЦикла;</span></span>

            <span class="зелёный">//часто бывает нужно записать какие то данные
            //Чтобы в объект записать, нужно его получить
            //в цикле мы перемещаемся по объектам(записям) в колекции Выборка, 
            //значит если хотим записать во все объекты,
            //то в цикле получаем каждый объект и пишем в него</span>
            <span class="светло_синий"><span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>ЭтоГруппа <span class="светло_красный">Тогда
                    Продолжить
                КонецЕсли;</span>
                ОбъектСправочника <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>ПолучитьОбъект<span class="светло_красный">();</span>
                ОбъектСправочника<span class="светло_красный">.</span>&lt;какое то поле> <span class="светло_красный">=</span>  &lt;какое то значение><span class="светло_красный">;</span>
                ОбъектСправочника<span class="светло_красный">.</span>Записать<span class="светло_красный">();
            КонецЦикла;</span></span>
        </pre>
    </div>
    <p>Получается, что в один миг мы можем работать с данными только с одним из элементов справочника. И тут мы можем или сразу их выводить пользователю или можно сложить их в массив и уже из массива потом сразу с ними со всеми что то сделать.</p>
    <p><i>Пример второй.</i></p>
    <p>Есть справочник "Сотрудники" и хотим получить всех сотрудников с датой рождения на сегодняшнее число. Применить метод НайтиПоРеквизиту() тут не очень подходит, потому что мы можем 2м параметром задать всю дату вместе с годом, но нам это не подходит, нам нужны те сотрудники, кто родился сегодняшним числои в текущий месац. И второе почему нам этот метод не подходит это то, что он возвращает ссылку на первого попавшегося сотрудника, а нам нужны все, кто подпадает под выборку. Поэтому другого выхода нет как выбрать всех сотрудников из базы со всеми их данными с помощью метода Выбрать().</p>
    <p>Писать код будем в модуле управляемого приложения на клиенте и в общем модуле для работы на сервере. Вот алгоритм:</p>
    <div class="code-style">
        <pre>
            --модуль приложения
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ПриНачалеРаботыСистемы<span class="светло_красный">()</span>
                Сотрудники <span class="светло_красный">=</span> ОбщийМодуль1<span class="светло_красный">.</span>ПолучитьСотрудников<span class="светло_красный">();</span>

                <span class="светло_красный">Для каждого</span> Сотрудник <span class="светло_красный">Из</span> Сотрудники <span class="светло_красный">Цикл</span>
                    Сообщить<span class="светло_красный">(</span>Сотрудник<span class="светло_красный">);
                КонецЦикла;
            КонецПроцедуры</span></span>


            --процедура в общем модуле ОбщийМодуль1
            <span class="светло_синий"><span class="светло_красный">Функция</span> ПолучитьСотрудников<span class="светло_красный">() Экспорт</span>
                СсылкаНаЭлемент <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Сотрудники<span class="светло_красный">.</span>Уволенные<span class="светло_красный">;</span>

                Сотрудники <span class="светло_красный">= Новый</span> Массив<span class="светло_красный">;</span>

                ТекМесяц <span class="светло_красный">=</span> Месяц<span class="светло_красный">(</span>ТекущаяДата<span class="светло_красный">());</span>
                ТекДень <span class="светло_красный">=</span> День<span class="светло_красный">(</span>ТекущаяДата<span class="светло_красный">());</span>

                Выборка <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Сотрудники<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                    <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>ЭтоГруппа <span class="светло_красный">ИЛИ</span> Выборка<span class="светло_красный">.</span>Родитель <span class="светло_красный">=</span> СсылкаНаЭлемент <span class="светло_красный">Тогда
                        Продолжить;
                    КонецЕсли;</span>

                    Месяц <span class="светло_красный">=</span> Месяц<span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>ДатаРождения<span class="светло_красный">);</span>
                    День <span class="светло_красный">=</span> День<span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>ДатаРождения<span class="светло_красный">);</span>

                    <span class="светло_красный">Если</span> Месяц <span class="светло_красный">=</span> ТекМесяц <span class="светло_красный">И</span> День <span class="светло_красный">=</span> ТекДень <span class="светло_красный">Тогда</span>
                        Сотрудники<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>Наименование<span class="светло_красный">);
                    КонецЕсли;	
                КонецЦикла;</span>

                <span class="светло_красный">Возврат</span> Сотрудники<span class="светло_красный">;
            КонецФункции</span></span>
        </pre>
    </div>
    <p>Нужно не забывать про то, что в настройках общего модуля нужно указать галочку "Сервер" и галочку "Вызов сервера", чтобы модуль приложения смог его вызвать на стороне сервера.</p>


    <p class="title-size16"><b id="spravochnik3">Получение данных из справочника через ссылку объектным способом и табличным</b></p>
    <p>Предположим у нас есть справочник "СтавкиНДС":</p>
    <img src="../img/1С-1/2022-12-04_17-55-18.png" class="screen" alt="">
    <p>И есть документ "РасходнаяНакладная":</p>
    <img src="../img/1С-1/2022-12-04_18-00-01.png" class="screen" alt="">
    <p>В документе в табличной части есть поле "СуммаНДС", чтобы вычислить это поле, нужно получить процент из поля "СтавкаНДС", чтобы получить число процента, нужно из БД его как то взять. 1й способ это через табличную модель:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Функция</span> ПолучитьСтавкуНДСЧислом<span class="светло_красный">(</span>СтавкаНДС<span class="светло_красный">)</span>
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ
                    |   СтавкиНДС.Ставка КАК Ставка
                    |ИЗ
                    |   Справочник.СтавкиНДС КАК СтавкиНДС
                    |ГДЕ
                    |	СтавкиНДС.Ссылка = &СтавкаНДС"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"СтавкаНДС"<span class="светло_красный">,</span> СтавкаНДС<span class="светло_красный">);</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                ВыборкаДетальныеЗаписи <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                ВыборкаДетальныеЗаписи<span class="светло_красный">.</span>Следующий<span class="светло_красный">();</span>
                <span class="светло_красный">Возврат</span> ВыборкаДетальныеЗаписи<span class="светло_красный">.</span>Ставка<span class="светло_красный">;

                <span class="зелёный">//из РезультатЗапроса можно выбрать, а можно выгрузить в таблицу значений
                //зачем это нужно. Я когда раньше делал выборку из БД, никак не мог понять как можно посмотреть, что я там выбрал
                //вот это как раз то, что я хотел. В отладке смотрим, что выгрузилось из Результата и там в виде таблицы
                //все записи из базы
                //Таблица = РезультатЗапроса.Выгрузить();</span>
            КонецФункции</span></span>
        </pre>
    </div>
    <p>2й способ то через объектную модель:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Функция</span> ПолучитьСтавкуНДСЧислом<span class="светло_красный">(</span>СтавкаНДС<span class="светло_красный">)</span>
                <span class="зелёный">//СтавкаНДС это реквизит с типом СправочникСсылка.СтавкиНДС,
                //в нём содержится ссылка на элемент справочника "СтавкиНДС".
                //При таком способе получения данных из базы мы сначала выбираем не конкретное поле
                //"Ставка", а получаем по ссылке весь объект со всеми полями
                //и только потом система из этого объекта получает значение поля "Ставка"
                //так что это не совсем правильный способ получения данных из базы
                //всё же правильней делать запрос с помощью языка запроса как в примере выше.
                //Если у объекта данных будет в подчинении ещё и таблица с чтабличной частью,
                //система даже эту табличную часть прочитает впридачу
                //НО, такой способ получения данных можно использовать, если мы будем
                //из объекта брать несколько полей, тогда затраты на получение всего
                //объекта будут хотя бы оправданы</span>
                <span class="светло_красный">Возврат</span> СтавкаНДС<span class="светло_красный">.</span>Ставка<span class="светло_красный">;
            КонецФункции</span></span>
        </pre>
    </div>
    <p>В обоих случаях мы передаём функции параметр СтавкаНДС. СтавкаНДС мы получаем из текущей строки табличной части - Элементы.Товары.ТекщуиеДанные.СтавкаНДС. В этом поле содержится не строка, а ссылка на элемент списка справочника СтавкиНДС. Чтобы заработал 1й способ с запросом, нужно привести этот реквизит в типу строка вот так - Строка(Элементы.Товары.ТекщуиеДанные.СтавкаНДС) и передать параметром в функцию. Во 2м способе, мы так и оставляем ссылочный тип и передаём эту ссылку в функцию. Функция выполняясь на сервере получает эту ссылку, в ссылке содержится элемент списка справочника СтавкиНДС, а значит нам доступны все поля этого элемента, в том числе и поле Ставка, которое нам вернёт числовое значение ставки.</p>

    <p class="title-size16"><b id="spravochnik4">Получение ссылки на элемент справочника</b>.</p>
    <p>Чтобы получить ссылку элемента справочника есть несколько путей.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ОткрытьФормуНоменклатуры<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>
                СсылкаНаНоменклатуру <span class="светло_красный">=</span> ПолучитьНоменклатуруПоКоду<span class="светло_красный">(</span><span class="серый">"000000004"</span><span class="светло_красный">);
            КонецПроцедуры </span></span>   

            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Функция</span> ПолучитьНоменклатуруПоКоду<span class="светло_красный">(</span>Код<span class="светло_красный">)</span>
                <span class="зелёный">//Возврат Справочники.Номенклатура.НайтиПоНаименованию();</span>
                <span class="зелёный">//Возврат Справочники.Номенклатура.НайтиПоРеквизиту();</span>
                <span class="светло_красный">Возврат</span> Справочники<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">.</span>НайтиПоКоду<span class="светло_красный">(</span>Код<span class="светло_красный">);
            КонецФункции</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="spravochnik5">Метод ПолучитьОбъект() у разных типов данных справочника и документа</b></p>
    <p>Какие типы имеются ввиду? Типы - СправочникВыборка.ИмяСправчоника и ВыборкаИзРезультатаЗапроса.</p>
    <p>Существуют разные типы выборки, например, у справочника. Если мы выбрали данные справочника через объектную модель вот так:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Выборка <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
            <span class="зелёный">//ещё есть такой метод. Он выбирает все объекты из указанной группы</span>
            Выборка <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">.</span>ВыбратьИерархически<span class="светло_красный">(&lt;Ссылка на группу>);</span>
            
            <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                СправочникОбъект <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>ПолучитьОбъект<span class="светло_красный">();
            КонецЦикла;</span></span>
        </pre>
    </div>
    <p>То в переменой Выборка будут лежать записи из БД и эта выборка будет иметь тип "СправочникВыборка.Номенклатура". У такой выборки сразу есть метод ПолучитьОбъект(), т.е. на каждом круге цикла мы вызывая этот метод получаем объект и в этот объект копируются данные полей из выборки. Это важно запомнить, при создании объекта для каждой записи система не идёт в БД за значениями его полей, они уже есть в выборке, она просто копирует их оттуда.</p>
    <p>Но есть и другоая выборка, которую мы получаем через табличную модель запроса, вот так:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
            ... 
            РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
            Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p>В этом случае в переменной Выборка также будут лежать записи из БД и тип выборки будет уже "ВыборкаРезультатаЗапроса". У этой выборки нет уже родного метода ПолучитьОбъект(), чтобы получить объект нужно заранее прописать в запросе получение поля Ссылка и вот уже у этого поля есть метод ПолучитьОбъект(). Вызов Выборка.Ссылка будет иметь тип "СправочникСсылка.Номенклатура" и у этого типа данных есть такой метод.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
            ... 
            РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
            Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>

            <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                СправочникОбъект <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Ссылка<span class="светло_красный">.</span>ПолучитьОбъект<span class="светло_красный">();
            КонецЦикла;</span></span>
        </pre>
    </div>
    <p>А вот при таком получении объекта из ссылки система будет обращаться каждый раз в БД за значениями полей.</p>

    <p class="title-size16"><b id="spravochnik6">Метод СоздатьЭлемент() у менеджера справочника и перемещение созданного элемента в группу</b></p>
    <p>Метод доступен на сервере.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="зелёный">//в переменную НовыйЭлемент вернётся объект типа СправочникОбъект.Номенклатура</span>
	        НовыйТовар <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">.</span>СоздатьЭлемент<span class="светло_красный">();</span> 
	        НовыйТовар<span class="светло_красный">.</span>Наименование <span class="светло_красный">=</span> <span class="серый">"Стиралка"</span><span class="светло_красный">;</span>

            <span class="зелёный">//созданный элемент я хочу поместить в группу "Ластики", для того нужно получить ссылку на эту группу</span>
            ГруппаЛастики <span class="светло_красный">=</span> Справочники<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">.</span>НайтиПоНаименованию<span class="светло_красный">(</span><span class="серый">"Ластики"</span><span class="светло_красный">);</span>

            <span class="зелёный">//проверяем есть ли группа, проверкой пустоты ссылки и проверяем не лежит ли там </span>
            <span class="зелёный">//значение Неопределено, при отсутствии такого наименования группы</span>
            <span class="светло_красный">Если</span> ГруппаЛастики<span class="светло_красный">.</span>Пустая<span class="светло_красный">() Тогда</span>
                Сообщить<span class="светло_красный">(</span><span class="серый">"Ссылка пустая"</span><span class="светло_красный">);
                Возврат;
            ИначеЕсли</span> ГруппаЛастики <span class="светло_красный">= Неопределено Тогда</span>
                Сообщить<span class="светло_красный">(</span><span class="серый">"Не верное Наименование группы"</span><span class="светло_красный">);
                Возврат;
            КонецЕсли;</span>

            <span class="зелёный">//Дошил сюда, значит всё нормально и для нового товара пишем в поле Родитель ссылку на найденную группу</span>
	        НовыйТовар<span class="светло_красный">.</span>Родитель <span class="светло_красный">=</span> ГруппаЛастики<span class="светло_красный">;</span>

            <span class="зелёный">//ну и записываем объект в базу</span>
            НовыйЭлемент<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="spravochnik7">Предопределенные элементы</b></p>
    <p>При создании предопределенных элементов справочника задаётся - Имя, Код, Наименование. Наименование и Код отображаются пользователю, а Имя использует разработчик в коде.</p>
    <p>Пока не забыл про предопределенные элементы, для чего они нужны, первое, их можно указывать по умолчанию в других местах. Например в справочнике Номенклатура у элемента товара есть поле ЕдИзм и для товара часто используются одни и те же единицы измерения товара - Шт., вот можно создать справочник ЕдиницыИзмерения и сделать в нём предопределенный элемент Шт. и указывать его по умолчанию. В спрвочнике Номенклатура укажем реквизит ЕдИзм с типом СправочникСсылка.ЕдиницыИзмерения и в его палитре свойств есть свойство "ЗначениеЗаполнения", вот там и можно будет выбрать имя предопределенного элемента для отображения по умолчанию.</p>
    <p>Второе, можно на стороне сервера получить ссылку на объект с предопределенными данными вот так - СправочникМенеджер.&lt;Имя справочника>.&lt;Имя предопределенного элемента справочника>. Т.е. просто через точку указываем имя предопределенного элемента и получаем ссылку на объект с данными для этого элемента из базы. Например, Справочники.ЕдиницыИзмерения.Шт вернёт ссылку на объект БД с данными этого элемента. Так как ссылка отображается в виде Наименования, то вернётся значение - "Шт." с типом СправочникСсылка.ЕдиницыИзмерения.</p>
    <p>Предопределённые элементы только для чтения пользователем, изменять он может только наименование, имя не может поменять, которое дал разработчик, удалить также пользователь не может их.</p>
    <p>Ещё одно назначение предопределенных элементов в том, что разработчик может заранее создать какие то элементы и использовать их в программном коде, зная, что пользователь не сможет их удалить. Разработчик кстати тоже не может изменить предопределенный элемент, только удалить и создать новый.</p>
    <p>Пока просто хаотично записываю всё, что встречаю по предопределенным элементам.</p>

    <p class="title-size16"><b id="spravochnik8">Как автоматом ставить галочку в поле "Услуга" для новых создаваемых элементов справочника Номенклатура? Для элементов внутри группы Товары в поле Услуга ставится Ложь, а для элементов внутри группы Услуги - Истина. Событие "ОбработкаЗаполнения"</b></p>
    <p>Для документов это наверно примерно также работает.</p>
    <p>Если что то вот это видео - https://www.youtube.com/watch?v=dkHZGoUvoxs&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=4.  Там примерно с самого начала эта тема.</p>
    <p>Для начала нам надо группы справочника Номенклатура также пометить признаком Услуга как и элементы. Когда мы создаём реквизит Услуга, то по умолчанию система отображает в пользовательском режиме значение этого поля только для элементов, нам же надо, чтобы значение этого поля отображалось и для групп. Для этого в палитре свойств этого реквизита есть вкладка Использование, а в ней свойство также "Использование" и в этом свойстве выбираем "Для групп и элементов". Теперь для групп тоже отображается значение реквизита Услуга. В пользовательском режиме поставим галочку в форме элемента для группы "Услуги" и запишем в базу. И теперь при создании нового элемента мы хотели бы, чтобы система оглядывалась на родителя этого элемента, считывала у родителя услуга он или нет и проставляла этот признак для нового элемента.</p>
    <p><span class="светло_красный">Когда перечитывал этут статью не сразу понимал о чём речь про реквизит "Услуга". Это то же самое что и реквизит "ВидНоменклатуры" со значениями перечисления - "Товар", "Услуга". Только тут значение простого типа - булево, где ставится просто галочка - это услуга или нет.</span></p>
    <p>При создании нового элемента система проходит по многим модулям и выполняет многие обработчики событий, если они заданы разработчиком. Одно из таких событий это событие заполнения реквизитов нового элемента. Это событие возникает каждый раз при создании нового элемента(как программного, так и через форму), при копировании элемента, при вводе на основании. Событие это называется "обработкаЗаполнения" и находится оно в модуле объекта. События модуля объекта всегда выполняются на стороне сервера.</p>
    <p>У этого события есть 3 параметра: ДанныеЗаполнения, ТекстЗаполнения и СтандартнаяОбработка. Нас интересует 1й параметр. ДанныеЗаполнения это то чем система собирается заполнить текущий элемент. Этот параметр может быть заполнен разными значениями. Например, находясь в форме списка справочника Номенклатура мы можем зайти в меню Ещё и там выбрать "Настройка списка", откроется окно, где мы можем указать отбор по каким то полям в этом списке, применим и список отфильтруется в соотсветствии с нашим отбором. А дальше нажмём создать новый элемент справочника, и в параметр ДанныеЗаполнения помимо свойства с ключом "Родитель" добавятся дополнительные свойства структуры с ключами состоящие из тех полей, котрые мы выбрали для отбора. В нашем случае мы отборы не устанавливаем поэтому там будет структура с 1м свойством - "Родитель" -> НазваниеРодителя. Ключ "Родитель" это строка, а его значение это ссылка на элемент этого родителя в БД, а если это ссылка значит можно обратиться в БД к любому полю этого элемента. У этого элемента-группы есть поле Услуга, которую мы заранее задали для групп(свойство "Использование") и мы заранее туда проставили галочку, если это группа относится к услугам. Значит проверка <i>ДанныеЗаполнения.Родитель.Услуга</i> даст Истина(если пытаемся создать элемент в группе услуг), ну и от этого условия далее заполняем  поле Услуга у создаваемого элемента.</p>
    <p>Ещё нужно проверить ДанныеЗаполнения на то есть в нём какое то значение или нет. Структуры там может и не быть если мы в пользовательском режиме выберем группу самого вырхнего уровня, ведь у этой группы нет родителя и не укажем отбор по каким то полям, тогда и структуру незачем системе создавать в этот параметр, а значит этот параметр может иметь значение Неопределено, поэтому и проверяем. А может быть так, что мы выбрали группу верхнего уровня, поле родителя в структуре не будет, но будут другие поля по отбору. Получится, что структура есть в параметре и есть какие то свойства в этой структуре, но не будет свойтсва с родителем и тоже будет ошибка. Значит делаем все эти проверки:</p>
    <div class="code-style">
        <pre>
            --модуль объекта
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаЗаполнения<span class="светло_красный">(</span>ДанныеЗаполнения<span class="светло_красный">,</span> ТекстЗаполнения<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                <span class="зелёный">//сначала мы вообще проверяем есть ли в параметре структура или нет</span>
                <span class="светло_красный">Если</span> ДанныеЗаполнения <span class="светло_красный">= Неопределено Тогда</span>
                    <span class="светло_красный">Возврат;</span>
                <span class="светло_красный">КонецЕсли;</span>

                <span class="зелёный">//далее надо проверить есть ли в структуре свойство с ключом "Родитель", 
                //2й параметр у метода Свойство() можно не указывать</span>
                <span class="светло_красный">Если</span> ДанныеЗаполнения<span class="светло_красный">.</span>Свойство<span class="светло_красный">(</span><span class="серый">"Родитель"</span><span class="светло_красный">) тогда</span>
                    Услуга <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Родитель<span class="светло_красный">.</span>Услуга<span class="светло_красный">;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Одно замечание. Я чуть выше писал, что если для списка справочника установить в настройках отбор по каким то полям, то в параметр ДанныеЗаполнения эти поля попадают в структуру в виде ключей, а значения этих полей в виде значения для ключей. Так вот при создании нового элемента справочника можно установить автоматом заполнение этих полей у нового элемента, если для каждого поля в палитре свойств в свойстве Представление -> "Заполнять из данных заполнения" поставить галочку, но такое заполнение будет работать только если существуют подходящие свойства в сруктуре, а они могут туда попасть при отборе или ещё как то. Но у нас немного другой случай, мы не устанавливаем отборы для списка, а значит и свойств соответствующих не будет в структуре параметра.</p>
    <p>НО мы можем сделать и по другому немного. Мы всё таки установим галочку для реквизита Услуга в свойстве  Представление -> "Заполнять из данных заполнения" и теперь чтобы этот реквизит заполнялся, нужно чтобы в параметре ДанныеЗаполнения в структуре было такое свойство как "Услуга" -> Истина или "Услуга" -> Ложь. Но такое свойство в структуре может появиться если мы сделаем отбор, но можно и не делать отбор, просто добавим в структуру сами это свойство в коде. По окончанию отработки этой процедуры в структуре параметра ДанныеЗаполнения будет нужное нам свойство и система сама уже заполнит соответствующие реквизиты из этой структуры, при наличии установленной галочки свойства "Заполнять из данных заполнения" для реквизита Услуга. 3й параметр как раз и говорит системе, чтобы она сама заполняла, если параметру СтандартнаяОбработка задать флаг Ложь, то система уже ничего сама заполнять не будет и тут поможет код выше, в котором мы сами устанавливали в реквизит Услуга нужное нам значение:</p>
    <div class="code-style">
        <pre>
            --модуль объекта
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаЗаполнения<span class="светло_красный">(</span>ДанныеЗаполнения<span class="светло_красный">,</span> ТекстЗаполнения<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                <span class="зелёный">//сначала мы вообще проверяем есть ли в параметре структура или нет</span>
                <span class="светло_красный">Если</span> ДанныеЗаполнения <span class="светло_красный">= Неопределено Тогда</span>
                    <span class="светло_красный">Возврат;</span>
                <span class="светло_красный">КонецЕсли;</span>

                <span class="зелёный">//далее надо проверить есть ли в структуре свойство с ключом "Родитель", 
                //2й параметр у метода Свойство() можно не указывать</span>
                <span class="светло_красный">Если</span> ДанныеЗаполнения<span class="светло_красный">.</span>Свойство<span class="светло_красный">(</span><span class="серый">"Родитель"</span><span class="светло_красный">) тогда</span>
                    ДанныеЗаполнения<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span><span class="серый">"Услуга"</span><span class="светло_красный">,</span> ДанныеЗаполнения<span class="светло_красный">.</span>Родитель<span class="светло_красный">.</span>Услуга<span class="светло_красный">);
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Это 2 работающих способа заполнять реквизиты. Если нам нужен простой способ заполнить реквизиты, то нужно постараться, чтобы использовать родной способ заполнения, т.е. использовать параметр СтандартнаяОбработка. А если у нас сложный код заполнения реквизитов, то отключаем стандартнуую обрабатку и сами заполняем как нам надо.</p>

    <p class="title-size16"><b id="spravochnik9">Проверка заполнения реквизитов при записи в БД. Событие "ОбработкаПроверкиЗаполнения"</b></p>
    <p>Если что то вот это видео - https://www.youtube.com/watch?v=dkHZGoUvoxs&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=4.  Там примерно с 30й минуты.</p>
    <p>Событие "ОбработкаПроверкиЗаполнения" как я понимаю наступает перед записью элемента справочника в БД. Если что поинтересоваться в синтакс помошнике.</p>
    <p>Например, есть такой случай, при создании нового элемента товара реквизит ЕдиницыИзмерения заполнять нужно, а вот при создании нового элемента услуги этот реквизит заполнять не нужно. Рассмотрим стандартный механизм заполнения. В конфигураторе для этого реквизита в палитре свойств у свойства Представление -> "Проверка заполнения" выберем "Выдавать ошибку". И теперь если это поле будет пустым, то система не даст нам записать этот элемент, например, для элемента услуги, где нам не нужно это поле заполнять. Идём в модуль объекта и там посмотрим на событие "ОбработкаПроверкиЗаполнения", в котором мы сможем создать разные условия для заполнения полей. 1й параметр Отказ, по умолчанию в нём Ложь, если в него поставить Истина, то элемент в БД не запишется. 2й парамметр Проверяемые реквизиты это массив реквизитов, для которых в свойстве "Проверка заполнения" выбрано "Выдавать ошибку". Вот что получилось:</p>
    <div class="code-style">
        <pre>
            --модуль объекта
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроверкиЗаполнения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> ПроверяемыеРеквизиты<span class="светло_красный">)</span>
                <span class="светло_красный">Если</span> <span class="светло_красный">НЕ</span> ЭтоГруппа <span class="светло_красный">И</span> Услуга <span class="светло_красный">Тогда</span>
                    Индекс <span class="светло_красный">=</span> ПроверяемыеРеквизиты<span class="светло_красный">.</span>Найти<span class="светло_красный">(</span><span class="серый">"ЕдИзм"</span><span class="светло_красный">);</span>
                    ПроверяемыеРеквизиты<span class="светло_красный">.</span>Удалить<span class="светло_красный">(</span>Индекс<span class="светло_красный">);</span>		
                <span class="светло_красный">КонецЕсли;	
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>При создании элемента услуги, мы смотрим на поле Услуга и если это она, то просто удаляем из массива ПроверяемыеРеквизиты поле "ЕдИзм".  Мы как бы говорим системе, что да, это поле стоит на проверку, но сейчас его не надо проверять, потому что мы создаём услуги и это поле нам не нужно. А вот в других случаях, когда мы создаём элемент товара, то у нас эта проверка не выполнится и мы не будем удалять из массива это поле и система смотжет проверить это поле на заполненность.</p>
    <p>Мы тут использовали возвожности самой системы как и в прошлом примере. Мы просто подправили массив, который считывает система для проверки заполненности реквизитов. Тут такой же совет, использовать по возможности стандартные механизмы системы, слегка вмешиваясь в этот механизм подправляя данные. Подобные механизмы работают и с документами и другими объектами.</p>

    <p class="title-size16"><b id="spravochnik10">Почему на этапе разработки не надо ставить галочку свойству "Неотрицательное" при установке реквизиту типа данных Число.</b></p>
    <p>Если мы установили эту галочку, то в пользовательском режиме не будет проблем, мы не сможем ввести отрицательное число. А вот при программировании, если мы вдруг захотим заполнить этот реквизит и там попадёт отрицательное число, то система превратит его в 0 и будет трудно отловить ошибку. А если мы уберём галочку, то после программного заполнения цен, если в реквизит попало отрицательное число, то мы увидим у товара отрицательную цену, а значит и понять примерно можем где ловить ошибку.</p>
    <p>Когда уже отладка конфигурации произошла и начали пользоваться ей, то можно и поставить эти галочки.</p>

    <p class="title-size16"><b id="spravochnik11">Определяем пол сотрудника по его отчеству.</b></p>
    <p>Есть карточка сотрудника, в этой карточке заполняются поля именем, фамилией, отчеством, также из перечисления можно выбрать пол сотрудника. Нужно по отчеству определить пол и вставить в поле "Пол". Вот решение:</p>
    <div class="code-style">
        <pre>
            --модуль формы элемента справочника "Сотрудники"
             
            &НаКлиенте
            Процедура ОтчествоПриИзменении(Элемент)
                Если ПустаяСтрока(Объект.Отчество) Тогда
                    Возврат;
                КонецЕсли;
            
                Окончание = НРег(Прав(Элементы.Отчество.ТекстРедактирования, 3));
                Если Окончание = "ич" Тогда
                    Объект.Пол = ПредопределенноеЗначение("Перечисление.ПолСотрудника.Мужской");
                Иначе	
                    Объект.Пол = ПредопределенноеЗначение("Перечисление.ПолСотрудника.Женский");
                КонецЕсли; 	
            КонецПроцедуры
        </pre>
    </div>

    

    <p class="title-size16"><b id="spravochnik13">Обработка заполняет реквизит "ВидНоменклатуры" у всех элементов справочника "Номенклатура" соответствующим значением перечисления</b></p>
    <p>В инфобазе "УчебнаяБаза(Курс Камков - Основные объекты)" в 3х обработках "ЗаполнениеВидаНоменклатуры1-2-3" написаны 3 немного разных способа заполнения этого реквизита.</p>

















    <h3 class="header-style" id="document">Работа с документами</h3>

    <p class="title-size16"><b id="document-base">Что такое и для чего нужен документ</b></p>
    <p>Объект конфигурации Документ предназначен для описания информации о совершенных хозяйственных операциях или о событиях, произошедших в жизни организации вообще. Как правило, в работе любой фирмы используются такие документы, как приходные накладные, приказы о приеме на работу, платежные поручения, счета и т.д. Свойства и структура этих документов описываются в объектах конфигурации Документ, на основе которых платформа создает в базе данных таблицы для хранения информации из этих документов. </p>
    <p>Логика работы документов отличается от логики работы других объектов конфигурации. Документ обладает способностью <i style="text-decoration: underline;">проведения</i>. Факт проведения документа означает, что событие, которое он отражает, повлияло на состояние учета. </p>
    <p>До тех пор, пока документ не проведен, состояние учета неизменно, и документ не более чем черновик, заготовка. Как только документ будет проведен, изменения, вносимые документом в учет, вступят в силу и состояние учета будет изменено. </p>
    <p>Поскольку документ вносит изменения в состояние учета, он всегда «привязан» к конкретному моменту времени. Это позволяет отражать в базе данных фактическую последовательность событий.</p>
    <p>Следующим важным фактом, вытекающим из двух предыдущих, является то, что система «1С:Предприятие» имеет механизмы, позволяющие отслеживать правильность состояния учета. Предположим, что мы изменили один из проведенных ранее документов и снова провели его задним числом. В этом случае система «1С:Предприятие» способна отследить, повлияют ли внесенные нами изменения на последующие проведенные документы, и, если это так, система способна перепровести необходимые документы. Механизм этот называется "Последовательности".</p>
    <p>В процессе работы пользователь может самостоятельно создавать новые документы – приходные и расходные накладные, счета и т.п. </p>
    <p>В базе данных каждый документ представляет собой отдельную запись в основной таблице, хранящей информацию об этом виде документов.</p>
    <p>Каждый документ, как правило, содержит информацию, которая подробнее описывает этот документ. Например, каждый документ Приходная накладная может содержать информацию о поставщике товаров, складе, на который приходуется товар, и т.д. </p>
    <p>Набор такой информации является одинаковым для всех документов одного вида, и для описания такого набора используются реквизиты объекта конфигурации Документ, являющиеся подчиненными объектами конфигурации. Большинство реквизитов разработчик создает самостоятельно, однако у каждого объекта конфигурации Документ по умолчанию существуют стандартные реквизиты. Два наиболее важных из них – это Дата и Номер. Поскольку тип данных Дата содержит дату и время с точностью до секунды, этот реквизит и определяет в основном положение документа на оси времени.</p>
    <p>Кроме этого, каждый документ содержит, как правило, некоторый набор информации, которая одинакова по своей структуре, но различна по количеству и предназначена для разных документов. Так, например, каждый документ Приходная накладная может содержать список приходуемых товаров. </p>
    <p>Для описания подобной информации служат табличные части объекта конфигурации Документ. В этом случае в базе данных будут созданы дополнительные таблицы для хранения табличных частей, подчиненных конкретному документу (рис. 4.3).</p>

    <p class="title-size16"><b id="document-types">Типы данных у документа</b></p>
    <p>Наряду с примитивными типами данных, таких как Число, Строка, Дата, Булево могут существовать типы данных, определяемые только конкретной конфигурацией. То есть такие типы, которые не присутствуют в конфигурации постоянно, а появляются в результате того, что добавлены некоторые объекты конфигурации.</p>
    <p>Объекты конфигурации, которые могут образовывать новые типы данных, называются <i style="text-decoration: underline;">типообразующими</i>.</p>
    <p>Например, при создании документа "Приходная накладная" в нашей конфигурации сразу появятся несколько типов данных:</p>
    <ul class="list">
        <li>ДокументМенеджер.ПриходнаяНакладная,</li>
        <li>ДокументСсылка.ПриходнаяНакладная,</li>
        <li>ДокументОбъект.ПриходнаяНакладная,</li>
        <li>ДокументВыборка.ПриходнаяНакладная</li>
    </ul>
    <img src="../img/1С-1/2023-08-02_11-09-28.png" class="screen" alt="">

    <p class="title-size16"><b id="document-prop-1">Значение заполнения</b></p>
    <p>Предположим у нашего предприятия есть основной склад и все товары поступающие к нам обязательно приходуются сначала на этот основной склад. Есть справочник Склады, в нём есть предопрделённый элемент склада - Основной. Мы можем облегчить работу пользователю указав этот предопределённый элемент склада по умолчанию. Пользователь создаёт новый документ, а там в реквизите "Склад" уже установленно значение "Основной".</p>
    <p>Нам нужно открыть палитру свойств реквизита "Склад" и найти свойство "Значение заполнения". В качестве значения этого свойства выберем предопределенный элемент справочника Склады – Основной.</p>
    <p>Ещё пример. Есть реквизит в справочнике "Сотрудники" - Пол. Мы задаём этому реквизиту тип данных "ПеречислениеСсылка.ПолСотрудника", а на закладке "Представление" в свойстве "Значение заполнения" можно выбрать любой пол для отображения по умолчанию.</p>
    <p>Как я понял пока, в этом свойстве можно выбирать предопределённые данные справочника или значения из перечисления. Других значений для выбора пока не встречал.</p>
    <p><span class="светло_красный">Более подробная инфа есть в книге "Разработка интерфейса" в главе 3.10.1</span></p>



    <p class="title-size16"><b id="doc-prop-1">Свойство "Проведение" во вкладке "Движения"</b></p>
    <p>Свойству "Проведение" можно указать значение "Запретить", но для большинства документов в этом смысла нет. Запрещаем мы проведение тогда, когда документ предназначен для ручной корректировки движений. В экзаменах это, например, документ "БухгалтерскаяОперация", где мы руками заносим проводки. Короче почти всегда свойству "Проведение" устанавливается "Разрешить".</p>



    <p class="title-size16"><b id="doc-prop-2">Свойство "Оперативное проведение" во вкладке "Движения"</b></p>
    <p>Фишка оперативного проведения в 3х приёмах:</p>
    <ul class="list">
        <li>Если мы прводим несколько раз документ текущим днём, то время каждый раз будет текущее</li>
        <li>Если 2 пользователя проведут документ в одну секунду, то система раскидает эти документы по разным секундам</li>
        <li>Будущей датой нельзя провести документ</li>
    </ul>
    <p>Если у нас стоит какая то задача, которая по условию противоречит одному из этих пунктов, то выключаем оперативное проведение. Например, документы начисляющие зарплату имеют запрет на оперативное проведение, потому что оно там не нужно. Зарплату раз в месяц начисляют ну или немного чаще и смысла от оперативного проведения нет. Зарплату наверно даже могут будущей датой назначить.</p>


    <p class="title-size16"><b id="doc-prop-3">Свойство "Удаление движений" во вкладке "Движения"</b></p>
    <p>У документа как объекта метаданных есть свойство "УдалениеДвижений" или в редакторе этого документа во вкладке "Движения" - "Удаление движений".</p>
    <p>По умолчанию стоит значение этого свойства - "Удалять автоматически при отмене проведения". В этом случае набор записей именно для текущего документа удаляется при отмене проведения, при пометке на удаление документа и при удалении документа. В этом режиме при перепроведении документа записи перезапишутся только в том миг, когда закончится процедура "ОбработкаПроведения".</p>
    <p>Если установить значение "Удалять автоматически", то при перепроведении с датой вперёд ещё до начала срабатывания обработчика "ОбработкаПроведения" система удалить предыдущие записи, да ещё и заблокирует их на время удаления, что не очень хорошо. Поэтому не надо трогать это значение. Казалось бы этот способ нам подходит при старой методике контроля остатков, нам как раз нужно удалять предыдущие записи из регистра для текущего документа в самом начале, чтобы они не попали в подсчёт остатков, но как уже описал, этот способ дополнительно производит блокировки и потому не очень желательно его использовать.</p>
    <p>Значит оставляем значение по умолчанию, но нам нужно как то удалить в самом начале обработки проведения предыдущие записи, мы сделаем это вручную, вот так:</p>
    <div class="code-style">
        <pre>
            Процедура ОбработкаПроведения(Отказ, Режим)  
                <span class="зелёный">//Либо так</span>
                Движения.ОстаткиТоваров.Очистить();
                Движения.ОстаткиТоваров.Записать();

                <span class="зелёный">//Либо так</span>
                Движения.ОстаткиТоваров.Записывать = Истина;
                Движения.Записать();

                <span class="зелёный">//Либо так</span>
                Движения.ОстаткиТоваров.Записать();
            КонецПроцедуры
        </pre>
    </div>
    <p>Раньше я думал, что если не включить значение "Удалять автоматически" и не удалять вручную в начале записи в регистре, то система при новой дате дописывает ещё один набор записей от того же документа просто с новой датой. Оказывает это не так. Система в любом случае при перепроведении перезапишет набор записей. Может я опять ошибаюсь, но пока на таком понимании остановился.</p>


    <p class="title-size16"><b id="dop-document11">Пересчёт суммы в табличной части и суммы документа</b></p>
    <p>Вот в этом видео показано с 30минуты - <a href="https://www.youtube.com/watch?v=baFxKi0Jcj4&list=PLh28ogpgRJUPQDnx1uV9p19jLbpyBa3ua">тут</a></p>





    <p class="title-size16"><b id="dop-document12">Как работате перепроведение</b></p>
    <p>Когда документ перепроводится и мы записываем в транзакции набор записей, то этот набор пока записывается в черновик куда то и как бы помечаются что это актуальный набор, а старый набор этого документа помечается как старый. Затем мы в запросе получаем остатки и функция Остатки() регистра начинает получать данные из итоговой таблицы. Берутся те данные, которые там есть для нужных товаров и идёт пересчёт в оперативной памяти этих итогов с учётом черновика(если есть чтото в черновике). Берутся записи помеченные как старые и вычитаются из итогов, а записи помеченные как новые прибавляются к итогам и этот результат возвращается из запроса. Это всё я так понимаю. Чистов единственное рассказал, что новый набор помещается в транзакционный кеш, буду считать это черновиком.</p>
    <img src="../img/1С-1/2025-02-10_12-47-45.png" class="screen" alt="">
    <p>Примерно так, если что пересмотреть видео Чистова "20 СпецКурс 012  Доп. " на рутубе</p>




    <p class="title-size16"><b id="dop-document1">Метод СоздатьДокумент() у менеджера документа и добавление товара из справочника в табличную часть документа</b></p>
    <p>Подразумевается, что уже создан вид документа "ПоступлениеТоваров", созданы реквизиты и табличная часть Товары и мы просто программно добавляем новый документ и вписываем в его табличную часть товар из справчоника. Всё это можно сделать не в обработке, а с помощью модуля приложения и процедуры в общих модулях. Чтобы сделать какую то обработку данных в системе 1С используются обработки, но можно обойтись и без них, но скорее только в учебных целях(но это не точно). Можно использовать в модуле приложения(он выполняется только на клиенте) обработчик события "ПриНачалеРаботыСистемы", который будет вызывать процедуру из общего модуля. Общий модуль сделаем доступным только на сервере, для этого поставим галочку "Сервер" и чтобы можно было вызвать процедуру из общего модуля от клиентского модуля приложения нужно ещё поставить галочку "Вызов сервера"(это обязательно) в свойствах общего модуля. Затем в процедуре общего модуля пишем логику с изменениями каких то данных в БД и при запуске системы срабатывает событие "при начале работы системы" и запускается обработчик в модуле приложения, который запускает процедуру из общего модуля на сервере и что то меняет на сервере. Вот такой есть способ сделать обработку данных. Ну правда придётся перезапускать 1С предприятие, чтобы выполнить обработку.</p>
    <div class="code-style">
        <pre>
            --модуль приложения
            <span class="светло_синий">Процедура ПриНачалеРаботыСистемы()
                Серверный.НаСервере();
            КонецПроцедуры</span>

            --общий модуль Серверный
            <span class="светло_синий">Процедура НаСервере() Экспорт
                НовыйДокумент = Документы.ПоступлениеТоваров.СоздатьДокумент();
                НовыйДокумент.Дата = ТекущаяДата();
                СтрокатабЧасти = НовыйДокумент.Товары.Добавить();
                СтрокатабЧасти.Товар = <span class="светло_красный">&lt;Тут должна быть ссылка на товар справочника></span>;
                НовыйДокумент.Записать();
            КонецПроцедуры</span>
        </pre>
    </div>





    <p class="title-size16"><b id="dop-document2">Разница между кнопкой "Записать" и "Провести" у документа</b></p>
    <p>Пока документ не проводился, то при нажатии кнопки "Записать" документ записывает свои данные реквизитов в БД и по пути вызываются обработчики событий объекта документа "ПередЗаписью" и "ПриЗаписи".</p>
    <p>Когда мы жмём "Провести" или "Провести и закрыть", то вызываются по пути к записи данных обработчики "ПередЗаписью", "ПриЗаписи", "ОбработкаПроведения". И теперь если нажать кнопку "Записать", то вызовутся все обработчики событий те же, что и при проведении.</p>
    <p>Вывод - записать документ без проведения можно только до его проведения, после он проводится по любой кнопке.</p>





    <p class="title-size16"><b id="dop-document3">Разница между событиями "ПередЗаписью", "ПриЗаписи", "ОбработкаПроведения"</b></p>
    <p>Представим такой случай. У нас в документе есть реквизит "СуммаДокумента" и мы решили, что сложим все суммы из табличной части и присвоим итоговую сумму в реквизит "СуммаДокумента" в обработчике "ОбработкаПроведения". Когда вызовется эта обработка? Она вызовется после записи всех данных в БД. Сумма присвоится реквизиту "СуммаДокумента", но в БД этот реквизит будет пустым, потому что запись уже прошла.</p>
    <p>После записи и отработки всех событий система сама вернёт обратно форму на клиент с обновлённой информацией и мы даже увидим в реквизите "СуммаДокумента" нужну сумму, но это будет обманка, потому что эта сумма присвоилась только реквизиту в обработке проведения, но не записана в БД. Но увидим сумму только в форме документа, потому что она обновляется при изменении и записи документа. А вот если мы находимся в форме списка документа, выбрали в списке документ и провели его через контекстное меню, то эта форма не обновится и в реквизите "СуммаДокумента" не увидим изменений. !!!Уточнение. Не верно я описал, форма списка обновляет проводимый объект документа, но если сумма документа считается в обработке проведение, то почему то реквизит "СуммаДокумента" не обновится при проведении выбранного документа, как он обновлялся в форме документа. А вот если бы сумма считалась в обработке "ПередЗаписью", то обновился бы.</p>
    <p>Поэтому, чтобы было всё хорошо с суммой в реквизите, надо либо сразу на клиенте посчитать в обработчике "ПередЗаписью"(на клиенте) модуля формы или в спомощью других событий формы на клиенте и присвоить в этот реквизит посчитанную сумму, либо в обработчике события "ПередЗаписью" модуля объекта описать присвоение. Ещё один миг почему в обработчике "ПередЗаписью" модуля объекта, а не в обработчике "ПередЗаписью"(на клиенте) модуля формы, потому что мы можем записать или провести документ программно из другого места программы, а это значит, что не отработает событие формы "ПередЗаписью".</p>
    <p>Вот схема записи и проведения документа. Схема учитывает, что документ уже проводился, а значит и запись и проведение будут возбуждать событие "ОбработкаПроведения". Если бы документ был бы не проведён, то запись не вызывала бы это событие:</p>
    <img src="../img/1С-1/2023-10-11_09-07-16.png" class="screen" alt="">
    <p>Если информация уточнится, то допишу.</p>




    <p class="title-size16"><b id="dop-document4">В таб. части Товары документа "ПродажаТоваров" при выборе товара нужно подставить цену в поле Цена из реквизита справочника Номенклатура "ЦенаПродажи".</b></p>
    <p>Много описывать тут нечего. Вот сразу код:</p>
    <div class="code-style">
        <pre>
            --модуль формы
            <span class="светло_синий"><span class="светло_красный">&НаСервереБезКонтекста
            Функция</span> ТоварыНоменклатураПриИзмененииНаСервере<span class="светло_красный">(</span>ИмяТовара<span class="светло_красный">)</span>
                <span class="зелёный">//В ИмяТовара содержится ссылка на элемент справочника. Через ссылку можно получать значения полей объекта БД, 
                //на который указывает эта ссылка</span>
                <span class="светло_красный">Возврат</span> СсылкаТовара<span class="светло_красный">.</span>ЦенаТовара<span class="светло_красный">;</span>
            <span class="светло_красный">КонецФункции

            &НаКлиенте
            Процедура</span> ТоварыНоменклатураПриИзменении<span class="светло_красный">(</span>Элемент<span class="светло_красный">)</span> 
                ТекДанные <span class="светло_красный">=</span> Элементы<span class="светло_красный">.</span>Товары<span class="светло_красный">.</span>ТекущиеДанные<span class="светло_красный">;</span>
                ЦенаТовара <span class="светло_красный">=</span> ТоварыНоменклатураПриИзмененииНаСервере<span class="светло_красный">(</span>ТекДанные<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">);</span>
                ТекДанные<span class="светло_красный">.</span>Цена <span class="светло_красный">=</span> ЦенаТовара<span class="светло_красный">;</span> 

                <span class="зелёный">//далее тут можно вызвать процедуру пересчёта поля Сумма,
                //если у нас есть такая логика</span>
            <span class="светло_красный">КонецПроцедуры</span></span>
        </pre>
    </div>


    <p class="title-size16"><b id="dop-document5">Практика. В таб.части документа изменить поле Цена во всех строках при изменении реквизита Контрагент в шапке документа.</b></p>
    <p>ПРимер из курса Камкова - Основные объекты(видео 2.3). Для начала вот снимок формы документа:</p>
    <img src="../img/1С-1/2023-05-07_09-46-12.png" class="screen" alt="">
    <p>Мы выбрали Контрагента и заполнили таб. часть товарами, но потом решили сменить поле Контрагент на другво поставщика и у нас должны смениться цены для всех товаров взятые из регистра сведений "ЦеныПоставщиков". Первоначально цены заполняются при выборе товара.</p>
    <p>Но есть ещё одно дополнение, мы не будем писать основной алгоритм в модуле формы, а напишем его в модуле объекта документа "ПоступлениеТоваров". Почему так? Как объяснил Камков, это для того чтобы была возможность вызвать этот алгоритм не только из формы, но и из других мест. Например, мы где то в обработке загрузили товары из файла Эксель и у нас есть название поставщика, нам нужно загрузить эти товары в таб.часть этого документа в БД и заполнить шапку документа. Получить цены мы сможем вызвав алгоритм написанный в модуле документа и дальше посчитать сумму и всё это записать в БД. Как видно мы тут не смогли бы так сделать, если бы алгоритм был написан в модуле формы.</p>
    <p>Продолжим. Опишем обработчик на клиенте события "ПриИзменении" для поля Контрагент в форме и вызовем функцию на сервере. Так как логика у нас будет в модуле объекта, то нам надо как то получить объект текущего документа, чтобы вызвать ту логику. Для этого есть функция РеквизитФормыВЗначение("Объект"), в которую передаём основной реквизит формы Объект в виде строки. После того как цены заполнены мы переводим на сервере обратно документ объект в основной реквизит формы Объект и заполняем его данными для отображения новых данных в форме. Всё это делает процедура ЗначениеВРеквизитФормы().</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Процедура</span> КонтрагентПриИзмененииНаСервере<span class="светло_красный">()</span>	  
                ДокументОбъект <span class="светло_красный">=</span> РеквизитФормыВЗначение<span class="светло_красный">(</span><span class="серый">"Объект"</span><span class="светло_красный">);</span>
                ДокументОбъект<span class="светло_красный">.</span>ЗаполнитьЦеныТоваровПоПоставщику<span class="r">();</span>
                ЗначениеВРеквизитФормы<span class="светло_красный">(</span>ДокументОбъект<span class="светло_красный">,</span> <span class="серый">"Объект"</span><span class="светло_красный">);   
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> КонтрагентПриИзменении<span class="светло_красный">(</span>Элемент<span class="светло_красный">)</span> 
                КонтрагентПриИзмененииНаСервере<span class="светло_красный">();
            КонецПроцедуры</span></span> 
        </pre>
    </div>
    <p>Вот сам код из модуля объекта. Первый код Камков показал, другой мой:</p>
    <div class="code-style">
        <pre>
            --код Камкова------------------------------------------------------------------------------------------------------------
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ЗаполнитьЦеныТоваровПоПоставщику<span class="светло_красный">() Экспорт</span>	
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"
                    |ВЫБРАТЬ
                    |	ПоступлениеТоваровТовары.Товар КАК Товар,
                    |	ПоступлениеТоваровТовары.СерияТовара КАК СерияТовара,
                    |	ПоступлениеТоваровТовары.Количество КАК Количество
                    |ПОМЕСТИТЬ ТаблицаДокумента
                    |ИЗ
                    |	Документ.ПоступлениеТоваров.Товары КАК ПоступлениеТоваровТовары
                    |ГДЕ
                    |	ПоступлениеТоваровТовары.Ссылка = &Ссылка
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ТаблицаДокумента.Товар КАК Товар,
                    |	ТаблицаДокумента.СерияТовара КАК СерияТовара,
                    |	ТаблицаДокумента.Количество КАК Количество,
                    |	ЦеныПоставщиковСрезПоследних.Цена КАК Цена,
                    |	ТаблицаДокумента.Количество * ЦеныПоставщиковСрезПоследних.Цена КАК Сумма
                    |ИЗ
                    |	ТаблицаДокумента КАК ТаблицаДокумента
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныПоставщиков.СрезПоследних(
                    |				&ДатаДокумента,
                    |				Контрагент = &Контрагент
                    |					И Номенклатура В
                    |						(ВЫБРАТЬ
                    |							ТаблицаДокумента.Товар КАК Товар
                    |						ИЗ
                    |							ТаблицаДокумента КАК ТаблицаДокумента)) КАК ЦеныПоставщиковСрезПоследних
                    |		ПО ТаблицаДокумента.Товар = ЦеныПоставщиковСрезПоследних.Номенклатура"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"ДатаДокумента"<span class="светло_красный">,</span> Дата<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"Контрагент"<span class="светло_красный">,</span> Контрагент<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"Ссылка"<span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                
                <span class="зелёный">//у табличной части документа Товары есть метод Загрузить(), передаём в этот метод 
                //таблицу значений и строки табличной части заполняются из этой таблицы</span>
                Товары<span class="светло_красный">.</span>Загрузить<span class="светло_красный">(</span>РезультатЗапроса<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">());	
            КонецПроцедуры</span></span>


            --второй код------------------------------------------------------------------------------------------------------------------------
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ЗаполнитьЦеныТоваровПоПоставщику2<span class="светло_красный">() Экспорт</span>
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"
                    |ВЫБРАТЬ
                    |	ПоступлениеТоваровТовары.Товар КАК Товар
                    |ПОМЕСТИТЬ ТаблицаДокумента
                    |ИЗ
                    |	Документ.ПоступлениеТоваров.Товары КАК ПоступлениеТоваровТовары
                    |ГДЕ
                    |	ПоступлениеТоваровТовары.Ссылка = &Документ
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ТаблицаДокумента.Товар КАК Товар,
                    |	ЦеныПоставщиковСрезПоследних.Цена КАК Цена
                    |ИЗ
                    |	ТаблицаДокумента КАК ТаблицаДокумента
                    |	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныПоставщиков.СрезПоследних(
                    |			,
                    |			Контрагент = &Контрагент
                    |			И Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ТаблицаДокумента.Товар КАК Товар
                    |					ИЗ
                    |						ТаблицаДокумента КАК ТаблицаДокумента)) КАК ЦеныПоставщиковСрезПоследних
                    |	ПО ТаблицаДокумента.Товар = ЦеныПоставщиковСрезПоследних.Номенклатура"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"Контрагент"<span class="светло_красный">,</span> Контрагент<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"Документ"<span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span> 
                
                <span class="зелёный">//если не нашлось товаров и цен для указанного Контраегнта, то заполняем поля Цена и Сумма пустотой</span>
                <span class="светло_красный">Если</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда
                    Для каждого</span> Строка <span class="светло_красный">Из</span> Товары <span class="светло_красный">Цик</span>л        
                        Строка<span class="светло_красный">.</span>Цена <span class="светло_красный">=</span> 0<span class="светло_красный">;</span>
                        Строка<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> 0<span class="светло_красный">;
                    КонецЦикла;
                Иначе</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span> 
                    <span class="зелёный">//для удобвства заполняю структуру данными из выборки. Ключ - Товар, значение - Цена</span>
                    Значения <span class="светло_красный">= Новый</span> Структура<span class="светло_красный">;
                    Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                        Значения<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>Товар<span class="светло_красный">,</span> Выборка<span class="светло_красный">.</span>Цена<span class="светло_красный">);       
                    КонецЦикла;</span>
                    
                    НайденноеЗначение <span class="светло_красный">=</span> Неопределено<span class="светло_красный">;
                    Для каждого</span> СтрокаТабЧасти <span class="светло_красный">Из</span> Товары <span class="светло_красный">Цикл
                        <span class="зелёный">//заполняем строки таб. части в полях Цена и Сумма, проверяя есть ли такой товар в структуре, если есть то подставляем цену</span>
                        <span class="зелёный">//если нету, то заполняем пустотой</span>
                        Если</span> Значения<span class="светло_красный">.</span>Свойство<span class="светло_красный">(</span>СтрокаТабЧасти<span class="светло_красный">.</span>Товар<span class="светло_красный">,</span> НайденноеЗначение<span class="светло_красный">) Тогда</span>
                            //у нас могут быть пусты цены у товаров, поэтому возвращается null, проверяем и заменяем на 0
                            НайденноеЗначение <span class="светло_красный">=</span> ?<span class="светло_красный">(</span>ТипЗнч<span class="светло_красный">(</span>НайденноеЗначение<span class="светло_красный">) =</span> Тип<span class="светло_красный">(</span>"Null"<span class="светло_красный">),</span> 0<span class="светло_красный">,</span> НайденноеЗначение<span class="светло_красный">);</span>
                            СтрокаТабЧасти<span class="светло_красный">.</span>Цена <span class="светло_красный">=</span> НайденноеЗначение<span class="светло_красный">;</span>
                            СтрокаТабЧасти<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> СтрокаТабЧасти<span class="светло_красный">.</span>Количество <span class="светло_красный">*</span> НайденноеЗначение<span class="светло_красный">;
                        Иначе</span>
                            СтрокаТабЧасти<span class="светло_красный">.</span>Цена <span class="светло_красный">=</span> 0<span class="светло_красный">;</span> 
                            СтрокаТабЧасти<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> 0<span class="светло_красный">;
                        КонецЕсли;        
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вся разница в итоге толко в обработке результата запроса. У Камкова обработка заняла всего одну строку из-за метода Загрузить() у табличной части. Я не знал про этот метод, надо запомнить. После проверок моя обработка результат работает также как и этот метод. Ну зато потренировался.</p>



    <p class="title-size16"><b id="dop-document6">"Дополнительные свойства" документа</b></p>
    <p>Пишу это из телеграмма одного программиста 1с.</p>
    <p>У некоторых объектов конфигурации есть полезная структура «Дополнительные свойства», которая позволяет хранить значения, связанные с объектом, но не изменяющие объект. В синтаксис-помощнике приводится пример использования этой структуры в подписке на событие. Но в своей задаче я воспользовался данной структурой, чтобы обойти определенные проверки при записи документа. Требовалось при создании документа «Поступления товаров и услуг» не выполнять заполнение собственных реквизитов, если документ создается автоматически специальной обработкой.</p>
    <p>Про «Дополнительные свойства» узнал из вопросов на собеседовании, как ответ на вопрос «как передать значение из события документа «ПередЗаписью» в «ПриЗаписи».</p>
    <div class="code-style">
        <pre>
            Процедура СоздадтьДокументы()
                //...
                НовыйДокумент = Документы.ПоступлениеТоваров.СоздатьДокумент();
                //...
                НовыйДокумент.ДополнительныеСвойства.Вставить("ПропуститьПроверки", Истина);
                НовыйДокумент.Записать();
                //...
            КонецПроцедуры
        </pre>
    </div>



    <p class="title-size16"><b id="dop-document7">Способ, как не добавляя реквизит "СуммаДокумента" в форму документа, видеть это поле с подсчётами в форме списка документа</b></p>
    <p>Описывать детально не буду, просто мне понравился сам подход, как такое можно делать и не только с суммой, но и с любым полем, если не нужно добавлять это поле в таблицу в БД.</p>
    <p>Суть в следующем. Создаём свою форму списка документа, потом в этой форме для его основного реквизита "Список" настраиваем прозвольный запрос, который нам будет выводить данные в список. В этом запросе нам надо как то добавить дополнительное поле "СуммаДокумента". Делаем запрос с выборкой из таб. части документа все ссылки и сумму(этому полю дадим псевдоним "СуммаДокумента"), затем группируем записи и помещаем во временную таблицу, потом в основном запросе через левое соединение присоединяем эту временную таблицу по полю Ссылка. А можно не через временную таблицу, а через вложенный запрос, вложенный запрос также вернёт таблицу с группированными товарами, присоединяем эту таблицу к основной таблице документа. Всё, осталось в редакторе формы вынести поле "СуммаДокумента" влево в элементы формы.</p>
    <p>Это трудозатратно для системы, но зато мы не добавляем лишнее поле в таблицу в БД. Что выгоднее пока не знаю.</p>
    <p>Запрос с временной таблицей:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">ПоступлениеТоваровТовары</span><span class="светло_красный">.</span>Ссылка <span class="светло_красный">КАК</span> Ссылка<span class="светло_красный">,</span>
                <span class="светло_красный">СУММА(</span><span class="зелёный">ПоступлениеТоваровТовары</span><span class="светло_красный">.</span>Сумма<span class="светло_красный">) КАК</span> СуммаДокумента
            <span class="светло_красный">ПОМЕСТИТЬ</span> <span class="зелёный">ВТ</span>
            <span class="светло_красный">ИЗ</span>
                Документ<span class="светло_красный">.</span>ПоступлениеТоваров<span class="светло_красный">.</span>Товары <span class="светло_красный">КАК</span> <span class="зелёный">ПоступлениеТоваровТовары</span>

            <span class="светло_красный">СГРУППИРОВАТЬ ПО</span>
                <span class="зелёный">ПоступлениеТоваровТовары</span><span class="светло_красный">.</span>Ссылка
            <span class="светло_красный">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Ссылка <span class="светло_красный">КАК</span> Ссылка<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>ПометкаУдаления <span class="светло_красный">КАК</span> ПометкаУдаления<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Номер <span class="светло_красный">КАК</span> Номер<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Дата <span class="светло_красный">КАК</span> Дата<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Проведен <span class="светло_красный">КАК</span> Проведен<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Контрагент <span class="светло_красный">КАК</span> Контрагент<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>ДоговорКонтрагента <span class="светло_красный">КАК</span> ДоговорКонтрагента<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Товары<span class="светло_красный">.(</span>
                    Ссылка <span class="светло_красный">КАК</span> Ссылка<span class="светло_красный">,</span>
                    НомерСтроки <span class="светло_красный">КАК</span> НомерСтроки<span class="светло_красный">,</span>
                    Номенклатура <span class="светло_красный">КАК</span> Номенклатура<span class="светло_красный">,</span>
                    Цена <span class="светло_красный">КАК</span> Цена<span class="светло_красный">,</span>
                    Количество <span class="светло_красный">КАК</span> Количество<span class="светло_красный">,</span>
                    Сумма <span class="светло_красный">КАК</span> Сумма
                <span class="светло_красный">) КАК</span> Товары<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>МоментВремени <span class="светло_красный">КАК</span> МоментВремени<span class="светло_красный">,</span>
                <span class="зелёный">ВТ</span><span class="светло_красный">.</span>СуммаДокумента <span class="светло_красный">КАК</span> СуммаДокумента
            <span class="светло_красный">ИЗ</span>
                Документ<span class="светло_красный">.</span>ПоступлениеТоваров <span class="светло_красный">КАК</span> <span class="зелёный">ДокументПоступлениеТоваров</span>
                    <span class="светло_красный">ЛЕВОЕ СОЕДИНЕНИЕ</span> ВТ <span class="светло_красный">КАК</span> <span class="зелёный">ВТ</span>
                    <span class="светло_красный">ПО</span> <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Ссылка <span class="светло_красный">=</span> <span class="зелёный">ВТ</span><span class="светло_красный">.</span>Ссылка</span>
        </pre>
    </div>
    <p>Запрос с вложенной таблицей:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Ссылка <span class="светло_красный">КАК</span> Ссылка<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>ПометкаУдаления <span class="светло_красный">КАК</span> ПометкаУдаления<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Номер <span class="светло_красный">КАК</span> Номер<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Дата <span class="светло_красный">КАК</span> Дата<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Проведен <span class="светло_красный">КАК</span> Проведен<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Контрагент <span class="светло_красный">КАК</span> Контрагент<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>ДоговорКонтрагента <span class="светло_красный">КАК</span> ДоговорКонтрагента<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Товары<span class="светло_красный">.(</span>
                    Ссылка <span class="светло_красный">КАК</span> Ссылка<span class="светло_красный">,</span>
                    НомерСтроки <span class="светло_красный">КАК</span> НомерСтроки<span class="светло_красный">,</span>
                    Номенклатура <span class="светло_красный">КАК</span> Номенклатура<span class="светло_красный">,</span>
                    Цена <span class="светло_красный">КАК</span> Цена<span class="светло_красный">,</span>
                    Количество <span class="светло_красный">КАК</span> Количество<span class="светло_красный">,</span>
                    Сумма <span class="светло_красный">КАК</span> Сумма
                <span class="светло_красный">) КАК</span> Товары<span class="светло_красный">,</span>
                <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>МоментВремени <span class="светло_красный">КАК</span> МоментВремени<span class="светло_красный">,</span>
                <span class="зелёный">ВЗ</span><span class="светло_красный">.</span>СуммаДокумента <span class="светло_красный">КАК</span> СуммаДокумента
            <span class="светло_красный">ИЗ</span>
                Документ<span class="светло_красный">.</span>ПоступлениеТоваров <span class="светло_красный">КАК</span> <span class="зелёный">ДокументПоступлениеТоваров</span>
                    <span class="светло_красный">ЛЕВОЕ СОЕДИНЕНИЕ</span> (
                        <span class="светло_синий"><span class="светло_красный">ВЫБРАТЬ</span>
                            <span class="зелёный">ПоступлениеТоваровТовары</span><span class="светло_красный">.</span>Ссылка <span class="светло_красный">КАК</span> Ссылка<span class="светло_красный">,</span>
                            <span class="светло_красный">СУММА(</span><span class="зелёный">ПоступлениеТоваровТовары</span><span class="светло_красный">.</span>Сумма<span class="светло_красный">) КАК</span> СуммаДокумента
                        <span class="светло_красный">ИЗ</span>
                            Документ<span class="светло_красный">.</span>ПоступлениеТоваров<span class="светло_красный">.</span>Товары <span class="светло_красный">КАК</span> <span class="зелёный">ПоступлениеТоваровТовары</span>
                        ) <span class="светло_красный">КАК</span> <span class="зелёный">ВЗ</span>
                    <span class="светло_красный">ПО</span> <span class="зелёный">ДокументПоступлениеТоваров</span><span class="светло_красный">.</span>Ссылка <span class="светло_красный">=</span> <span class="зелёный">ВЗ</span><span class="светло_красный">.</span>Ссылка</span>
        </pre>
    </div>





    <p class="title-size16"><b id="dop-document8">При выборе товара в таб. части документа открывается форма выбора справочника. Нужно чтобы в этой форме было доп. поле с остатками товаров.</b></p>
    <p>Пример похож на предыдущий, потому что придётся также использовать произвольный запрос для динамического списка.</p>
    <p>Когда мы в таб. части документа выбираем товар, то открывается форма выбора справочника Номенклатура, если мы хотим что то добавить своё в эту форму, значит нам надо создать свою форму выбора у этого справочника. Создаём, у этой формы основным реквизитом является динамический список "Список", также как и в предыдущем примере настраиваем произвольный запрос на вкладке "Объект" в палитре свойств. В запросе можно на выбор использовать либо временную таблицу, либо вложенную. Я буду писать с временной таблицей. В запросе нам нужно к основной таблице справочника Номенклатура присоединить временную таблицу с остатками товаров. Вот такой запрос получился:</p>
    <p>Мы не будем создавать реквизит "ОстаткиТоваров" для этой формы, мы добавим поле в динамический список в запросе, всё как в прошлом примере. Если сравнить, то наше поле "ОстатокТоваров" это виртуальное поле, которое мы на лету создаём и заполняем.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">ОстаткиТоваровОстатки</span><span class="светло_красный">.</span>Номенклатура <span class="светло_красный">КАК</span> Номенклатура<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиТоваровОстатки</span><span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">КАК</span> ОстатокТовара
            <span class="светло_красный">ПОМЕСТИТЬ</span> <span class="зелёный">ВТ</span>
            <span class="светло_красный">ИЗ</span>
                РегистрНакопления<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Остатки <span class="светло_красный">КАК</span> <span class="зелёный">ОстаткиТоваровОстатки</span>
            <span class="светло_красный">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Ссылка <span class="светло_красный">КАК</span> Ссылка<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>ПометкаУдаления <span class="светло_красный">КАК</span> ПометкаУдаления<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Родитель <span class="светло_красный">КАК</span> Родитель<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>ЭтоГруппа <span class="светло_красный">КАК</span> ЭтоГруппа<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Код <span class="светло_красный">КАК</span> Код<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Наименование <span class="светло_красный">КАК</span> Наименование<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>СтавкаНДС <span class="светло_красный">КАК</span> СтавкаНДС<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Весовой <span class="светло_красный">КАК</span> Весовой<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Качество <span class="светло_красный">КАК</span> Качество<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>ПроисхождениеНоменклатуры <span class="светло_красный">КАК</span> ПроисхождениеНоменклатуры<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Услуга <span class="светло_красный">КАК</span> Услуга<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>ЕдИзм <span class="светло_красный">КАК</span> ЕдИзм<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>ЦенаТовара <span class="светло_красный">КАК</span> ЦенаТовара<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Предопределенный <span class="светло_красный">КАК</span> Предопределенный<span class="светло_красный">,</span>
                <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>ИмяПредопределенныхДанных <span class="светло_красный">КАК</span> ИмяПредопределенныхДанных<span class="светло_красный">,</span>
                <span class="зелёный">ВТ<span class="светло_красный"></span>.</span>ОстатокТовара <span class="светло_красный">КАК</span> ОстатокТовара
            <span class="светло_красный">ИЗ</span>
                Справочник<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">КАК</span> <span class="зелёный">СправочникНоменклатура</span>
                    <span class="светло_красный">ЛЕВОЕ СОЕДИНЕНИЕ</span> <span class="зелёный">ВТ</span> <span class="светло_красный">КАК</span> <span class="зелёный">ВТ</span>
                    <span class="светло_красный">ПО</span> <span class="зелёный">ВТ</span><span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> <span class="зелёный">СправочникНоменклатура</span><span class="светло_красный">.</span>Ссылка</span>
        </pre>
    </div>




    <p class="title-size16"><b id="dop-document9">Дополнение к предыдущей записи про форму выбора. Нужно передать параметр в форму выбора справочника в запрос для динамического списка. Свойство <b>"Связи параметров выбора"</b>, свойство <b>"Параметры"</b> у формы.</b></p>
    <p>Обстановка та же что и в предыдущей записи. Мы в произвольном запросе соединяли с основной таблицей Номенклатура таблицу остатков, в эту таблицу остатков мы можем передать параметр &ДатаДокумента. Как это сделать? Идём в документ и далее к реквизиту Товар таб. части Товары. Для этого реквизита в палитре свойств найдём знакомое нам свойство "Связи параметров выбора". Откроем его и в окне слева выберем доступный нам реквизит Дата, перенесём его вправо и в колонке Имя зададим имя какой нам хочется, назовём его МояДата.</p>
    <p>Когда мы нажимаем на кнопку "Показать все" в подсказке у реквизита Товар, то система программно открывает форму выбора справочника, видимо она считывает значение свойства "Связи параметров выбора", формирует параметр из того, что мы указали и даёт сигнал на сервер с командой создать такую форму и передать ей вот эти параметры. Параметры попадают в свойство "Параметры" для создаваемой формы выбора. Теперь идём в форму выбора справочника Номенклатура и у ней есть событие "ПриСозданииНаСервере". Это событие сработает когда форма собирается на сервере. В обработчике этого события мы можем поймать этот переданный параметр. У формы есть свойство Параметры, куда помещаются все переданные ей параметры, получим оттуда наш параметр:</p>
    <div class="code-style">
        <pre>
            --модуль формы выбора справочника Номенклатура
            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                Дата <span class="светло_красный">=</span> Параметры<span class="светло_красный">.</span>МояДата<span class="светло_красный">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>В свойстве формы Параметры есть свои стандартные параметры и те, которые передаём мы. Но мы можем и не передать параметр, тогда будет ошибка при попытке его получения, сделаем проверку:</p>
    <div class="code-style">
        <pre>
            --модуль формы выбора справочника Номенклатура
            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                <span class="светло_красный">Если</span> Параметры<span class="светло_красный">.</span>Свойство<span class="светло_красный">(</span><span class="серый">"МояДата"</span><span class="светло_красный">) =</span> Неопределено <span class="светло_красный">Тогда</span>
                    <span class="зелёный">//установим дату никакую</span>
                    Дата <span class="светло_красный">=</span> <span class="оранжевый">'00010101'</span><span class="светло_красный">;</span>
                <span class="светло_красный">Иначе</span>
                    Дата <span class="светло_красный">=</span> Параметры<span class="светло_красный">.</span>МояДата<span class="светло_красный">;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Итак, параметр мы поймали, теперь его надо передать как то в динамический список "Список". У динамического списка тоже есть свойство Параметры, у этого свойства есть метод УстановитьЗначениеПраметра():</p>
    <div class="code-style">
        <pre>
            --модуль формы выбора справочника Номенклатура
            <span class="светло_синий"><span class="светло_красный">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                <span class="светло_красный">Если</span> Параметры<span class="светло_красный">.</span>Свойство<span class="светло_красный">(</span><span class="серый">"МояДата"</span><span class="светло_красный">) =</span> Неопределено <span class="светло_красный">Тогда</span>
                    <span class="зелёный">//установим дату никакую</span>
                    Дата <span class="светло_красный">=</span> <span class="оранжевый">'00010101'</span><span class="светло_красный">;</span>
                <span class="светло_красный">Иначе</span>
                    Дата <span class="светло_красный">=</span> Параметры<span class="светло_красный">.</span>МояДата<span class="светло_красный">;
                КонецЕсли;</span>

                Список<span class="светло_красный">.</span>Параметры<span class="светло_красный">.</span>УстановитьЗначениеПараметра<span class="светло_красный">(</span><span class="серый">"ДатаДокумента"</span><span class="светло_красный">,</span> Дата<span class="светло_красный">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Ещё одно замечание от себя. Если передать параметр с датой документа, то мы получим остатки до того, как повлияет этот документ на остатки. Если вдруг надо получить остатки уже после влияния этого документа, то к дате нужно прибавить секунду.</p>





    <p class="title-size16"><b id="dop-document10">Что такое "режим разделения итогов"(для поиска "разделение итогов")</b></p>
    <p>Данные с ИТС. Данный режим поддерживается для регистра накопления и регистра бухгалтерии.</p>
    <p>Прежде всего, нужно отметить, что режим разделения итогов влияет только на параллельность работы системы и никак не сказывается на самой бизнес-логике решаемых задач. То есть это механизм платформы, который обеспечивает более высокий уровень параллельности и управляется в конфигурации и в информационной базе только с целью настройки использования данной возможности для конкретных объектов конфигурации и в конкретном внедрении. С точки зрения решаемых задач предметной области он конфигурирования не требует.</p>
    <p>Поясним суть работы механизма на примере регистра накопления.</p>
    <p>Для быстрого получения итогов регистра на текущий момент и на другие моменты времени система поддерживает в актуальном состоянии в отдельных таблицах (недоступных непосредственно для разработчика конфигурации) состояние итогов с учетом всех имеющихся в таблице движений. Записи в этих таблицах автоматически обновляются при записи движений. Эти записи используются системой автоматически при обращении к виртуальным таблицам регистров для получения соответствующих итогов.</p>
    <p>Например, есть движения:</p>
    <img src="../img/1С-1/2025-02-10_10-06-13.png" class="screen" alt="">
    <p>Тогда в системе есть текущие остатки в таблице остатков:</p>
    <img src="../img/1С-1/2025-02-10_10-07-31.png" class="screen-2" alt="">
    <p>То есть таблица итогов содержит алгебраическую сумму движений (с учетом вида движений) по каждой комбинации измерений. Алгебраическая сумма это сумма положительных и отрицательных чисел, у которых нет знака сложения и их скобок, например, вот такое сложение (-1) + (6) + (-5) + (11) принято писать без знака + и без скобок, но со знаками самих чисел и получится так: -1 + 6 - 5 + 11. Вот так и в итоговой таблице от вида движения ставится знак для количества и складываются все числа.</p>
    <p>При каждой записи движений система добавляет или вычитает в зависимости от вида движения значения ресурсов движений из соответствующих строк таблицы итогов. Для того чтобы это сделать, система должна считать текущее значение, увеличить или уменьшить его, и записать измененное значение. Разумеется, чтобы эта операция прошла корректно, нужно заблокировать считываемую запись, чтобы никто не мог изменить запись после считывания. Таким образом, в приведенном примере приходная накладная номер 1 и  приходная накладная номер 2 не могу быть параллельно проведены, так как не могут быть записаны параллельно записи по комбинации измерений «Стол - Основной».</p>
    <p>Механизм разделения итогов вводит в состав хранимой таблицы итогов специальное поле, позволяющее распараллелить обновление записей итогов.</p>
    <p>Например, если одновременно записывается приходная накладная 1 и приходная накладная 2, то записи будут выглядеть следующим образом:</p>
    <img src="../img/1С-1/2025-02-10_10-45-26.png" class="screen-2" alt="">
    <p>Таким образом, уже становится возможным параллельное проведение приходной накладной 1 и приходной накладной 2.</p>
    <p>Когда после этого будет записана расходная накладная 5, записи будут выглядеть так:</p>
    <img src="../img/1С-1/2025-02-10_12-47-35.png" class="screen-2" alt="">
    <p>При получении итогов (обращении к виртуальной таблице), система сворачивает записи по комбинациям измерений, и поэтому при обращении к виртуальной таблице мы получим:</p>
    <img src="../img/1С-1/2025-02-10_12-47-44.png" class="screen-2" alt="">
    <p>Новые записи с уже существующими комбинациями измерений создаются системой только в случае, если параллельно выполняются две и более транзакции. Фактически, значение разделителя - это некоторое число, выдаваемое системой в очередной транзакции и уникальное среди всех параллельно выполняемых транзакций в данный момент времени. Система выдает первое свободное число, то есть числа, выданные ранее завершившимся  транзакциям, переиспользуются. Таким образом, увеличение количества записей итогов зависит от количества одновременно выполняемых транзакций.</p>
    <p>анный механизм работает только при записи движений. При обращении к итогам регистров в запросе блокировка накладывается на все записи с используемыми комбинациями измерений. И это соответствует сути решаемой задачи. Например, при проведении расходной накладной средствами встроенного языка выполняется считывание остатков для проверки возможности продажи товара. В этом случае блокировка не позволит провести расходную накладную параллельно с другой расходной накладной или приходной накладной, если имеются пересекающиеся комбинации  измерений. И это правильно, потому что, расходную накладную номер 5 нельзя проводить параллельно с приходной накладной 1 и приходной накладной 5, так как необходимо обеспечить логическую проверку наличия товара на складе, так чтобы никто не мог поменять считанный остаток до конца транзакции проведения расходной накладной. Таким образом, механизм разделения итогов исключает блокировки, устанавливаемые для поддержки актуальных итогов (решения системной задачи), но не исключает блокировки, накладываемые для решения задач бизнес-логики.</p>
    <p>Аналогичная логика поддерживается и при использовании управляемого режима блокировки. Из встроенного языка доступна блокировка только по измерениям (без учета разделения итогов по отдельным записям).</p>
    <p>Заметим, что данный механизм не работает в файловом варианте, так как там поддерживается только блокировка уровня таблиц. Также он не поддерживается при работе с СУБД PostgreSQL в автоматическом режиме блокировок.</p>
    <p>Разумеется, работа данного механизма влечет за собой дополнительные накладные расходы (наличие поля в таблицах итогов, увеличение количества записей в таблицах итогов).</p>
    <p>При пересчете итогов регистра записи сворачиваются по комбинациям измерений. То есть, после пересчета, избыточные записи из регистра удаляются.</p>
    <p>Чтобы управлять работой данного механизма, предусмотрены две возможности.</p>
    <p>В конфигурации для регистров введено свойство «Разрешить разделение итогов». Это свойство, позволяет включить или отключить возможность разделения итогов для конкретного регистра. Отключение свойства полностью исключает влияние данного механизма на работу регистра, так как само поле, используемое для разделения итогов, не включается в структуру регистра. Например, отключение данной возможности полезно для регистров, которые не используются при параллельной работе пользователей. Например, для регистров всегда заполняемых специальными регламентными обработками.</p>
    <p>В информационной базе для регистров (тех, для которых разделение итогов разрешено в конфигурации) поддерживается хранение признака использования разделения итогов. Он может быть получен и установлен методами ПолучитьРежимРазделенияИтогов() и УстановитьРежимРазделенияИтогов(), а также в стандартном диалоге («Операции-Управление итогами-Установка режима разделения итогов»). Такая возможность позволяет включать или выключать режим разделения итогов в зависимости от условий работы пользователей в конкретной организации. Например, при интенсивном параллельном вводе информации этот режим может быть полезен. Но если с системой работает небольшое количество пользователей, то выигрыш от  его применения будет небольшой, а некоторое замедление при получении отчетов и лишние записи в таблицах итогов, фактически будут лишними (неоправданными).</p>









    <p class="title-size16"><b id="dop-document11">Что на самом деле делает свойство "БлокироватьДляИзменения"</b></p>
    <p>Что бы понять материал данной статьи, нужно хорошо знать и понимать 2 вещи:</p>
    <ul class="list">
        <li>Что такое режим разделения итогов.</li>
        <li>Новая методика контроля остатков (остатки контролируются после записи).</li>
    </ul>
    <p>Режим разделения итогов очень полезен в том случае, если не нужно делать контроль остатков по регистру т.к. можно параллельно записывать данные с одинаковым набором измерений.</p>
    <p>Если по регистру необходимо <b>всегда</b> контролировать остатки, то лучше не использовать режим разделения итогов т.к. выигрыша в параллельности он не дает. Наверно имеется ввиду, например, если в регистр "ОстаткиТоваров" пишет только допустим "РасходнаяНакладная", то получается, что при каждой записи в регистр мы проверяем остатки, тогда следует отключить режим разделения итогов у этого регистра.</p>
    <p>Но как быть, если например у регистра есть 2 регистратора, и один документ использует контроль остатков, а второй нет? Как я понял, имеется ввиду, например, один документ "Приходная", не использующий контроль остатков, а как раз использующий режим разделения итогов для того, чтобы не блокировать записи одинаковых товаров. И второй регистратор это "Расходная", который использует конроль остатков. Получается, что один регистратор использует этот режим, а второму наоборот нужно этот режим временно отключить, чтобы получить правильные остатки.</p>
    <p>В этом случае нам как раз и пригодится свойство набора записей регистров накопления и бухгалтерии «БлокироватьДляИзменения».</p>
    <p>Начнем с того, что использовать «БлокироватьДляИзменения» имеет смысл, только если выполняются все следующие условия:</p>
    <ul class="list">
        <li>транзакция выполняется в управляемом режиме (если использовать в автоматическом, то возникнет ошибка). Как я понял речь идёт о режиме управления блокировкой данных.</li>
        <li>у регистра включен режим разделения итогов (если он выключен, то свойство не имеет смысла и будет просто игнорироваться)</li>
        <li>используется новая методика контроля остатков (остатки контролируются после записи) (в старой методике не имеет смысла, т.к. там нужно накладывать блокировку до записи в регистр). Почему именно так, не поясняют</li>
    </ul>
    <p>Пока не буду дописывать. Потому что пока трудно понимаю что происходит. оставлю на статью ссылку - <a href="https://infostart.ru/1c/articles/196565/">тут</a>. Ещё вот видео посмотреть - <a href="https://rutube.ru/video/5a22ac6154a6ff6ed7d7b4f1b3035e26/">тут</a>. Это в том случае, когда захочу получше разобраться в блокировках в транзакциях.</p>
    

    



    <p class="title-size16"><b id="kam-doc-1">Что такое оперативный учёт?</b></p>
    <p>Оперативный учёт это разновидность хозяйственного учёта. В противовес другим видам учёта в оперативном учёте имеет важность получения данных о состоянии показателей на текущий миг времени в отличии, например, от бухучёта, где из-за необходимости документального подтверждения данные в учёте появляются с какой то задержкой. В оперативном учёте нам нужно видеть, например, сколько товаров на данный миг на складе имеется, либо сколько товаров у нас с начала дня продано до текущего мига. Далее пойдёт речь про ведение оперативного учёта, для этого в базе уже есть регистры продаж, остатков и документы движения товаров.</p>



    <p class="title-size16"><b id="kam-doc-2">Стандартная обработка "Управление итогами". Таблица итогов.</b></p>
    <p>При создании регистра накопления в режиме "остатки" система создаёт дополнительную таблицу с итогами по остаткам. А при создании регистра накопления в режиме "обороты" система создаёт доп. таблицу с итогами по оборотам.</p>
    <p>Таблица с итогами по остаткам хранит подсчитанные остатки на начало и конец месяца по умолчанию, а также на 3999 год. Как хранятся в итоговой таблицы подсчитанные значения?</p>
    <p>Допустим к нам поступают и продаются весь месяц яблоки:</p>
    <img src="../img/1С-1/2023-12-27_20-37-13.png" class="screen" alt="">
    <p>Так как до января к нам ничего не поступало, поэтому на начало месяца остаток 0. Если запросом получать остатки на заданную нами дату, например, на 3 января, то система запусткает метод Остатки() и он обращается к итоговой таблице. Нам нужно на 3 число остаток, система получает ближайший подсчитанный остаток, а это на начало месаца(0) и доститывает от этого 0 до 3 числа по основной таблице регистра. Получим остаток 21.</p>
    <p>Если перейти в пользовательский режим и открыть обработку "Управление итогами", то у нас появится возможность настраивать как то таблицы с итогами.</p>
    <img src="../img/1С-1/2023-12-28_08-57-26.png" class="screen" alt="">
    <p>Во-первых итоги можно включить или выключить. Эти таблицы всё-таки занимают ресурсы и потому их можно выключать. Делается это по кнопке "Итоги" -> "Выключить/Включить". Включение/выключение показывает колонка "Итоги"</p>
    <p>Есть также кнопка "Текущие итоги", что это? Это итоги самые последние на текущий миг, на тот самый ноябрь 3999 года. Это когда в запросе мы не указываем дату, на которую хотим получить остаток, и в этом случае возвращается остаток на текущий миг времени, т.е. самый последний, указанный на 3999г. "Текущие итоги" также можно включить или выключить.</p>
    <p>"Текущие итоги" не доступны для таблиц итогов в режиме оборотов, потому что обороты не содержат остаток на конец времён. Включение текущих итогов соответственно показано в колонке "Текущие итоги".</p>
    <p>Есть также минимальный и максимальный период расчитывания итогов. Это период, в котором система хранит и расчитывает итоги. Если мы установим период в пол года, то только в нём будут расчитываться и хранится итоги. Устанавливается этот период по кнопке "Установить период итогов".</p>
    <p>Также есть кнопка "Пересчет", которая позволяет пересчитать разные итоги: за период, текущие или просто итоги.</p>
    <p>Доступа к таблицам итогов нет ни из встроенного языка, ни из языка запросов, они просто системой используются по её усмотрению.</p>


    <p class="title-size16"><b id="kam-doc-3">Создание механизма бронирования товара при оперативном учёте. Делаем кнопку в форме документа(используем модуль объекта), в форме списка документа(используем модуль менеджера).</b></p>
    <p><span class="светло_синий"><i>Первая часть задачи. Создать кнопку в форме документа</i></span></p>
    <p>Это пример из видеокурса Камкова, видео - https://www.youtube.com/watch?v=Hx23nbwHHhI&list=PLHWLo4jq87N6wg9Ghx2u_NqcqeR9poe1e&index=14, видео имеет номер 4.1</p>
    <p><span class="фиолетовый">Важно! Мы тут не проверяем остаток на складе товара, а по правилам нужно бы проверять. Потому что как мы бронируем товар и не знаем есть ли вообще что бронировать. Наверно это связано с тем, что мы почему то начали с бронирования не проходя урок по контролю остатков товара. Короче как сказал Камков это не полноценный механизм бронирования.</span></p>
    <p>Есть такой случай. Продавая товар покупателю может возникнуть какая то заминка с офофрмлением товара и чтобы за это время, пока идёт отладка заминки, другой продавец не продал этот товар, нужно забронировать этот товар для покупателя до проведения документа. У нас есть регистр с остатками товаров, есть документ "ПродажаТоваров". В документе нужно сделать кнопку "Забронировать", по нажатию на которую нужно бы проверять остатки товара в регистре "ОстаткиНоменклатуры" и если товар есть записывать в регистр "БронированиеТоваров" товар и его количество. Но тут мы без проверки просто записываем в бронь. Здесь встречается тот случай, когда нужно писать в регистр не при проведении документа, а до проведения. Такой случай я уже описывал как писать в регистр не через обработчик "ОбработкаПроведения". Этот случай описан в статье в разделе про регистр сведений, статья про запись в регистр из обработчика "ПриЗаписи". <a href="#reg-info-17">Тут</a></p>
    <p>Код добавления в регистр  "БронированиеТоваров" мы будем писать в модуле объекта, потому что мы можем и программно забронировать товары не заходя в форму документа. Поэтому в форме мы по нажатию только вызываем код из модуля объекта. Напомню тут для напоминания, что если мы код пишем в модуле объекта, то у нас есть помощь платформы в виде свойства Движения, если же не в модуле объекта, то этого свойства нет и запись в регистр немного другая, как раз другая запись описана в статье, которую я упомянул в прошлом абзаце.</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ПродажаТоваров"
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> Забронировать<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>
                ЗабронироватьНаСервере<span class="светло_красный">();
            КонецПроцедуры

            &НаСервере
            Процедура</span> ЗабронироватьНаСервере<span class="светло_красный">()</span>
                ДокументОбъект <span class="светло_красный">=</span> РеквизитФормыВЗначение<span class="светло_красный">(</span>"Объект"<span class="светло_красный">);</span>
                ДокументОбъект<span class="светло_красный">.</span>Забронировать<span class="светло_красный">();</span>
                ЗначениеВРеквизитФормы<span class="светло_красный">(</span>ДокументОбъект<span class="светло_красный">,</span> "Объект"<span class="светло_красный">);
            КонецПроцедуры</span></span>


            --модуль объекта документа "ПродажаТоваров"
            <span class="светло_синий"><span class="светло_красный">Процедура</span> Забронировать<span class="светло_красный">() Экспорт</span> 
                <span class="зелёный">//может быть такое, что мы создали движения и хотим их добавить в регистр "БронированиеТоваров",
                //но при добавлении в БД система сама добавляет в каждое движение поле "Регистратор" и пишет туда текущий документ,
                //но вдруг документ сам ещё не записан в БД, ведь нужна ссылка на документ, а она пуста, 
                //тогда система не найдёт его и будет исключение. Значит надо перед
                //записью в регистр "БронированиеТоваров" записать сам документ в БД</span>
                Записать<span class="светло_красный">();</span>

                <span class="зелёный">//Хоть мы и не в обработке проведения, но мы в контексте документа,
	            //а поэтому поле "Регистратор" система сама заполнит</span>
                
                <span class="зелёный">//документ записан, теперь запишем и движения в регистр</span>
                <span class="светло_красный">Для каждого</span> ТекСтрокаТовары <span class="светло_красный">Из</span> Товары <span class="светло_красный">Цикл</span>
                    Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                    Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Приход<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Количество<span class="светло_красный">;
                КонецЦикла;</span>

                Движения<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>Записать<span class="светло_красный">();
            КонецПроцедуры</span></span>        
        </pre>
    </div>
    <p>Почему тут нет строки - Движения.БронированиеТоваров.Записывать = Истина, а есть строка Движения.БронированиеТоваров.Записать(); в конце процедуры? Потому что это не обработчик "ОбработкаПроведения", который по этому флагу сам записывает записи в регистр по окончанию процедуры.</p>
    <p>Далее, мы заминку починили и можем провести документ и нужно теперь при проведении удалить записи из регистра "БронированиеТоваров". Как показал Камков, то мы пишем в обработчик "ОбработкаПроведения" вот эти 2 строки:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Движения<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>Очистить<span class="светло_красный">();</span>
            Движения<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span></span>
        </pre>
    </div>
    <p>Но у меня возникает вопрос, а что если в регистр не только мы забронировали, а ещё какие то продавцы тоже туда добавили товары, то мы что? И их записи тоже удалим?Вопрос решён. Оказывается, что каждый документ создаёт свой набор записей и записывает его в регистр и когда мы находясь в контексте текущего документа очищаем, то очищается только набор записей созданный этим документом ранее. Если в регистре есть другие наборы от других документов, то они не трогаются.</p>
    <p>Следующий шаг это сделать так, чтобы закрыть возможность бронировать товары, если документ уже проведён. Для этого в процедуре Забронировать в контексте объекта документа есть свойство Проведен, делаем проверку и выполняем бронирование если это свойтсво Ложь.</p>
    <p><span class="светло_синий"><i>Вторая часть задачи. Создать кнопку в форме списка документа</i></span></p>
    <p>Нужно сделать так, чтобы пользователю не требовалось открывать форму документа и там нажимать "Забронировать", а эта кнопка была бы в панели команд формы списка документа. Мы выбираем в списке документ или документы и по нажатию на кнопку товары внутри этих документов бронировались.</p>
    <p>Как я понимаю есть как минимум 2 способа добавить кнопку в форму списка документа. Превый это через подобъект Команды этого документа и через форму списка документа. Мы будем делать 2м способом. Добавим команду в форме и вынесем её в командную панель формы, также повесим обработчик на эту команду и будем также вызывать внешний код для бронирования. Нам нужно как то определить, какие документы выбраны в списке. У элемента формы "Список" как и у табличной части(и тот и другой элемент формы имеет тип данных "Таблица формы") есть свойство, которое возвращает текущие выделенные строки. Оно так и называется <b>ВыделенныеСтроки</b>, это свойство возвращает массив с значениями, которые находятся в этих строках. </p>
    <p>Маленькое отступление! Бывает у нас есть своя форма списка и мы вносим в неё изменения, но они не видны в пользовательской части. Причина может быть в том, что форма не назначена основной, делается это на вкладке Формы.</p>
    <p>Итак, по нажатию к нам приходит массив со ссылками, в цикле можно перебрать эти ссылки и для каждой получить объект типа ДокументОбъект и вызвать уже ранее написанную процедуру Забронировать в модуле объекта. Но такой способ затратный, потому что при получении объекта типа ДокументОбъект из БД считываются все данные каждого объекта, собираются свойства и методы для этого объекта и так в цикле для каждого объекта. А нам не нужны все эти данные, свойства и методы, кроме одного метода. И нужно найти более подходящий способ без собирания объекта. ЗАМЕТКА! Подумал тут и видится мне не совсем бесполезным способом получать объект и вызывать у него метод Забронировать(). Многие данные, которые объект собирает нам понадобятся. Когда мы будем вызывать метод Забронировать() то в нём нам будут нужны почти все данные объекта - Дата, Проведен, Ссылка, таб. часть Товары, да и плюс будет свойство Движения, а значит нам платформа поможет немного. И пока как мне видится не нужно будет делать запросы к БД, у нас все данные уже есть. Так что когда научусь замерять быстродействие методов, нужно будет сравнить, что быстрее. Но есть НО. Мы собираем объект документа в цикле, а сбор это запросы к БД. Значит у нас будут запросы к БД в цикле, а это плохо. Хотя и ниже в коде от Камкома мы тоже делаем запросы в цикле.</p>
    <p>Выходом может стать написания метода Забронировать() не в модуле объекта, а в модуле менеджера документа вида "ПоступлениеТоваров". Модуль менеджера ещё выбрали, потому что он не связан с каким то одним документом, в нём содержаться свойства и методы для управления всеми документами одного вида. Можно было бы и написать в Общем модуле и всё работало бы, но этот метод не тянет на общий и связан вполне с конкретным видом документа.</p>
    <p>В модуле менеджера теперь не будет свойства Движения и платформа нам уже не поможет с записью в регистр и тут вот как раз и понадобится способ писать в регистр, про который я выше писал и ссылку на статью оставил.</p>
    <p>Итак вот код который написал Камков, также я ниже указал своё решение как написать метод Забронировать и вызывать его из формы. В моём решении нет запросов в цикле, я передаю на сервер массив с ссылками и на сервере делаю запрос один раз на получение всех товаров из документов указанных в массиве и потом уже в цикле обрабатываем эти данные:</p>
    <div class="code-style">
        <pre>
            --модуль формы списка документа ПродажаТоваров
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> Забронировать<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>
                <span class="зелёный">//чтобы не передавать весь контекст формы на сервер
                //мы укажем директиву &НаСервереБезКонтекста и передадим
                //на сервер только массив с ссылками на документы</span> 
                МассивСсылок <span class="светло_красный">=</span> Элементы<span class="светло_красный">.</span>Список<span class="светло_красный">.</span>ВыделенныеСтроки<span class="светло_красный">;</span>
                ЗабронироватьНаСервере<span class="светло_красный">(</span>МассивСсылок<span class="светло_красный">);</span>
            <span class="светло_красный">КонецПроцедуры</span>

            <span class="светло_красный">&НаСервереБезКонтекста
            Процедура</span> ЗабронироватьНаСервере<span class="светло_красный">(</span>МассивСсылок<span class="светло_красный">)</span>
                <span class="светло_красный">Для каждого</span> СсылкаНаДокумент <span class="светло_красный">Из</span> МассивСсылок <span class="светло_красный">Цикл</span>
                    <span class="зелёный">//можно через получение объекта из базы и вызов Забронировать(),
                    //который мы уже выше описали в модуле объекта
                    //ДокументОбъект = СсылкаНаДокумент.ПолучитьОбъект();
                    //ДокументОбъект.Забронировать();</span>

                    <span class="зелёный">//а можно через Забронировать() описанный в модуле менеджера</span>
                    Документы<span class="светло_красный">.</span>ПродажаТоваров<span class="светло_красный">.</span>Забронировать<span class="светло_красный">(</span>СсылкаНаДокумент<span class="светло_красный">);</span>	
                <span class="светло_красный">КонецЦикла;

                <span class="зелёный">//это моё решение
                Документы.ПродажаТоваров.Забронировать2(МассивСсылок);</span>
            КонецПроцедуры</span></span>


            --модуль менеджера документа ПродажаТоваров
            <span class="светло_синий"><span class="светло_красный">Процедура</span> Забронировать<span class="светло_красный">(</span>ДокументСсылка<span class="светло_красный">)  Экспорт</span>
                Запрос <span class="светло_красный">=</span> Новый Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"Ссылка"<span class="светло_красный">,</span> ДокументСсылка<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span><span class="серый">"
                    |ВЫБРАТЬ
                    |	ПродажаТоваров.Дата КАК Дата,
                    |	ПродажаТоваров.Склад КАК Склад,
                    |	ПродажаТоваров.Проведен КАК Проведен
                    |ИЗ
                    |	Документ.ПродажаТоваров КАК ПродажаТоваров
                    |ГДЕ
                    |	ПродажаТоваров.Ссылка = &Ссылка"</span><span class="светло_красный">;</span>
                
                ДанныеИзШапкиДокумента <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">().</span>Выбрать<span class="светло_красный">();</span>
                ДанныеИзШапкиДокумента<span class="светло_красный">.</span>Следующий<span class="светло_красный">();</span> 
                
                <span class="светло_красный">Если</span> ДанныеИзШапкиДокумента<span class="светло_красный">.</span>Проведен <span class="светло_красный">Тогда</span>
                    <span class="светло_красный">Возврат;</span>
                <span class="светло_красный">КонецЕсли;</span>
                
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"
                    |ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	ПродажаТоваровТовары.Количество КАК Количество
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка"</span><span class="светло_красный">;</span>
                
                Выборка <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">().</span>Выбрать<span class="светло_красный">();</span>

                НаборЗаписей <span class="светло_красный">=</span> РегистрыНакопления<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>СоздатьНаборЗаписей<span class="светло_красный">();</span> 
                НаборЗаписей<span class="светло_красный">.</span>Отбор<span class="светло_красный">.</span>Регистратор<span class="светло_красный">.</span>Установить<span class="светло_красный">(</span>ДокументСсылка<span class="светло_красный">);</span>
	
                <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">()</span> <span class="светло_красный">Цикл</span>
                    Движение <span class="светло_красный">=</span> НаборЗаписей<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                    Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Приход<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> ДанныеИзШапкиДокумента<span class="светло_красный">.</span>Дата<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> ДанныеИзШапкиДокумента<span class="светло_красный">.</span>Склад<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">;
                КонецЦикла;</span>

                НаборЗаписей<span class="светло_красный">.</span>Записать<span class="светло_красный">();
            КонецПроцедуры</span></span>



            --модуль менеджера документа ПродажаТоваров. Под мой способ
            <span class="светло_синий"><span class="светло_красный">Процедура</span> Забронировать2<span class="светло_красный">(</span>МассивСсылок<span class="светло_красный">) Экспорт</span>
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Ссылка КАК Ссылка,
                    |	ПродажаТоваровТовары.Ссылка.Дата КАК Дата,
                    |	ПродажаТоваровТовары.Ссылка.Склад КАК Склад,
                    |	ПродажаТоваровТовары.Ссылка.Проведен КАК Проведен,
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	ПродажаТоваровТовары.Количество КАК Количество
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка В(&Ссылка)"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Ссылка"</span><span class="светло_красный">,</span> МассивСсылок<span class="светло_красный">);</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                Таблица <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">();</span>
                
                <span class="светло_красный">Для каждого</span> Элемент <span class="светло_красный">Из</span> МассивСсылок <span class="светло_красный">Цикл</span>
                    НаборЗаписей <span class="светло_красный">=</span> РегистрыНакопления<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>СоздатьНаборЗаписей<span class="светло_красный">();</span>
                    <span class="зелёный">//Устанавливаем отбор по текущему документу и перезаписываем набор</span>
                    НаборЗаписей<span class="светло_красный">.</span>Отбор<span class="светло_красный">.</span>Регистратор<span class="светло_красный">.</span>Установить<span class="светло_красный">(</span>Элемент<span class="светло_красный">);</span>
                    
                    <span class="светло_красный">Для каждого</span> СтрокаТаблицы <span class="светло_красный">Из</span> Таблица <span class="светло_красный">Цикл</span>
                        <span class="светло_красный">Если</span> Элемент <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Ссылка <span class="светло_красный">И НЕ</span> СтрокаТаблицы<span class="светло_красный">.</span>Проведен <span class="светло_красный">Тогда</span>
                            Движение <span class="светло_красный">=</span> НаборЗаписей<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                            Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Приход<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Дата<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Склад<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Количество<span class="светло_красный">;
                        КонецЕсли;
                    КонецЦикла;</span>
                    НаборЗаписей<span class="светло_красный">.</span>Записать<span class="светло_красный">();
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Не знаю почему, но Камков написал код так, что у него в цикле выполяется как минимум по 2 запроса. Мы из формы документа вызываем метод Забронировать() в цикле, а в этом методе мы делаем 2 запроса к БД.Ниже я опишу свой метод Забронировать, который я не вызываю в цикле, а сразу передаю в него весь массив ссылок и уже в методе делаю всего 1 запрос, куда также передаю параметром массив ссылок и мне вернётся ответ по всем документам нас интересующих. Для удобства ответ выгружу в таблицу значений и её буду использовать.</p>
    <p>Сделал замер производительности кода Камкова и своего, если я всё правильно понял по времени, то выполнение кода Камкова заняло 35,43598, мой занял 3,395823, как видно разница в 10 раз.Могу предположить, что если бы мы использовали тот способ, где мы получаем в цикле на каждую ссылку объект документа, то там тоже было бы не быстро, потому что в цикле запросы по получению данных и сбор методов для объекта.</p>
    <p>В наборе записей когда мы добавляем новую запись, то Период заполняется обязательно(если это периодический регистр).</p>
    <p>Когда мы заполняли регистр накопления "БронированиеТоваров" в подтексте документа в модуле объекта, то там, я так понял, в запись(движение) автоматом записывалось такое поле как Регистратор и это поле заполнялось ссылкой на документ в подтексет которого и выполнился этот модуль. Но мы находимся в модуле менеджер документов и тут автоматом это поле не заполняется, его нужно заполнить нам самим. Есть 2 способа записать Регистратор. Можно просто написать <b>Движение.Регистратор = ДокументСсылка</b>, а есть 2й способ, который встречается более чаще, пишем перед циклом такую строку <b>НаборЗаписей.Отбор.Регистратор.Установить(ДокументСсылка);</b>.</p>
    <p>Мой код:</p>
    <div class="code-style">
        <pre>
            --модуль формы списка документа ПродажаТоваров
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> Забронировать<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>
                ЗабронироватьНаСервере<span class="светло_красный">();
            КонецПроцедуры

            &НаСервере
            Процедура</span> ЗабронироватьНаСервере<span class="светло_красный">()</span> 
                <span class="зелёный">//1й способ
                //Для каждого СсылкаНаДокумент Из Элементы.Список.ВыделенныеСтроки Цикл
                //	Документы.ПродажаТоваров.Забронировать(СсылкаНаДокумент);	
                //КонецЦикла; 
                
                //2й способ
                //Для каждого СсылкаНаДокумент Из Элементы.Список.ВыделенныеСтроки Цикл
                //    ДокументОбъект = СсылкаНаДокумент.ПолучитьОбъект();
                //    ДокументОбъект.Забронировать();
                //КонецЦикла;


                //мой способ
                //инструкция Элементы.Список.ВыделенныеСтроки возвращает массив ссылок</span>
                Документы<span class="светло_красный">.</span>ПродажаТоваров<span class="светло_красный">.</span>Забронировать2<span class="светло_красный">(</span>Элементы<span class="светло_красный">.</span>Список<span class="светло_красный">.</span>ВыделенныеСтроки<span class="светло_красный">);
            КонецПроцедуры</span></span>



            --модуль менеджера документа ПродажаТоваров
            <span class="светло_синий"><span class="светло_красный">Процедура</span> Забронировать2<span class="светло_красный">(</span>МассивСсылок<span class="светло_красный">) Экспорт</span>
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Ссылка КАК Ссылка,
                    |	ПродажаТоваровТовары.Ссылка.Дата КАК Дата,
                    |	ПродажаТоваровТовары.Ссылка.Склад КАК Склад,
                    |	ПродажаТоваровТовары.Ссылка.Проведен КАК Проведен,
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	ПродажаТоваровТовары.Количество КАК Количество
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка В(&Ссылка)"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span>"Ссылка"<span class="светло_красный">,</span> МассивСсылок<span class="светло_красный">);</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                Таблица <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">();</span>
                
                <span class="светло_красный">Для каждого</span> Элемент <span class="светло_красный">Из</span> МассивСсылок <span class="светло_красный">Цикл</span>
                    НаборЗаписей <span class="светло_красный">=</span> РегистрыНакопления<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>СоздатьНаборЗаписей<span class="светло_красный">();</span>
                    НаборЗаписей<span class="светло_красный">.</span>Отбор<span class="светло_красный">.</span>Регистратор<span class="светло_красный">.</span>Установить<span class="светло_красный">(</span>Элемент<span class="светло_красный">);</span>
                    
                    <span class="светло_красный">Для каждого</span> СтрокаТаблицы <span class="светло_красный">Из</span> Таблица <span class="светло_красный">Цикл</span>
                        <span class="светло_красный">Если</span> Элемент <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Ссылка <span class="светло_красный">И НЕ</span> СтрокаТаблицы<span class="светло_красный">.</span>Проведен <span class="светло_красный">Тогда</span>
                            Движение <span class="светло_красный">=</span> НаборЗаписей<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                            Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Приход<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Дата<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Склад<span class="светло_красный">;</span>
                            Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> СтрокаТаблицы<span class="светло_красный">.</span>Количество<span class="светло_красный">;
                        КонецЕсли;
                    КонецЦикла;</span>
                    НаборЗаписей<span class="светло_красный">.</span>Записать<span class="светло_красный">();
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>



    <p class="title-size16"><b id="kam-doc-4">Создание механизма бронирования товара. Другой способ записи в регистр. Создаём отдельно документ "БронированиеТоваров".</b></p>
    <p>Создадим документ "БронированиеТоваров", реквизиты свои добавлять не будем, запретим ему проведение. При запрете проведения в форме исчезнут кнопки проведения. На закладке Движения отметим, что движения будут по регистру накопления "БронированиеТоваров". Создаём форму документа. Раскроем основной реквизит формы "Объект", увидим там свойство "Движения", его тоже раскром и в движении будут все регистры, в которые пишет данный документ, берём "БронированиеТоваров" и перетаскиваем в элементы формы Теперь у нас в документе отображается набор записей принадлежащий этому документу из регистра "БронированиеТоваров". Прям в него пишем товары и жмём Записать. Нужно отметить, что в пользовательской части появится кнопка Добавить, которая добавляет новую запись в регистр.</p> 
    <p>Удалить запись из регистра можно из этого же документа, выделив строку и в меню Ещё выбрать Удалить. Или можно обработать пометку на удаление. Например пользователь пометил документ на удаление и мы обработаем эту пометку там же в обработчике "ПередЗаписью", потому что при пометке происходит перезапись документа. Можно удалить запись или сделать не активной.</p>
    <p>Обычно документ пишет в регистры через обработчик "ОбработкаПроведения", но в этом примере, документ не использует этот обработчик, платформа сама пишет в регистр после записи самого документа в БД. Если нам нужно что то подправить в запись набора, то можно воспользоваться обработчиком "ПередЗаписью", что мы дальше и сделаем. Например, облегчим заполнение движения пользователю, убрав поле Период. Для этого в форме в окне Элементы уберём это поле. Но это поле обязательно к заполнению и мы его будем заполнять в обработчике "ПередЗаписью" в модуле объекта. Поле Период скорее всего будет соответствовать дате документа, поэтому и заполним его датой.</p>
    <p>Если есть нужда сразу видеть, что мы записали в регистр, то можно в форму документа в панель навигации вынести ссылку на записи регистра сделанные этим документом. Как известно, документ если имеет подчинённые регистры, в которые он пишет, то в форме во вкладке "Командный интерфейс" платформа сама добавит в список группы "Перейти" в панели навигации этот регистр. Остаётся только поставить галочку, чтобы отображать этот регистр в форме:</p>
    <img src="../img/1С-1/2023-12-31_10-32-57.png" class="screen-2" alt="">
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ПередЗаписью<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> РежимЗаписи<span class="светло_красный">,</span> РежимПроведения<span class="светло_красный">)</span>
                <span class="зелёный">//Обходим в цикле набор записей регистра "БронированиеТоваров" для текущего документа
                //и для каждой записи заполняем поле Период вместо пользователя, облегчая его работу.
                //Делаем заполнение поля перед тем, как платформа начнёт запись всего набора
                //в регистр, а начнёт она после записи документа в базу, поэтому и выполняем это в обработчике "ПередЗаписью".
                //И ещё одно уточнение. Мы дописываем поле "Период" у набора записей
                //который пользователь изменял в форме документа</span>
                <span class="светло_красный">Для каждого</span> Запись <span class="светло_красный">Из</span> Движения<span class="светло_красный">.</span>БронированиеТоваров <span class="светло_красный">Цикл</span>
                    Запись<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;
                КонецЦикла;</span>
                
                <span class="зелёный">//Если пользователь ставит пометку на удаление документа, то платформа
                //по умолчанию сразу начинает процедуру перезаписи документа в базу,
                //чтобы установить в поле "ПометкаУдаления" новое значение, в данном 
                //случае записать в поле значение Истина. Перед записью объекта в базу
                //сработает этот обработчик, цикл выше отработает, но он нас не интересует,
                //потому что мы запросим из базы набор записей для текущего документа
                //и проставим в поле "Активность" для записей значение Ложь, чтобы записи стали неактивными
                //или можем их удалить. Как по мне логичнее их удалить, чтобы они там не 
                //болтались в базе</span>
                <span class="светло_красный">Если НЕ</span> ПометкаУдаления <span class="светло_красный">=</span> Ссылка<span class="светло_красный">.</span>ПометкаУдаления <span class="светло_красный">Тогда</span>
                    Движения<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>Прочитать<span class="светло_красный">();</span>
                    <span class="светло_красный">Для каждого</span> Движение <span class="светло_красный">Из</span> Движения<span class="светло_красный">.</span>БронированиеТоваров <span class="светло_красный">Цикл</span>
                        Движение<span class="светло_красный">.</span>Активность <span class="светло_красный">= НЕ</span> ПометкаУдаления<span class="светло_красный">;</span>
                    <span class="светло_красный">КонецЦикла;</span> 
                    Движения<span class="светло_красный">.</span>БронированиеТоваров<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span>
                <span class="светло_красный">КонецЕсли;</span>
            <span class="светло_красный">КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Ещё раз. В этом коде отрабатывает 2 сценария. Первый при изменении, добавлении и сохранении записи пользователем. Отработает только первый цикл с заполнением поля "Период", остальной код будет пропущен. И второй при пометке и снятии пометки на удаление документа. Отработает весь код , но первый цикл прогонится в пустую, потому что ниже в условии мы всё равно получаем набор записей из базы и в этом наборе заполняем поле "Активность" и записываем набор.</p>



    <p class="title-size16"><b id="kam-doc-5">Создание документа "Ручная коррекция задолженности" для создания, изменения, удаления записей регистра напрямую из формы.</b></p>
    <p>Этот механизм нам нужен для того, что вручную в таблице поправить какие то записи регистра. Похожий механизм уже описан в разделе "Обработки" -> "Редактирование записей регистра накопления Продажи из формы обработки напрямую".</p>
    <p>Тут будет очень похоже на предыдущую статью про бронирование товаров. Также создаём документ "Ручная коррекция задолженности", запрещаем ему проводку, в движениях указываем движения по регистру "Задолженности", чтобы это движение появилось в основном реквизите "Объект" формы документа. Выносим этот регистр в элементы формы и всё, у нас появилась возможность редактировать записи регистра напрямую.</p>




    <p class="title-size16"><b id="kam-doc-6">Показываем остаток выделенного товара в табличной части документа "ПродажаТоварв". Событие "ПриАктивизацииСтроки".</b></p>
    <p>Эту статью можно отнести к статье про добавление товаров в регистр "БронированиеТоваров" как продолжение логики. Мы в документе, перед тем как нажать на кнопку "Забронировать", можем в таб. части посмотреть остаток этих товаров на складе.</p>
    <p>Стоит задача отобразить в реквизите формы "Остаток товара" с видом "Поле надписи", ниже табличной части "Товары", остаток выделенного товара в таб. части документа "ПродажаТоваров". Для табличной части "Товары"(тип ТаблицаФормы) есть событие "ПриАктивизацииСтроки", это когда мы кликаем по строке и она выделается, срабатывает это событие. Далее вешаем на это событие в модуле формы документа обработчики:</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ПродажаТоваров"
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки<span class="светло_красный">(</span>Элемент<span class="светло_красный">)</span>
                СсылкаНаТовар <span class="светло_красный">=</span> Элементы<span class="светло_красный">.</span>Товары<span class="светло_красный">.</span>ТекущиеДанные<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                ТоварыПриАктивизацииСтрокиНаСервере<span class="светло_красный">(</span>СсылкаНаТовар<span class="светло_красный">,</span> Объект.Склад<span class="светло_красный">);
            КонецПроцедуры</span>

            <span class="светло_красный">&НаСервереБезКонтекста
            Функция</span> ТоварыПриАктивизацииСтрокиНаСервере<span class="светло_красный">(</span>СсылкаНаТовар<span class="светло_красный">,</span> Склад<span class="светло_красный">)</span>
                <span class="зелёный">//объектная модель запроса 
                //так как этот регистр имеет 2 измерения, то их и указываем</span>
                Отбор <span class="светло_красный">= Новый</span> Структура<span class="светло_красный">(</span><span class="серый">"Номенклатура, Склад"</span><span class="светло_красный">,</span> СсылкаНаТовар<span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>

                <span class="зелёный">//мы обращаемся к виртуальной таблице поэтому вернётся таблица с типом "ТаблицаЗначений"
                //Если мы не указываем 3й и 4й парметры, которые задают в строковом виде
                //измерения и ресурсы, которые мы ходим видеть в таблице, то таблица вернётся
                //со всеми измерениями и ресурсами. Из-за этого может быть очень много
                //строк с одним и тем же товаром и система не сможет его свернуть
                //потому что другие измерения не дают этого сделать, потому что разные значения в них
                //Например в данном случаем таким измерением будет "Партия", там для каждого 
                //товара будет разное значение этого измерения и поэтому будет много строк.
                //но мы можем 3й и 4й параметром задать "Номенклатура" и "Количество" и тогда
                //вернётся таблица только с этими двумя полями и свёрнутая по ним.
                //Но метод Итог()в этом случае всё равно можно оставить, потому как он уберегает от ошибки,
                //если не вернулся ни один товар, этот метод не вызовет её.</span>
                ТаблицаОстатков <span class="светло_красный">=</span> РегистрыНакопления<span class="светло_красный">.</span>ОстаткиНоменклатуры<span class="светло_красный">.</span>Остатки<span class="светло_красный">(,</span> Отбор<span class="светло_красный">);</span> 

                <span class="светло_красный">Возврат</span> ТаблицаОстатков<span class="светло_красный">.</span>Итог<span class="светло_красный">(</span>"Количество"<span class="светло_красный">);</span>
                


                <span class="зелёный">//табличная модель запроса
                //Запрос = Новый Запрос;
                //Запрос.Текст = 
                //	"ВЫБРАТЬ
                //	|	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК КоличествоОстаток
                //	|ИЗ
                //	|	РегистрНакопления.ОстаткиНоменклатуры.Остатки(, Номенктлатура = &Товар И Склад = &Склад) КАК ОстаткиНоменклатурыОстатки";
                //
                //Запрос.УстановитьПараметр("Товар", СсылкаНаТовар);
                //Запрос.УстановитьПараметр("Склад", Склад);
                //РезультатЗапроса = Запрос.Выполнить();
                //ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
                //ВыборкаДетальныеЗаписи.Следующий();
                //Возврат ВыборкаДетальныеЗаписи.КоличествоОстаток;</span>
            <span class="светло_красный">КонецФункции</span></span>
        </pre>
    </div>
    <p>Заходим, проверяем работу и всё работает, но нас поджидает ошибка при попытке создать новый документ ПродажаТоваров. Когда мы создадим документ, нам откроется форма документа, где мы будем заполнять поля и событие "ПриАктивизацииСтроки" сразу срабатывает, это событие пытается спозиционироваться на строку в табличной части, но у нас ещё не заполнена табличная часть и потому нет пока строки, на которую это событие указывает, а потому в процедуре строка <b>СсылкаНаТовар = Элементы.Товары.ТекущиеДанные.Товар;</b> вызовет ошибку, в Элементы.Товары.ТекущиеДанные будет лежать Неопределено и попытка прочитать у Неопределено поле Товар вызовет ошибку. Перепишем процедуру на клиенте:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки(Элемент)
                <span class="зелёный">//1й способ мой через Попытка ... Исключение</span>
                <span class="светло_красный">Попытка</span>
                    СсылкаНаТовар <span class="светло_красный">=</span> Элементы<span class="светло_красный">.</span>Товары<span class="светло_красный">.</span>ТекущиеДанные<span class="светло_красный">.</span>Товар<span class="светло_красный">;
                Исключение
                    Возврат;
                КонецПопытки;</span>
                ТоварыПриАктивизацииСтрокиНаСервере<span class="светло_красный">(</span>СсылкаНаТовар<span class="светло_красный">);</span>
                
                <span class="зелёный">//2 способ Камкова через условие
                //ТекущиеДанные = Элементы.Товары.ТекущиеДанные.Товар;
                //Если ТекущиеДанные &lt;> Неопределено Тогда
                //  ТоварыПриАктивизацииСтрокиНаСервере(ТекущиеДанные.Товар);
                //КонецЕсли;</span>
            <span class="светло_красный">КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Если же нам по какой то причине нужно получать остатки не актуальные, а на дату документа, то в метод Остатки первым аргументом передаём дату документа или момент времени документа. Можно момент времени передать 2мя способами - 1) у основного реквизита Объект нет такого свойства, зато есть в таблице документа в БД, чтобы его получить обратимся через ссылку - <b>Объект.Ссылка.МоментВремени</b>, 2) и можно создать момент времени самому и передать в него параметры - <b>Новый МоментВремени(Объект.Дата, Объект.Ссылка)</b>.</p>
    <p>Важно не забывать, что при добавления товара, платформа сама спозиционирует выделение на новой созданной строке и опять же сработает это событие. Остатки не покажутся, потому что в миг срабатывания события товар ещё не был выбран, поэтому можно сделать вызов процедуры ТоварыПриАктивизацииСтрокиНаСервере() где нибудь в обработчике ТоварПриИзменении(), когда срабатывает событие "ПриИзменении" при выборе товара.</p>
    <p>Ещё может быть ошибка. При создании нового документа, а затем сразу при создании нового товара событие "ПриАктивизацииСтроки" сработает и Элементы.Товары.ТекущиеДанные.Товар вернёт пустую ссылку. При передаче на сервер пустой ссылки И передаче в параметр момента времени(ТаблицаОстатков = РегистрыНакопления.ОстаткиНоменклатуры.Остатки(Объект.Ссылка.МоментВремени, Отбор);) попытка получить данные по этой пустой ссылке приведёт к тому, что будет бесконечный цикл. Как показывает отладчик, если передать в Остатки момент времени, то при пустой ссылке снова срабатывает событие "ПриАктивизацииСтроки" и так по кругу, а если не передавать момент времени, то всё норм. Можно решить проблему по разному, можно как я ниже показано, а можно как Камков сделал. Он перед запросом проверял на пустоту ссылку и если она пустая мы моменту времени присваиваем Неопределено, это то же самое что и не передавали этот момоент времени, а если не пустая, то передаём момент времени. Механизм Попытка ... Исключение пустую ссылку не отлавливает как ошибку, поэтому проверяем в попытке значение на пустую ссылку и если она пустая, то возбуждаем исключение:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки(Элемент)
                <span class="зелёный">//1й способ мой через Попытка ... Исключение</span>
                <span class="светло_красный">Попытка</span>
                    СсылкаНаТовар <span class="светло_красный">=</span> Элементы<span class="светло_красный">.</span>Товары<span class="светло_красный">.</span>ТекущиеДанные<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                    <span class="светло_красный">Если</span> СсылкаНаТовар<span class="светло_красный">.</span>Пустая<span class="светло_красный">() Тогда</span>
                        ВызватьИсключение<span class="светло_красный">(</span>" "<span class="светло_красный">);
                    КонецЕсли;
                Исключение
                    Возврат;
                КонецПопытки;</span>
                ТоварыПриАктивизацииСтрокиНаСервере<span class="светло_красный">(</span>СсылкаНаТовар<span class="светло_красный">);</span>
                
                <span class="зелёный">//2 способ Камкова через условие
                //ТекущиеДанные = Элементы.Товары.ТекущиеДанные.Товар;
                //Если ТекущиеДанные &lt;> Неопределено Тогда
                //  ТоварыПриАктивизацииСтрокиНаСервере(ТекущиеДанные.Товар);
                //КонецЕсли;</span>
            <span class="светло_красный">КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Потому что если пустая ссылка пойдёт дальше, то там может случится бесконечный вызов при моменте времени.</p>



    <p class="title-size16"><b id="kam-doc-7">Контроль остатков и расчёт себестоимости по курсу Камкова. Есть пару объяснений про оперативное проведение. Блокировка таблицы. С использованием склада. Старая методика.</b></p>
    <p>Продолжаем с теми же документами из видео Камкова. Видео 4.2. У нас есть документ "ПродажаТоваров", регистры накопления - "ОстаткиНоменклатуры", "Продажа", "Задолженности".</p>
    <p>Итак, в какой миг мы должны проверять остатки на складах? Сопобов написать код в разных местах много и он будет работать, но самым правильным способом является проверка при проведении документа. Код соответственно пишется в модуле объекта документа в обработчике "ОбработкаПроведения". В этом обработчике перед движениями сделаем запрос в БД о том, достаточно ли у нас на складе товаров из таб. части документа "ПродажаТоваров", в контексте которого и находится этот обработчик. В запросе будем запрашивать НомерСтроки товара в таб.части, Количество(которое мы хотим продать), Товар, КоличествоОстаток и Сумму для вычисления себестоимости. Сумма в регистре остатков это сумма себестоимости товаров. НомерСтроки нужен для того, чтобы указать пользователю, при нехватке товара на какой строке какого товара на складе не хватает.</p>
    <p>Номер строки, Количество и Товар выбираем во временную таблицу из табличной части документа "ПродажаТоваров". В таб. части документа пользователь может ввести несколько одинаковых товаров и нам в запросе нужно товары сгруппировать и просуммировать колличество, а вот как быть с полем НомерСтроки? Если мы это поле поместим вместе с товаром в группировку, то сгруппировать товары не получится, потому что все номера строк разные, а если применить к этому полю агрегатную функцию, то можно что то получить. Но какую функцию к ней применить? Предположим у нас есть 2 одинаковых товара, один на 1й строке, второй на 4й. Нам номера строк нужны для того, чтобы указать пользователю на какой строке у него недостающий товар. Если в результате проверок окажется, что этого товара не хватает на складе, то в принципе без разницы какой номер строки указать пользователю - 1й или 4й, давайте будем указывать наименьшую строку у одинаковых товаров, поэтому и применим функцию МИНИМУМ() к полю НомерСтроки.</p>
    <p>Далее во втором пакете запроса мы должны выбрать количество остаток и сумму остаток(которая себестоимость) из виртуальной таблицы Остатки и номенклатуру, номер строки, количество из временной таблицы, соединяя эти 2 таблицы левым соединеним. Слева будет временная таблица, потому что в ней будут только те товары, которые есть в таб. части документа. В правой виртуальной таблице 2м параметром пишем условие, в котором выбираем только те товары, которые есть во временной таблице.</p>
    <p>Также нам предстоит сравнивать количество продаваемых товаров с остатком товаров, но остатков может не быть на складе, значит вирт. таблица вернёт в этом поле NULL, сравнение с NULL недопустипо, поэтому сразу переводим NULL в 0 в запросе. Для поля СуммаОстаток точно также.</p>
    <p>ЗАМЕТКА! По базе Камкова я заметил, что он ещё дополнительно во временную таблицу отбирал только товары отсеивая услуги. Зачем вообще писать услуги в регистр ОстаткиНоменклатуры? Как услуги могут хранится на складе, чтобы у них ещё остатки подсчитывать? Мне вот это не понятно. А хотя он отсеивал услуги из табличной части документа. Но вроде в предыдущих видео мы услуги убрали отдельно в другую табличну часть. Видимо база уже немного другая. Но я не буду тут заморачиваться с услугами, она у меня в базе отдельно в другой таблице лежит, поэтому и в запросе её отсеивать не буду. Хотя нужно хорошо разобраться с этим вопросом.</p>
    <p>Также мы устанавливаем в парамтерах виртуальной таблицы Дату документа, на которую нужно получить остатки товаров. У меня такой вопрос. Зачем устанавливать дату, при проведении нам же нужны самые последние данные об остатках товара на складе? Спустя время отвечаю, дата при оперативном проведении всё равно будет самая последняя, поэтому её и указываем, а потом при не оперативном проведении эта дата опять же поможет найти остатки на эту дату. Дата задаётся как момент времени документа. Просто дата документа не подойдёт, потому что в этой дате в точности до секунды может быть несколько документов проводимых одновременно и задав просто дату мы получим остатки до данной секунды, а значит и учёт остатков проведённых одновременно с нашим документов не будет учтён в регистре. Если не понятно то ещё раз. Мы проводим оперативно документ продажи в "01.01.2024 15:00:01". В этот же миг вместе с нами провелись ещё 4 документа продажи на эту же секунду. И передавая эту дату в запрос мы получим остатки впритык до этой секунды, так работают остатки. Мы получим остатки на "01.01.2024 15:00:00" включительно. Т.е. наша 01 секунда не входит в учёт, а значит и документы проведённые одновременно тоже не войдут в учёт и остатки вернутся без учёта этих документов. Поэтому нам и нужен момент времени, который в одной секунде более точно скажет до каких пор нужно получить остатки. При моменте времени мы получим остатки до нашего документа, но уже с учётом предыдущих документов и всё это в одной секунде.</p>
    <img src="../img/1С-1/2023-12-28_08-57-98.png" class="screen" alt="">
    <p>Кстати вопрос про дату был почти верный. В коде в пояснениях я описал, почему не стоит указывать дату при оперативном проведении. Описано там где задаются параметры для запроса.</p>
    <p>Едем дальше. Мы получили от запроса какие то данные. Теперь в цикле нужно сделать сравнение количеств. Если продаваемого товара больше чем на складе, то выдаём сообщение.</p>
    <p>Отступление!!!Почему то пытался пользователю передать сообщение через класс СообщениеПользователю, но выдаёт ошибку, что "Значение не является значением объектного типа (Текст)". Фиг знает, что это значит, не нашёл решения. Используем обычный метод глобального контекста Сообщить(). Ошибку вроде нашёл, я использовал переменную Сообщение для того, чтобы поместить туда объект конструктора СообщениеПолюзователю, а эта переменная то ли занята кем то, то ли перебивается, фиг знает, короче переименовал её и вроде норм.</p>
    <p>Продолжаем. Если же количество меньше, то делаем запись в регистр ОстаткиНоменклатуры. Замечу, что мы сразу сгруппировали товары в запросе из таб. части документа, поэтому в регистр пишем уже сгруппированные, что уменьшает размер таблицы. Вот обработчик:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоваров"
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> Режим<span class="светло_красный">)</span> 
                <span class="зелёный">//если мы не установили значение "Удалять автоматически" у реквизита
                //"Удаление движений" в окне настройки объекта конфы во вкладке "Движения",
                //то можно написать тут в обработке очистку этих движений
                //Движения.ОстаткиНоменклатуры.Очистить()
                //Движения.ОстаткиНоменклатуры.Записать()
                //Нужно это для того, чтобы при перепроведении в оперативном режиме
                //удалялись предыдущие записи в регистре</span>

                <span class="зелёный">//Блокировка отдельных записей есть только в серверном варианте
                //В файловом способе заблокируется полностью таблица</span>
                Блокировка <span class="светло_красный">= Новый</span> БлокировкаДанных<span class="светло_красный">;</span> 

                <span class="зелёный">//Объект Блокировка может заблокировать от 1й до нескольких таблиц
                //или отдельные записи в таблице. Укажем таблицу для блокировки</span>
                ЭлементБлокировки <span class="светло_красный">=</span> Блокировка<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"РегистрНакопления.ОстаткиНоменклатуры"</span><span class="светло_красный">);</span>
                <span class="зелёный">//Указываем режим блокировки. Только для записи(Разделяемый)
                //или только для чтения(Исключительный)</span>
                ЭлементБлокировки<span class="светло_красный">.</span>Режим <span class="светло_красный">=</span> РежимБлокировкиДанных<span class="светло_красный">.</span>Исключительный<span class="светло_красный">;</span> 

                <span class="зелёный">//После установки режима блокировки можно уже блокировать всю таблицу,
                //но мы будем блокироваь отдельные записи в таблице. Это и сделаем.
                //Создаём таблицу значений путём выгрузки из таб. части Товары.
                //Таблица значений будет использована для того, чтобы
                //показать системе по каким измерениям нужно блокировать записи
                //В нашем случае по 2м измерениям: Номенклатура и Склад</span>
                ДанныеБлокировки <span class="светло_красный">=</span> Товары<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">(,</span> <span class="серый">"Товар"</span><span class="светло_красный">);</span>
                <span class="зелёный">//Так как таб. часть не имеет поля Склад, то добавим в ТЗ
                //ещё одну колонку Склад и заполним её значениями 
                //реквизита Склад шапки документа.</span>
                ДанныеБлокировки<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">);</span>
                ДанныеБлокировки<span class="светло_красный">.</span>ЗаполнитьЗначения<span class="светло_красный">(</span>Склад<span class="светло_красный">,</span> <span class="серый">"Склад"</span><span class="светло_красный">);</span> 
            
                ЭлементБлокировки<span class="светло_красный">.</span>ИсточникДанных <span class="светло_красный">=</span> ДанныеБлокировки<span class="светло_красный">;</span> 
                <span class="зелёный">//указываем для какого измерения какие записи блокировать
                //Измерение указывается 1м параметром, а вторым указывется
                //колонка из ТЗ, откуда будут браться названия товаров, которые
                //нужно заблокировать. Со складом тоже самое</span>
                ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Номенклатура"</span><span class="светло_красный">,</span> <span class="серый">"Товар"</span><span class="светло_красный">);</span>	
                ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> <span class="серый">"Склад"</span><span class="светло_красный">);</span>	
                Блокировка<span class="светло_красный">.</span>Заблокировать<span class="светло_красный">();</span>
                <span class="зелёный">//Длокировку нужно писать как можно позже в коде, чтобы не блокировать записи слишком долго
                //вот перед запросо на остатки самое место
                //Также в файловом способе БД мы не можем блокировать отдельные записи, платформой блокируется вся таблица
                //Что мы тут описали это для клиент-серверного взаимодействия
                //Также эта блокировка называется управляемой и при запуске может возникнуть ошибка
                //что нельзя использовать блокировки в управляемом режиме, это потому что по умолчанию
                //в платформе установлен режим блокировки автоматический. У корня конфигурации в свойствах нужно
                //поменять на управляемые</span>

                Движения<span class="светло_красный">.</span>ОстаткиНоменклатуры<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>

                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ
                    |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	ПродажаТоваровТовары.Товар КАК Номенклатура,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВременнаяТаблица
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Документ
                    |   
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Товар
                    |;
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВременнаяТаблица.Номенклатура КАК Номенклатура,
                    |	ВременнаяТаблица.НомерСтроки КАК НомерСтроки,
                    |	ВременнаяТаблица.Количество КАК Количество,
                    |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток
                    |ИЗ
                    |	ВременнаяТаблица КАК ВременнаяТаблица
                    |	ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(
                    |			&Дата,
                    |			Склад = &Склад
                    |	        И Номенклатура В
                    |				(ВЫБРАТЬ
                    |					ВременнаяТаблица.Номенклатура КАК Номенклатура
                    |				ИЗ
                    |			ВременнаяТаблица КАК ВременнаяТаблица)) КАК ОстаткиНоменклатурыОстатки
                    |	ПО (ОстаткиНоменклатурыОстатки.Номенклатура = ВременнаяТаблица.Номенклатура)"</span><span class="светло_красный">;</span>

                <span class="зелёный">//если режим проведения оперативный, то не передаём параметр даты  
                //в этом режиме в дате и так будет самая последняя дата и если передать её в параметр, то системе нужно
                //потратить время на вычисление даты из момента времени, потом найти по этой дате в таблице остатков
                //сами остатки, это всё время занимает. Проще ничего не передавать и система сама поймёт, что нужно
                //вернуть последние остатки и она просто пойдёт и возмёт остатки на 3999 год(т.е. самые последние)
                //без вычисления всяких дат.
                //Дату мы обычно передаём при неоперативном режиме, потому что там нам нужны не последние данные вообще, 
                //а данные на конкретную дату
                //Если Режим РежимПроведенияДокумента.Неоперативный Тогда
                //    Запрос.УстановитьПараметр("Дата", МоментВремени());
                //Иначе
                //    Запрос.УстановитьПараметр("Дата",Неопределено);	
                //КонецЕсли;</span>  

                <span class="зелёный">//НО!!! А если при оперативном режиме одновременно провели 3 документа в одну секунду, То
                //тут не обойтись без момента времени, потому что только он определяет положение документа
                //в одной секунде. Вывод, нужно и там и там писать момент времени</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Дата"</span><span class="светло_красный">,</span> МоментВремени<span class="светло_красный">());</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Документ"</span><span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>
                
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                
                <span class="зелёный">//перебираем результат запроса и если есть товары, которых не хватает на складе, 
                //то они пропустяться, а те что есть, запишутся в регистр
                //Зависит от того будем ли мы использовать Отказ или нет</span>
                <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                    <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">></span> Выборка<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">Тогда</span>
                        МоёСообщение <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                        МоёСообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Не хватает товара "</span> 
                                            <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>Номенклатура 
                                            <span class="светло_красный">+</span> <span class="серый">" в количестве "</span> 
                                            <span class="светло_красный">+</span> <span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">-</span> Выборка<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">)</span> 
                                            <span class="светло_красный">+</span> <span class="серый">" в строке с номером "</span> 
                                            <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>НомерСтроки<span class="светло_красный">;</span>
                        <span class="зелёный">//Свойству Поле нужно указать путь до реквизита формы
                        //чтобы оно привязало этот текст сообщения к этому реквизиту
                        //Но если Отказ установлен в Истина, то это сообщение
                        //возле реквизита не показывается</span>
                        МоёСообщение<span class="светло_красный">.</span>Поле <span class="светло_красный">=</span> <span class="серый">"Товары["</span> <span class="светло_красный">+ (</span>Выборка<span class="светло_красный">.</span>НомерСтроки <span class="светло_красный">-</span> 1<span class="светло_красный">)</span> <span class="светло_красный">+</span> <span class="серый">"].Количество"</span><span class="светло_красный">;</span> 
                        <span class="зелёный">//нужно указать объект, с которым должно быть связано сообщение
                        //Тут указываем, что с ДокументОбъект.ПродажаТоваров должна быть связь</span>
                        МоёСообщение<span class="светло_красный">.</span>УстановитьДанные<span class="светло_красный">(</span>ЭтотОбъект<span class="светло_красный">);</span>
                        МоёСообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();</span>

                        <span class="зелёный">//если тут указать Отказ равно Истина, то ни один товар не проведётся, потому что при первом же
                        //отрицательном количестве сработает Отказ и документ не будет проводится
                        //А если убрать это присвоение, то проведутся только те товары, которые есть на складе
                        //вот и выбираем что нам нужно.</span>
                        Отказ <span class="светло_красный">= Истина;</span>
                    <span class="светло_красный">КонецЕсли;</span> 

                    <span class="светло_красный">Если</span> Отказ <span class="светло_красный">Тогда
                        Продолжить;
                    КонецЕсли;</span>

                    <span class="зелёный">// регистр ОстаткиНоменклатуры Расход</span>
                    Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиНоменклатуры<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                    Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
        
                    <span class="зелёный">//тут мы расчитываем себестоимость товара и умножаем его на количество, которое хотим продать</span>
                    Движение<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>СуммаОстаток <span class="светло_красный">/</span> Выборка<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">*</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">;	</span>	
                <span class="светло_красный">КонецЦикла;</span>	
            КонецПроцедуры</span>
        </pre>
    </div>
    <p><span class="светло_синий">Про проведение документа при оперативном режиме</span></p>
    <p>Допустим у нас осталось "Апельсины" на складе 190шт. Мы проводим оперативно документ и списываем 185 апельсинов, он списал их, осталось 5шт. Через пару секунд опять пытаемся провести этот же документ и уже не сможем, потому что дата уже другая и перепроведение не удаляет записи в регистре и там остаток апельсинов 5шт, а мы пытаемся снова списать 185шт. Можно решить эту проблему разными способами. Первый это во вкладке "Движения" документа продажи установим реквизит "Удаление движений" в значение не "Удалять автоматически при отмене проведения", а в "Удалять автоматически". Второй способ это в обработке проведения в самом начале очистить движения и тут же их записать.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Движения<span class="светло_красный">.</span>ОстаткиНоменклатуры<span class="светло_красный">.</span>Очистить<span class="светло_красный">();</span>
            Движения<span class="светло_красный">.</span>ОстаткиНоменклатуры<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p>Т.е. мы перед записью в регистр очищаем все записи сделанные этим документом и изменения записываем в БД. Что в итоге. Получается мы создали один документ и теперь можно хоть до упада перепроводить его сегодня, без разницы, он будет только один раз списывать товары. Ещё раз напомню, это касается документов, которые мы пытаемся перепроводить на текущий день, потому что оперативное проведение подрубается и меняет время под текущее.</p>
    <p><span class="светло_красный">Ещё одно замечание!</span> Если у нас в настройках разрешено проведение документов оперативно, то на текущий день последний оперативно проводимый документ на оси времени смещается на самую границу этой оси, т.е. становится самым последним по времени. Например, мы за сегодня провели несколько документов, без разницы в какое время мы их провели, любой из них который мы проведём ещё раз станец последним. И тут есть одна штука,  в обработчике который выше, мы передаём параметр Дата со значением МоментВремени(). Так вот нет смысла указывать дату для оперативно проведённого документа, потому то дата будет показывать вот прям последнюю текущую секунду, без указания даты виртуальная таблица ОстаткиНоменклатуры.Остатки автоматом нам даст данные на это же время. Ведь известно, если не указать в параметрах дату, то вернутся самые последние данные. Так в чём тогда прикол, не передавать дату? Ну передал её или не передал какая разница, всё равно вернутся самые последние данные, но разница есть в производительности. Системе проще вернуть последние данные без указания от нас даты. Поэтому в обработчике выше сделаем проверку на оперативный режим.</p>
    <p><span class="светло_синий">Про блокировку таблицы</span></p>
    <p>В обработчике "ОбработкаПроведения" мы ещё не сделали функционал блокирования таблицы БД, допишем его. Создаётся объект от класса БлокировкаДанных, который может блокировать одну или несколько таблиц в БД. Вызываем метод Добавить() у этого объекта и передаём ему имя таблицы, которую надо заблокировать. Этот метод вернёт тип ЭлементБлокировки, у которого есть свойство Режим. Для этого свойства нужно указать каой режим мы будем использовать. Для указания режима используем системеное перечисление РежимБлокировкиДанных с 2мя значениями - Исключительны и Разделяемый. Эти 2 режима нам говорят о том, как мы хотим заблокировать таблицу. Исключительный блокирует и чтение и запись данных. Нам нужно, чтобы другие пользователи не могли ни прочитать, ни записать данные, пока мы проводим документ, а Разделяемый запрещает писать в регистр, но читать можно. Ну и далее вызываем метод Заблокировать().</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Блокировка <span class="светло_красный">= Новый</span> БлокировкаДанных<span class="светло_красный">;</span>
            ЭлементБлокировки <span class="светло_красный">=</span> Блокировка<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"РегистрНакопления.ОстаткиНоменклатуры"</span><span class="светло_красный">);</span>
            ЭлементБлокировки<span class="светло_красный">.</span>Режим <span class="светло_красный">=</span> РежимБлокировкиДанных<span class="светло_красный">.</span>Исключительный<span class="светло_красный">;</span>
            Блокировка<span class="светло_красный">.</span>Заблокировать<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p>Но у механизма блокирования, который мы описали есть недостатки. Мы блокируем полностью всю таблицу и, например, мы продаём яблоки, а другой пользователь в это же время пытается продать груши, но он не сможет, хотя вроде мы продаём разные продукты, потому что заблокирована вся общая таблица с остатками продуктов. Чтобы исправить механизм нужно блокировать не всю таблицу, а только те записи с продуктами в регистре, остатки которых мы запрашиваем. Для этого перед методом Заблокировать() мы выгрузим из табличной части колонку, в которой указаны ссылки на товар. У меня эта колонка называется "Товар". Метод Выгрузить() у табличной части возвращает ТаблицуЗначений. Но нам мало только указать товары, ещё нужно указать и склад, а для этого мы в таблицу значений добавим новую колонку "Склад". И заполним значения этой колонки с помощью метода ЗаполнитьЗначения().</p>
    <p>Теперь у нас есть таблица значений, в которой у нас есть пара: Номенклатура, Склад, по соответствующим измерениям мы будем блокировать записи в регистре. Далее нужно указать эту таблицу элементу блокировки. И сказать какие поля из таблицы значений соответствуют измерениям, 1й параметр измерение, 2й имя колонки из таблицы. </p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Блокировка <span class="светло_красный">= Новый</span> БлокировкаДанных<span class="светло_красный">;</span>

            ЭлементБлокировки <span class="светло_красный">=</span> Блокировка<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"РегистрНакопления.ОстаткиНоменклатуры"</span><span class="светло_красный">);</span>
            ЭлементБлокировки<span class="светло_красный">.</span>Режим <span class="светло_красный">=</span> РежимБлокировкиДанных<span class="светло_красный">.</span>Исключительный<span class="светло_красный">;</span>

            <span class="зелёный">//создаём таблицу значений пучём выгрузки из таб. части</span>
            ДанныеБлокировки <span class="светло_красный">=</span> Товары<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">(,</span> <span class="серый">"Товар"</span><span class="светло_красный">);</span>
            ДанныеБлокировки<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">);</span>
            ДанныеБлокировки<span class="светло_красный">.</span>ЗаполнитьЗначения<span class="светло_красный">(</span>Склад<span class="светло_красный">,</span> <span class="серый">"Склад"</span><span class="светло_красный">);</span> 
            
            <span class="зелёный">//задаём для элемента блокировки откуда ему брать данные для блокирования записей
            //в измерения Номенклатура и Склад подставляются значения из колонок Товары и Склад
            //и по этим значениям блокируются записи. Например, товар "Груши", склад "Основной"
            //значит нужно найти в регистре запись в измерениях Номенклатура и Склад которого есть "Груши" и "Основной"
            //и заблокировать её </span>
            ЭлементБлокировки<span class="светло_красный">.</span>ИсточникДанных <span class="светло_красный">=</span> ДанныеБлокировки<span class="светло_красный">;</span>
            ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Номенклатура"</span><span class="светло_красный">,</span> <span class="серый">"Товар"</span><span class="светло_красный">);</span>
            ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> <span class="серый">"Склад"</span><span class="светло_красный">);</span>

            Блокировка<span class="светло_красный">.</span>Заблокировать<span class="светло_красный">();</span></span>
        </pre>
    </div>
    <p><span class="светло_красный">Змечание!</span> В файловом варианте организации БД несмотря на то, что мы описали, всё равно заблокируется вся таблица целиков. Отдельные записи мы можем заблокировать только при наличии сервера.</p>
    <p><span class="светло_синий">Проблема образования отрицательного остатка при изменении количества товара в документе "ПоступлениеТоваров" и проведении его задним числом.</span></p>
    <p>Мы вроде бы уже сделали контроль остатков при проведении документа "ПродажаТоваров", но бывает, что пользователи изменяют задним числом документы "ПоступлениеТоваров", изменяя, например, себестоимость товара, то это приведёт уже к неправильному подсчёту далее в других документах. Этот случай исправляет объект "Последовательности".</p>





    <p class="title-size16"><b id="kam-doc-8">Контроль остатков(количества и суммы(себестоимости)) в документе "ПоступлениеТоваров". Объект "Последовательности".</b></p>
    <p>Решаем проблему остатка количества и суммы(себестоимости) товаров с другой стороны. Мы решили задачу по остаткам при проведении документа "ПродажаТоваров", но пользователь может изменить количество или сумму товаров в документе "ПоступлениеТоваров" и провести. Если потом посмотреть в отчёте остатки, то можно увидеть отрицательные остатки.</p>
    <p>Как решить такую проблему? Можно запретить проводить задним числом этот вид документа, но это будет минус нашей конфигурации. Если пользователь изменит себестоимость или количество поступившего товара, то нужно и перепроводить все документы "ПродажаТоваров". Решением и будет перепроводка всех документов "ПродажаТоваров". НО перепроводить все документы продажи может быть долго. Поэтому надо сделать механизм, который будет отслеживать у какого товара при поступлении мы изменили себестоимость или количество и перепровести продажные документы начиная с того, где в первый раз встретился этот товар, т.е. не все документы, а начиная с какого-то и до конца на оси времени. Такой механизм уже есть в системе. Называется этот механизм "Последовательности", находится внутри объекта конфигурации "Документы".</p>
    <p>Создадим новый объект Последовательности и назовём его "Товарная". Добавим объект в подсистему какую-нибудь. Есть важная закладка "Использование". В окне "Входящие документы" этой закладки мы отмечаем те документы, которые нужно перепроводить, если сбивается последовательность. Выбираем Документ.ПродажаТоваров. Нарушение последовательности в нашем случае это изменение себестоимости задним числом в "ПоступлениеТоваров". А что влияет на границы этой последовательности? Ниже окошко с названием - "Движения, влияющие на последовательность". В этом окошке нужно отметить регистр накопления ОстаткиНоменклатуры, который влияет на границы последовательности. Тут же выберем и регистр накопления "БронированиеТоваров", он тоже влияет, хотя как он влияет пока не совсем понятно. В принципе всё, мы указали какие документы перепроводить и что влияет на их перепровождение. Сохраняем, проверяем.</p>
    <p><span class="светло_красный">Как я понял, система отслеживает изменения в ресурсах указанных регистров и отмечает то значение измерения, с которого нужно перепровести все документы "ПродажаТоваров". Например, пользователь изменил количество или себестоимость в документе "ПоступлениеТоваров" у какого-то товара и провёл, тут же в регистре произойдёт изменение ресурса, итоги пересчитаются и система отловит тот товар, ресурс которого был изменён. А затем перепроведёт все документы продажи начиная с того, где в регистре впервые встречается этот товар. Система наверное в регистре находит ссылку на этот товар и подключает стандартную обработку "Перепроведение документов", передаёт эту ссылку и все документы продажи начиная с переданного перепроводятся. Но это только догадки.</span> Ответ будет дальше.</p>
    <img src="../img/1С-1/2023-05-20_17-47-11.png" class="screen" alt="">
    <p>Как теперь увидеть её работу? Последовательность в интерфейсе отображаться не будет, хотя мы её и добавили в подсистему Прочее. В БД последовательность хранит данные в 2х таблицах. Покажем эти 2 таблицы с последовательностью и её границами на начальной странице. Чтобы показать что то на начальной странице нужна форма, а формы у объекта последовательности нет, значит обратимся к общим формам. Идём в общие формы и добавляем новую форму с типом Произвольная форма, назовём её "ФормаПоследовательности" и жмём Готово. Появится пустая форма, командную панель можно скрыть убрав галочку в свойствах у свойства Автозаполнение.</p>
    <p>Теперь нужно как то показать список какой то таблицы из базы. Создаём реквизит формы и даём ему тип "Динамический список", так как таблицы 2, значит и будем выводить 2 списка. Первый реквизит назовём "ТаблицаПоследовательности". Чтоб будем выводить в него? Как мы помним есть закладка Объект со свойством Основная таблица и если посмотреть список таблиц в нём, то не найдём там таблицы с последовательностью, потому, что не положено. Поэтому нам остаётся написать произвольный запрос поставив галочку выше в одноимённом свойстве. Появится ссылка Открыть, жмём на неё, откроется редактор составления запроса для динамического списка. В редакторе жмём на Конструктор запроса и в нём мы видим объект Последовательности, в котором 2 таблицы: Товарная и Товарная.Границы. Сначала выбираем таблицу Товарная и все её поля, а это Регистратор и Период и жмём принять. Перетаскиваем в элементы формы этот реквизит. Теперь создаём 2й реквизит с именем "ТаблицаГраницыПоследовательности" с типом Динамический список. Также пишем произвольный запрос, выбирая в запросе таблицу Товарная.Граница со всеми её полями, поля там с такими же названиями, но это совершенно другая таблица, принимаем и также перетаскиваем на форму.</p>
    <p>Теперь идём в настройки начальной страницы и отображаем там ФормуПоследовательности. В пользовательской части видим 2 этих списка, пока они пусты, но есть проблемы с высотой, потому что приходится прокручивать. Идём в форму и в Элементах выделяем эти реквизиты и укажем в свойствах высоту, например, 7. Можно было бы конечно создать для каждой таблицы по одной форме, тогда они сами бы высоту приняли, но у нас пусть будет в одной форме.</p>
    <p>Чтобы в таблице последовательности что то появилось, нужно провести все документы поступления и продажи. После проведения обновляем и в таблице Товарная появятся все документы продажи товаров, как мы и указали в конфигураторе. А в таблице Товарная.Граница увидим самый последний проведённый документ продажи. Теперь если изменить сумму в любом документе поступления у товара, то при обновлении таблицы границы последовательности, мы увидим в её списке этот проведённый документ поступления в качестве границы. Т.е нам система теперь показывает, что если проводить все документы, то начинать нужно вот с этого документа поступления товаров. И теперь если зайти в системную обработку ПроведениеДокументов, то там есть закладка "Восстановление последовательностей", она становится доступной, когда мы создали последовательность и перепровели первый раз документы. в окне указана последовательность, которую мы создали в конфе, выше есть кнопка "Восстановить", по нажатию на которую документы перепроведутся начиная с документа поступления, в котором мы изменили цену и после проведения в качестве границы опять установится самый последний документ продажи.</p>
    <p>Как я понял, на начальной странице нет смысла отображать эти 2 таблицы последовательности, они не несут никакой информации. Просто если где то изменили цену в поступлении, то открываем системную обработку по проведению документов и там проводим их в закладке "Восстановление последовательностей". И ещё, мы вроде бы посмотрели этот механизм, который перепроводит документы при изменении цены, а как быть с изменением количества? Или количество не трогают? Или этот механизм работает и для изменения количества? Чёт сомневаюсь. Ведь если изменить количество где то в постеплении товаров задним число, то при перепроведении где то там продажный документ не запишет в регистр продаваемый товар, потому что уже не хватает его на складе, а товар как бы уже продан по факту, но в отчёт уже не попадёт. Я так понимаю пользователи не меняю количество задним числом, цену меняют, а количество нет. Пока не понятно. Узнаю, распишу.</p>

    

    <p class="title-size16"><b id="kam-doc-9">Продажа товара и списание себестоимости методом ФИФО и ЛИФО</b></p>
    <p>Видео Камкова 4.2, начиная с 01:52:10</p>
    <p>У вычисления себестоимости по средней есть небольшие косяки связанные с остатками маленьких хвостиков, например, -0,01 может остаться в отчёте. Всё из за того, что могут быть не целые числа и округления этих чисел могут нарушить остаток и не выйти в ноль. Это так, маленькое отступление. Кстати Чистов показывал формулу как по средней списывать так, чтобы не оставалось хвостиков, если что смотреть в описании про Чистова в моей шпоре.</p>
    <p>Иногда специалисты учётные просят применять другую систему вычисления себестоимости товара при продаже. Сейчас мы высчитываем среднюю и по ней списываем. Но есть способы ФИФО(First In First Out - первый вошел, первый вышел) и ЛИФО(Last In First Out - последний вошел, первый вышел). ФИФО это когда мы первым продаём товар, которой пришёл на склад самый первый и так далее. Если представить товары в виде стопки, которую мы накладываем начиная с низу и вверх, продавать также будем начиная с низу и вверх. ЛИФО это когда наоборот. По стопке это продавать будем сверху вниз, последний прибывший товар продаётся первым.</p>
    <p>Разберёмся с ФИФО. Введём в регистр накопления ОстаткиНоменклатуры новое измерение Партия. Такой учёт принято называть <i>партионным</i>. Тип данных измерения Пария будет ДокументСсылка.ПоступлениеТоваров. Это значит нам нужно открыть модуль объекта документа ПоступлениеТоваров и в обработчике "ОбработкаПроведения" дописать в движение данного регистра новое поле Партия и присвоить ему текущий документ поступления:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><b>Движение<span class="светло_красный">.</span>Партия <span class="светло_красный">=</span> Ссылка<span class="светло_красный">;</span></b></span>
        </pre>
    </div>
    <p>Т.е. мы в этом поле Партия указываем какой документ зафиксировал приходование пачки товара(партию).</p>
    <p><span class="светло_красный">Кстати заметка для себя! Раньше часто не хватало поле Регистратор в виртуальной таблице Остатки, вот одно  из решений, мы добавили поле Партия и теперь при перепроведении всех документов поступления товаров это поле заполнится этим документом и для каждого прихода товаров будет свой документ поступления. Чем не поле Регистратор.</span></p>
    <p>Итак перепроведём все документы "ПоступленияТоваров". Поле Партия заполнится этим документом. Если раньше виртуальная таблица Остатки группировала товары и не было понятно когда какой товар поступал, то с введением нового поля Партия появятся одинаковые товары но в разрезе разных документов вида поступления. Видны партии поступления товаров в какой то период.</p>
    <p>Далее нужно как то переписать запрос в обработчике "ОбработкаПроведения". Предыдущий запрос описан выше в статье про контроль остатков и списание себестоимости по средней. Что нужно изменить в этом запросе? Добавим выборку поля Партия и сделаем итоги по номенклатуре и упорядочим партии:</p>
    <div class="code-style">
        <pre>
            Запрос.Текст = 
                "ВЫБРАТЬ
                |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                |	ПродажаТоваровТовары.Товар КАК Номенклатура,
                |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество
                |ПОМЕСТИТЬ ВременнаяТаблица
                |ИЗ
                |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                |ГДЕ
                |	ПродажаТоваровТовары.Ссылка = &Документ
                |
                |СГРУППИРОВАТЬ ПО
                |	ПродажаТоваровТовары.Товар
                |;
                |
                |////////////////////////////////////////////////////////////////////////////////
                |ВЫБРАТЬ
                |	ВременнаяТаблица.Номенклатура КАК Номенклатура,
                |	ВременнаяТаблица.НомерСтроки КАК НомерСтроки,
                |	ВременнаяТаблица.Количество КАК Количество,
                |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток,
                |	ОстаткиНоменклатурыОстатки.Партия КАК Партия    <span class="зелёный"><b>//добавили вот эту строку</b></span>
                |ИЗ
                |	ВременнаяТаблица КАК ВременнаяТаблица
                |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(
                |				&Дата,
                |				Склад = &Склад
                |					И Номенклатура В
                |						(ВЫБРАТЬ
                |							ВременнаяТаблица.Номенклатура КАК Номенклатура
                |						ИЗ
                |							ВременнаяТаблица КАК ВременнаяТаблица)) КАК ОстаткиНоменклатурыОстатки
                |		ПО (ОстаткиНоменклатурыОстатки.Номенклатура = ВременнаяТаблица.Номенклатура)
                |
                |УПОРЯДОЧИТЬ ПО <span class="зелёный"><b>//и также упорядочили по партиям</b></span>
                |	ОстаткиНоменклатурыОстатки.Партия.МоментВремени
                |ИТОГИ           <span class="зелёный"><b>//и добавили итоги по номенклатуре</b></span>
                |	МАКСИМУМ(НомерСтроки),
                |	МАКСИМУМ(Количество),
                |	СУММА(КоличествоОстаток)
                |ПО
                |	Номенклатура";
        </pre>
    </div>
    <p>Если провести первый документ продажи, то запрос вернёт такой ответ:</p>
    <img src="../img/1С-1/2023-05-23_17-26-22.png" class="screen" alt="">
    <P>Для чего мы получаем итоги по каждому товару? В итогах мы сразу подсчитываем общий остаток товара и другую важну инфу можно туда вынести. Без итога мы бы не знали какой остаток апельсинов вообще, потому что таблица показывает остаток апельсинов по партиям. И так как мы верхнем уровне группировки проверяем хватает ли остатки с тем что хотим продать, то там нужна и инфа в итогах о количестве продаваемого товара и также номер строки товара для сообщения об ошибки. Вот поэтому удобно в итогах их вынести.</P>
    <p>Из этой таблицы нам нужны строки только итоговые, поэтому в метод Выбрать() нужно передать занчение системеного перечисления ОбходРезультатаЗапроса.ПоГруппировкам. Вот код обработки запроса:</p>
    <div class="code-style">
        <pre>
            сверху тут блокировка записей как и в статье по средней и запрос, который выше описан.

            <span class="светло_синий"><span class="зелёный">//если режим проведения оперативный, то не передаём параметр даты  
            //в этом режиме в дате и так будет самая последняя дата и если передать её в параметр, то системе нужно
            //потратить время на вычисление даты из момента времени, потом найти по этой дате в таблице остатков
            //сами остатки, это всё время занимает. Проще ничего не передавать и система сама поймёт, что нужно
            //вернуть последние остатки и она просто пойдёт и возмёт остатки на 3999 год(т.е. самые последние)
            //без вычисления всяких дат.
            //Дату мы обычно передаём при неоперативном режиме, потому что там нам нужны не последние данные вообще, 
            //а данные на конкретную дату</span>    
            <span class="светло_красный">Если</span> Режим <span class="светло_красный">=</span> РежимПроведенияДокумента<span class="светло_красный">.</span>Неоперативный <span class="светло_красный">Тогда</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Дата"</span><span class="светло_красный">,</span> МоментВремени<span class="светло_красный">());</span>
            <span class="светло_красный">Иначе</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Дата"</span><span class="светло_красный">,</span> <span class="светло_красный">Неопределено);</span>	
            <span class="светло_красный">КонецЕсли;</span>    
            
            Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Документ"</span><span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
            Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>
            
            РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
            Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
            
            <span class="зелёный">//перебираем результат запроса и если есть товары, которых не хватает на складе, 
            //то они пропустяться, а те что есть, запишутся в регистр
            //Зависит от того будем ли мы использовать Отказ или нет</span>
            <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">></span> Выборка<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">Тогда</span>
                    МоёСообщение <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                    МоёСообщение<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Не хватает товара "</span> 
                                        <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>Номенклатура 
                                        <span class="светло_красный">+</span> <span class="серый">" в количестве "</span> 
                                        <span class="светло_красный">+</span> <span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">-</span> Выборка<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">)</span> 
                                        <span class="светло_красный">+</span> <span class="серый">" в строке с номером "</span> 
                                        <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>НомерСтроки<span class="светло_красный">;</span>
                    <span class="зелёный">//Свойству Поле нужно указать путь до реквизита формы
                    //чтобы оно привязало этот текст сообщения к этому реквизиту
                    //Но если Отказ установлен в Истина, то это сообщение
                    //возле реквизита не показывается</span>
                    МоёСообщение<span class="светло_красный">.</span>Поле <span class="светло_красный">=</span> <span class="серый">"Товары["</span> <span class="светло_красный">+ (</span>Выборка<span class="светло_красный">.</span>НомерСтроки <span class="светло_красный">-</span> 1<span class="светло_красный">)</span> <span class="светло_красный">+</span> <span class="серый">"].Количество"</span><span class="светло_красный">;</span> 
                    <span class="зелёный">//нужно указать объект, с которым должно быть связано сообщение
                    //Тут указываем, что с ДокументОбъект.ПродажаТоваров должна быть связь</span>
                    МоёСообщение<span class="светло_красный">.</span>УстановитьДанные<span class="светло_красный">(</span>ЭтотОбъект<span class="светло_красный">);</span>
                    МоёСообщение<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();</span>

                    <span class="зелёный">//если тут указать Отказ равно Истина, то ни один товар не проведётся, потому что при первом же
                    //отрицательном количестве сработает Отказ и документ не будет проводится
                    //А если убрать это присвоение, то проведутся только те товары, которые есть на складе
                    //вот и выбираем что нам нужно.</span>
                    Отказ <span class="светло_красный">= Истина;
                Иначе</span> 
                    <span class="зелёный">//тут списываем количество товаров по партиям методом (первый поступил первый продался)</span>  
                    ВыборкаДетальные <span class="светло_красный">=</span>  ВыборкаГруппировки<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span> 
                    ПродаваемоеКоличество <span class="светло_красный">=</span> ВыборкаГруппировки<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                    <span class="светло_красный">Пока</span> ВыборкаДетальные<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span> 
                        <span class="зелёный">// регистр ОстаткиНоменклатуры Расход</span>
                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиНоменклатуры<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Партия <span class="светло_красный">=</span> ВыборкаДетальные<span class="светло_красный">.</span>Партия<span class="светло_красный">;</span>
        
                        <span class="светло_красный">Если</span> ПродаваемоеКоличество <span class="светло_красный">></span> 0 <span class="светло_красный">Тогда</span>
                            <span class="светло_красный">Если</span> ПродаваемоеКоличество <span class="светло_красный">&lt;</span> ВыборкаДетальные<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">Тогда</span>
                                Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ПродаваемоеКоличество<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> ВыборкаДетальные<span class="светло_красный">.</span>СуммаОстаток <span class="светло_красный">/</span> ВыборкаДетальные<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">*</span> ПродаваемоеКоличество<span class="светло_красный">;</span>
                                ПродаваемоеКоличество <span class="светло_красный">=</span> 0<span class="светло_красный">;</span>
                            <span class="светло_красный">Иначе</span>
                                Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ВыборкаДетальные<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> ВыборкаДетальные<span class="светло_красный">.</span>СуммаОстаток<span class="светло_красный">;</span>
                                ПродаваемоеКоличество <span class="светло_красный">=</span> ПродаваемоеКоличество <span class="светло_красный">-</span> ВыборкаДетальные<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">;
                            КонецЕсли;
                        КонецЕсли;	
                    КонецЦикла;   
                КонецЕсли;	
            КонецЦикла;</span></span>
        </pre>
    </div>





    <p class="title-size16"><b id="document13">(Курс Чистова - 8.2) Контроль остатков и расчёт себестоимости по средней в документе "ПродажаТоваров". Без использования склада. Старая методика.</b></p>
    <p>Этот способ проведения старого образца, соответствует для использования на экзамене на специалиста, если там требуется старый способ. Старая методика всё равно используется. Когда её можно использовать, а когда новую? Если в документе есть все данные для записи в регистр, то используем новую методику, а если данных не хватает и нужно будет вычислять ещё дополнительно поля, например, себестоимость, чтобы её тоже записать в регистр, то используем старую методику.</p>
    <p>Вот такой способ у Чистова:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоваров"
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> РежимПроведения<span class="светло_красный">)</span> 
                Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Очистить<span class="светло_красный">();</span>
                Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span>

                <span class="зелёный">//Если что, то подробно описано что тут происходит в контролях остатков у Камкова
                //Блокировку нужно писать как можно позже, чтобы как можно меньше времени мы блокировали записи в регистре
                //Вот перед запросом на остатки самое место.
                //Также в файловом способе БД мы не можем блокировать отдельные записи, платформой блокируется вся таблица
                //Что мы тут описали это для клиент-серверного взаимодействия
                //Также эта блокировка называется управляемой и при запуске может возникнуть ошибка
                //что нельзя использовать блокировки в управляемом режиме, это потому что по умолчанию
                //в платформе установлен режим блокировки автоматический. У корня конфигурации в свойствах нужно
                //поменять на управляемые</span>
                Блокировка <span class="светло_красный">= Новый</span> БлокировкаДанных<span class="светло_красный">;</span>
                ЭлементБлокировки <span class="светло_красный">=</span> Блокировка<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"РегистрНакопления.ОстаткиТоваров"</span><span class="светло_красный">);</span>
                ЭлементБлокировки<span class="светло_красный">.</span>Режим <span class="светло_красный">=</span> РежимБлокировкиДанных<span class="светло_красный">.</span>Исключительный<span class="светло_красный">;</span> 
                ДанныеБлокировки <span class="светло_красный">=</span> Товары<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">(</span>, <span class="серый">"Номенклатура"</span><span class="светло_красный">);</span>
                ДанныеБлокировки<span class="светло_красный">.</span>Колонки<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">);</span>
                ДанныеБлокировки<span class="светло_красный">.</span>ЗаполнитьЗначения<span class="светло_красный">(</span>Склад<span class="светло_красный">,</span> <span class="серый">"Склад"</span><span class="светло_красный">);</span> 
                ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Номенклатура"</span><span class="светло_красный">,</span> <span class="серый">"Номенклатура</span><span class="светло_красный">);</span>	
                ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> <span class="серый">"Склад"</span><span class="светло_красный">);</span>
                ЭлементБлокировки<span class="светло_красный">.</span>ИсточникДанных <span class="светло_красный">=</span> ДанныеБлокировки<span class="светло_красный">;</span> 
                Блокировка<span class="светло_красный">.</span>Заблокировать<span class="светло_красный">();</span>             

                <span class="зелёный">//во 2м пакете запроса указана функция ЕСТЬNULL(). Если мы продадим товар, который ещё не поступал на склад
                //то в остатках будет значение NULL, вот мы и меняем это значение на 0, чтобы не было ошибок</span> 
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                <span class="зелёный">//не оптимизированный запрос. Почему нет, читать нижу в статье про многоскладской учёт
                Запрос.Текст= 
                    "ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.КоличествоОстаток) КАК КоличествоОбщ,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.СебестоимостьОстаток) КАК СебестоимостьОбщ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки КАК ОстаткиТоваровОстатки
                    |		ПО (ПродажаТоваровТовары.Номенклатура = ОстаткиТоваровОстатки.Номенклатура)
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура";</span>

                <span class="зелёный">//оптимизированный запрос</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span>
                    <span class="серый">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК КоличествоПродажи
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура
                    |
                    |ИНДЕКСИРОВАТЬ ПО
                    |	Номенклатура
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Номенклатура КАК Номенклатура,
                    |   ПРЕДСТАВЛЕНИЕ(ВТ.Номенклатура) КАК НоменклатураП,
                    |	ВТ.НомерСтроки КАК НомерСтроки,
                    |	ВТ.КоличествоПродажи КАК Количество,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОбщ,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьОбщ
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |               Склад = &Склад И
                    |				Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ВТ.Номенклатура
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Ссылка"</span><span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"ДатаДокумента"</span><span class="светло_красный">,</span> МоментВремени<span class="светло_красный">());</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                
                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">(); </span>

                    Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                    
                    <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                        <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">></span> Выборка<span class="светло_красный">.</span>КоличествоОбщ <span class="светло_красный">Тогда</span>
                            СообщениеП <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Не хватает товара "</span> 
                                                <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>НоменклатураП 
                                                <span class="светло_красный">+</span> <span class="серый">" в количестве "</span> 
                                                <span class="светло_красный">+</span> <span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">-</span> Выборка<span class="светло_красный">.</span>КоличествоОбщ<span class="светло_красный">)</span> 
                                                <span class="светло_красный">+</span> <span class="серый">" в строке с номером "</span> 
                                                <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>НомерСтроки<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Поле <span class="светло_красный">=</span> <span class="серый">"Товары["</span> <span class="светло_красный">+</span> <span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>НомерСтроки <span class="светло_красный">-</span> 1<span class="светло_красный">)</span> <span class="светло_красный">+</span> <span class="серый">"].Количество"</span><span class="светло_красный">;</span> 
                            СообщениеП<span class="светло_красный">.</span>УстановитьДанные<span class="светло_красный">(</span>ЭтотОбъект<span class="светло_красный">);</span>
                            СообщениеП<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();</span>

                            Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                        <span class="светло_красный">КонецЕсли;</span>

                        <span class="зелёный">//Допустим у нас 1000 строк в таб. части и из этой 1000 товаров не хватает только в 
                        //3й строке. Мы зайдём на 3м круге цикла в условие и в Отказ запишем Истина. Пошли след. круги
                        //цикла и на 4м круге, допустим, у нас хватает товаров, но нет смысла гонять код и записывать данные
                        //в набор записей регистра, потому что Отказ уже Истина, значит документ не будет записан. Поэтому
                        //мы просто пропускаем круг, нам нужно теперь просто выдать пользователю все нехватающие товары и всё</span>
                        <span class="светло_красный">Если</span> Отказ <span class="светло_красный">Тогда</span>
                            <span class="светло_красный">Продолжить;
                        КонецЕсли;</span>

                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>                       
                        <span class="зелёный">//вот такая формула нахождения себестоимости из-за проблем округления может оставить копейки в остатках	
                        //Движение.Себестоимость = (Выборка.СебестоимостьОбщ / Выборка.КоличествоОбщ) * Выборка.Количество;	
                        //а вот такая формула будет без остатков копеек, так обещает Чистов</span>
                        Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">/</span> Выборка<span class="светло_красный">.</span>КоличествоОбщ <span class="светло_красный">*</span> Выборка<span class="светло_красный">.</span>СебестоимостьОбщ<span class="светло_красный">;
                    КонецЦикла;
                КонецЕсли; 
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Замечу, что такое проведение обеспечивает учёт только по одному складу, который находится у предприятия.</p>

    <p class="title-size16"><b id="document14">Как вести многоскладской учёт?</b></p>
    <p>Видео, с которого это пишу - https://www.youtube.com/watch?v=bqZwpeTZ5Ug&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=12</p>
    <p><span class="светло_синий">Отступление. В этом видео человек показывает решение задачи Чистова, как вести многоскладской учёт, когда в продажном документе мы указываем склад не из шапки документа, а из поля Склад табличной части документа, то есть склад выбирается для каждого товара - https://www.youtube.com/watch?v=e62fUxSCV7k</span></p>
    <p>Как вести учёт с наличием одного склада мы вроде бы разобрались. Подсчитываем количество и себестоимость по средней и не паримся. Но когда появляется ещё один склад или несколько, то возникают проблемы с подсчётом себестоимости по средней. Например, у нас есть 2 склада: Склад1 и Склад2. На Склад1 поступил товар Ложки в количестве 1 шт. за 100 руб. Позже на Склад2 поступил такой же товар Ложки 1 шт. за 200 руб. Наступил миг продажи и нам нужно продать одну ложку. Как нам подсчитать себестоимость списываемой ложки? Можно было бы считать себестоимость учитывая склады, но тогда у нас на каждом складе была бы своя себестоимость на один и тот же товар. Такое бывает на автономных складах(например, в разных городах склады), но мы хотели бы, чтобы на всех складах себестоимость была одинаковой на одинаковый товар. Получится если мы спишем ложку из первого склада по средней по 150 руб. за ложку, то остаток себестоимости на первом складе составит -50 руб., а количество будет по нулям, тут всё нормально с количеством. Дальше если мы продадим последнюю ложку со второго склада, то средняя также будет 150 руб., потому что подсчёт 200 - 50 = 150, и при продаже на втором складе остаток будет 50 руб. Всё, ложек нет, но остаток себестоимости на 1м складе -50, на втором 50, ерунда полная. Да, на всех складах остаток в итоге выйдет в 0, но если мы посмотрим остаток на первом складе, там не будет 0 и на 2м тоже.</p>
    <p>Для чего нам вообще нужно знание себестоимости товара? Первое это для расчёта валовой прибыли, второе для отчёта остатков, где мы хотели бы видеть на какую сумму осталось товара на складах.</p>
    <p>Для чего мы вообще описываем как вести многоскладской учёт? Для того, чтобы понимать как сделать отчёт с понятным отображением остатков количества и себестоимости товаров на складах. И сделать так, чтобы себестоимость на всех складах для одинакого товара была одна, посчитанная по средней или методами ФИФО или ЛИФО.</p>
    <p>Как же сделать такой отчёт?</p> 
    <p>Как я понимаю из видео, то для решения такой задачи нужно 2 регистра накопления. Один регистр мы возмём "ОстаткиНоменклатуры", эта будет таблица с общими остатками количества и себестоимости, а второй нужно создать. В чём смысл этих 2х регистров? В первом регистре у нас будут измерения Номенклатура, может быть Контрагент, а ресурсы - Количество и Себестоимость, Количество будем использовать как общее количество одного товара на всех складах. При продаже мы в первый регистр записываем себестоимость продаваемых товаров со всех складов, т.е. у нас не будет вообще привязки к складам, как будто мы продаём из одного склада. В документе продажи мы конечно же будем указывать склад, но записывать склад в первый регистр не будем.</p>
    <p>А вот второй регистр у нас будет иметь 2 измерения - Номенклатура и Склад, а ресурс один это Количество. Создадим такой регистр и назовём "ОстаткиПоСкладам". Во втором мы уже при проведении документа будем учитывать товар с какого склада продаём, тут нам не нужен ресурс Себестоимость, потому как мы выяснили выше, будут проблемы с его вычислением. Получается Себестоимость и общее количество мы вычисляем в первом регистре(хотя общее количество мы можем получить и из второго регистра, ну пусть будет в первом), а количество по складам во втором регистре, далее в СКД нам нужно будет соединить эти 2 виртуальные таблицы остатков и присоединить вычисляемое поле Себестоимость. Это вычисляемое поле будем отображать в отчёте, в отличии от поля Себестоимость в первой таблице. Вычисляемое поле будем вычислять на основе полей из 2х соединенных таблиц остатков.</p>
    <p>Прежде чем такой отчёт сделать в СКД, покажу как это выглядит в виде запроса в консоле запросов:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">ОстаткиПоСкладамОстатки</span><span class="светло_красный">.</span>Номенклатура <span class="светло_красный">КАК</span> Номенклатура<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиПоСкладамОстатки</span><span class="светло_красный">.</span>Склад <span class="светло_красный">КАК</span> Склад<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиПоСкладамОстатки</span><span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">КАК</span> КоличествоОстаток<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиТоваровОстатки</span><span class="светло_красный">.</span>СебестоимостьОстаток <span class="светло_красный">КАК</span> СебестоимостьОбщ<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиТоваровОстатки</span><span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">КАК</span> КоличествоОбщ<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиПоСкладамОстатки</span><span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">/</span> ОстаткиТоваровОстатки<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">*</span> <span class="зелёный">ОстаткиТоваровОстатки</span><span class="светло_красный">.</span>СебестоимостьОстаток <span class="светло_красный">КАК</span> Себестоимость
            <span class="светло_красный">ИЗ</span>
                РегистрНакопления<span class="светло_красный">.</span>ОстаткиПоСкладам<span class="светло_красный">.</span>Остатки <span class="светло_красный">КАК</span> <span class="зелёный">ОстаткиПоСкладамОстатки</span>
                    <span class="светло_красный">ЛЕВОЕ СОЕДИНЕНИЕ</span> РегистрНакопления<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Остатки <span class="светло_красный">КАК</span> <span class="зелёный">ОстаткиТоваровОстатки</span>
                    <span class="светло_красный">ПО</span> <span class="зелёный">ОстаткиПоСкладамОстатки</span><span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> <span class="зелёный">ОстаткиТоваровОстатки</span><span class="светло_красный">.</span>Номенклатура</span>
        </pre>
    </div>
    <img src="../img/1С-1/2023-06-09_09-51-31.png" class="screen" alt="">
    <p>Как видно из таблицы у нас есть количество(КоличествоОстаток) товаров по складам из таблицы "ОстаткиПоСкладам" и есть общее количество(КоличествоОбщ) каждого товара по всем складам(без привязки к складу), а также есть общая себестоимость(СебестоимостьОбщ) товаров также без привязки к складам. Добавляем вычмсляемое поле Себестоимость и расчитываем его по формуле, которую дал Чистов(говорит, что она не имеет таких косяков с остатками копеек):</p>
    <p><i>ОстаткиПоСкладамОстатки.КоличествоОстаток / ОстаткиТоваровОстатки.Количество.Общ * ОстаткиТоваровОстатки.СебестоимостьОбщ</i></p>
    <p>Вместо старой формулы, которая с косяками(ну эти косяки убтраются если что, на канале ТЕХПОДДЕРЖКА вроде рассказывал как их убрать):</p>
    <p><i>ОстаткиТоваровОстатки.СебестоимостьОбщ / ОстаткиТоваровОстатки.Количество.Общ * ОстаткиПоСкладамОстатки.КоличествоОстаток</i></p>
    <p>К этой таблице можно для интереса добавить ещё одно вычисляемое поле Себестоимость_1_ед, которая будет показывать себестоимость 1 единицы товара. Расчитать её можно разделив общую себестоимость на общее количество.</p>
    <p>Теперь можно убрать из запроса получение полей с общей себестоимостью и общим количеством и получим вот такую таблицу, где по складам мы видим себестоимость и количество и всё правильно подсчитывается:</p>
    <img src="../img/1С-1/2023-06-09_10-46-01.png" class="screen" alt="">
    <p>Далее начну описывать по шагам как создать такой отчёт в СКД на основе этих 2х виртуальных таблиц.</p>
    <p>Начнём с набора данных для отчёта, их будет 2 набора из запроса. В первом наборе данных запрашиваем поля из виртуальной таблицы "ОстаткиПоСкладам.Остатки", потом создаём ещё один набор данных и запрашиваем поля из виртуальной таблицы "ОстаткиНоменклатуры.Остатки". Соединение в СКД таблиц всегда только левое. Если мы создали больше одного набора данных, то появляется вкладка "Связи наборов данных". На ней нажимаю на плюс мы создаём связь 2х таблиц. Слева у нас будт таблица со складами, поэтому в поле "Источник связи" указывам первый набор данных, а в поле "Приемник связи" будет таблица с общими остатками. Далее в поле "Выражение источник" и в поле "Выражение приемник" указываем поля, по которым мы будем связывать эти 2 таблицы. Это поле Номенклатура. В поле "Параметр" указываем Период, потому что нам важно, чтобы даты формирования записей в 2х таблицах совпадали(пока не особо понял это решение с датой).</p>
    <p>Далее нужно добавить вычисляемое поле Себестоимость, поэтому идём во вкладку "Вычисляемые поля". В поле "Путь к данным" укажем имя нашего вычисляемого поля - Себестоимость. В поле "Выражение" нужно написать формулу, по которой мы вычисляем поле Себестоимость. Формула там будет та, что я указал выше первой от Чистова. Чтобы в вычисляемом поле не получить большую дробную часть, тут же на поледнем поле "Оформление" можно настроить формат числа. В списке окна оформления выбираем функцию Формат и там для числа задаём длина 15, точность 2. Всё, теперь число будет обрезаться до 2 цифр в дробной части.</p>
    <p>У нас в формуле присутствует деление, в 1С при делении на 0 будет ошибка, поэтому стоит подстраховаться. Если общего товара не будет на складе(делим же на общее количество вот и проверяем это число), то в записи будет NULL. Я тут подумал и пока не понимаю как вообще в общем количестве может быть 0 или Null. Если в общем количестве будет Null, то скорее всего товара нет на складе, а значит такой записи с товаром вообще не будет в таблице. Поэтому оставлю без проверок эту формулу, может что то встретися допишу.</p>
    <p>Ну всё дальше уже понятно, выбираем ресурсы на вкладке ресуров и в настройках выводим как нам надо.</p>
    <p>А как быть при проведении продажного документа, как нам проверять есть ли продаваемый товар на указываемом складе? Ведь до этого мы всё время продавали товар проверяя его общее количество со всех складов. Теперь же когда у нас есть многоскладской учёт, то мы указываем склад в документе, с которого пытаемся продать товар, надо как-то в обработку проведения добавить и проверку на остатки на указанном складе.</p>
    <p>Напишем пока такой запрос, он повторяет не оптимизированный запрос из предыдущей статьи, только добавляется 2я виртуальная таблица с остатками по складу:</p>
    <div class="code-style">
        <pre>
            Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
            Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                <span class="серый">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.КоличествоОстаток) КАК КоличествоОбщ,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.СебестоимостьОстаток) КАК СебестоимостьОбщ,
                    |	МИНИМУМ(ОстаткиПоСкладамОстатки.КоличествоОстаток) КАК КоличествоОстатокНаСкладе
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки КАК ОстаткиТоваровОстатки
                    |		ПО (ПродажаТоваровТовары.Номенклатура = ОстаткиТоваровОстатки.Номенклатура)
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки КАК ОстаткиПоСкладамОстатки
                    |		ПО (ПродажаТоваровТовары.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура)
                    |			И (ПродажаТоваровТовары.Ссылка.Склад = ОстаткиПоСкладамОстатки.Склад)
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура"</span><span class="светло_красный">;</span>
        </pre>
    </div>
    <p><i>Оптимизация запроса</i></p>
    <p>Как объяснил Чистов, что вот так как написан запрос выше не очень оптимально, потому что у нас в табличной части документа могут повторяться товары, мы к этой таблице присоединяем 2 виртуальные таблицы остатков, которые сама система уже сгруппировывает. И присоединив к таб. части эти 2 сгруппированные вирт. таблицы они опять повторяют записи, потому что в таб. части могут быть повторения товаров и только потом в конце запроса мы группируем всю соединённую таблицу. Чтобы так не было можно взять отдельно получить товары из таб. части, сгруппировать её, поместить во временную таблицу и уже потом к ней присоединять остатки. Плюсом, как по мне, являетс ещё то, что не нужно применять агрегатные функции ко всем полям виртуальных таблиц как в примере выше.</p> 
    <p>Также очень важным замечанием является то, что виртуальные таблицы сначала выбирают все товары, потом начинается сравнение, что нам нужны товары только такие как из таб. части и отбрасываются опять куча ненужных товаров. Делается двойная работа. Нужно сразу в параметрах вирт. таблиц указать какие товары надо выбрать для этих таблиц. Вот какой должен быть запрос:</p>
    <div class="code-style">
        <pre>
            Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
            Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                <span class="серый">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК КоличествоПродажи
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Номенклатура КАК Номенклатура,
                    |	ВТ.НомерСтроки КАК НомерСтроки,
                    |	ВТ.КоличествоПродажи КАК Количество,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОбщ,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьОбщ,
                    |	ЕСТЬNULL(ОстаткиПоСкладамОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокНаСкладе
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ВТ.Номенклатура
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки(
                    |				&ДатаДокумента,
                    |				Склад = &Склад
                    |				И Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ВТ.Номенклатура
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиПоСкладамОстатки
                    |		ПО ВТ.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура"</span><span class="светло_красный">;</span>
        </pre>
    </div>
    <p>В итоге получим такой код в обработке проведения:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоваров"
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> РежимПроведения<span class="светло_красный">)</span> 
                <span class="зелёный">//во 2м пакете запроса указана функция ЕСТЬNULL(). Если мы продадим товар, который ещё не поступал на склад
                //то в остатках будет значение NULL, вот мы и меняем это значение на 0, чтобы не было ошибок</span> 
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ
                        |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                        |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                        |	СУММА(ПродажаТоваровТовары.Количество) КАК КоличествоПродажи
                        |ПОМЕСТИТЬ ВТ
                        |ИЗ
                        |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                        |ГДЕ
                        |	ПродажаТоваровТовары.Ссылка = &Ссылка
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ПродажаТоваровТовары.Номенклатура
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ВТ.Номенклатура КАК Номенклатура,
                        |	ВТ.НомерСтроки КАК НомерСтроки,
                        |	ВТ.КоличествоПродажи КАК Количество,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОбщ,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьОбщ,
                        |	ЕСТЬNULL(ОстаткиПоСкладамОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокНаСкладе
                        |ИЗ
                        |	ВТ КАК ВТ
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                        |				&ДатаДокумента,
                        |				Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки(
                        |				&ДатаДокумента,
                        |				Склад = &Склад
                        |				И Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиПоСкладамОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Ссылка"</span><span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"ДатаДокумента"</span><span class="светло_красный">,</span> МоментВремени<span class="светло_красный">());</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                
                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">(); </span>

                    Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                    Движения<span class="светло_красный">.</span>ОстаткиПоСкладам<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                    
                    <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                        <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">></span> Выборка<span class="светло_красный">.</span>КоличествоОстатокНаСкладе <span class="светло_красный">Тогда</span>
                            СообщениеП <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> "Не хватает товара " 
                                                <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>Номенклатура 
                                                <span class="светло_красный">+</span> " в количестве " 
                                                <span class="светло_красный">+</span> <span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">-</span> Выборка<span class="светло_красный">.</span>КоличествоОстатокНаСкладе<span class="светло_красный">)</span> 
                                                <span class="светло_красный">+</span> " в строке с номером " 
                                                <span class="светло_красный">+</span> Выборка<span class="светло_красный">.</span>НомерСтроки<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Поле <span class="светло_красный">=</span> "Товары[" <span class="светло_красный">+</span> <span class="светло_красный">(</span>Выборка<span class="светло_красный">.</span>НомерСтроки <span class="светло_красный">-</span> 1<span class="светло_красный">)</span> <span class="светло_красный">+</span> "].Количество"<span class="светло_красный">;</span> 
                            СообщениеП<span class="светло_красный">.</span>УстановитьДанные<span class="светло_красный">(</span>ЭтотОбъект<span class="светло_красный">);</span>
                            СообщениеП<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();</span>

                            Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                            <span class="зелёный">//Почему пропускаем круг цикла, а не прерываем цикл полностью? Ведь уже есть товар, которого не хватает,
                            //уже всё равно не пройдёт транзакция записи. А для того, чтобы вывести пользователю все товары,
                            //которых не хватает. Моё предположение, до конца не уверен.</span>
                            <span class="светло_красный">Продолжить;
                        КонецЕсли;</span>

                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                        <span class="зелёный">//вот такая формула нахождения себестоимости из-за проблем округления может оставить копейки в остатках	
                        //Движение.Себестоимость = (Выборка.СебестоимостьОбщ / Выборка.КоличествоОбщ) * Выборка.Количество;	
                        //а вот такая формула будет без остатков копеек, так обещает Чистов</span>
                        Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">/</span> Выборка<span class="светло_красный">.</span>КоличествоОбщ <span class="светло_красный">*</span> Выборка<span class="светло_красный">.</span>СебестоимостьОбщ<span class="светло_красный">;</span>


                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиПоСкладам<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">;
                    КонецЦикла;
                КонецЕсли; 
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document15">Партионный учёт, продажа товара и списание себестоимости методом ФИФО и ЛИФО</b></p>
    <p>Курс Чистова, видео - https://www.youtube.com/watch?v=I70c87BCWS8&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=13</p>
    <p>Смысл такого учёта в том, что мы списываем товар по пришедшим партиям. ФИФО это списание от начала и до конца. Добавляем в регистр остатков с себестоимостью поле Партия и записываем в это поле ссылку на документ, который эту партию оприходовал. Получаем запросом нужные товары из этого регистра и упорядычиваем по возрастанию поле Партия.Дата, затем начинаем списывать от начала до конца то количество товара, котрое хотим продать. Когда мы заходим внутрь партии, то там себестоимость вычисляется по средней. И в каждой партии будет своя себестоимость, если у одного и того же товара разная себестоимость при поступлении.</p>
    <p>ЛИФО запрещён в России с какого то года, но используется где то в управленческом учёте, пока не понимаю о чём речь.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> РежимПроведения<span class="светло_красный">)</span> 
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ
                        |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                        |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                        |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество
                        |ПОМЕСТИТЬ ВТ
                        |ИЗ
                        |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                        |ГДЕ
                        |	ПродажаТоваровТовары.Ссылка = &Ссылка
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ПродажаТоваровТовары.Номенклатура
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ВТ.Номенклатура КАК Номенклатура,
                        |	ВТ.НомерСтроки КАК НомерСтроки,
                        |	ВТ.Количество КАК Количество,
                        |   ОстаткиТоваровОстатки.Партия КАК Партия,
                        |   ОстаткиТоваровОстатки.Партия.Склад КАК Склад,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоПартии,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьПартии,
                        |	ЕСТЬNULL(ОстаткиПоСкладамОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокНаСкладе
                        |ИЗ
                        |	ВТ КАК ВТ
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                        |				&ДатаДокумента,
                        |				Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки(
                        |				&ДатаДокумента,
                        |				Склад = &Склад
                        |				И Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиПоСкладамОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура
                        |
                        |УПОРЯДОЧИТЬ ПО Партия.Дата ВОЗР
                        |
                        |ИТОГИ МИНИМУМ(Количество), МИНИМУМ(КоличествоОстатокНаСкладе)
                        |ПО ВТ.Номенклатура"</span><span class="светло_красный">;</span>
                
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Ссылка"</span><span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"ДатаДокумента"</span><span class="светло_красный">,</span> МоментВремени<span class="светло_красный">());</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>


                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span> 
                    <span class="зелёный">//выбираем в выборку толко записи верхнего уровня с итогами</span>
                    ВыборкаИтогов <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">(</span>ОбходРезультатаЗапроса<span class="светло_красный">.</span>ПоГруппировкам<span class="светло_красный">);</span> 

                    Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                    Движения<span class="светло_красный">.</span>ОстаткиПоСкладам<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                    
                    <span class="светло_красный">Пока</span> ВыборкаИтогов<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                        <span class="светло_красный">Если</span> ВыборкаИтогов<span class="светло_красный">.</span>Количество <span class="светло_красный">></span> ВыборкаИтогов<span class="светло_красный">.</span>КоличествоОстатокНаСкладе <span class="светло_красный">Тогда</span>
                            СообщениеП <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Не хватает товара "</span> <span class="светло_красный">+</span> ВыборкаИтогов<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();</span>

                            Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                            Продолжить;
                        КонецЕсли;</span>  
                        
                        <span class="зелёный">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество <span class="светло_красный">=</span> ВыборкаИтогов<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                        
                        <span class="зелёный">//из текущей записи верхнего уровня с итогами выбираем его детальные записи</span>
                        ВыборкаДетальных <span class="светло_красный">=</span> ВыборкаИтогов<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                        <span class="светло_красный">Пока</span> ВыборкаДетальных<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span> 
                            <span class="зелёный">//если есть что списывать, то идём внутрь. Если у нас партии упорядочены по возрастанию, 
                            //то вот здесь и начинается списание и вычисление себестоимости по методу ФИФО </span>
                            <span class="светло_красный">Если</span> СписываемоеКоличество <span class="светло_красный">></span> 0 <span class="светло_красный">И</span> ВыборкаДетальных<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад <span class="светло_красный">Тогда</span>
                                Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                                Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Партия <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>Партия<span class="светло_красный">;</span>
                            
                                <span class="светло_красный">Если</span> СписываемоеКоличество <span class="светло_красный">&lt;</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоПартии <span class="светло_красный">Тогда</span>
                                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> СписываемоеКоличество<span class="светло_красный">;</span>
                                    Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> СписываемоеКоличество <span class="светло_красный">/</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоПартии <span class="светло_красный">*</span> ВыборкаДетальных<span class="светло_красный">.</span>СебестоимостьПартии<span class="светло_красный">;</span>
                                    СписываемоеКоличество <span class="светло_красный">=</span> СписываемоеКоличество <span class="светло_красный">-</span> СписываемоеКоличество<span class="светло_красный">;</span>
                                <span class="светло_красный">Иначе</span>
                                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоПартии<span class="светло_красный">;</span>
                                    Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>СебестоимостьПартии<span class="светло_красный">;</span>
                                    СписываемоеКоличество <span class="светло_красный">=</span> СписываемоеКоличество <span class="светло_красный">-</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоПартии<span class="светло_красный">;
                                КонецЕсли;

                            КонецЕсли;
                        КонецЦикла;</span> 
                        
                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиПоСкладам<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Номенклатура <span class="светло_красный">=</span> ВыборкаИтогов<span class="светло_красный">.</span>Номенклатура<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ВыборкаИтогов<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                    КонецЦикла;
                КонецЕсли;   
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document16">(Курс Чистова 8.2)Последовательности, что такое и для чего нужны.</b></p>
    <p>Видео - https://www.youtube.com/watch?v=RLedCEoiA2s&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=14</p>
    <p>В принципе смысл тот же самый, что и в курсе Камкова, там я уже примерно описал, что такое поледовательности и как этот объект работает.</p>
    <p>Тема не особо понятна как это применяется на практике. Нужно будет поискать более развёрнутый ответ в инете. Хотя если несколько раз пересмотреть видео, то можно понять работу последовательности.</p>

    <p class="title-size16"><b id="document18">Как свернуть(сгруппировать) одинаковые товары табличной части при записи их в регистр</b></p>
    <p>Пользователь может ввести несколько раз один и тот же товар в табличной части и не заметит. Чтобы не раздувать БД регистра нужно сгруппировать одинаковые товары перед записью их в регистр. Есть несколько способов это сделать.</p>
    <p><i>Первый</i>. В обработке проведения в замом начале насильно записываем данные документа в БД, затем делаем запрос в этим данным документа, получаем все товары табличной части, в запросе группируем и записываем в регистр.</p>
    <p><i>Второй</i>. Можем выгрузить табличную часть в таблицу значений и у таблицы значений есть метод Свернуть(), почитать про него можно тут же в шпоре в типах данных про ТЗ. Затем из таблицы получаем строки и записываем товары в регистр. Пример:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> РежимПроведения<span class="светло_красный">)</span>
                Движения<span class="светло_красный">.</span>ОстаткиСкоропортящихсяТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>

                ТЗ <span class="светло_красный">=</span> Товары<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">();</span>
                <span class="зелёный">//в первом параметре указвыем колонки для свёртывания, во втором 
                //параметре колонки для суммирования. Колонки которые мы не указали
                //не войдут в новую свёрнутую таблицу.</span>
                ТЗ<span class="светло_красный">.</span>Свернуть<span class="светло_красный">(</span><span class="серый">"Товар, СрокГодности"</span><span class="светло_красный">,</span> <span class="серый">"Количество, Сумма"</span><span class="светло_красный">);</span>

                <span class="светло_красный">Для каждого</span> ТекСтрока <span class="светло_красный">Из</span> ТЗ <span class="светло_красный">Цикл</span>
                    Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиСкоропортящихсяТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                    Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Приход<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> ТекСтрока<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Партия <span class="светло_красный">=</span> Ссылка<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>СрокГодности <span class="светло_красный">=</span> ТекСтрока<span class="светло_красный">.</span>СрокГодности<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ТекСтрока<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                    Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> ТекСтрока<span class="светло_красный">.</span>Сумма<span class="светло_красный">;
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p><i>Третий</i>. Этот способ я сам выдумывал, он описан где то в конфигурации "Управление кухней" от канал ТЕХПОДДЕРЖКА. В этом способе я средствами языка 1С сам группирую строки табличной части, но смысла в нём тогда нет, потому что то же самое делает метод Свернуть() у ТЗ.</p>
    <p><span class="светло_красный">Кстати нужно будет ещё проверить как быстрее будет сворачивать строки, через 1й или 2й способы.</span></p>

    <p class="title-size16"><b id="document19">Как для реквизита шапки/таб.части документа добавить кнопку выбора и открыть окно с результатом, который мы выберем из БД</b></p>
    <p>Описание такого примера можно найти в разделе 1С - Разные заметки 1С - События формы - НачалоВыбора</p>

    <p class="title-size16"><b id="document20">Опишу тут другой способ бронировать товары</b></p>
    <p>Напомню, что если нужно в отсортированном списке партий поднять одну конкретную запись в верх списка, то это описано в статье: "Заметки по запросам" - Первая статья.</p>
    <p>Опишу тут решения из 2х задач, номер 8 и 9. В 8 задаче заказчик не может взять меньше заказанного и при отказе от заказа просто удаляем документ бронирования. А 9 задаче нужно сделать, чтобы заказчик мог взять любое количество товара(больше или меньше заказанного). Также нужно сделать возможность, чтобы заказчик мог бронировать несколько раз один и тот же товар и списывать эти товары из брони в порядке их бронирования(это партии).</p>
    <p><i style="text-decoration: underline;">Это решение задачи из книги - Чистов П.А. - Сборник задач по разработке на платформе 1С.Предприятие - 2020,  под номером 8.</i></p>
    <p>Заказчик не может взять меньше заказанного и при отказа от своей брони, документ с бронёй просто удаляется и регистр очищается.</p>
    <p>К нам приходит покупатель или звонит и заказывает товар, но говорит, что заберёт позже. Нам нужно забронировать товар для этого покупателя. В системе создаём документ "БронированиеТоваров", документы "ПоступлениеТоваров" и "ПродажаТоваров" есть само собой. Нам понадобится 2 регистра накопления в режиме Остатки - "ОстаткиТоваров" и "ТоварыВБроне".</p>
    <p>В документе "БронированиеТоваров" будет 2 доп. реквизита - "Контрагент" и "Телефон". И тот и другой будут ссылаться на справочники "Контрагенты" и "Телефоны". Справочник "Телефоны" сделаем подчинёным справочнику "Контрагенты". В форме документа "БронированиеТоваров" настроим связь между этими реквизитами через "Связи параметров выбора".</p>
    <p>В запросе мы кроме остатков товаров на сладе("ОстаткиТоваров.Остатки") используем и таблицу остатков забронированных товаров("ТоварыВБроне.Остатки"), чтобы узнать остатки не только физические на складе, но и сколько до нас уже забронировали этот товар, ведь его тоже нужно учитывать. Узнав все остатки мы сравниваем их с количеством, которое хотим забронировать.</p>
    <p>В статье про бронирование товара у Камкова, я видимо не правильно понял и писал, что нужно при бронировании из регистра "ОстаткиТоваров" списывать товар и в регистр бронирования записывать, так вот с регистра "ОстаткиТоваров" не надо ничего списывать, а просто записываем в регистр "ТоварыВБроне". Потом в обработке проведения документа "ПродажаТоваров" мы смотрим остатки в "ОстаткиТоваров.Остатки" и смотрим остатки в "ТоварыВБроне.Остатки" и вычитаем из физических остатков на складе те, что забронированные просто математическим действием и получаем свободный остаток товаров, как видим ничего из регистра остатков со склада не надо списывать.</p>
    <p>На счёт того нужно ли блокировать таблицу "РегистрНакопления.ОстаткиТоваров" при бронировании товара пока не ясно. Как видится мне то нужно. В решении блокирования не было, но если подумать, то блокирование нужно, потому что пока мы проводим документ бронирования и смотрим в эту таблицу и в начале кода остаток есть, то до конца кода уже его может и не быть, а мы забронируем как-будто он есть.</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "БронированиеТоваров"
            <span class="светло_синий">Процедура ОбработкаПроведения(Отказ, РежимПроведения)
                Движения.ТоварыВБроне.Записывать = Истина;

                <span class="зелёный">//блокировка записей в таблице ОстаткиТоваров</span>
                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить(<span class="серый">"РегистрНакопления.ОстаткиТоваров"</span>);
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
                ДанныеБлокировки = Товары.Выгрузить(, <span class="серый">"Товар"</span>);
                ЭлементБлокировки.ИсточникДанных = ДанныеБлокировки;
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="серый">"Товар"</span>, <span class="серый">"Товар"</span>); 
                Блокировка.Заблокировать();

                Запрос = Новый Запрос;
                Запрос.Текст = 
                    <span class="серый">"ВЫБРАТЬ
                    |	БронированиеТоваровТовары.Товар КАК Товар,
                    |	СУММА(БронированиеТоваровТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.БронированиеТоваров.Товары КАК БронированиеТоваровТовары
                    |ГДЕ
                    |	БронированиеТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	БронированиеТоваровТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокВБроне
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Товар = ОстаткиТоваровОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ТоварыВБронеОстатки
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки.Товар"</span>;
                    
                Запрос.УстановитьПараметр(<span class="серый">"ДатаДокумента"</span>, Неопределено);
                Запрос.УстановитьПараметр(<span class="серый">"Ссылка"</span>, Ссылка);
                РезультатЗапроса = Запрос.Выполнить(); 

                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                    
                    Пока Выборка.Следующий() Цикл
                        ОстатокТовараСУчётомЗабронированных = Выборка.КоличествоОстаток - Выборка.КоличествоОстатокВБроне;
                        Если Выборка.Количество > ОстатокТовараСУчётомЗабронированных Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="серый">"Не хватает товара "</span> + Выборка.ТоварП + <span class="серый">" в количестве "</span> + (Выборка.Количество - ОстатокТовараСУчётомЗабронированных);
                            СообщениеП.Сообщить();

                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;

                        Движение = Движения.ТоварыВБроне.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
                        Движение.Период = Дата;
                        Движение.Товар = Выборка.Товар;
                        Движение.Контрагент = Контрагент;
                        Движение.Количество = Выборка.Количество;             
                    КонецЦикла
                КонецЕсли;
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Далее покупатель пришёл за товаром. Для отпуска ему товара мы используем документ "ПродажаТоваров", в обработчике которого мы в запросе используем также 3 таблицы, только из таблицы "ТоварыВБроне.Остатки" мы будем 2 раза получать данные и получается соединено будет 4 таблицы. Из одной и той же таблицы "ТоварыВБроне.Остатки" мы хотим получить данные бронированных товаров чужих покупателей и товары только с нашим покупателем.</p> <p>Всё, дальше мы количество из документа "ПродажаТоваров" сравниваем с физическими остатками минус остатки в броне других покупателей и записываем в регистр "ОстаткиТоваров" расход количества товаров из документа, а в регистр "ТоварыВБроне" записываем расход количества товаров покупателя из остатков в броне, т.е. мы из резерва списываем всё что там было. Почему так, ведь можно было просто записать и туда и туда остаток из брони данного покупателя, но покупатель когда прийдёт за товаром, то он может заказть больше или меньше своей брони, а больше или меньше будет лежать только в количестве документа. Поэтому и получается, что в регистр "ОстаткиТоваров" мы пишем только то, что реально заказчик купит(количество из документа), а из регистра "ТоварыВБроне" нам нужно списать столько сколько там и лежит.</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоаров"
            <span class="светло_синий">Процедура ОбработкаПроведения(Отказ, РежимПроведения) 
                Движения.ОстаткиТоваров.Записывать = Истина;
                Движения.ТоварыВБроне.Записывать = Истина;


                <span class="зелёный">//блокировка записей в таблице ОстаткиТоваров</span>
                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить(<span class="серый">"РегистрНакопления.ОстаткиТоваров"</span>);
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
                ДанныеБлокировки = Товары.Выгрузить(, <span class="серый">"Товар"</span>);
                ЭлементБлокировки.ИсточникДанных = ДанныеБлокировки;
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="серый">"Товар"</span>, <span class="серый">"Товар"</span>); 
                Блокировка.Заблокировать();


                Запрос = Новый Запрос;
                Запрос.Текст = 
                    <span class="серый">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	СУММА(ПродажаТоваровТовары.Сумма) КАК Сумма
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,
                    |	ВТ.Сумма КАК Сумма,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеДругихКонтрагентов,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки1.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеНашегоКонтрагента
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар
                    |					ИЗ
                    |						ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Товар = ОстаткиТоваровОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				НЕ Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар
                    |						ИЗ
                    |							ВТ)) КАК ТоварыВБронеОстатки
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар КАК Товар
                    |						ИЗ
                    |							ВТ КАК ВТ)) КАК ТоварыВБронеОстатки1
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки1.Товар"</span>;
                                                            
                Запрос.УстановитьПараметр(<span class="серый">"Ссылка"</span>, Ссылка);
                Запрос.УстановитьПараметр(<span class="серый">"ДатаДокумента"</span>, Неопределено);
                Запрос.УстановитьПараметр(<span class="серый">"Контрагент"</span>, Контрагент);
                РезультатЗапроса = Запрос.Выполнить();
                
                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                    
                    Пока Выборка.Следующий() Цикл
                        СвободныйОстатокТовара = Выборка.КоличествоОстаток - Выборка.КоличествоОстатокВБронеДругихКонтрагентов;
                        Если Выборка.Количество > СвободныйОстатокТовара Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="серый">"Не хватает товара "</span> + Выборка.ТоварП + <span class="серый">" на складе "</span> + Склад + <span class="серый">" в количество "</span>
                                                + (Выборка.Количество - СвободныйОстатокТовара);
                            СообщениеП.Сообщить();
                            
                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;

                        Движение = Движения.ОстаткиТоваров.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Товар = Выборка.Товар;
                        Движение.Количество = Выборка.Количество;

                        Движение = Движения.ТоварыВБроне.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Товар = Выборка.Товар;
                        Движение.Контрагент = Контрагент; 
                        Движение.Количество = Выборка.КоличествоОстатокВБронеНашегоКонтрагента;
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Если заказчик отказывается от брони, то просто удаляем документ "БронированиеТоваров" для этого покупателя, все записи в регистре автоматом удалятся. На всякий случай нужно поставить "Удалять автоматически" в закладке Движения этого документа.</p>
    <p><i style="text-decoration: underline;">Это решение задачи из книги - Чистов П.А. - Сборник задач по разработке на платформе 1С.Предприятие - 2020,  под номером 9.</i></p>
    <p>Теперь нужно исправить то место, когда заказчик может взять меньше забронированного и если у заказчика несколько броней одного и того же товара, то нужно списывать из брони в порядке бронирования по дате. Короче говоря нужно вести партионное списание. Также если заказчик забрал часть товара из брони, а от части отказался, то нужно ввести документ "СнятиеБрони".</p>
    <p>Итак писать код обработчика проведения документа "БронированиеТоваров" не буду, там все 2 строки изменения. Нужно в регистр "ТоварыВБроне" добавить измерение Партия, затем в обработчике нужно записывать в этот регистр в поле Партия ссылку на текущий документ бронирования и в запросе также получать это поле Партия.</p>
    <p>А вот код обработчика проведения документа "ПродажаТоваров" нужно описать, потому что там больше изменений:</p>
    <div class="code-style">
        <pre>           
            <span class="светло_синий">Процедура ОбработкаПроведения(Отказ, РежимПроведения) 
                Движения.ОстаткиТоваров.Записывать = Истина;
                Движения.ТоварыВБроне.Записывать = Истина;


                <span class="зелёный">//блокировка записей в таблице ОстаткиТоваров</span>
                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить(<span class="серый">"РегистрНакопления.ОстаткиТоваров"</span>);
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
                ДанныеБлокировки = Товары.Выгрузить(, <span class="серый">"Товар"</span>);
                ЭлементБлокировки.ИсточникДанных = ДанныеБлокировки;
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="серый">"Товар"</span>, <span class="серый">"Товар"</span>); 
                Блокировка.Заблокировать();


                Запрос = Новый Запрос;
                Запрос.Текст = 
                    <span class="серый">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	СУММА(ПродажаТоваровТовары.Сумма) КАК Сумма
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,  
                    |	ВТ.Сумма КАК Сумма,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеДругихКонтрагентов,
                    |	ТоварыВБронеОстатки1.Партия КАК Партия,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки1.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеНашегоКонтрагента
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар
                    |					ИЗ
                    |						ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Товар = ОстаткиТоваровОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				НЕ Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар
                    |						ИЗ
                    |							ВТ)) КАК ТоварыВБронеОстатки
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар КАК Товар
                    |						ИЗ
                    |							ВТ КАК ВТ)) КАК ТоварыВБронеОстатки1
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки1.Товар 
                    |УПОРЯДОЧИТЬ ПО
                    |	ТоварыВБронеОстатки1.Партия  
                    |ИТОГИ
                    |	МИНИМУМ(Количество),
                    |	МИНИМУМ(КоличествоОстаток),
                    |	МИНИМУМ(КоличествоОстатокВБронеДругихКонтрагентов),
                    |	МИНИМУМ(Сумма),
                    |	СУММА(КоличествоОстатокВБронеНашегоКонтрагента)
                    |ПО
                    |	Товар"</span>;
                                                            
                Запрос.УстановитьПараметр(<span class="серый">"Ссылка"</span>, Ссылка);
                Запрос.УстановитьПараметр(<span class="серый">"ДатаДокумента"</span>, Неопределено);
                Запрос.УстановитьПараметр(<span class="серый">"Контрагент"</span>, Контрагент);
                РезультатЗапроса = Запрос.Выполнить();

                Если НЕ РезультатЗапроса.Пустой() Тогда
                    ВыборкаГруппировки = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
                    
                    Пока ВыборкаГруппировки.Следующий() Цикл
                        СвободныйОстатокТовара = ВыборкаГруппировки.КоличествоОстаток - ВыборкаГруппировки.КоличествоОстатокВБронеДругихКонтрагентов;
                        Если ВыборкаГруппировки.Количество > СвободныйОстатокТовара Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="серый">"Не хватает товара "</span> + ВыборкаГруппировки.ТоварП + <span class="серый">" на складе "</span> + Склад + <span class="серый">" в количество "</span>
                                                + (ВыборкаГруппировки.Количество - СвободныйОстатокТовара);
                            СообщениеП.Сообщить();
                            
                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;
                        
                        <span class="зелёный">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество = ВыборкаГруппировки.Количество;
                        ВыборкаДетальныхИзГруппы = ВыборкаГруппировки.Выбрать();			
                        Пока ВыборкаДетальныхИзГруппы.Следующий() Цикл 
                            Если СписываемоеКоличество > 0 Тогда
                                Движение = Движения.ТоварыВБроне.Добавить();
                                Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                                Движение.Период = Дата;
                                Движение.Товар = ВыборкаДетальныхИзГруппы.Товар;
                                Движение.Контрагент = Контрагент; 
                                Движение.Партия = ВыборкаДетальныхИзГруппы.Партия;	            
                                Если СписываемоеКоличество &LT;= ВыборкаДетальныхИзГруппы.КоличествоОстатокВБронеНашегоКонтрагента Тогда
                                    Движение.Количество = СписываемоеКоличество;
                                    СписываемоеКоличество = СписываемоеКоличество - СписываемоеКоличество;
                                Иначе
                                    Движение.Количество = ВыборкаДетальныхИзГруппы.КоличествоОстатокВБронеНашегоКонтрагента;
                                    СписываемоеКоличество = СписываемоеКоличество - ВыборкаДетальныхИзГруппы.КоличествоОстатокВБронеНашегоКонтрагента;
                                КонецЕсли;
                            Иначе
                                Прервать;
                            КонецЕсли;	
                        КонецЦикла;


                        Движение = Движения.ОстаткиТоваров.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Товар = ВыборкаГруппировки.Товар;
                        Движение.Количество = ВыборкаГруппировки.Количество;	
                    КонецЦикла;
                КонецЕсли;  
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Теперь у нас покупатель может взять меньше из резерва, а остальное из брони можно списать документом "СнятиеБрони". Документ "СнятиеБрони" имеет 2 доп. реквизита - "Покупатель" и "ДокументБронирования". Документ "СнятиеБрони" может списать с указанного документа бронирования или если не указать никаких ссылок на документ бронирования, то списываются все брони для указанного покупателя. Вот обработчик проведения документа "СнятиеБрони":</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Процедура ОбработкаПроведения(Отказ, РежимПроведения)
                Если ЗначениеЗаполнено(ДокументБронирования) Тогда
                    НаборЗаписей = РегистрыНакопления.ТоварыВБроне.СоздатьНаборЗаписей();
                    НаборЗаписей.Отбор.Регистратор.Установить(ДокументБронирования);
                    НаборЗаписей.Очистить();
                    НаборЗаписей.Записать();
                Иначе
                    Запрос = Новый Запрос;
                    Запрос.Текст = 
                        <span class="серый">"ВЫБРАТЬ
                        |	ТоварыВБроне.Регистратор КАК Регистратор
                        |ИЗ
                        |	РегистрНакопления.ТоварыВБроне КАК ТоварыВБроне
                        |ГДЕ
                        |	ТоварыВБроне.Контрагент = &Контрагент"</span>;
                    
                    Запрос.УстановитьПараметр(<span class="серый">"Контрагент"</span>, Контрагент);
                    РезультатЗапроса = Запрос.Выполнить();
                    Выборка = РезультатЗапроса.Выбрать();
                    
                    Пока Выборка.Следующий() Цикл
                        НаборЗаписей = РегистрыНакопления.ТоварыВБроне.СоздатьНаборЗаписей();
                        НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор);
                        НаборЗаписей.Очистить();
                        НаборЗаписей.Записать();	
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span>
        </pre>
    </div>

    <p class="title-size16"><b id="document21">(Курс Чистова 8.3) Контроль остатков и расчёт себестоимости по средней. Новая методика.</b></p>
    <p>Тут опишу последнее видение Чистова о том как правильно писать код для обработки проведения документа продажи товаров. Это минимальный шаблон кода. Описание кода находится в комментариях. Тут также будут вставки от Ильи Леонтьева, если будет что добавить из кода или объяснений, вставки фиолетового цвета.</p>
    <p>Но, как говорят, новую методику использут реже, потому что её нужно использовать когда для записи движения достаточно данных из документа и его таб. частей. Что имеется ввиду? Например, мы записываем в движения запись с датой, товаров и количеством. Эти данные есть в документе. Всё вот тут и можно использовать новую методику. Но если для записи данных не хватает и нужно дополнительно в коде что то вычислять, например, себестоимость или ещё что-то(при этом лезем в БД), то это повод для использования старой методики, потому что уж если мы лезем в БД для вычисления чего то, то смысл уже пропадает в новой методике.</p>
    <p>Да тут ниже в коде мы используем вычисление себестоимости, но используем новую методику. Ну тут думаю Чистов просто хотел показать вообще как выглядит эта методика.</p>
    <div class="code-style">
        <pre>
            --модуль объекта, процедура "ОбработкаПроведения" документа "РасходнаяНакладная"

            <span class="зелёный">//тут Чистов делает проверку остатков товара немного другим способом
            //мы сразу записываем в регистр товары, которые хотим продать, блокируем регистр,
            //затем делаем запрос в регистр и получаем остатки наших товаров,
            //у которых есть остаток в минусе. Если есть такие товары с минусом
            //то мы отказываемся от транзакции записи, т.е. записи из регистра
            //система сама удалит и также удалит записи документа из БД
            //Как утверждает Чистов, то такой способ проверки остатков
            //более быстродейственнее, из-за того, что мы сначала всё записали
            //и только потом проверили есть ли отрицательные остатки. 
            //В другом способе, он описан в курсе 8.2, мы сначала сразу начинаем
            //проверять остатки и только потом записываем.</span>
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> Режим<span class="светло_красный">)</span>
                Движения<span class="светло_красный">.</span>Взаиморасчеты<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span> 
                Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span> 

                <span class="зелёный">//регистр Взаиморасчеты Приход</span>
                Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>Взаиморасчеты<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Приход<span class="светло_красный">;</span>
                Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                Движение<span class="светло_красный">.</span>Контрагент <span class="светло_красный">=</span> Контрагент<span class="светло_красный">;</span>
                Движение<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> СуммаИтого<span class="светло_красный">;</span>

                <span class="зелёный">//Итак, сначала записываем товары в регистр остатков товаров, но
                //для начала нам нужно свернуть повторяющиеся товары из табличной части.
                //Можно свернуть двумя способами:</span>
                
                <span class="зелёный">////Это первый способ как получить и свернуть одинаковые товары
                ////В первом параметре указываем колонки для свёртывания, во втором 
                ////параметре колонки для суммирования. Колонки которые мы не указали
                ////не войдут в новую свёрнутую таблицу.
                //ТЗ = Товары.Выгрузить();
                //ТЗ.Свернуть("Товар", "Количество"); 


                //Это второй способ получить и свернуть товары, через запрос 
                //Что быстрее работает, через запрос или через ТЗ не знаю
                //В этом запросе мы поместим результат во временную таблицу
                //и сразу получим из неё данные. Временная таблица нужна будет
                //для другого запроса ниже, для отбора товаров из таблицы остатков 
                //Чтобы временная таблица сохранилась в памяти, нужно создать объект
                //менеджера временных таблиц и он сам всё сделает
                //Использование временных таблиц будет оправдано, если нам
                //она будет нужна несколько раз. Если же используем один раз,
                //то во вложенном запросе ниже можно и сразу получить товары из документа,
                //потому что для временной таблицы нужно построить в базе саму эту таблицу,
                //а это затраты ресурсов. В этой процедуре мы используем раза 2 обращение
                //к временной таблице в рваных запросах 
                //Кстати!!! Вот так можно посмотреть что лежит во временной таблице
                //Запрос.МенеджерВременныхТаблиц.Таблицы[0].ПолучитьДанные().Выгрузить();</span>
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>МенеджерВременныхТаблиц <span class="светло_красный">=</span> Новый МенеджерВременныхТаблиц<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"
                    |ВЫБРАТЬ
                    |	РасходнаяНакладнаяТовары.Товар КАК Товар,
                    |	СУММА(РасходнаяНакладнаяТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.РасходнаяНакладная.Товары КАК РасходнаяНакладнаяТовары
                    |ГДЕ
                    |	РасходнаяНакладнаяТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	РасходнаяНакладнаяТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество
                    |ИЗ
                    |	ВТ КАК ВТ"</span><span class="светло_красный">;</span>

                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Ссылка"</span><span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>

                <span class="зелёный">//После того как мы получили либо таблицу значений, 
                //либо выборку со свёртнутыми товарами, мы записываем эти товары в регистр
                </span>

                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                    <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span> 
                        <span class="зелёный">// регистр ОстаткиТоваров Приход</span>
                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">; 
                    КонецЦикла;
                КонецЕсли;</span> 
                
                <span class="зелёный">//Блокировка будет проведена платформой самостоятельно при вызове метода Движения.Записать(), 
                //но нам нужно ещё и заблокировать разделение итогов, чтобы документы расходные в очередь встали
                //при попытке записать в итоги, а не паралельно писали с нами, поэтому и указываем флаг 
                //"БлокироватьДляИзменения" в Истина. Это свойство указывает на блокировку записей в итоги, а не
                //на блокировку записей в регистр
                //В старой методике почему мы описывали управляемую блокировку, потому что там мы не вызывали метод Записать(),
                //который самостоятельно блокирует записи в таблице регистра. Тогда вопрос, как мы в старой методике 
                //блокировали запись в итоги? Или управляемая блокировка сама этим занималась?</span>
                Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>БлокироватьДляИзменения <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                
                <span class="зелёный">//Когда мы указываем вот так записать, то происходит запись наборов записей во
                //все регистры подчинённые данному документу. И запись произойдёт только
                //если для этих наборов установлен флаг Записывать в Истина
                //Например, для такой строки - Движения.ОстаткиТоваров.Записать() флаг можно в истину не ставить 
                //После записи флаг опять у всех регистров сбрасывается в Ложь
                //Для регистра ОстаткиСебестоимостиТоваров выше не указано Записывать = Истина, поэтому
                //этот регистр не будет очищен от старых записей. Мы очищаем ниже.</span>      
                Движения<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span>
                
                <span class="зелёный">//выше мы записали сразу в регистр количество товаров, которые хотим продать
                //и теперь в запросе получаем из него остатки, которые ушли в минус
                //если такие есть, то документ не проводим
                //Этот запрос мы не инициализируем как новый объект, а продолжаем использовать
                //старый, созданный выше, меняем только текст запроса. Выше в запросе у нас есть сохранённая временная
                //таблица благодаря менеджеру временных таблиц,
                //а значит мы можем к ней обратиться в новом тексте запроса.</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ	
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Товар) КАК ТоварП,
                    |	ОстаткиТоваровОстатки.КоличествоОстаток КАК КоличествоОстаток
                    |ИЗ
                    |	РегистрНакопления.ОстаткиТоваров.Остатки(
                    |			&МоментВремени,
                    |			Склад = &Склад И 
                    |			Товар В
                    |				(ВЫБРАТЬ
                    |					ВТ.Товар КАК Товар
                    |				ИЗ
                    |					ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки 
                    |ГДЕ
                    |	ОстаткиТоваровОстатки.КоличествоОстаток &lt; 0"</span><span class="светло_красный">;</span>
                
                <span class="зелёный">//это то же самое, что прибавить 1 секунду к дате, чтобы данные текущего документа
                //уже учитывались при расчёте остатков
                //если задать просто МоментВремени(), то вернутся остатки до влияния текущего
                //документа на них</span> 
                Граница <span class="светло_красный">= Новый</span> Граница<span class="светло_красный">(</span>МоментВремени<span class="светло_красный">(),</span> ВидГраницы<span class="светло_красный">.</span>Включая<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"МоментВремени"</span><span class="светло_красный">,</span> Граница<span class="светло_красный">);</span>	
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>
                <span class="зелёный">//в условии виртуальной таблицы Остатки выше мы отбираем те товары
                //которые есть в табличной части документа -> Товары В (Вложенный запрос)
                //Но можно сделать и без вложенного запроса -> Товары В (&МассивТоваров)
                //нам нужен массив товаров для параметра. Мы можем получить такой массив вот так:
                //Запрос.УстановитьПараметр("МассивТоваров", Товары.ВыгрузитьКолонку("Товар"));	</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                
                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                
                    <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                        СообщениеП <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                        СообщениеП<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Не хватает товара "</span> <span class="светло_красный">+</span> Выборка.ТоварП <span class="светло_красный">+</span> <span class="серый">" в количестве "</span> <span class="светло_красный">+ (-</span>Выборка<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">);</span>
                        СообщениеП<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();
                    КонецЦикла;</span>
                    Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                КонецЕсли;</span>

                <span class="фиолетовый">-----------------------------------------------------------------------------------</span>
                <span class="фиолетовый">Новая методика была описана выше до этого мига, дальше идёт запись в другой регистр</span>

                <span class="светло_красный">Если</span> Отказ <span class="светло_красный">Тогда
                    Возврат;
                КонецЕсли;</span> 

                	
                                    

                <span class="зелёный">//следующий пакет запроса. Здесь мы уже получаем данные из ВТ и 
                //вирт. таб. ОстаткиСебестоимостиТоваров.Остатки, чтобы была
                //возможность заполнить расходные движения регистра ОстаткиСебестоимостиТоваров, 
                //а именно нужны данные для вычисления себестоимости по средней
                //в запросе мы к временной таблице присоединяем таблицу остатков
                //поэтому в таблице остатков может не быть каких то записей и система
                //там проставит NULL. В данном случае не надо всем числовым полям таблице с остатками, ставить
                //проверку ЕСТЬNULL(), хватит одному полю, которое мы будем проверять в цикле,
                //потому что функция ЕСТЬNULL() довольно медленная и не нужно всем подряд полям её ставить
                //Вот мы в цикле выбрали проверку поля КоличествоОстаток на равенство 0, всё этого поля нам хватит  
                //БЛОКИРОВКА. Заблокировать набор записей в регистре  ОстаткиСебестоимостиТоваров для текущего документа
                //уже не получится так как было выше одной строкой, потому что у нас нет записей для этого документа в регистре
                //мы запрашиваем записи из регистра чужих документов. Поэтому придётся самим описать блокировку.</span>

                Блокировка <span class="светло_красный">= Новый</span> БлокировкаДанных<span class="светло_красный">;</span>
                ЭлементБлокировки <span class="светло_красный">=</span> Блокировка<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"РегистрНакопления.ОстаткиСебестоимостиТоваров"<span class="светло_красный"></span>);</span>
                ЭлементБлокировки<span class="светло_красный">.</span>Режим <span class="светло_красный">=</span> РежимБлокировкиДанных<span class="светло_красный">.</span>Исключительный<span class="светло_красный">;</span> 
                <span class="зелёный">//дальше нужно указать источник данных, по данным которого будем ставить блокировку
                //У нас есть измерение Товар, нам нужно знать по каким товарам заблокировать записи
                //Товары у нас хранятся в табличной части Товары</span>
                ЭлементБлокировки<span class="светло_красный">.</span>ИсточникДанных <span class="светло_красный">=</span> Товары<span class="светло_красный">;</span>
                <span class="зелёный">//Дальше в методе первый параметр это измерение регистра по которому будем делать отбор, указываем "Товар"
                //второй параметр это поле табличной части Товары, данные этого поля это значение для отбора
                //Например, выбрать запись где измерение Товар = "Ложка", Товар = "Вилка"    
                //В результате мы установим блокировку на записи в регистре с товарами равными товарам из табличной части</span>
                ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Товар"</span><span class="светло_красный">,</span> <span class="серый">"Товар"</span><span class="светло_красный">);</span>
                Блокировка<span class="светло_красный">.</span>Заблокировать<span class="светло_красный">();</span>    


                <span class="зелёный">//если мы документ перепроводим, то у нас есть старые записи для этого документа
                //и способ выше их не заблокирует, поэтому тут можно применить строку с блокировкой.
                //Этот момент не понял. Ну если мы перепроводим, то у нас способ выше заблокирует
                //записи с товарами из табличной части, старые записи будут содержать такие же товары
                //значит должны заблокироваться, а если мы изменили товары в табличной части, то
                //зачем нам тогда блокировать старые? Короче пока не понятно. Понятно то, что
                //кроме блокировки старых записей ещё будет отключено разделение итогов.
                //А разделение итогов нужно отключать если проводятся документы продажи товаров </span>
                Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>БлокироватьДляИзменения <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span>	

                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество,
                    |	ЕСТЬNULL(ОстаткиСебестоимостиТоваров.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ОстаткиСебестоимостиТоваров.СебестоимостьОстаток КАК СебестоимостьОстаток
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиСебестоимостиТоваров.Остатки(
                    |				&МоментВремени,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиСебестоимостиТоваров
                    |		ПО ВТ.Товар = ОстаткиСебестоимостиТоваров.Товар"</span><span class="светло_красный">;</span>
                
                <span class="зелёный">//если документ будет перепроводится, то нам нужны остатки до влияния
                //этого документа на остатки, поэтому и параметр МоментВремени()</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"МоментВремени"</span><span class="светло_красный">,</span> МоментВремени<span class="светло_красный">());</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>

                
                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                
                    <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span> 
                        <span class="зелёный">//так как деление на 0 это ошибка, поэтому проверяем это поле
                        //Если это поле будет равно 0, значит записей в регистре нет для данного товара
                        //значит останавливаем проведение документа</span>
                        <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">=</span> 0 <span class="светло_красный">Тогда</span>
                            <span class="зелёный">//Почему такое сообщение, что есть расхождения?
                            //Выше есть запрос к остаткам товаров на складе и если мы дошли до
                            //этого кода, то остатки на складе были, ну а если мы зашли в эту проверку
                            //то остаков себестоимости по этому товару нет. Значит получилось
                            //так, что есть расхождения в остатках в этих двух регистрах</span>
                            Сообщить<span class="светло_красный">(</span><span class="серый">"Остаток себестоимости не совпадает с остатками на складе"</span><span class="светло_красный">);</span>
                            Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                            Возврат;	
                        КонецЕсли;</span>

                        <span class="зелёный">// регистр ОстаткиСебестоимостиТоваров Приход</span>
                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>

                        <span class="зелёный">//вот такая формула нахождения себестоимости из-за проблем округления может оставить копейки в остатках	
                        //Движение.Себестоимость = (Выборка.СебестоимостьОбщ / Выборка.КоличествоОбщ) * Выборка.Количество;
                
                        //а вот такая формула будет без остатков копеек, так обещает Чистов</span>
                        Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество <span class="светло_красный">/</span> Выборка<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">*</span> Выборка<span class="светло_красный">.</span>СебестоимостьОстаток<span class="светло_красный">;	
                    КонецЦикла;
                КонецЕсли;</span>
            
                <span class="зелёный">//если выше буду очищать набор записей для этого регистра, то
                //запись снимает флаг Записывать в ложь, поэтому внизу мы 
                //разместили эту инструкцию, чтобы флаг снова стал Истина и 
                //новый движения записались в регистр</span>
                Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;   
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document22">(Курс Чистова 8.3) Партионный учёт, продажа товара и списание себестоимости методом <b>ФИФО</b>.</b></p>
    <div class="code-style">
        <pre>
            --модуль объекта, процедура "ОбработкаПроведения" документа "РасходнаяНакладная"

            <span class="зелёный">//тут Чистов делает проверку остатков товара немного другим способом
            //мы сразу записываем в регистр товары, которые хотим продать, блокируем регистр,
            //затем делаем запрос в регистр и получаем остатки наших товаров,
            //у которых есть остаток в минусе. Если есть такие товары с минусом
            //то мы отказываемся от транзакции записи, т.е. записи из регистра
            //система сама удалит и также удалит записи документа из БД
            //Как утверждает Чистов, то такой способ проверки остатков
            //более быстродейственнее, из-за того, что мы сначала всё записали
            //и только потом проверили есть ли отрицательные остатки. 
            //В другом способе, он описан в курсе 8.2, мы сначала сразу начинаем
            //проверять остатки и только потом записываем.</span>
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения<span class="светло_красный">(</span>Отказ<span class="светло_красный">,</span> Режим<span class="светло_красный">)</span>
                Движения<span class="светло_красный">.</span>Взаиморасчеты<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span> 
                Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span> 

                <span class="зелёный">//регистр Взаиморасчеты Приход</span>
                Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>Взаиморасчеты<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span> 
                Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Приход<span class="светло_красный">;</span>
                Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                Движение<span class="светло_красный">.</span>Контрагент <span class="светло_красный">=</span> Контрагент<span class="светло_красный">;</span>
                Движение<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> СуммаИтого<span class="светло_красный">;</span>
                
                <span class="зелёный">////Это первый способ как получить и свернуть одинаковые товары
                ////В первом параметре указываем колонки для свёртывания, во втором 
                ////параметре колонки для суммирования. Колонки которые мы не указали
                ////не войдут в новую свёрнутую таблицу.
                //ТЗ = Товары.Выгрузить();
                //ТЗ.Свернуть("Товар", "Количество"); 


                //Это второй способ получить и свернуть товары, через запрос 
                //Что быстрее работает, через запрос или через ТЗ не известно
                //Нужно будет проверить
                //В этом запросе мы поместим результат во временную таблицу
                //и сразу получим из неё данные. Временная таблица нужна будет
                //в запросе ниже, для отбора товаров из таблицы остатков 
                //Чтобы временная таблица сохранилась в памяти, нужно создать объект
                //менеджера временных таблиц и он сам всё сделает
                //Использование временных таблиц будет оправдано, если нам
                //она будет нужна несколько раз. Если же используем один раз,
                //то во вложенном запросе ниже можно и сразу получить товары из документа,
                //потому что для временной таблицы нужно построить в базе саму эту таблицу,
                //а это затраты ресурсов. В этой процедуре мы используем раза 2 обращение
                //к временной таблице в рваных запросах 
                //Кстати!!! Вот так можно посмотреть что лежит во временной таблице
                //Запрос.МенеджерВременныхТаблиц.Таблицы[0].ПолучитьДанные().Выгрузить();</span>
                Запрос <span class="светло_красный">= Новый</span> Запрос<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>МенеджерВременныхТаблиц <span class="светло_красный">=</span> Новый МенеджерВременныхТаблиц<span class="светло_красный">;</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"
                    |ВЫБРАТЬ
                    |	РасходнаяНакладнаяТовары.Товар КАК Товар,
                    |	СУММА(РасходнаяНакладнаяТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.РасходнаяНакладная.Товары КАК РасходнаяНакладнаяТовары
                    |ГДЕ
                    |	РасходнаяНакладнаяТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	РасходнаяНакладнаяТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество
                    |ИЗ
                    |	ВТ КАК ВТ"</span><span class="светло_красный">;</span>

                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Ссылка"</span><span class="светло_красный">,</span> Ссылка<span class="светло_красный">);</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>

                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                    <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span> 
                        <span class="зелёный">// регистр ОстаткиТоваров Приход</span>
                        Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                        Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Склад <span class="светло_красный">=</span> Склад<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                        Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> Выборка<span class="светло_красный">.</span>Количество<span class="светло_красный">; 
                    КонецЦикла;
                КонецЕсли;</span> 
                
                <span class="зелёный">//вот так выглядит блокировка набора записей регистра с остатками именно
                //тех товаров, которые мы тут пытаемся получить. Как я понял
                //вся таблица регистра не блокируется. Заблокируются те записи,
                //у которых в измерениях Товар и Склад будет то же что и у набора
                //записей, который мы записали выше. Например, если мы продаём Ложки со склада Основной,
                //то в регистре заблокируются все записи приходные и расходные
                //где есть Товар Ложки со Складом - Основной 
                //Теперь никто не сможет прочитать остатки по нашим товарам до конца транзакции
                //Эта инструкция ещё не сама блокировка, а указание, что нужно будет заблокировать.
                //Блокировка наступит в миг когда произойдёт запись движений в регистр.
                //Эта инструкция также запретит разделение итогов, таким образом документ
                //приходования товаров не сможет записать такие же товары в итоги, будет ждать в очереди
                //Что такое разделение итогов можно посмотреть в шпоре по  словам "ключевые итоги".
                //Эта инструкция блокировки работает, когда
                //набор записей уже записан в регистр. Они записаны и мы можем
                //заблокировать все записи по измерениям из этого набора записей.
                //Если нужно блокировать записи, а набор записей ещё не записан в регистр, 
                //то нужно использовать класс "БлокировкаДанных"</span>
                Движения<span class="светло_красный">.</span>ОстаткиТоваров<span class="светло_красный">.</span>БлокироватьДляИзменения <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                
                <span class="зелёный">//Когда мы указываем вот так записать, то происходит запись наборов записей во
                //все регистры подчинённые данному документу. И запись произойдёт только
                //если для этих наборов установлен флаг Записывать в Истина
                //Например, для такой строки - Движения.ОстаткиТоваров.Записать() флаг можно в истину не ставить </span>      
                Движения<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span>
                
                <span class="зелёный">//выше мы записали сразу в регистр количество товаров, которые хотим продать
                //и теперь в запросе получаем из него остатки, которые ушли в минус
                //если такие есть, то документ не проводим
                //Этот запрос мы не инициализируем как новый объект, а продолжаем использовать
                //старый, созданный выше, меняем только текст запроса. Выше в запросе мы помещали
                //результат во временную таблицу и сейчас у нас в памяти висит эта временная таблица,
                //благодаря менеджеру временных таблиц,
                //а значит мы можем к ней обратиться в новом тексте запроса.</span>
                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ	
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Товар) КАК ТоварП,
                    |	ОстаткиТоваровОстатки.КоличествоОстаток КАК КоличествоОстаток
                    |ИЗ
                    |	РегистрНакопления.ОстаткиТоваров.Остатки(
                    |			&МоментВремени,
                    |			Склад = &Склад И 
                    |			Товар В
                    |				(ВЫБРАТЬ
                    |					ВТ.Товар КАК Товар
                    |				ИЗ
                    |					ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки 
                    |ГДЕ
                    |	ОстаткиТоваровОстатки.КоличествоОстаток &lt; 0"</span><span class="светло_красный">;</span>
                
                <span class="зелёный">//это то же самое, что прибавить 1 секунду к дате, чтобы данные текущего документа
                //уже учитывались при расчёте остатков
                //если задать просто МоментВремени(), то вернутся остатки до влияния текущего
                //документа на них</span> 
                Граница <span class="светло_красный">= Новый</span> Граница<span class="светло_красный">(</span>МоментВремени<span class="светло_красный">(),</span> ВидГраницы<span class="светло_красный">.</span>Включая<span class="светло_красный">);</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"МоментВремени"</span><span class="светло_красный">,</span> Граница<span class="светло_красный">);</span>	
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"Склад"</span><span class="светло_красный">,</span> Склад<span class="светло_красный">);</span>
                <span class="зелёный">//в условии виртуальной таблицы Остатки выше мы отбираем те товары
                //которые есть в табличной части документа -> Товары В (Вложенный запрос)
                //Но можно сделать и без вложенного запроса -> Товары В (&МассивТоваров)
                //нам нужен массив товаров для параметра. Мы можем получить такой массив вот так:
                //Запрос.УстановитьПараметр("МассивТоваров", Товары.ВыгрузитьКолонку("Товар"));	</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>
                
                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    Выборка <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                
                    <span class="светло_красный">Пока</span> Выборка<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span>
                        СообщениеП <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                        СообщениеП<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Не хватает товара "</span> <span class="светло_красный">+</span> Выборка.ТоварП <span class="светло_красный">+</span> <span class="серый">" в количестве "</span> <span class="светло_красный">+ (-</span>Выборка<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">);</span>
                        СообщениеП<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();
                    КонецЦикла;</span>
                    Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                КонецЕсли;</span>

                <span class="светло_красный">Если</span> Отказ <span class="светло_красный">Тогда
                    Возврат;
                КонецЕсли;</span> 

                <span class="зелёный">//Объясняю!!! У Чистова при оперативном проведении(на текущую дату) документа
                //всё хорошо, но стоит только перепровести документ, как система ставит новую
                //дату документа, точнее время и происходит попытка новой записи движений в регистре
                //потому что дата другая, отличается от той что раньше была записана, а значит
                //предыдущий набор записей в регистре не удаляется. Получается, что при оперативном
                //перепроведении всё время пишутся новые наборы записей и товары уменьшаются.
                //По этой причине нам нужно определить, режим проведения оперативный? Если да
                //то запишем пустой набор записей в регистр для данного документа, таким образом
                //удалятся старые движения
                //У себя я такой проблемы не заметил, у меня при оперативном перепроведении 
                //движения перезаписываются системой сами, может разработчики исправили.
                //Поэтом закоментирую пока у себя эту проверку, посмотрим как это скажется
            
                //Если Режим = РежимПроведенияДокумента.Оперативный Тогда
                //	Движения.ОстаткиСебестоимостиТоваров.Записать();		
                //КонецЕсли;
                                        


                //следующий пакет запроса. Здесь мы уже получаем данные из ВТ и 
                //вирт. таб. ОстаткиСебестоимостиТоваров.Остатки, чтобы была
                //возможность заполнить расходные движения регистра ОстаткиСебестоимостиТоваров, 
                //а именно нужны данные для вычисления себестоимости по средней
                //в запросе мы к временной таблице присоединяем таблицу остатков
                //поэтому в таблице остатков может не быть каких то записей и система
                //там проставит NULL. В данном случае не надо всем числовым полям таблице с остатками, ставить
                //проверку ЕСТЬNULL(), хватит одному полю, которое мы будем проверять в цикле,
                //потому что функция ЕСТЬNULL() довольно медленная и не нужно всем подряд полям её ставить
                //Вот мы в цикле выбрали проверку поля КоличествоОстаток на равенство 0, всё этого поля нам хватит  
                //БЛОКИРОВКА. Заблокировать набор записей в регистре  ОстаткиСебестоимостиТоваров для текущего документа
                //уже не получится так как было выше одной строкой, потому что у нас нет записей для этого документа в регистре
                //мы запрашиваем записи из регистра чужих документов. Поэтому придётся самим описать блокировку.</span>

                Блокировка <span class="светло_красный">= Новый</span> БлокировкаДанных<span class="светло_красный">;</span>
                ЭлементБлокировки <span class="светло_красный">=</span> Блокировка<span class="светло_красный">.</span>Добавить<span class="светло_красный">(</span><span class="серый">"РегистрНакопления.ОстаткиСебестоимостиТоваров"<span class="светло_красный"></span>);</span>
                ЭлементБлокировки<span class="светло_красный">.</span>Режим <span class="светло_красный">=</span> РежимБлокировкиДанных<span class="светло_красный">.</span>Исключительный<span class="светло_красный">;</span> 
                <span class="зелёный">//дальше нужно указать источник данных, по данным которого будем ставить блокировку
                //У нас есть измерение Товар, нам нужно знать по каким товарам заблокировать записи
                //Товары у нас хранятся в табличной части Товары</span>
                ЭлементБлокировки<span class="светло_красный">.</span>ИсточникДанных <span class="светло_красный">=</span> Товары<span class="светло_красный">;</span>
                <span class="зелёный">//Дальше в методе первый параметр это измерение регистра по которому будем делать отбор, указываем "Товар"
                //второй параметр это поле табличной части Товары, данные этого поля это значение для отбора
                //Например, выбрать запись где измерение Товар = "Ложка", Товар = "Вилка"    
                //В результате мы установим блокировку на записи в регистре с товарами равными товарам из табличной части</span>
                ЭлементБлокировки<span class="светло_красный">.</span>ИспользоватьИзИсточникаДанных<span class="светло_красный">(</span><span class="серый">"Товар"</span><span class="светло_красный">,</span> <span class="серый">"Товар"</span><span class="светло_красный">);</span>
                Блокировка<span class="светло_красный">.</span>Заблокировать<span class="светло_красный">();</span>    

                <span class="зелёный">//если мы документ перепроводим, то у нас есть старые записи для этого документа
                //и способ выше их не заблокирует, поэтому тут можно применить строку с блокировкой.
                //Этот момент не понял. Ну если мы перепроводим, то у нас способ выше заблокирует
                //записи с товарами из табличной части, старые записи будут содержать такие же товары
                //значит должны заблокироваться, а если мы изменили товары в табличной части, то
                //зачем нам тогда блокировать старые? Короче пока не понятно. Понятно то, что
                //кроме блокировки старых записей ещё будет отключено разделение итогов.
                //А разделение итогов нужно отключать если проводятся документы продажи товаров </span>
                Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>БлокироватьДляИзменения <span class="светло_красный">=</span> Истина<span class="светло_красный">;</span>
                Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>Записать<span class="светло_красный">();</span>	

                Запрос<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> 
                    <span class="серый">"ВЫБРАТЬ
                        |	ВТ.Товар КАК Товар,
                        |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                        |	ВТ.Количество КАК Количество,
                        |	ОстаткиСебестоимостиТоваров.Партия КАК Партия,
                        |	ЕСТЬNULL(ОстаткиСебестоимостиТоваров.КоличествоОстаток, 0) КАК КоличествоОстаток,
                        |	ОстаткиСебестоимостиТоваров.СебестоимостьОстаток КАК СебестоимостьОстаток
                        |ИЗ
                        |	ВТ КАК ВТ
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиСебестоимостиТоваров.Остатки(
                        |				&МоментВремени,
                        |				Товар В
                        |					(ВЫБРАТЬ
                        |						ВТ.Товар КАК Товар
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиСебестоимостиТоваров
                        |		ПО ВТ.Товар = ОстаткиСебестоимостиТоваров.Товар
                        |
                        |УПОРЯДОЧИТЬ ПО
                        |	ОстаткиСебестоимостиТоваров.Партия.МоментВремени,
                        |	ОстаткиСебестоимостиТоваров.Товар.Наименование
                        |ИТОГИ
                        |	МИНИМУМ(Количество),
                        |	СУММА(КоличествоОстаток)
                        |ПО
                        |	Товар"</span><span class="светло_красный">;</span>
                
                <span class="зелёный">//если документ будет перепроводится, то нам нужны остатки до влияния
                //этого документа на остатки, поэтому и параметр МоментВремени()</span>
                Запрос<span class="светло_красный">.</span>УстановитьПараметр<span class="светло_красный">(</span><span class="серый">"МоментВремени"</span><span class="светло_красный">,</span> МоментВремени<span class="светло_красный">());</span>
                РезультатЗапроса <span class="светло_красный">=</span> Запрос<span class="светло_красный">.</span>Выполнить<span class="светло_красный">();</span>

                
                <span class="светло_красный">Если НЕ</span> РезультатЗапроса<span class="светло_красный">.</span>Пустой<span class="светло_красный">() Тогда</span>
                    ВыборкаИтогов <span class="светло_красный">=</span> РезультатЗапроса<span class="светло_красный">.</span>Выбрать<span class="светло_красный">(</span>ОбходРезультатаЗапроса<span class="светло_красный">.</span>ПоГруппировкам<span class="светло_красный">);</span>
        
                    <span class="светло_красный">Пока</span> ВыборкаИтогов<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл </span>
                        <span class="зелёный">//так как деление на 0 это ошибка, поэтому проверяем это поле
                        //Если это поле будет равно 0, значит записей в регистре нет для данного товара
                        //значит останавливаем проведение документа</span>
                        <span class="светло_красный">Если</span> Выборка<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">=</span> 0 <span class="светло_красный">Тогда</span>
                            <span class="зелёный">//Почему такое сообщение, что есть расхождения?
                            //Выше есть запрос к остаткам товаров на складе и если мы дошли до
                            //этого кода, то остатки на складе были, ну а если мы зашли в эту проверку
                            //то остаков себестоимости по этому товару нет. Значит получилось
                            //так, что есть расхождения в остатках в этих двух регистрах</span>
                            Сообщить<span class="светло_красный">(</span><span class="серый">"Остаток себестоимости не совпадает с остатками на складе"</span><span class="светло_красный">);</span>
                            Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                            Возврат;	
                        КонецЕсли;</span>
            
                        <span class="светло_красный">Если</span> ВыборкаИтогов<span class="светло_красный">.</span>Количество <span class="светло_красный">></span> ВыборкаИтогов<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">Тогда</span>
                            СообщениеП <span class="светло_красный">= Новый</span> СообщениеПользователю<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Текст <span class="светло_красный">=</span> <span class="серый">"Не хватает товара "</span> <span class="светло_красный">+</span> ВыборкаИтогов<span class="светло_красный">.</span>ТоварП<span class="светло_красный">;</span>
                            СообщениеП<span class="светло_красный">.</span>Сообщить<span class="светло_красный">();</span>
            
                            Отказ <span class="светло_красный">=</span> Истина<span class="светло_красный">;
                            Продолжить;
                        КонецЕсли;</span>
            
                        <span class="зелёный">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество <span class="светло_красный">=</span> ВыборкаИтогов<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                        
                        <span class="зелёный">//из текущей записи верхнего уровня с итогами выбираем его детальные записи</span>
                        ВыборкаДетальных <span class="светло_красный">=</span> ВыборкаИтогов<span class="светло_красный">.</span>Выбрать<span class="светло_красный">();</span>
                        <span class="светло_красный">Пока</span> ВыборкаДетальных<span class="светло_красный">.</span>Следующий<span class="светло_красный">() Цикл</span> 
                            <span class="зелёный">//если есть что списывать, то идём внутрь. Если у нас партии упорядочены по возрастанию, 
                            //то вот здесь и начинается списание и вычисление себестоимости по методу ФИФО </span>
                            <span class="светло_красный">Если</span> СписываемоеКоличество <span class="светло_красный">></span> 0 <span class="светло_красный">Тогда</span>
                                <span class="зелёный">// регистр ОстаткиСебестоимостиТоваров Приход</span>
                                Движение <span class="светло_красный">=</span> Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                                Движение<span class="светло_красный">.</span>ВидДвижения <span class="светло_красный">=</span> ВидДвиженияНакопления<span class="светло_красный">.</span>Расход<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Период <span class="светло_красный">=</span> Дата<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                                Движение<span class="светло_красный">.</span>Партия <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>Партия<span class="светло_красный">;</span>
                            
                                <span class="светло_красный">Если</span> СписываемоеКоличество <span class="светло_красный">&lt;=</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">Тогда</span>
                                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> СписываемоеКоличество<span class="светло_красный">;</span>
                                    Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> СписываемоеКоличество <span class="светло_красный">/</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоОстаток <span class="светло_красный">*</span> ВыборкаДетальных<span class="светло_красный">.</span>СебестоимостьОстаток<span class="светло_красный">;</span>
                                    СписываемоеКоличество <span class="светло_красный">=</span> СписываемоеКоличество <span class="светло_красный">-</span> СписываемоеКоличество<span class="светло_красный">;
                                Иначе</span>
                                    Движение<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">;</span>
                                    Движение<span class="светло_красный">.</span>Себестоимость <span class="светло_красный">=</span> ВыборкаДетальных<span class="светло_красный">.</span>СебестоимостьОстаток<span class="светло_красный">;</span>
                                    СписываемоеКоличество <span class="светло_красный">=</span> СписываемоеКоличество <span class="светло_красный">-</span> ВыборкаДетальных<span class="светло_красный">.</span>КоличествоОстаток<span class="светло_красный">;
                                КонецЕсли;
            
                            КонецЕсли;
                        КонецЦикла; 	
                    КонецЦикла;
                КонецЕсли;</span></span>
            
                <span class="зелёный">//если выше буду очищать набор записей для этого регистра, то
                //запись снимает флаг Записывать в ложь, поэтому внизу мы 
                //разместили эту инструкцию, чтобы флаг снова стал Истина и 
                //новый движения записались в регистр</span>
                Движения<span class="светло_красный">.</span>ОстаткиСебестоимостиТоваров<span class="светло_красный">.</span>Записывать <span class="светло_красный">=</span> Истина<span class="светло_красный">;   
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document23">(Курс Чистова 8.3)Как правильно построить отчёт о продажах товара</b></p>
    <p>Мы могли бы построить отчёт на данных табличных частей документа, откуда мы бы брали Сумму(Выручка) проданного товара и на регистре накопления "ОстаткиСебестоимостиТоваров" в режиме "Остатки", из виртуальной таблицы "ОстаткиСебестоимостиТоваров.Обороты" которого брали бы данные поля "СебестоимостьРасход", но у этого способа есть минусы.</p> 
    <p>Во-первых, обращение к табличным частям документа это долго. Но это ещё не самое страшное. Пострашнее это обращение к регистру накопления, а точнее к его виртуальной таблице "Обороты". Этот регистр работает в режиме "Остатки", а мы получаем поле "СебестоимостьРасход" из виртуальной таблицы ОстаткиСебестоимостиТоваров.Обороты. Как говорит Чистов это плохо, потому что для получения такого поля регистр снова бегает по регистру движений "ОстаткиСебестоимостиТоваров" и заного подсчитывает данные для этого поля. Потому что у регистра накопления движений в режиме "Остатки" нету итоговой таблицы для хранения подсчитанных оборотовых данных, а для хранения остатков такая итоговая таблица есть. А вот в режиме "Обороты" итоговая таблица есть для оборотов, которая заранее уже содержит промежуточные итоги. Но переделывать регистр накопления работающий в режиме остатков в режим оборотов будет неправильно. Поэтому выходом тут будет построение нового регистра накопления в режиме "Оборотов". Хотя такой описанный способ получения данных для анализа может подойти где-нибудь в типовой конфигурации, когда не нужно создавать никаких новых объектов конфигурации, а можно только использовать то что имеется.</p>
    <p>В третьих, кто сказал, что в поле "СебестоимостьРасход" виртуальной таблицы оборотов всегда будет лежать именно себестоимость проданных товаров? Тут у меня есть вопросы. Чистов говорит, что могут быть разные случаи: пожар, украли, вернули и т.д.,  и из-за этого в этом поле может быть разные данные, не обязательно себестоимость проданных товаров. Тогда мне не понятны следующие точки его рассказа:</p>
    <ul class="list">
        <li>Ну вот украли, сгорел, вернули товар. И что теперь у товара пропала из-за этого себестоимость? Ну допустим украли товар, мы его наверно каким то документом списываем, но при списании мы же указываем себестоимость украденного товара. Аааа, кажется я понял, в этом поле всегда будет себестоимость товара лежать, разница в том, себестоимость какого товара? Проданного, сгоревшего, который украли, вернули и т.д. Мы то строим отчёт только по проданным товарам, а у нас в регистре могут лежать в поле "Себестоимость" себестоимость товаров, например, сгоревших и мы эти сгоревшие посчитаем, как-будто проданные. Вот про эту причину и говорил Чистов, по которой мы не можем составить правильный отчёт по продажам по данному регистру. Пока понятно, другие вопросы отпали сами.</li>
    </ul>
    <p>Итак, как выглядел бы запрос к данным по тому способу, который мы описали выше. Мы хотим построить отчёт о продаже товаров, чтобы в нём были поля с контаргентами, товарами, количеством проданных, себестоимостью проданных, выручкой, прибылью. У нас на миг создания такого отчёта есть только документы продажи и регистр накопления "ОстаткиСебестоимостиТоваров" в режиме "остатки", регистр кстати не имеет измерения Контрагенты. Из имеющихся данных можно слепить такой запрос:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">РасходнаяНакладнаяТовары</span><span class="светло_красный">.</span>Товар <span class="светло_красный">КАК</span> Товар<span class="светло_красный">,</span>
                <span class="зелёный">РасходнаяНакладнаяТовары</span><span class="светло_красный">.</span>Ссылка<span class="светло_красный">.</span>Контрагент <span class="светло_красный">КАК</span> Контрагент<span class="светло_красный">,</span>
                <span class="оранжевый">СУММА</span><span class="светло_красный">(</span><span class="зелёный">РасходнаяНакладнаяТовары</span><span class="светло_красный">.</span>Сумма<span class="светло_красный">)</span> <span class="светло_красный">КАК</span> Выручка
            <span class="светло_красный">ПОМЕСТИТЬ</span> Продажи
            <span class="светло_красный">ИЗ</span>
                Документ<span class="светло_красный">.</span>РасходнаяНакладная<span class="светло_красный">.</span>Товары <span class="светло_красный">КАК</span> <span class="зелёный">РасходнаяНакладнаяТовары</span>

            <span class="светло_красный">СГРУППИРОВАТЬ ПО</span>
                <span class="зелёный">РасходнаяНакладнаяТовары</span><span class="светло_красный">.</span>Товар<span class="светло_красный">,</span>
                <span class="зелёный">РасходнаяНакладнаяТовары</span><span class="светло_красный">.</span>Ссылка<span class="светло_красный">.</span>Контрагент
            <span class="светло_красный">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">ОстаткиСебестоимостиТоваровОбороты</span><span class="светло_красный">.</span>Товар <span class="светло_красный">КАК</span> Товар<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиСебестоимостиТоваровОбороты</span><span class="светло_красный">.</span>Регистратор<span class="светло_красный">.</span>Контрагент <span class="светло_красный">КАК</span> РегистраторКонтрагент<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиСебестоимостиТоваровОбороты</span><span class="светло_красный">.</span>КоличествоРасход <span class="светло_красный">КАК</span> КоличествоРасход<span class="светло_красный">,</span>
                <span class="зелёный">ОстаткиСебестоимостиТоваровОбороты</span><span class="светло_красный">.</span>СебестоимостьРасход <span class="светло_красный">КАК</span> СебестоимостьРасход
            <span class="светло_красный">ПОМЕСТИТЬ</span> СебестоимостьПродаж
            <span class="светло_красный">ИЗ</span>
                РегистрНакопления<span class="светло_красный">.</span>ОстаткиСебестоиомстиТоваров<span class="светло_красный">.</span>Обороты<span class="светло_красный">(, ,</span> Регистратор<span class="светло_красный">, ) КАК</span> <span class="зелёный">ОстаткиСебестоимостиТоваровОбороты</span>
            <span class="светло_красный">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="светло_красный">ВЫБРАТЬ</span>
                <span class="зелёный">Продажи</span><span class="светло_красный">.</span>Товар <span class="светло_красный">КАК</span> Товар<span class="светло_красный">,</span>
                <span class="зелёный">Продажи</span><span class="светло_красный">.</span>Контрагент <span class="светло_красный">КАК</span> Контрагент<span class="светло_красный">,</span>
                <span class="зелёный">СебестоимостьПродаж</span><span class="светло_красный">.</span>КоличествоРасход <span class="светло_красный">КАК</span> КоличествоРасход<span class="светло_красный">,</span>
                <span class="зелёный">СебестоимостьПродаж</span><span class="светло_красный">.</span>СебестоимостьРасход <span class="светло_красный">КАК</span> СебестоимостьРасход<span class="светло_красный">,</span>
                <span class="зелёный">Продажи</span><span class="светло_красный">.</span>Выручка <span class="светло_красный">КАК</span> Выручка
            <span class="светло_красный">ИЗ</span>
                Продажи <span class="светло_красный">КАК</span> <span class="зелёный">Продажи</span>
                    <span class="светло_красный">ЛЕВОЕ СОЕДИНЕНИЕ</span> СебестоимостьПродаж <span class="светло_красный">КАК</span> <span class="зелёный">СебестоимостьПродаж</span>
                    <span class="светло_красный">ПО</span> Продажи<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> СебестоимостьПродаж<span class="светло_красный">.</span>Товар
                        <span class="светло_красный">И</span> Продажи<span class="светло_красный">.</span>Контрагент <span class="светло_красный">=</span> СебестоимостьПродаж<span class="светло_красный">.</span>РегистраторКонтрагент</span>
        </pre>
    </div>
    <p>Мы можем облегчить описанный выше способ получения данных. Можно исключить табличные части документа и использовать только регистр "ОстаткиСебестоимостиТоваров". Нам станет не доступно поле выручки для отчёта, поэтому мы добавим не измерение, а доп. реквизит "СуммаПродажи" в этот регистр. Документ будет писать в этот реквизит сумму товара(выручку). Чисто технически можно в запросе получить этот реквизит и расчитать поле Прибыль, но как говорит Чистов это полный бред.</p>
    <p>Но как и было сказано, такой способ нам не подходит. Правильней сделать другой регистр для сбора данных чисто о продажах. В регистр продаж мы не будем записывать товары, с которыми случилось что-то другое кроме продажи.</p>
    <p>Создадим регистр накопления "Продажи" в режиме оборотов. У него будет 2 измерения - Контрагенты и Номенклатура, 3 ресурса - Себестоимость, Количество, Выручка. Делать движения в этом регистре будет ТОЛЬКО документ продажи товаров, документы списывающие сгоревшие, украденные или другие товары в регистр "Продажи" писать не будут, чтобы у нас был регистр по сбору только проданных товаров. В этом и отличие его от регистра ОстаткиСебестоимостиТоваров. </p>
    <div class="code-style">
        <pre> 
            --модуль объекта, процедура "ОбработкаПроведения"

            <span class="светло_синий">Процедура ОбработкаПроведения(Отказ, Режим)
                Движения.Взаиморасчеты.Записывать = Истина; 
                Движения.ОстаткиТоваров.Записывать = Истина; 

                <span class="зелёный">//регистр Взаиморасчеты Приход</span>
                Движение = Движения.Взаиморасчеты.Добавить(); 
                Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
                Движение.Период = Дата;
                Движение.Контрагент = Контрагент;
                Движение.Сумма = СуммаИтого;
                
                <span class="зелёный">////Это первый способ как получить и свернуть одинаковые товары
                ////В первом параметре указываем колонки для свёртывания, во втором 
                ////параметре колонки для суммирования. Колонки которые мы не указали
                ////не войдут в новую свёрнутую таблицу.
                //ТЗ = Товары.Выгрузить();
                //ТЗ.Свернуть("Товар", "Количество");</span>


                <span class="зелёный">//Это второй способ получить и свернуть товары, через запрос 
                //Что быстрее работает, через запрос или через ТЗ не известно
                //Нужно будет проверить
                //В этом запросе мы поместим результат во временную таблицу
                //и сразу получим из неё данные. Временная таблица нужна будет
                //в запросе ниже, для отбора товаров из таблицы остатков 
                //Чтобы временная таблица сохранилась в памяти, нужно создать объект
                //менеджера временных таблиц и он сам всё сделает
                //Использование временных таблиц будет оправдано, если нам
                //она будет нужна несколько раз. Если же используем один раз,
                //то во вложенном запросе ниже можно и сразу получить товары из документа,
                //потому что для временной таблицы нужно построить в базе саму эту таблицу,
                //а это затраты ресурсов. В этой процедуре мы используем раза 2 обращение
                //к временной таблице в рваных запросах 
                //Кстати!!! Вот так можно посмотреть что лежит во временной таблице
                //Запрос.МенеджерВременныхТаблиц.Таблицы[0].ПолучитьДанные().Выгрузить();</span>
                Запрос = Новый Запрос;
                Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
                Запрос.Текст = 
                    <span class="серый">"ВЫБРАТЬ
                    |	РасходнаяНакладнаяТовары.Товар КАК Товар,
                    |	СУММА(РасходнаяНакладнаяТовары.Количество) КАК Количество,
                    |	СУММА(РасходнаяНакладнаяТовары.Сумма) КАК Выручка
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.РасходнаяНакладная.Товары КАК РасходнаяНакладнаяТовары
                    |ГДЕ
                    |	РасходнаяНакладнаяТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	РасходнаяНакладнаяТовары.Товар,
                    |	РасходнаяНакладнаяТовары.Ссылка.Контрагент
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество
                    |ИЗ
                    |	ВТ КАК ВТ"</span>;

                Запрос.УстановитьПараметр(<span class="серый">"Ссылка"</span>, Ссылка);
                РезультатЗапроса = Запрос.Выполнить();

                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                    Пока Выборка.Следующий() Цикл 
                        <span class="зелёный">// регистр ОстаткиТоваров Приход</span>
                        Движение = Движения.ОстаткиТоваров.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Склад = Склад;
                        Движение.Товар = Выборка.Товар;
                        Движение.Количество = Выборка.Количество; 
                    КонецЦикла;
                КонецЕсли; 
                
                <span class="зелёный">//вот так выглядит блокировка набора записей регистра с остатками именно
                //тех товаров, которые мы тут пытаемся получить. Как я понял
                //вся таблица регистра не блокируется. Заблокируются те записи,
                //у которых в измерениях Товар и Склад будет то же что и у набора
                //записей, который мы записали выше. Например, если мы продаём Ложки со склада Основной,
                //то в регистре заблокируются все записи приходные и расходные
                //где есть Товар Ложки со Складом - Основной 
                //Теперь никто не сможет прочитать остатки по нашим товарам до конца транзакции
                //Эта инструкция ещё не сама блокировка, а указание, что нужно будет заблокировать.
                //Блокировка наступит в миг когда произойдёт запись движений в регистр.
                //Эта инструкция также запретит разделение итогов, таким образом документ
                //приходования товаров не сможет записать такие же товары в итоги, будет ждать в очереди
                //Что такое разделение итогов можно посмотреть в шпоре по  словам "ключевые итоги".
                //Эта инструкция блокировки работает, когда
                //набор записей уже записан в регистр. Они записаны и мы можем
                //заблокировать все записи по измерениям из этого набора записей</span>
                Движения.ОстаткиТоваров.БлокироватьДляИзменения = Истина;
                
                <span class="зелёный">//Когда мы указываем вот так записать, то происходит запись наборов записей во
                //все регистры подчинённые данному документу. И запись произойдёт только
                //если для этих наборов установлен флаг Записывать в Истина
                //Например, для такой строки - Движения.ОстаткиТоваров.Записать() флаг можно в истину не ставить </span>      
                Движения.Записать();
                
                <span class="зелёный">//выше мы записали сразу в регистр количество товаров, которые хотим продать
                //и теперь в запросе получаем из него остатки, которые ушли в минус
                //если такие есть, то документ не проводим
                //Этот запрос мы не инициализируем как новый объект, а продолжаем использовать
                //старый, созданный выше, меняем только текст запроса. Выше в запросе мы помещали
                //результат во временную таблицу и сейчас у нас в памяти висит эта временная таблица,
                //благодаря менеджеру временных таблиц,
                //а значит мы можем к ней обратиться в новом тексте запроса.</span>
                Запрос.Текст = 
                    <span class="серый">"ВЫБРАТЬ	
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Товар) КАК ТоварП,
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Склад) КАК СкладП,
                    |	ОстаткиТоваровОстатки.КоличествоОстаток КАК КоличествоОстаток
                    |ИЗ
                    |	РегистрНакопления.ОстаткиТоваров.Остатки(
                    |			&МоментВремени,
                    |			Склад = &Склад И 
                    |			Товар В
                    |				(ВЫБРАТЬ
                    |					ВТ.Товар КАК Товар
                    |				ИЗ
                    |					ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки 
                    |ГДЕ
                    |	ОстаткиТоваровОстатки.КоличествоОстаток &lt; 0"</span>;
                
                <span class="зелёный">//это то же самое, что прибавить 1 секунду к дате, чтобы данные текущего документа
                //уже учитывались при расчёте остатков
                //если задать просто МоментВремени(), то вернутся остатки до влияния текущего
                //документа на них </span>
                Граница = Новый Граница(МоментВремени(), ВидГраницы.Включая);
                Запрос.УстановитьПараметр(<span class="серый">"МоментВремени"</span>, Граница);	
                Запрос.УстановитьПараметр(<span class="серый">"Склад"</span>, Склад);
                <span class="зелёный">//в условии виртуальной таблицы Остатки выше мы отбираем те товары
                //которые есть в табличной части документа -> Товары В (Вложенный запрос)
                //Но можно сделать и без вложенного запроса -> Товары В (&МассивТоваров)
                //нам нужен массив товаров для параметра. Мы можем получить такой массив вот так:
                //Запрос.УстановитьПараметр("МассивТоваров", Товары.ВыгрузитьКолонку("Товар"));	</span>
                РезультатЗапроса = Запрос.Выполнить();
                
                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                
                    Пока Выборка.Следующий() Цикл
                        СообщениеП = Новый СообщениеПользователю;
                        СообщениеП.Текст = <span class="серый">"Не хватает товара "</span> + Выборка.ТоварП + <span class="серый">" в количестве "</span> + (-Выборка.КоличествоОстаток) + <span class="серый">" на складе """</span> + Выборка.СкладП + <span class="серый">""""</span>;
                        СообщениеП.Сообщить();
                    КонецЦикла;
                    Отказ = Истина;
                КонецЕсли;

                Если Отказ Тогда
                    Возврат;
                КонецЕсли; 

                <span class="зелёный">//Объясняю!!! У Чистова при оперативном проведении(на текущую дату) документа
                //всё хорошо, но стоит только перепровести документ, как система ставит новую
                //дату документа, точнее время и происходит попытка новой записи движений в регистре
                //потому что дата другая, отличается от той что раньше была записана, а значит
                //предыдущий набор записей в регистре не удаляется. Получается, что при оперативном
                //перепроведении всё время пишутся новые наборы записей и товары уменьшаются.
                //По этой причине нам нужно определить, режим проведения оперативный? Если да
                //то запишем пустой набор записей в регистр для данного документа, таким образом
                //удалятся старые движения
                //У себя я такой проблемы не заметил, у меня при оперативном перепроведении 
                //движения перезаписываются системой сами, может разработчики исправили.
                //Поэтом закоментирую пока у себя эту проверку, посмотрим как это скажется</span>
            
                <span class="зелёный">//Если Режим = РежимПроведенияДокумента.Оперативный Тогда
                //	Движения.ОстаткиСебестоимостиТоваров.Записать();		
                //КонецЕсли;</span>
                                        


                <span class="зелёный">//следующий пакет запроса. Здесь мы уже получаем данные из ВТ и 
                //вирт. таб. ОстаткиСебестоимостиТоваров.Остатки, чтобы была
                //возможность заполнить расходные движения регистра ОстаткиСебестоимостиТоваров, 
                //а именно нужны данные для вычисления себестоимости по средней
                //в запросе мы к временной таблице присоединяем таблицу остатков
                //поэтому в таблице остатков может не быть каких то записей и система
                //там проставит NULL. В данном случае не надо всем числовым полям таблице с остатками, ставить
                //проверку ЕСТЬNULL(), хватит одному полю, которое мы будем проверять в цикле,
                //потому что функция ЕСТЬNULL() довольно медленная и не нужно всем подряд полям её ставить
                //Вот мы в цикле выбрали проверку поля КоличествоОстаток на равенство 0, всё этого поля нам хватит  
                //БЛОКИРОВКА. Заблокировать набор записей в регистре  ОстаткиСебестоимостиТоваров для текущего документа
                //уже не получится так как было выше одной строкой, потому что у нас нет записей для этого документа в регистре
                //мы запрашиваем записи из регистра чужих документов. Поэтому придётся самим описать блокировку.</span>

                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиСебестоимостиТоваров");
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный; 
                <span class="зелёный">//дальше нужно указать источник данных, по данным которого будем ставить блокировку
                //У нас есть измерение Товар, нам нужно знать по каким товарам заблокировать записи
                //Товары у нас хранятся в табличной части Товары</span>
                ЭлементБлокировки.ИсточникДанных = Товары;
                <span class="зелёный">//Дальше в методе первый параметр это измерение регистра по которому будем делать отбор, указываем "Товар"
                //второй параметр это поле табличной части Товары, данные этого поля это значение для отбора
                //Например, выбрать запись где измерение Товар = "Ложка", Товар = "Вилка"    
                //В результате мы установим блокировку на записи в регистре с товарами равными товарам из табличной части</span>
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="серый">"Товар"</span>, <span class="серый">"Товар"</span>);
                Блокировка.Заблокировать();    

                <span class="зелёный">//если мы документ перепроводим, то у нас есть старые записи для этого документа
                //и способ выше их не заблокирует, поэтому тут можно применить строку с блокировкой.
                //Этот момент не понял. Ну если мы перепроводим, то у нас способ выше заблокирует
                //записи с товарами из табличной части, старые записи будут содержать такие же товары
                //значит должны заблокироваться, а если мы изменили товары в табличной части, то
                //зачем нам тогда блокировать старые? Короче пока не понятно. Понятно то, что
                //кроме блокировки старых записей ещё будет отключено разделение итогов.
                //А разделение итогов нужно отключать если проводятся документы продажи товаров</span> 
                Движения.ОстаткиСебестоимостиТоваров.БлокироватьДляИзменения = Истина;
                Движения.ОстаткиСебестоимостиТоваров.Записать();	

                Запрос.Текст = 
                    <span class="серый">"ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,
                    |	ВТ.Выручка КАК Выручка,
                    |	ОстаткиСебестоимостиТоваров.Партия КАК Партия,
                    |	ЕСТЬNULL(ОстаткиСебестоимостиТоваров.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ОстаткиСебестоимостиТоваров.СебестоимостьОстаток КАК СебестоимостьОстаток
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиСебестоимостиТоваров.Остатки(
                    |				&МоментВремени,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиСебестоимостиТоваров
                    |		ПО ВТ.Товар = ОстаткиСебестоимостиТоваров.Товар
                    |
                    |УПОРЯДОЧИТЬ ПО
                    |	ОстаткиСебестоимостиТоваров.Партия.МоментВремени,
                    |	ОстаткиСебестоимостиТоваров.Товар.Наименование
                    |ИТОГИ
                    |	МИНИМУМ(Количество),
                    |	СУММА(КоличествоОстаток),
                    |	МИНИМУМ(Выручка)
                    |ПО
                    |	Товар"</span>;
                
                <span class="зелёный">//если документ будет перепроводится, то нам нужны остатки до влияния
                //этого документа на остатки, поэтому и параметр МоментВремени()</span>
                Запрос.УстановитьПараметр(<span class="серый">"МоментВремени"</span>, МоментВремени());
                РезультатЗапроса = Запрос.Выполнить();

                
                Если НЕ РезультатЗапроса.Пустой() Тогда
                    ВыборкаИтогов = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
                
                    Пока ВыборкаИтогов.Следующий() Цикл 
                        <span class="зелёный">//так как деление на 0 это ошибка, поэтому проверяем это поле
                        //Если это поле будет равно 0, значит записей в регистре нет для данного товара
                        //значит останавливаем проведение документа</span>
                        Если ВыборкаИтогов.КоличествоОстаток = 0 Тогда
                            <span class="зелёный">//Почему такое сообщение, что есть расхождения?
                            //Выше есть запрос к остаткам товаров на складе и если мы дошли до
                            //этого кода, то остатки на складе были, ну а если мы зашли в эту проверку
                            //то остаков себестоимости по этому товару нет. Значит получилось
                            //так, что есть расхождения в остатках в этих двух регистрах</span>
                            Сообщить(<span class="серый">"Остаток себестоимости не совпадает с остатками на складе"</span>);
                            Отказ = Истина;
                            Возврат;	
                        КонецЕсли;

                        Если ВыборкаИтогов.Количество > ВыборкаИтогов.КоличествоОстаток Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="серый">"Не хватает товара "</span> + ВыборкаИтогов.ТоварП;
                            СообщениеП.Сообщить();

                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;

                        <span class="зелёный">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество = ВыборкаИтогов.Количество;
                        
                        <span class="зелёный">//из текущей записи верхнего уровня с итогами выбираем его детальные записи</span>
                        ВыборкаДетальных = ВыборкаИтогов.Выбрать();
                        <span class="зелёный">//переменная для накопления себестоимостей товаров продаваемых по партиям, 
                        //чтобы потом эту общую себестоимость записать в регистр "Продажи"</span>
                        НакоплениеСебестоимости = 0;
                        Пока ВыборкаДетальных.Следующий() Цикл 
                            <span class="зелёный">//если есть что списывать, то идём внутрь. Если у нас партии упорядочены по возрастанию, 
                            //то вот здесь и начинается списание и вычисление себестоимости по методу ФИФО</span> 
                            Если СписываемоеКоличество > 0 Тогда
                                <span class="зелёный">// регистр ОстаткиСебестоимостиТоваров Приход</span>
                                Движение = Движения.ОстаткиСебестоимостиТоваров.Добавить();
                                Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                                Движение.Период = Дата;
                                Движение.Товар = ВыборкаДетальных.Товар;
                                Движение.Партия = ВыборкаДетальных.Партия;
                            
                                Если СписываемоеКоличество &lt;= ВыборкаДетальных.КоличествоОстаток Тогда
                                    ВычислениеСебест = СписываемоеКоличество / ВыборкаДетальных.КоличествоОстаток * ВыборкаДетальных.СебестоимостьОстаток;
                                    Движение.Количество = СписываемоеКоличество;
                                    Движение.Себестоимость = ВычислениеСебест;
                                    НакоплениеСебестоимости = НакоплениеСебестоимости + ВычислениеСебест;
                                    СписываемоеКоличество = СписываемоеКоличество - СписываемоеКоличество;
                                Иначе
                                    Движение.Количество = ВыборкаДетальных.КоличествоОстаток;
                                    Движение.Себестоимость = ВыборкаДетальных.СебестоимостьОстаток;
                                    НакоплениеСебестоимости = НакоплениеСебестоимости + ВыборкаДетальных.СебестоимостьОстаток;
                                    СписываемоеКоличество = СписываемоеКоличество - ВыборкаДетальных.КоличествоОстаток; 
                                КонецЕсли;

                            КонецЕсли;
                        КонецЦикла;
                        
                        <spa class="vue-r">Вот это место где мы наполняем регистр Продажи, также расчитываем для него себестоимость</spa>
                        <span class="зелёный">//блокировок на эту таблицу ставить не нужно</span>
                        Движение = Движения.Продажи.Добавить();;
                        Движение.Период = Дата;
                        Движение.Товар = ВыборкаИтогов.Товар; 	
                        Движение.Контрагент = Контрагент; 	
                        Движение.Количество = ВыборкаИтогов.Количество; 	
                        Движение.Выручка = ВыборкаИтогов.Выручка; 
                        Движение.Себестоимость = НакоплениеСебестоимости; 	
                    КонецЦикла;
                КонецЕсли;
            
                <span class="зелёный">//если выше буду очищать набор записей для этого регистра, то
                //запись снимает флаг Записывать в ложь, поэтому внизу мы 
                //разместили эту инструкцию, чтобы флаг снова стал Истина и 
                //новый движения записались в регистр</span>
                Движения.ОстаткиСебестоимостиТоваров.Записывать = Истина;   
                Движения.Продажи.Записывать = Истина;   
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Теперь можно построить отчёт на основе регистра Продажи. В этом регистре теперь есть все нужные нам поля, не нужно соединять несколько таблиц, не нужно обращаться к медленным таблицам документов, не нужно обращаться за данными к медленной витруальной таблице ОстаткиТоваров.Обороты, потому что регистр накопления работает  в режиме "остатки". Мы используем одну вирт. таблицу Продажи.Обороты в режиме работы регистра "обороты", ну и останется только создать одно вычисляемое поле Прибыль и всё, отчёт готов. Это быстрее и производительнее. И не забываем, что теперь есть итоговая таблица, в которой будут сразу подсчитываться итоги по оборотам и при обращении к виртуальной таблице Продажи.Обороты у нас уже намного быстрей будут возвращаться данные, потому что будет задействована итоговая таблица, в которой уже заранее будет что то подсчитано.</p>

    <p class="title-size16"><b id="document24">(Курс Чистова 8.3) Бронирование товаров.</b></p>
    <p>Делаю по этому видео - https://www.youtube.com/watch?v=r5ZNzST8Mzc&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=39.   ДЗ №5</p>
    <p>Вот задание по созданию бронирования товаров.</p>
    <img src="../img/1С-1/2023-09-23_16-11-22.png" class="screen" alt="">
    <p>Это пока ещё не полной механизм бронироания товаров, а начало его. Со временем будем его дополнять.</p>
    <p>У нас уже имеется регистр накопления "ОстаткиТоваров" и можно было бы в него добавить ещё один ресурс "ВБроне", многие так и делают, но это считается не правильным. Остаки товаров предназначены для подсчёта только остатков товаров на складе, вот и пусть так и остаётся, а вот для бронирования лучше создать отдельный регистр "ТоварыВБроне". Как говорит Чистов, чтобы составлять легко отчёты, нужно хранить показатели разных областей каждый в своём регистре. Для анализа продаж создаём регистр продаж, для анализа остатка на складе создаём регистр остатков товаров, для анализа остатков в броне создаём регистр брони и т.д. И тогда не придётся строить сложные отчёты на одном громоздком регистре или на соединении нескольких таблиц. Если можно этого избежать, то лучше избегать. Так и сделаем.</p>
    <img src="../img/1С-1/2023-09-24_20-22-17.png" class="screen-2" alt="">
    <p>Ещё Чистов рассказывал, что одно из главных назначений регистра это отдалиться от документов и отчётами не завязываться на документы, потому что документы через время могут меняться, а регистр будет хранить стабильно показатель от разных документов. Пусть они там меняются, главное чтобы писали в регистр изменение показателя и всё.</p>
    <p>Документ, который будет писать в наш регистр это "СчетНаОплату". Для документа запретим оперативное проведение, это нам не нужно. В документе также добавим реквизит с типом дата для указания - до какого числа будем бронировать. Вот так выглядит обработка проведения документа:</p>
    <div class="code-style">
        <pre>
            --модуль объекта "ОбработкаПроведения" документа "СчетНаОплату"

            <span class="светло_синий">Процедура ОбработкаПроведения(Отказ, РежимПроведения)
                ТЗ = Товары.Выгрузить();
                ТЗ.Свернуть("Товар", "Количество");

                Движения.ТоварыВБроне.Записывать = Истина;
                Для Каждого ТекСтрокаТЗ Из ТЗ Цикл
                    <span class="зелёный">// регистр ТоварыВБроне Приход</span>
                    Движение = Движения.ТоварыВБроне.Добавить();
                    Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
                    Движение.Период = Дата;
                    Движение.Склад = Склад;
                    Движение.Контрагент = Контрагент;
                    Движение.ДатаОкончанияБрони = КонецДня(ДоКакогоЧислаБронировать);
                    Движение.Товар = ТекСтрокаТЗ.Товар;
                    Движение.Количество = ТекСтрокаТЗ.Количество; 
                КонецЦикла; 
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Как видим механизм бронирования пока простой по сравнению с теми, что описаны раньше от Камкова или от Чистова из курса 8.2. Но надеюсь со временем допишем его до конца.</p>




    <p class="title-size16"><b id="document25">(Курс Чистова 8.3) Ввод на основании.</b></p>
    <p>Взято из видео курса под названием СпецКурс 016.</p>
    <p>Событие "ОбработкаЗаполнения" срабатывает каждый раз когда создаётся новый документ или справочник и т.д.</p>
    <p>У нас есть 2 документа: "СчетНаОплату" и "РасходнаяНакладная". Первый документ предоставляет счёт покупателю и после того как он его оплатил мы проводим второй документ отгружая ему товар. Эти документы по своему составу похожи и можно облегчить работу пользователю и не заставлять после счёта заного вбивать все данные в документ "РасходнаяНакладная". Мы можем создавая новый документ продажи товаров перенести данные из счёта. Для этого есть механизм "Ввод на основании".</p>
    <p>В 1С есть конструктор этого механизма, но для начала вручную посмотрим как это работает. В редакторе окна документа "РасходнаяНакладная" есть вкладка "Ввод на основании". В верхнем окошке жмём на картику карандаша. В открывшемся окошке выбираем объект, который будет основанием для документа "РасходнаяНакладная". Как видим в выборе есть не только документы, но и другие объекты(справочники и т.д.). Например, на основании справочника "Сотрудники" можно создать документ о приёме на работу и в этот документ перенесутся все нужные данные из карточки сотрудника. Но можно и наоборот, на основе документа создать карточку сотрудника.</p>
    <p>Итак, укажем документом основанием "СчетНаОплату". Это повлияло на интерфейс форм этого документа. Там появилась группа кнопок "Ввод на основании", в которой есть одна команда "Расходная накладная". Эта команда является параметризуемой, т.е. в процедуру "ОбработкаКоманды" передаётся параметр со ссылкой на документ "СчетНаОплату", который выбран в списке или из которого мы и вызываем данную команду.</p>
    <p>Далее, у нас есть команда у счёта, которая создаёт новый документ "РасходнаяНакладная", но документ будет создаваться пустой. Нужно как то заполнять его. Для этого есть событие в модуле объекта "ОбработкаЗаполнения". Откроем модуль у документа "РасходнаяНакладная" и откроем шаблон обработчика этого события. Событие срабатывает на сервере в миг создания нового документа, как я понял. У обработчика события есть 3 параметра: "ДанныеЗаполнения", "ТекстЗаполнения" и "СтандартнаяОбработка".</p>
    <ul class="list">
        <li>"СтандартнаяОбработка" - этот параметр позволяет отменить стандартное поведение обработчика.</li>
        <li>"ТекстЗаполнения" - текст, используемый для заполнения документа. Если у объекта реквизит Номер находится в списке "Ввод по строке" и не установлен признак Автонумерация, то значение присваивается реквизиту Номер. В противном случае присвоение не выполняется. Неопределено - для мобильной платформы.</li>
        <li>"ДанныеЗаполнения" - самый интересный параметр, который нам и нужен. В нём будет ссылка на тот объект, который является основанием, т.е. ссылка на документ "СчетНаОплату". Внимание! Ссылка в нём будет, если мы вводим на основании и от одного объекта, потому что есть и другие разновидности вызова этого события и там в этом параметре может быть уже другой тип данных. Например, массив, в котором будут ссылки на разные объекты основания и исходя из этого мы будем заполнять по другому. Поэтому нужно всегда проверять, что лежит в этом параметре. А может и структура быть(о ней позже опишу).</li>
    </ul>
    <p>Параметры понятны, теперь нужно заполнить реквизиты нового документа "РасходнаяНакладная" реквизитами документа основания "СчетНаОплату". Как будем получать данные документа "СчетНаОплату" из базы? Объектным или табличным способом? Вот статья в каких случаях что использовать - https://its.1c.ru/db/metod8dev/content/2717/hdoc.  Как я понял, да и Чистов так делает, мы можем использовать объектный способ получения данных через ссылку, потому что при получении какого то поля объекта, из базы выбирается весь объект вместе с табличной частью или частями, если их несколько. Этот объект кешируется и мы можем уже получать из закешированного объекта другие поля. Если бы нам нужно было бы одно или 2 поля, то тогда скорее подойдёт запрос табличным способом, а так нам нужно обратиться к нескольким полям, можно сказать почти весь объект нам и нужен.</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "РасходнаяНакладная"

            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаЗаполнения<span class="светло_красный">(</span>ДанныеЗаполнения<span class="светло_красный">,</span> ТекстЗаполнения<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                Контрагент <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Контрагент<span class="светло_красный">;</span>
                Договор <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Договор<span class="светло_красный">;</span>
                Склад <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Склад<span class="светло_красный">;</span>
                
                <span class="зелёный">//чтобы выгрузить из одной табличной части в другую
                //можно использовать промежуточную таблицу значений</span>
                ТЧТовары <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Товары<span class="светло_красный">;</span>
                Товары<span class="светло_красный">.</span>Загрузить<span class="светло_красный">(</span>ТЧТовары<span class="светло_красный">.</span>Выгрузить<span class="светло_красный">());</span> 

                <span class="зелёный">////или вот другой способ через цикл
                //Для каждого СтрокаТабЧасти Из ДанныеЗаполнения.Товары Цикл
                //	НоваяСтрока = Товары.Добавить();
                //	ЗаполнитьЗначенияСвойств(НоваяСтрока,СтрокаТабЧасти);
                //КонецЦикла;</span>
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Если сделать это через конструктор, то он нам создаст такой код:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаЗаполнения<span class="светло_красный">(</span>ДанныеЗаполнения<span class="светло_красный">,</span> ТекстЗаполнения<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                <span class="светло_красный">Если</span> ТипЗнч<span class="светло_красный">(</span>ДанныеЗаполнения<span class="светло_красный">) =</span> Тип<span class="светло_красный">(</span>"ДокументСсылка.СчётНаОплату"<span class="светло_красный">) Тогда</span>
                    <span class="зелёный">// Заполнение шапки</span>
                    Договор <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Договор<span class="светло_красный">;</span>
                    Контрагент <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Контрагент<span class="светло_красный">;</span>
                    Склад <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Склад<span class="светло_красный">;</span>
                    <span class="светло_красный">Для Каждого</span> ТекСтрокаТовары <span class="светло_красный">Из</span> ДанныеЗаполнения<span class="светло_красный">.</span>Товары <span class="светло_красный">Цикл</span>
                        НоваяСтрока <span class="светло_красный">=</span> Товары<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                        НоваяСтрока<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                        НоваяСтрока<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Сумма<span class="светло_красный">;</span>
                        НоваяСтрока<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                        НоваяСтрока<span class="светло_красный">.</span>ЦенаПродажи <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>ЦенаПродажи<span class="светло_красный">;
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вот схема действий от нажатия по кнопке "РасходнаяНакладная" в группе "Ввод на основании" до открытия нового документа "РасходнаяНакладная":</p>
    <img src="../img/1С-1/2023-10-11_10-34-30.png" class="screen" alt="">

    <p><b id="document25-1">Давайте сделаем теперь всё то же самое, только сами, без помощи системы</b>. "Ввод на основании вручную", "Передача параметров в форму". "Открытие формы"</p>
    <p>Имеется ввиду, что сделаем тот же ввод на основании документа "СчетНаОплату", по которому будем создавать и заполнять документ "РасходнаяНакладная".</p>
    <p>Мы делаем этот пример только для показа передачи параметров в создающуюся форму документа.</p>
    <p>Зайдём в форму документа "СчетНаОплату" и создадим команду "ВводНаОснованииВручную", перенесём её в элементы формы. На клиенте создаём обработчик для команды. Вспоминаем, что делает система при вводе на основании. Она создаёт новый документ указанного вида и открываем его основную форму документа. Значит мы можем использовать метод ОткрытьФорму() по имени. Этот метод, как я понимаю, может создать новый объект документа и сконструировать по параметрам для него форму, а затем отправить на клиента для отображения.</p>
    <p>При написании этого метода система помогает при выборе формы. Мы можем открыть форму объекта, которая на данный миг является основной, выбрав "ФормаОбъекта":</p>
    <img src="../img/1С-1/2023-09-28_09-19-40.png" class="screen" alt=""> 
    <p>Или выбрать "Форма" и тогда мы можем выбрать любую форму, которые созданы для объекта документа. Может у нас заранее несколько форм для объекта созданы, но основная только одна. Вот пункт "Форма" позволяет выбрать одну из этих заранее созданных:</p>
    <img src="../img/1С-1/2023-09-28_09-20-09.png" class="screen" alt="">
    <p>Далее 2м аргументом нужно передать какие то параметры для формы. Параметры собираются в структуру и эта структура передаётся. Что нам нужно передать? Опять вспоминаем, что система передаёт на сервер в параметр "ДанныеЗаполнения" в обработку заполнения, при стандартном вводе на основании? Система передаёт ссылку на объект текущего документа "СчетНаОплату". Значит нужно передать ссылку на текущий объект. В расширениях формы для документа есть свои параметры формы с разными ключами, нам нужен такой ключ как "Основание", вот для этого ключа и надо указать ссылку:</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "СчетНаОплату"

            <span class="светло_синий"><span class="светло_красный">&НаКлиенте
            Процедура</span> ВводНаОснованииВручную<span class="светло_красный">(</span>Команда<span class="светло_красный">)</span>
                ПраметрыФормы <span class="светло_красный">= Новый</span> Структура<span class="светло_красный">;</span>
                ПраметрыФормы<span class="светло_красный">.</span>Вставить<span class="светло_красный">(</span><span class="серый">"Основание"</span><span class="светло_красный">,</span> Объект<span class="светло_красный">.</span>Ссылка<span class="светло_красный">);</span>                                                                 	

                ОткрытьФорму<span class="светло_красный">(</span><span class="серый">"Документ.РасходнаяНакладная.Форма.ФормаДокумента"</span><span class="светло_красный">,</span> ПраметрыФормы<span class="светло_красный">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>У документа "РасходнаяНакладная", который мы собираемся создавать на основании, в его модуле объекта оставим код в обработке заполнения тот же.</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаЗаполнения<span class="светло_красный">(</span>ДанныеЗаполнения<span class="светло_красный">,</span> ТекстЗаполнения<span class="светло_красный">,</span> СтандартнаяОбработка<span class="светло_красный">)</span>
                <span class="светло_красный">Если</span> ТипЗнч<span class="светло_красный">(</span>ДанныеЗаполнения<span class="светло_красный">) =</span> Тип<span class="светло_красный">(</span>"ДокументСсылка.СчётНаОплату"<span class="светло_красный">) Тогда</span>
                    <span class="зелёный">// Заполнение шапки</span>
                    Договор <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Договор<span class="светло_красный">;</span>
                    Контрагент <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Контрагент<span class="светло_красный">;</span>
                    Склад <span class="светло_красный">=</span> ДанныеЗаполнения<span class="светло_красный">.</span>Склад<span class="светло_красный">;</span>
                    <span class="светло_красный">Для Каждого</span> ТекСтрокаТовары <span class="светло_красный">Из</span> ДанныеЗаполнения<span class="светло_красный">.</span>Товары <span class="светло_красный">Цикл</span>
                        НоваяСтрока <span class="светло_красный">=</span> Товары<span class="светло_красный">.</span>Добавить<span class="светло_красный">();</span>
                        НоваяСтрока<span class="светло_красный">.</span>Количество <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Количество<span class="светло_красный">;</span>
                        НоваяСтрока<span class="светло_красный">.</span>Сумма <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Сумма<span class="светло_красный">;</span>
                        НоваяСтрока<span class="светло_красный">.</span>Товар <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>Товар<span class="светло_красный">;</span>
                        НоваяСтрока<span class="светло_красный">.</span>ЦенаПродажи <span class="светло_красный">=</span> ТекСтрокаТовары<span class="светло_красный">.</span>ЦенаПродажи<span class="светло_красный">;
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Запустим систему и в форме документа "СчетНаОплату" нажмём кнопку "ВводНаОснованииВручную". У нас всё отработает хорошо, откроется заполненная форма документа "РасходнаяНакладная". Вот накидал схему, как я понимаю, описанных действий:</p>
    <p>Вот схема действий от нажатия по кнопке "РасходнаяНакладная" в группе "Ввод на основании вручную" до открытия нового документа "РасходнаяНакладная":</p>
    <img src="../img/1С-1/2023-10-11_10-42-00.png" class="screen" alt="">

    <p><b id="document25-2">Дальше про свойство "Заполнять из данных заполнения"</b>. Это свойство также связанно с событием "ОбработкаЗаполнения". В определённых случаях с помощью этого свойства в событие передаётся параметр в виде структуры с данными. Когда это происходит? Уже где то описывал один пример с этим свойством и как оно работает. Опишу тут ещё раз, но наш пример.</p>
    <p>В пользовательской части открываем форму списка документа "РасходнаяНакладная" и видим список документов. В подменю "Еще" есть такой пункт как "Настроить список", это возможность сделать со списком документов что-то. Например, сделать отбор по списку. Допустим, оставим в списке документы с контрагентом ЗАО "Бурёнка", для этого в отборе выберем контрагент и равно ЗАО "Бурёнка", завершаем настройку и тут же система отсортирует список и оставит указанные документы. И вот после этого действия, если мы создадим новый документ, то сработает событие "ОбработкаЗаполнения" и в первый параметр "ДанныеЗаполнения" попадёт структура с ключом "Контрагент" и значением "ЗАО "Бурёнка"".</p>
    <p>Когда откроется форма нового документа то поля будут пусты, если конечно в обработке "ОбработкаЗаполнения" ничего никуда не присваивается. Но если в конфигураторе установить свойство "Заполнять из данных заполнения" поставив галочку, потм опять настроить список с отбором, то при создании нового документа в поля с контрагентом попадёт сразу значение "ЗАО "Бурёнка"" из структуры. Система это сделает сама, не нужно описывать это в обработчике.</p>
    <p>Для чего это нужно? Как объясняет Чистов это нужно, когда пользователь ищет конкретные документы и устанавливает отборы и вдруг ничего не нашёл, то он может создать новый документ и система заполнит все реквизиты по отбору. Для меня пока трудно представить такой случай, когда что то ищешь, не находишь и давай создавать новый документ с недостающими реквизитами. Примеры такого не приходят в голову, как это может быть в жизни.</p>
    <p>Важное замечание! Система сама добавляет в реквизиты из структуры, а значит это срабатывает стандартная обработка, если в 3й параметр поставить флаг Ложь, то система перестанет это делать.</p>
    <p>Ещё пользователь может отобрать из списка с помощью строки поиска:</p>
    <img src="../img/1С-1/2023-09-26_10-19-37.png" class="screen" alt="">
    <p>Но в этом случае в параметр "ДанныеЗаполнения" ничего не попадает. Также есть расширенный поиск в меню с картинкой лупы, там мы как для отбора выбираем где искать и что искать, после применения сверху рядом со списком появится обозначение отбора. Но в этом случае также ничего не передаётся в параметр "ДанныеЗаполнения". Передаются только при настройке списка.</p>






    <p class="title-size16"><b id="hrust">(Курс Пособие ... Хрусталёва). Обработка проведения, контроль остатков, вычисление себестоимости по средней</b></p>
    <p>По сути тут воплощён новый метод контроля остатков с признаками старого метода, в общем подзапутанный код. Мы сначала записываем в регистр движения и только при оперативном проведении смотрим отрицательные остатки. Проверкой остатков товаров при неоперативном проведении, как описано в книге, должен заведовать код, написанный в другом месте. Где это место мне не очень понятно.</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ОказаниеУслуги"

            <span class="светло_синий"><span class="светло_красный">Процедура</span> ОбработкаПроведения(Отказ, Режим)	
                <span class="зелёный">//я вынес отдельно получение значения перечисления для того, чтобы каждый раз в цикле
                //не обращаться в БД, но тут видимо как и с объектами БД, значение сохраняется в оперативной
                //памяти и берётся оттуда</span>   
                Материал = Перечисления.ВидыНоменклатуры.Материал; 

                Движения.ОстаткиМатериалов.Записывать = Истина;
                Движения.СтоимостьМатериалов.Записывать = Истина;
                Движения.Продажи.Записывать = Истина; 
                
                МенеджерВТ = Новый МенеджерВременныхТаблиц;
                
                Запрос = Новый Запрос;
                Запрос.МенеджерВременныхТаблиц = МенеджерВТ;
                Запрос.Текст = 
                    <span class="серый">"ВЫБРАТЬ
                    |	ОказаниеУслугиПереченьНоменклатуры.Номенклатура КАК Номенклатура,
                    |	ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры КАК ВидНоменклатуры,
                    |	СУММА(ОказаниеУслугиПереченьНоменклатуры.Количество) КАК Количество,
                    |	СУММА(ОказаниеУслугиПереченьНоменклатуры.Сумма) КАК Сумма
                    |ПОМЕСТИТЬ НоменклатураДокумента
                    |ИЗ
                    |	Документ.ОказаниеУслуги.ПереченьНоменклатуры КАК ОказаниеУслугиПереченьНоменклатуры
                    |ГДЕ
                    |	ОказаниеУслугиПереченьНоменклатуры.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ОказаниеУслугиПереченьНоменклатуры.Номенклатура,
                    |	ОказаниеУслугиПереченьНоменклатуры.Номенклатура.ВидНоменклатуры"</span>;

                Запрос.УстановитьПараметр("Ссылка", Ссылка);
                Запрос.Выполнить();
                
                <span class="зелёный">//Стр. 437 из книги Хрусталёвой
                //Чтобы в этом запросе появилась временная таблица "НоменклатураДокумента", 
                //предыдущий запрос нужно выполнить, а в этом указать тот же менеджер временных таблиц. 
                //Можно конечно весь запрос написать и в одном запросе и разделить пакеты.
                //Также при создании Запроса2 в конструкторе нам нужно будет создать
                //описание временной таблицы, где укажем имя "НоменклатураДокумента" и
                //опишем все поля из неё с указанием типов </span>
                Запрос2 = Новый Запрос;
                Запрос2.МенеджерВременныхТаблиц = МенеджерВТ;
                Запрос2.Текст = 
                    <span class="серый">"ВЫБРАТЬ
                    |	НоменклатураДокумента.Номенклатура КАК Номенклатура,
                    |	НоменклатураДокумента.ВидНоменклатуры КАК ВидНоменклатуры,
                    |	НоменклатураДокумента.Количество КАК КоличествоВДокументе,
                    |	НоменклатураДокумента.Сумма КАК СуммаВДокументе,
                    |	ЕСТЬNULL(ОстаткиМатериаловОстатки.КоличествоОстаток, 0) КАК Количество,
                    |	ЕСТЬNULL(СтоимостьМатериаловОстатки.СтоимостьОстаток, 0) КАК Стоимость
                    |ИЗ
                    |	НоменклатураДокумента КАК НоменклатураДокумента
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиМатериалов.Остатки(
                    |				,
                    |				Материал В
                    |					(ВЫБРАТЬ
                    |						НоменклатураДокумента.Номенклатура КАК Номенклатура
                    |					ИЗ
                    |						НоменклатураДокумента КАК НоменклатураДокумента)) КАК ОстаткиМатериаловОстатки
                    |		ПО НоменклатураДокумента.Номенклатура = ОстаткиМатериаловОстатки.Материал
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.СтоимостьМатериалов.Остатки(
                    |				,
                    |				Материал В
                    |					(ВЫБРАТЬ
                    |						НоменклатураДокумента.Номенклатура КАК Номенклатура
                    |					ИЗ
                    |						НоменклатураДокумента КАК НоменклатураДокумента)) КАК СтоимостьМатериаловОстатки
                    |		ПО НоменклатураДокумента.Номенклатура = СтоимостьМатериаловОстатки.Материал"</span>;  

                <span class="зелёный">// Установим необходимость блокировки данных в регистрах СтоимостьМатериалов
                // и ОстаткиМатериалов</span>
                Движения.СтоимостьМатериалов.БлокироватьДляИзменения = Истина;
                Движения.ОстаткиМатериалов.БлокироватьДляИзменения = Истина; 

                <span class="зелёный">//очистим регистры от предыдущих записей сделанных этим документом
                //и попутно будут заблокированы записи. Чтобы Запрос2 работал с записями, которые никто не 
                //прочитает и не изменит одновременно с нами. Правда пока не понимаю, как система
                //определит какие записи блокировать. У нас к этому мигу нет заполненных движений, у нас
                //нет описанной нами управляемой блокировки, где мы указываем значения конкретных измерений
                //В общем мне до сих пор не понятен этот код</span>
                Движения.СтоимостьМатериалов.Записать();
                Движения.ОстаткиМатериалов.Записать();

                РезультатЗапроса = Запрос2.Выполнить();
                ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
                
                Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
                    <span class="зелёный">//Делить на 0 нельзя, поэтому заранее проверим чему равно поле "Количество" </span>
                    Если ВыборкаДетальныеЗаписи.Количество = 0 Тогда
                        СтоимостьМатериала = 0;
                    Иначе
                        СтоимостьМатериала = ВыборкаДетальныеЗаписи.Стоимость / ВыборкаДетальныеЗаписи.Количество;
                    КонецЕсли;

                    Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = Материал Тогда
                        <span class="зелёный">// Регистр ОстаткиМатериалов Расход</span>
                        Движение = Движения.ОстаткиМатериалов.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура;
                        Движение.Склад = Склад;
                        Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;

                        <span class="зелёный">// Регистр СтоимостьМатериалов Расход</span>  
                        Движение = Движения.СтоимостьМатериалов.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Материал = ВыборкаДетальныеЗаписи.Номенклатура; 
                        <span class="зелёный">//тут формула расчёта себестоимости такая, что будут косяки с остатками копеек
                        //если что, то нужно заменить на формулу от Чистова</span>
                        Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе * СтоимостьМатериала;
                    КонецЕсли;

                    <span class="зелёный">// Регистр Продажи</span>
                    Движение = Движения.Продажи.Добавить();
                    Движение.Период = Дата;
                    Движение.Покупатель = Покупатель;
                    Движение.Мастер = Мастер;
                    Движение.Номенклатура = ВыборкаДетальныеЗаписи.Номенклатура;
                    Движение.Количество = ВыборкаДетальныеЗаписи.КоличествоВДокументе;
                    <span class="зелёный">//тут формула расчёта себестоимости такая, что будут косяки с остатками копеек
                    //если что, то нужно заменить на формулу от Чистова</span>	
                    Движение.Стоимость = ВыборкаДетальныеЗаписи.КоличествоВДокументе * СтоимостьМатериала;	
                    Движение.Выручка = ВыборкаДетальныеЗаписи.СуммаВДокументе;	
                КонецЦикла; 

                <span class="зелёный">//Блокировки установлены, движения заполнены, теперь запишем
                //эти движения в регистр и по пути заблокировав все записи с нужными значениями измерений</span>
                Движения.Записать(); 

                Если Режим = РежимПроведенияДокумента.Оперативный Тогда
                    <span class="зелёный">// Проверить отрицательные остатки</span>
                    Запрос3 = Новый Запрос;
                    Запрос3.МенеджерВременныхТаблиц = МенеджерВТ;
                    Запрос3.Текст = 
                        <span class="серый">"ВЫБРАТЬ
                        |	ОстаткиМатериаловОстатки.Материал КАК Материал,
                        |	ОстаткиМатериаловОстатки.КоличествоОстаток КАК КоличествоОстаток
                        |ИЗ
                        |	РегистрНакопления.ОстаткиМатериалов.Остатки(
                        |			,
                        |			Материал В
                        |					(ВЫБРАТЬ
                        |						НоменклатураДокумента.Номенклатура
                        |					ИЗ
                        |						НоменклатураДокумента)
                        |				И Склад = &Склад) КАК ОстаткиМатериаловОстатки
                        |ГДЕ
                        |	ОстаткиМатериаловОстатки.КоличествоОстаток &lt; 0"</span>;

                    Запрос3.УстановитьПараметр("Склад", Склад);
                    РезультатЗапроса = Запрос3.Выполнить(); 
                    ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать(); 

                    Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
                        СообщениеП = Новый СообщениеПользователю();
                        СообщениеП.Текст = <span class="серый">"Не хватает "</span> + Строка(- ВыборкаДетальныеЗаписи.КоличествоОстаток) +
                        <span class="серый">" единиц материала """</span> + ВыборкаДетальныеЗаписи.Материал + <span class="серый">""""</span>;
                        СообщениеП.Сообщить();
                        Отказ = Истина;
                    КонецЦикла;
                КонецЕсли;
            <span class="светло_красный">КонецПроцедуры</span></span>
        </pre>
    </div>


</div>
