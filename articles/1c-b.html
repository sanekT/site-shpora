<div class="wrap">
   
    <h2 class="header-style">Основы программирования на 1с</h2>


    <ul class="list">
        <li><a href="#0">Основная конфигурация(Метаданные), Конфигурация БД.</a></li>
        <li><a href="#notes">Короткие заметки по 1С</a></li>
        <li><a href="#props">Свойства реквизитов объектов конфигурации</a></li>
        <li><a href="#1">Типы данных</a></li>
        <li><a href="#1a">Преобразование типов данных</a></li>
        <li><a href="#structure-module">Структура модуля</a></li>
        <li><a href="#2">Операции сравнения</a></li>
        <li><a href="#3">Функция Формат()</a></li>
        <li><a href="#4">Часто используемые методы Глобального контекста</a></li>
        <li><a href="#4b">Проверка даты, строки, числа на <b>пустоту</b></a></li>
        <li><a href="#interactiv">Процедуры и функции для взаимодействия с пользователем</a>
            <ul class="list2">
                <li><a href="#interactiv-1">Как показать пользователю текстовое сообщение</a></li>
                <li><a href="#interactiv-2">Модальное окно. Почему надо отказываться от модальности. Асинхронные методы.</a></li>
                <li><a href="#interactiv-3"></a></li>
                <li><a href="#interactiv-4"></a></li>
            </ul>
        </li>
        <li><a href="#5">Условный оператор</a></li>
        <li><a href="#5a">Тройной оператор</a></li>
        <li><a href="#6">Циклы</a></li>
        <li><a href="#7">Процедуры и функции</a></li>
        <li><a href="#7a">Переменные передаются по ссылке в процедуры и функции. Оператор <b>Знач</b>.</a></li>
        <li><a href="#10">Не срабатывает метод Сообшить</a></li>
        <li><a href="#11">Объекты конфигурации</a></li>
        <li><a href="#prop-root-config">Свойства корня конфигурации</a>
            <ul class="list2">
                <li><a href="#prop-root-config-1">"Режим управления блокировкой данных" во вкладке "Совместимость"</a></li>
                <li><a href="#prop-root-config-2"></a></li>
            </ul>
        </li>
        <li><a href="#konst">Работа с <b>константами</b></a>
            <ul class="list2">
                <li><a href="#konst1">Константа и её свойства</a></li>
                <li><a href="#konst2">Пример работы с константой</a></li>
            </ul>
        </li>
        <li><a href="#spravochnik">Работа со <b>справочником</b></a>
            <ul class="list2">
                <li><a href="#spravochnik-base">Что такое и для чего нужен справочник</a></li>
                <li><a href="#spravochnik-prop">Свойства реквизитов справочника</a></li>
                <li><a href="#spravochnik-dohovor">Подчинённый справочник. Реквизит "Владелец".</a></li>
                <li><a href="#spravochnik1">Типы данных у справочников</a></li>
                <li><a href="#spravochnik2">Получение данных справочника из базы объектным способом</a></li>
                <li><a href="#spravochnik3">Получение данных справочника по ссылке объектным способом и через запрос</a></li>
                <li><a href="#spravochnik4">Получение ссылки на элемент справочника</a></li>
                <li><a href="#spravochnik5">Метод <b>ПолучитьОбъект()</b> у разных типов данных справочника и документа</a></li>
                <li><a href="#spravochnik6">Метод <b>Создатьэлемент()</b> у менеджера справочника и перемещение созданного элемента в группу</a></li>
                <li><a href="#spravochnik7">Предопределенные элементы</a></li>
                <li><a href="#spravochnik8">Заполнение реквизитов автоматом при создании нового элемента. Тип данных - Список значений. Как автоматом ставить галочку в поле "Услуга" для новых создаваемых элементов справочника Номенклатура? Для новых элементов внутри группы Товары в поле Услуга ставится Ложь, а для новых элементов внутри группы Услуги - Истина. <b>Событие "ОбработкаЗаполнения"</b>.</a></li>
                <li><a href="#spravochnik9">Проверка заполнения реквизитов при записи в БД. <b>Событие "ОбработкаПроверкиЗаполнения". Свойство "Проверка заполнения". Пункт "Ещё" -> "Настроить список"</b>.</a></li>
                <li><a href="#enumeration-3">Произвольное представление ссылки.</a></li>
                <li><a href="#spravochnik10">Почему на этапе разработки не надо ставить галочку свойству <b>"Неотрицательное"</b> при установке реквизиту типа данных Число.</a></li>
                <li><a href="#spravochnik11">Определяем пол сотрудника по его отчеству</a></li>
                <li><a href="#spravochnik12">Устанавливаем <b>картинку</b> товара в форме элемента справочника "Номенклатура". События формы <b>"ПередЗаписью"</b> и <b>"ПередЗаписьюНаСервере"</b></a></li>
            </ul>
        </li>
        <li><a href="#document">Работа с <b>документом</b></a>
            <ul class="list2">
                <li><a href="#document-base">Что такое и для чего нужен документ</a></li>
                <li><a href="#document-types">Типы данных у документа</a></li>
                <li><a href="#document-prop">Свойства реквизитов документа</a>
                    <ul class="list2">
                        <li><a href="#document-prop-1">Значение заполнения</a></li>
                        <li><a href="#">Заполнять из данных заполнения</a>. В 2х местах 2 примера с эти свойством - <a href="#spravochnik8">тут</a> и <a href="#document25-2">тут</a></li>
                        <li><a href=""></a></li>
                        <li><a href=""></a></li>
                        <li><a href=""></a></li>
                    </ul>
                </li>
                <li><a href="#document-events">События модуля объекта</a>
                    <ul class="list2">
                        <li><a href="#document25-2">ОбработкаЗаполнения</a></li>
                        <li><a href="#spravochnik8">ОбработкаЗаполнения - другой пример</a></li>
                        <li><a href=""></a></li>
                        <li><a href=""></a></li>
                        <li><a href=""></a></li>
                    </ul>
                </li>
                <li><a href="#document-events">События модуля менеджера</a>
                    <ul class="list2">
                        <li><a href="#"></a></li>
                        <li><a href=""></a></li>
                        <li><a href=""></a></li>
                        <li><a href=""></a></li>
                        <li><a href=""></a></li>
                    </ul>
                </li>
                <li><a href="#document1">Метод <b>СоздатьДокумент()</b> у менеджера документа</a></li>
                <li><a href="#document2a"><b>Практика</b>. В таб. части Товары документа "ПродажаТоваров" при выборе товара нужно подставить цену в поле Цена из реквизита справочника Номенклатура "ЦенаПродажи"</a></li>
                <li><a href="#document2b"><b>Практика</b>. В таб.части документа изменить поле Цена во всех строках таб. части при изменении реквизита Контрагент в шапке документа</a></li>
                <li><a href="#document3"><b>Практика</b>. Создание механизма <b>бронирования товара</b> при оперативном учёте. Делаем кнопку в форме документа(используем модуль объекта и запись в регистр с помощью свойства Движения) и в форме списка документа(используем модуль менеджера и запись в регистр без свойства Движения)</a></li>
                <li><a href="#document4"><b>Практика</b>. Показываем остаток выделенного товара в табличной части документа "ПродажаТоварв". Событие у таб. части с типом ТаблицаФормы - <b>"ПриАктивизацииСтроки"</b>. Продолжение к предыдущему примеру</a></li>
                <li><a href="#document5"><b>Практика</b>. Создание механизма бронирования товара. Другой способ записи в регистр, выносим Движения в документ и прям напрямую пишем. Создаём отдельно документ "БронированиеТоваров"</a></li>
                <li><a href="#document6"><b>Практика</b>. (курс Камкова) <b>Контроль остатков</b> и расчёт <b>себестоимости</b> по средней в документе "ПродажаТоваров". Есть пару объяснений про оперативное проведение. Блокировка таблицы</a></li>
                <li><a href="#document7"><b>Практика</b>. (курс Камкова) Контроль остатков(количества и суммы) в документе "ПоступлениеТоваров". Объект <b>"Последовательности"</b>.</a></li>
                <li><a href="#document8">"Дополнительные свойства" документа</a></li>
                <i><a href="#document9"><b>Практика</b>. (курс Камкова) Продажа товара и списание себестоимости методом ФИФО и ЛИФО</a></i>
                <li><a href="#document10">Способ, как не добавляя реквизит "СуммаДокумента" в форму документа, видеть это поле с подсчитаным значением в форме списка документа.</a></li>
                <li><a href="#document11"><b>Форма выбора. Динамический список.</b> При выборе товара в таб. части документа открывается форма выбора товара. Нужно чтобы в этой форме было доп. поле с остатками товаров</a></li>
                <li><a href="#document12"><b>Передача параметра в форму. Форма выбора. Динамический список</b>. Дополнение к предыдущей записи про форму выбора. Нужно передать параметр в форму выбора справочника в запрос для динамического списка. Свойство <b>"Связи параметров выбора"</b>, свойство <b>"Параметры"</b> у формы</a></li>
                <li><a href="#document13">(Курс Чистова 8.2) <b>Контроль остатков</b> и расчёт <b>себестоимости</b> по средней в документе "ПродажаТоваров"</a></li>
                <li><a href="#document14">(Курс Чистова 8.2) Как вести <b>многоскладской</b> учёт? <b>Формула себестоимости по средней, "Связи наборов данных".</b></a></li>
                <li><a href="#document15">(Курс Чистова 8.2) Партионный учёт, продажа товара и списание себестоимости методом <b>ФИФО</b> и ЛИФО</a></li>
                <li><a href="#document16">(Курс Чистова 8.2) <b>Последовательности</b>, что такое и для чего нужны.</a></li>
                <li><a href="#document18">Как <b>свернуть(сгруппировать)</b> одинаковые товары табличной части при записи их в регистр в обработке проведения документа "ПоступлениеТоваров". <span class="vue-r">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document19"><b>"Кнопка выбора", событие "НачалоВыбора"</b>. Как для реквизита шапки/таб.части документа добавить кнопку выбора и открыть окно с результатом, который мы выберем из БД</a></li>
                <li><a href="#document20"><b>Бронирование товара</b>. Опишу тут немного другой способ бронирования товаров. На мой взгляд более правильный чем у Камкова. Решение задачи №8 из книги Чистова.</a></li>
                <li><a href="#enumeration-3">Произвольное представление ссылки.</a></li>
                <li><a href="#document21">(Курс Чистова 8.3) <b>Контроль остатков</b> и расчёт <b>себестоимости</b> по средней. <span class="vue-r">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document22">(Курс Чистова 8.3) Партионный учёт, продажа товара и списание себестоимости методом <b>ФИФО</b>. <span class="vue-r">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document23">(Курс Чистова 8.3) Как правильно построить отчёт о продажах товара. Регистр накопления <b>"Продажи"</b>. <span class="vue-r">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document24">(Курс Чистова 8.3) Бронирование товаров. <span class="vue-r">Модуль объекта. ОбработкаПроведения()</span></a></li>
                <li><a href="#document25">(Курс Чистова 8.3) Ввод на основании. Событие модуля объекта "ОбработкаЗаполнения". Свойство "Заполнять из данных заполнения". Делаем ввод на основании вручную. Смотрим свойство <b>"Параметры"</b> у формы и передачу их в форму. <span class="vue-r">Модуль формы</span></a></li>
                <li><a href="#document22"></a></li>
                <li><a href="#document22"></a></li>
                <li><a href="#document22"></a></li>
            </ul>
        </li>
        <li><a href="#work-forms">Работа с <b>формами</b></a>
            <ul class="list2">
                <li><a href="#work-forms-total">В общем о классе ФормаКлиенскогоПриложения</a>
                    <ul class="list2">
                        <li><a href="#work-forms-client-server">Подробно о директивах НаКлиенте, НаСервере, НаСервереБезКонтекста</a></li>
                        <li><a href="#work-forms-context">Контекст модуля формы</a></li>
                        <li><a href="#work-forms-events">События формы и её элементов в модуле формы</a>
                            <ul class="list2">
                                <li><a href="#work-forms-events-1"><b>"ПриСозданииНаСервере", "ПриОткрытии"</b>. Свойство <b>"Параметры"</b> у формы. <b>"Ключевой параметр"</b></a></li>
                            </ul>
                        </li>
                        <li><a href="#work-forms-prog-open-form">Программно открываем формы. Метод <b>ОткрытьФорму()</b></a></li>
                        <li><a href="#work-forms-prog-param-form">Передача праметров в форму</a></li>
                        <li><a href="#work-forms-prog-form">Форма как программный объект</a></li>
                    </ul>
                </li>
                <li><a href="#work-forms-select">Форма выбора</a>
                    <ul class="list2">
                        <li><a href="#work-forms-select1">Основы</a></li>
                        <li><a href="#work-forms-select2"></a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><a href="#table-part">Работа с <b>табличной частью</b></a>
            <ul class="list2">
                <li><a href="#table-part1">Как включить <b>подвал</b> и вывести в него итоги</a></li>
                <li><a href="#table-part2">Запрещаем изменение значений реквизитов в табличной части на форме</a></li>
                <li><a href="#table-part3">Размещаем в ком. панели таб. части кнопку "Подбор" и по ней открываем форму выбора справочника Номенклатура. Из формы выбора выбираем товар и он добавляется в таб. часть</a></li>
                <li><a href="#table-part4">Свойство "Проверка заполнения" для табличной части</a></li>
            </ul>
        </li>
        <li><a href="#work-buttons">Работа с <b>кнопкой выбора/выпадающего списка/очистки/регулирования/открытия/создания</b> у поля ввода и с их событиями</a>
            <ul class="list2">
                <li><a href="#work-buttons1">Основы</a></li>
                <li><a href="#work-buttons2">Кнопка выбора</a>
                    <ul class="list2">
                        <li><a href="#work-buttons2a"></a></li>
                        <li><a href="#work-buttons2b"></a></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><a href="#reg-copy-0">Отдельно об <b>регистре накопления</b></a>
            <ul class="list2">
                <li><a href="#reg-theory">Теория</a></li>
                <li><a href="#reg-copy-0.1">Команда перехода к движениям в форме документа</a></li>
                <li><a href="#reg-copy-1">Основная таблица регистра накпления</a></li>
                <li><a href="#reg-copy-2">Виртуальная таблица Остатки</a></li>
                <li><a href="#reg-copy-3">Виртуальная таблица Обороты</a></li>
                <li><a href="#reg-copy-4">Виртуальная таблица ОборотыИОстатки</a></li>
                <li><a href="#reg-copy-5">Выборка из виртуальной таблицы Остатки объектным и табличным способом</a></li>
                <li><a href="#reg-copy-6">Для чего <b>поле "Активность"</b> в таблице регистра накопления в БД</a></li>
                <li><a href="#reg-copy-7">Как не записывать одинаковые товары в регистр при проведении</a></li>
                <li><a href="#reg-copy-8">Регистр <b>"Взаиморасчеты"</b> и отчёт по нему. <b>"Пользователские поля" для отчёта</b></a></li>
                <li><a href="#document17">Регистр <b>"Продажи"</b> и отчёт по нему</a></li>
                <li><a href="#reg-copy-9">Отличие оборотного регистра накопления от остаточного. Свойство <b>"Использовать в итогах"</b>, кнопка <b>"Агрегаты"</b>.</a></li>
                <li><a href="#reg-copy-10">Отличие оборотного регистра накопления от остаточного в выборе измерений</a></li>
                <li><a href="#reg-copy-11">Свойство <b>"Разрешить разделение итогов"</b> регистра накопления на вкладке "Прочее"</a></li>
                <li><a href="#reg-copy-12">Подробно про итоговую таблицу остатков и оборотов. <b>"Итоговая таблица остатков и оборотов"</b></a></li>
                <li><a href="#reg-copy-9"></a></li>
                <li><a href="#reg-copy-9"></a></li>
            </ul>
        </li>
        <li><a href="#reg-info">Отдельно об <b>регистре сведений</b></a>
            <ul class="list2">
                <li><a href="#reg-info-theory">Теория</a></li>
                <li><a href="#reg-info-example">Примеры использования регистра сведений</a></li>
                <li><a href="#reg-info-1">Что такое регистр сведений</a></li>
                <li><a href="#reg-info-2">Что такое измерение и ресурс</a></li>
                <li><a href="#reg-info-3">Рассмотрим переодический регистр сведений</a></li>
                <li><a href="#reg-info-4">Добавление переодического регистра сведений. Свойство <b>Ведущее</b>. Свойство <b>"Основной отбор по периоду"</b> и <b>"Основной отбор"</b></a></li>
                <li><a href="#reg-info-5">Создание записей в регистре сведений.</a></li>
                <li><a href="#reg-info-6">Автоматическая подстановка цены в поле "Цена" табличной части документа при выборе номенклатуры. Обращение к регистру сведений "Цены на номенклатуру" с помощью <b>объектной модели</b></a></li>
                <li><a href="#reg-info-7">Запись в регистр сведений из документа числовых значений</a></li>
                <li><a href="#reg-info-8">Запись в регистр сведений из документа не числовых значений</a></li>
                <li><a href="#reg-info-9"><b>Запись или добавление</b> в регистр сведений записей <b>программно</b> из обработки</a></li>
                <li><a href="#reg-info-10">Читаем данные из регистра сведений с помощью <b>табличной модели</b>(пишем запрос)</a></li>
                <li><a href="#reg-info-11">Дополнение от меня.</a></li>
                <li><a href="#reg-info-12">Виртуальная таблица РегистраСведений - СрезПервых и СрезПоследних</a></li>
                <li><a href="#reg-info-13">Выводим текущие цены из регистра сведений на начальную страницу</a></li>
                <li><a href="#reg-info-14">Разница между методами <b>Получить()</b>, <b>ПолучитьПервое()</b> и <b>ПолучитьПоследнее()</b> у менеджера регистра сведений при попытке получить ресурс из БД.</a></li>
                <li><a href="#reg-info-15">Миг связанный с получением цены из регистра сведений при добавлении товара в табличной части документа.</a></li>
                <li><a href="#reg-info-16">Изменяем данные в независимом переиодическом регистре сведений по <b>отбору</b> по поставщикам(по измерению)</a></li>
                <li><a href="#reg-info-17">Записываем и изменяем данные в периодическом зависимом регистре сведений в обработчике "ПриЗаписи". Что такое отбор, что такое <b>транзакции. Отбор по регистратору</b>. Показан алгоритм записи в регистр сведений без помощи платформы, а именно без свойства Движения, по такому алгоритму помжно записывать в регистр из любого модуля системы. Тут много понятной теории, полезно перечитать.</a></li>
                <li><a href="#reg-info-18">Отличие метода РегистрСведенийМенеджер.&lt;Имя регистра сведений>.<b>СоздатьНаборЗаписей()</b> от РегистрСведенийМенеджер.&lt;Имя регистра сведений>.<b>СоздатьМенеджерЗаписи()</b></a></li>
            </ul>
        </li>
        <li><a href="#enumeration"><b>Перечисления</b>. Тут много взято из книги Хрусталёвой "Пособие ...". Не все статьи тут прям про объект перечисление, но все примеры связаны с ним. Полезно почитать как для ссылок делать свои представления, как отделить материалы от услуг при проведении документа.</a>
            <ul class="list2">
                <li><a href="#enumeration-1">Что такое Перечисление</a></li>
                <li><a href="#enumeration-2">Добавление перечисления и привязка его значений к реквизиту "Вид номенклатуры" справочника "Номенклатура"</a></li>
                <li><a href="#enumeration-3">Произвольное представление номенклатуры</a></li>
                <li><a href="#enumeration-4">Запись в движения только той номенклатуры, которая является материалом</a></li>
            </ul>
        </li>
        <li><a href="#11b">Крестики-нолики</a></li>
        <li><a href="#12">Объектная модель запросов к БД</a></li>
        <li><a href="#common_obj">Объекты из дерева "Общие"</a>
            <ul class="list2">
                <li><a href="#func_options">Функциональные опции</a></li>
                <li><a href="#roli">Роли</a></li>
                <li><a href="#"></a></li>
            </ul>
        </li>
        <li><a href="#query">Заметки по <b>запросам</b></a>
            <ul class="list2">
                <li><a href="#query1">Как в результате запроса сделать, чтобы в отсортированном списке одну нужную мне запись поднять вверх списка или опустить на низ</a></li>
                <li><a href="#query2">Как получить 2 таблицы с данными в одном запросе. Пакет запросов, метод <b>ВыполнитьПакет()</b>.</a></li>
                <li><a href="#query2"></a></li>
                <li><a href="#query2"></a></li>
            </ul>
        </li>
        <li><a href="#command">Работа с <b>командами</b></a>
            <ul class="list2">
                <li><a href="#command1">В общем о командах</a></li>
                <li><a href="#command2">Пример. Зададим команду(кнопку) для документов вида "ПоступлениеТоваров"</a></li>
                <li><a href="#command3">Общая команда, которая открывает параметры учёта</a></li>
                <li><a href="#command4">Сделаем команду "Печать" для документа "ПродажаТоваров" без конструктора</a></li>
                <li><a href="#command5"></a></li>
                <li><a href="#command6"></a></li>
            </ul>
        </li>
        <li><a href="obj-data">Объектные и не объектные данные в БД</a></li>
        <li><a href="#14">Объект встроенного языка УправляемаяФорма</a>
            <ul class="list2">
                <li><a href="#14a">Получение данных полей табличной части из элементов формы документа</a></li>
                <li><a href="#14b">Выносим процедуру подсчёта суммы в Общие Модули</a></li>
                <li><a href="#14c">Свойства и методы управляемой формы</a></li>
            </ul>
        </li>
        <li><a href="#15">Модули</a>
            <ul class="list2">
                <li><a href="#gc">Глобальный контекст</a></li>
                <li><a href="#15a">Модуль управляемого приложения</a></li>
                <li><a href="#15b">Общие модули.</a></li>
                <li><a href="#15c">Модуль объектов. Что такое ДокументМенеджер и ДокументОбъект.</a></li>
                <li><a href="#15d">Модуль форм</a></li>
                <li><a href="#15e">Модуль сеанса</a></li>
                <li><a href="#15f">Модуль внешнего соединения</a></li>
                <li><a href="#15g">Модуль менеджера</a></li>
                <li><a href="#15h">Модуль команды</a></li>
            </ul>
        </li>
        <li><a href="#17">Анализ незнакомого кода с помощью синтакс-помощника</a></li>
        <li><a href="#18">Анализ кода с помощью отладчика</a></li>
        <li><a href="#19"></a></li>
        <li><a href="#20"></a></li>
        <li><a href="#21"></a></li>
        <li><a href="#22"></a></li>
        <li><a href="#23"></a></li>
        <li><a href="#24">Директивы <b>&НаСервере</b>, <b>&НаСервереБезКонтекста</b></a></li>
    </ul>







    
    <h3 class="header-style2" id="0">Основная конфигурация(Метаданные), Конфигурация БД.</h3>
    <img src="../img/1С-1/2023-04-17_18-38-07.png" class="screen" alt="">
    <p>Мы можем наглядно это увидеть. Например, создадим в нашей рабочей(основной) конфигурации справочник любой и сохраним, но не обновляем БД, затем можно открыть конфигурацию БД в меню сверху - Конфигурация -> Конфигурация базы данных -> Открыть конфигурацию БД. Откроется в окне конфигурация БД и в ней если раскрыть дерево справочников, то там не увидем тот справочник, который мы создали в своей рабочей. Если образно, то наша рабочая конфа это черновик, а конфа БД это уже чистовик. Чтобы наш справочник появился в БД нажимаем бочёнок.</p>
    <p>Дополнительно про устройство информационной базы можно почитать в книге Хрусталёвой в последнем разделе "Теория" главы про справочники.</p>













    <h3 class="header-style2" id="notes">Короткие заметки по 1С</h3>
    <ul class="list">
        <li>Важной особенностью языка запросов в системе 1С:Предприятие является то, что он обеспечивает доступ к данным ТОЛЬКО ДЛЯ ЧТЕНИЯ. Для ЗАПИСИ же информации используются конструкции на встроенном языке 1С:Предприятие, а именно типы данных ДокументОбъект.ИмяДокумента, СправочникОбъект.ИмяДокумента и другие подобные типы.</li>
        <li>Справочники/Документы – это коллекция менеджеров всех справочников/документов, содержащихся в конфигурации. Коллекция имеет тип данных СправочникиМенеджер/ДокументыМенеджер</li>
        <li><b>Макет</b> предназначен для хранения различных форм представления данных, которые могут потребоваться каким-либо объектам конфигурации или всему прикладному решению в целом. Макеты нужны для вывода данных из систему 1С. Если формы служат для ввода данных пользователем, то макеты представляют из себя шаблоны, которые позволят данные из системы вывести.</li>
        <li>Если у нас в справочнике заполнены какие то данные и с течением времени, какие то данные устарели(например, поменялся товар), то нежелательно их переписывать на другие данные, потому что потом в других документах и справочниках ссылающихся на данный справочник заменятся одни данные на другие и будет уже путаница. Вот если, например, мы написали в справочнике товар с опечаткой и потом написали кучу документов, которые ссылаются на этот справочник и позже заметили ошибку в слове, то можно в справочнике исправить имя товара и он исправиться во всех документах, такое можно делать. Но если имя товара меняется кардинально, например  с Шапка, на Пальто, то так не надо делать. Ну или мы хотим чуть подкорректировать адрес, то так можно делать. Главное чтобы суть оставалась прежней.</li>
        <li>В объекте документа, например, Покупка есть во вкладке Прочее - Модуль объекта. Этот модуль нужен для кода обработки по событиям, например проведения и записи документа. Также могут быть и просто экспортные процедуры и функции. А в модуле менеджера находятся вспомогательные процедуры и функции, например, как я помню там обрабатывается взаимодействие с макетом печатной формы документа.</li>
        <li>Чтобы очистить регистр накопления можно всем документам отменить проведение, которые в этот регистр делают записи.</li>
        <li>Условное проведение документа. Когда мы проводим документ, который делает приход товара, то там всё просто, мы делаем запись в регистре накопления, например, товар, его количество и цену или сумму. Такое проведение называется безусловным. Но когда мы потребляем товар, то на м нужно вычислить сколько стоит употреблённый товар, ведь мы можем купить один и тот же товар по разной цене. В этом случае есть 3 способа вычислить стоимость товара: 1) Высчитать среднеарифметическое, 2) 3). Также нам нужно проверить перед употреблением товара, а есть ли он на складе или в холодильнике. В общем такое проведение называется условным, т.е. более умным, с разными условиями.</li>
        <li>Когда есть процедура на клиенте и эта процедура вызывает процедуру на сервере, то данные шапки документа неявно передаются на сервер и доступны в сервеной процедуре. Данные табличной части надо передаваать самому. Ну это пока я так понял. А вообще слышал что все данные документа неявно передаются на сервер.</li>
        <li>Когда сотрудника на предприятии переводят в другое подразделение, то издаётся кадровый приказ о его переводе. В 1с должен быть документ о перемещении сотрудников на предприятии. Документ можно так и назвать "Кадровый приказ"</li>
        <li>Тонкий клиент это приложение на клиентской стороне, которая берёт на себя роль отображать данные и расчёт каких то алгоритмов тоже может выполнять. Непосредственно обработка данных и чтение их выполняются на серверной стороне.</li>
        <li>Толстый клиент содержит средство разработки - конфигуратор</li>
        <li>Веб клиент находится в браузере, подключаясь к веб серверу. Веб сервер через какие то компоненты взаимодействует с серверами(кластерами серверов) 1с предприятия.</li>
        <li>Во Вкладке Данные у справочника есть такой раздел как Основное представление и 2 выбора: 1)В виде кода, 2)В виде наименования. Так вот это представление ссылки какого то элемента справочника где то в другом объекте. Например в справочнике Еда есть поле с типом СправочникСссылка.Вкусы и выбирая из списка какой то вкус, система в это место записывает ссылку на элемент справочника Вкусы. Ссылка обычно выглядит примерно так - 12хlksd9033ij09w3ojir09uisd2903u2ht68sd, чтобы не пугать пользователя такой аброкадаброй мы и указываем как представлять ссылку? В виде наименования или в виде кода. В 1с предприятии 8.3 появилась возможность описать представление вообще как нам хочется.</li>
        <li>В таблицах документа в БД есть виртуальное поле - МоментВремени. Это поле содержит дату документа и представление ссылки, выглядит примерно так - 25.02.2022 0:00:00;Поступление товаров 2 от 25.02.2022 0:00:00. Так как в одну секунду могут быть записаны несколько документов, чтобы их как то отделять создали такое поле и добавили к дате ссылку, по этой ссылке в одной секунде и отличаются документы.</li>
        <li>В таблицах документа в БД есть виртуалное поле Представление, это представление ссылки в виде наименования(конечно если в настройках задано представление в виде наименования).</li>
        <li>В таблице БД РегистрНакопления есть поле Активность. Это поле говорит системе о том, будет ли запись, у которой Активность стоит ДА учавствовать в построении виртуальных таблиц этого регистра. Иногда проще поставить записи значение НЕТ в поле Активность  чем её удалять.</li>
        <li>Виртуальная таблица РегистрНакопления.Продажа.Обороты. В этой вирт. таблице есть 4 параметра - началоПериода, конецпериода, Периодичность и Условие. Мы можем задать отрезок времени, на который хотим получить оборот продаж. А можно задать переиодичность, например, Месяц и за каждый месяц нам выдаст обороты продаж. При периодичности появится новое поле в таблице с периодом, где будут помесячно показаны продажи товаров.</li>
        <li>ВАЖНО!!! Когда мы в конструкторе запросов пишем Условие для виртуальной таблицы, то часто бывает что в виртуальной таблице задаём такое условие: Товар В(&lt;тут вложенный запрос>). Чтобы руками не писать вложенный запрос, сделаем один отступ в нутри скобок и выделим этот пробел и правой кнопкой мыши можно будет открыть ещё один конструктор запроса для написания вложенного запроса.</li>
        <li>WebЦвета - коллекция цветов по их названиям.</li>
        <li>Символы - коллекция разных отступов. Например, Символы.ПС - это перенос строки.</li>
        <li>OLE-объектом называется любой документ, сформированный с использованием технологии OLE (Object Linking and Embedding). Многие программные приложения, работающие под управлением Windows, поддерживают данную технологию и формируют документы, которые могут быть переданы другому программному приложению в качестве объекта.</li>
        <li>Документ перед проведением сначала записывается в БД.</li>
        <li>Бывает такое явление как остатки записей в регистре с осатком суммы от товара. Поступили одинаковые товары, но с разной ценой, мы их посчитали и для каждого высчитали среднюю стоимость(среднюю стоимость мы высчитываем, потому что товар один , а цены разные и нам при списании одного товара нужно списать и его сумму, а как понять какая именно у него сумма, поэтому и расчитываем среднюю на все товары и при списании списываем эту среднюю цену) и округлили, затем при списании всех товаров, товары будут 0, а сумма может зависнуть как -0.01 или ещё как то. Это всё из за округления, потому что при округлении мы теряем какие то микро копейки и их потом уже будет не хватать или наоборот будет больше. Нужно как то выкручиваться и не допускать в таких случаях округления. Можно конечно не округлять и записывать прям так с большим числом после запятой, тогда всё будет нормально. Узнаю другие решения допишу.</li>
        <li>В документах продажи или покупки товаров часто указывают реквизит "СуммаДокумента". Это считается избыточным реквизитом, но польза от него есть и не маленькая. Например, этот реквизит хорошо видно в списке документов одного вида и не нужно заходить в сам документ, чтобы увидеть всю сумму стоимости товаров в его табличной части. Или сумму документа можно вынести в отдельную колонку(графу) в журнале документов, где также мы сразу в списке видем сумму.</li>
        <li>Если мы хотим получить из виртуальной таблицы "остатки" данные на какой то период времени, например на 22.03.2023 18:00:00 и у нас есть в записях БД данные на эту секунду, то мы не получим эти данные, потому что это особенность вирт. таб. "остатки". Чтобы получить эти данные нужно прибавить к дате секунду. Виртуальная таблица "обороты" работает по другому, на период от 22.03.2023 00:00:00 до 22.03.2023 18:00:00 мы получим все данные в этом периоде и даже те, которые находятся на этой секунде, т.е. не нужно как в остатках прибавлять секунду.</li>
        <li>У документов на закладке Движения есть такой пункт как Удалять движения и там по умолчанию выбрано "Удалять автоматически при отмене проведения". Но бывают случаи, когда мы провели документ и он записал в какой то регистр какие то данные и потом перепроводим этот документ снова. При проведении мы обращаемся за данными в этот регистр куда этот документ пишет записи и при перепроведении мы уже получим данные из регистра с учётом того, что этот документ уже изменил записи при первом проведении. Т.е. при первом проведении данные мы получали одни из регистра, а уже при повторном проведении этого документа данные уже другие(они изменились при первом проведении). Такое поведение нас не устраивает, мы хотим при повторном проведении получать данные как при первом, поэтому выберем другое значение у пункта "Удалять движения" на "Удалять автоматически". В этом случае при повторном проведении данные из регистра удаляться и запишутся снова при перепроведении. Есть разные способы решения этой проблемы. Описал самый простой способ.</li>
        <li>Стандартный реквизит "Наименование" у справочников имеет ограниченную длину(150 символов), поэтому используется для коротких именований чего то. Чтобы описать полное наименование, создаётся дополнительный реквизит.</li>
        <li>Есть справочник СтавкиНДС, в котором обозначенно несколько предопределённых элементов с именами НДС10 и НДС18. Чтобы получить из базы эти данные можно просто вызвать Справочники.СтавкиНДС.НДС18 или Справочники.СтавкиНДС.НДС10, т.е. мы не делаем запросов в объектной или табличной модели. Такое получение возможно только с предопределёнными данными.</li>
        <li>Если у нас есть переменная, в которой лежит ссылка с типом СправочникСсылка.ИмяСправочника или ДокументСсылка.ИмяДокумента, то на сервере мы через эту ссылку можем прочитать значения любых полей из объекта БД, на который указывает эта ссылка.</li>
        <li>ПредопределенноеЗначение() - на клиенте эта функция позволяет получить данные, из БД на сервере, объекта Перечисления. Пример, ПредопределенноеЗначение("Перечисление.СпособыОплаты.Безналичные") - вернёт значение Безналичные из таблицы Перечисление.СпособыОплаты. С этим значением можно сравнить значение реквизита в форме, выбранного пользователем. Если значение реквизита будет Безналичные с типом реквизита Перечисление.СпособыОплаты, то сравнение вернёт Истину.</li>
        <li>Как то не мог найти, как заблокировать колонку табличной части для изменений. Пытался через Элементы найти колонки в табличной части, заблокировать их при открытии формы, но не получалось. Оказалось просто нужно выбрать поле табличной части и в палитре свойств поставить галочку "Только просмотр".</li>
        <li>Бывает такой эффект как одинаковые коды в справочнике. Например, мы создали элемент справочника(000000001), а позже создали 2 предопределённые группы в этом справочнике. Предопределённые группы начинают отчёт тоже с начала и имеют коды (000000001 и 000000002). И получаемся у нас 2 элемента с одинаковым кодом.</li>
        <li>Есть документ "ПродажаТоваров" и в нём есть реквизит "СуммаДокумента". Нужно заполнять этот реквизит перед записью. Код можно написать в модуле формы, а можно в модуле объекта. И там и там есть событие "ПередЗаписью". Отличие в том, что если мы будем программно записывать документ, то событие формы "ПередЗаписью" не сработает, а событие "ПередЗаписью" в модуле объекта сработает. Вывод, лучше описывать заполнение реквизита "СуммаДокумента" в модуле объекта.</li>
        <li>Чтобы найти какой то код или объект конфы в конфигурации то Правка -> Глобальный поиск.</li>
        <li>В форме списка какого то объекта конфы есть основной реквизит Список, у этого реквизита в палитре свойств есть закладка "Объект" и в ней свойство "Основная таблица". Это свойство показывает какую таблицу из БД Список отображает на форме. Таблицу можно поменять или написать свой запрос, что отображать в этом списке.</li>
        <li>1С работает с переменнными как и JS по новому стандарту через "let". В 1С как и в JS(через let) при первом проходе разборщика по коду он определяет все переменные объявленные ниже по коду в значение Неопределено в начале кода, но это не значит что можно присваивать переменные друг в друга в начале кода до их объявления(объявление происходит через Перем или при присвоении значения), это можно сделать при объявлении в JS через "var". Но в отличии от JS в 1С видимость переменных объявленных где то в блоке(в скобках {}) видна и вне этого блока, в JS, если переменная объявлена где то в блоке, то она там и видна, вне блока нет такой переменной, в 1С есть.</li>
        <li>Сайт портал это такой сайт, который может пользователя перенаправлять по разным ссылкам на какие то конкретные площадки.</li>
        <li>Когда нужно обрабатывать ОШИБКИ? Если методы, например коллекций, возвращают значения типо Неопределено, а где то дальше по коду мы с вернувшимся значением производим операции, то такое значение всегда нужно обрабатываеть через условие, мол если вернулось неудачное значение, то то -то и то-то сделать, а если удачное, то продолжить операции.</li>
        <li>Файл базы данных(1Cv8.1CD) нужно периодически копировать на запасной носитель. Такие копии программисты называют "бэкап", от английского back up выполнять резервное копирование.</li>
        <li>Чтобы сделать какую то обработку данных в системе 1С используются обработки, но можно обойтись и без них, но скорее только в учебных целях(но это не точно). Можно использовать в модуле приложения(он выполняется только на клиенте) обработчик события "ПриНачалеРаботыСистемы", который будет вызывать процедуру из общего модуля. Общий модуль сделаем доступным только на сервере, для этого поставим галочку "Сервер" и чтобы можно было вызвать процедуру из общего модуля от клиентского модуля приложения нужно ещё поставить галочку "Вызов сервера"(это обязательно) в свойствах общего модуля. Затем в процедуре общего модуля пишем логику с изменениями каких то данных в БД и при запуске системы срабатывает событие "при начале работы системы" и запускается обработчик в модуле приложения, который запускает процедуру из общего модуля на сервере и что то меняет на сервере. Вот такой есть способ сделать обработку данных. Ну правда придётся перезапускать 1С предприятие, чтобы выполнить обработку.</li>
        <li>Изменять, удалять и записывать в БД может только тип СправочникОбъект.ИмяСправочника, ДокументОбъект.ИмяДокумента и прочие похожие объекты. У этих объектов есть свои модули с предопределёнными обработчиками событий, называется - модуль объекта. Так как эти объекты могут записывать в БД, то и события у них есть разные - "ПередЗаписью", "ПриЗаписи", "ПередУдалением" и прочие.</li>
        <li>Важно. Если мы делаем отчет, то в запросе для ссылок, если мы их выбираем, нужно также выбрать представление этих ссылок, иначе система где то в цикле будет делать мини запросы, чтобы для каждой ссылке получить представление. Если мы делаем обработку, которая не предполагает вывод ссылок на экран, а просто использет где то внутри себя данные, то там не нужно выбирать представление ссылок. Если запрос в СКД, то получать представление не нужно, СКД сама их получит</li>
        <li></li>
        <li></li>
        <li></li>
    </ul>











    
    <h3 class="header-style2" id="props">Свойства реквизитов объектов конфигурации</h3>
    <ul class="list">
        <li><b>"Проверка заполнения"</b> - значение "Выдавать ошибку" заставляет пользователя ввести данные в поле</li>
        <li><b>"Связи параметров выбора"</b> - позволяет создать связь между реквизитами. Например, есть 2 реквизита - "Контрагенты" и "ДоговорыКонтрагентов" или "Контрагенты" и "КонтактныеЛица", 2й подчинён 1му. На форме мы указываем контрагента в реквизите "Контрагент", затем при указании договора в реквизите "ДоговорыКонтрагентов" нам откроется форма выбора со всеми договорами, а мы хотели бы чтобы договора были только те, которые относятся к выбранному контрагенту. Вот как раз через это свойство и настраивается связь этих реквизитов. В свойстве нужно будет выбрать поле Контрагенты и Отбор по Владельцу. Отбор по Владельцу обычно сам подставляется, но если у реквизита "ДоговорыКонтрагентов" составной тип, то нужно вручную выбрать Отбор по Владельцу. Другой пример свойства "Связи параметров выбора". Документ "ПродажаТоваров", у него есть таб. часть Товары, мы при создании новой строки в таб. части начинаем выбирать товар и если мы открываем форму выбора справочника Номенклатура(почему если, потому что можно и не открывать форму, можно сразу в подсказке выбрать нужный товар), то в эту форму можно передать параметр. Какой параметр и куда? Форма выбора справочника использует для отображения данных динамический список "Список", этот список можно настроить создав произвольный запрос к БД. В произвольном запросе мы пишем свой запрос, напрмер, к виртуальной таблице "Остатки" и в эту таблицу хотим передать параметр &Дата. Запрос составили, параметр обозначили, теперь надо как то передать этот параметр в этот запрос. Тут и поможет это свойство. Мы идём в документ и для реквизита Товар таб. части Товары в свойстве "Связи параметров выбора" в окне слева выбираем доступное нам свойство Дата и переносим вправо, в колонке Имя указываем имя для этого реквизита такое какое указали в запросе. "Связи параметров выбора" - это мы делаем связь текущих реквизитов документа с открывающейся формой выбора, т.е можно передать парметр только из реквизитов текущего документа, а "Параметры выбора" это можно передать в форму выбора любой параметр, какой захотим.</li>
        <li><b>"Параметры выбора"</b> - свойство позволяет задать параметры, по которым будет произведён запрос в БД и нам в форме выбора выдаст результат этого запроса. Можно задавать для реквизита в форме, тогда будет только для этой формы, а можно задать для реквизита объекта конфы, тогда будет работать для всех форм. Например, в табличной части Товары в колонке Товар мы выбираем товар и нам откроется форма выбора со всей номенклатурой(Товары, Услуги и прочее). Мы хотим, чтобы открывался список только товаров без услуг и прочего. В конфе для этой колонки и задаём в свойстве "Параметры выбора" те параметры, по которым и будут отбираться только товары. Что это за параметры зависит от того как мы обозначали, что товар это товар, а услуга это услуга. Например, в справочнике Номенклатура мы добавили реквизит "ВидНоменклатуры", тип у этого реквизита ПеречислениеСсылка.ВидНоменклатуры, это значит что мы создали объект конфы Перечисления "ВидНоменклатуры" и задали ему 2 значения - Товар и Услуга. И когда мы создаём товар в справочнике то указываем в реквизите "ВидНоменклатуры" из списка перечисления товар это или услуга. В этом примере мы обозначили товары и услуги вот так. Теперь, какие парметры нужно задать в свойстве "Параметры выбора", чтобы в табличной части Товары выбирать только товары? Идём в конфу и для реквизита Товар табличной части Товары(в каком нибудь документе) в палитре свойств открываем "Параметры выбора", в окне добавляем новый параметр и выбираем Отбор.ВидНоменклатуры, в значении выбираем что это ПеречислениеСсылка.ВидНоменклатуры и затем выбираем значение Товар.
        <b>Другой пример</b>. Обозначим товары и услуги теперь по другому. Добавим в справочник Номенклатура реквизит Услуга и дадим ему тип булево, это значит, что этот реквизит будет отображаться в виде галочки. Заходим в пользовательский режим и заполняем товары и услуги и для каждого указываем галочкой услуга это или нет. Для товарв ничего не ставим, а для услуг ставим эту галочку. Вот так обозначили где товар, а где услуга. Теперь опять идём в конфу и для реквизита Товар табличной части Товары в ствойстве "Параметры выбора" открываем окно и добавляем параметр Отбор.Услуга, а в значении указываем тип булево и выбираем значение Ложь. Т.е. у нас будет открываться список только товаров. Если же нам для колонки Товар надо открывать только услуги, то в значении параметра выбираем значение Истина для Отбор.Услуга.
        Ещё один пример, у нас есть справочник Сотрудники, в нём 2 предопределенных группы с именами - Работающие и Уволенные. В документе ПродажаТоваров есть поле Сотрудник и мы хотели бы при открытии формы выбора сотрудников видет там только работающих из папки Работающие. Также в форме документа для реквизита Сотрудник жмём на свойство "Параметры выбора" и добавляем новый параметр - Отбор.Родитель и в значении выбираем тип СправочникСсылка.Сотрудники и выбираем значение Работающие(т.к. группа является тоже элементом справочника, поэтому и тип такой).
        Вывод. "Праметры вывода" это параметры для запроса в БД, по которым будет отбираться результ.</li>
        <li><b>"ВыборГруппИЭлементов"</b> - например есть реквизит и у него тип СправочникСсылка.<Имя справочника>, т.е. реквизит открывает форму выбора элементов справочника, в пользовательской части я хочу выбрать из этого реквизита именно группу, но система скажет, что нельзя выбрать группу, нужно выбрать элемент справочника. Так вот чтобы появилась возможность выбирать группу есть свойство у реквизита - "ВыборГруппИЭлементов". Для этого свойства нужно выбрать значение "Групп".</li>
        <li><b>"Поведение"</b> - можно добавить в форму обычную группу(с отображением) и в неё поместить какие то поля, зададим этой группе заголовок. Всё, теперь мы видим заголовок этой группы и помещённые в неё поля, но можно сделать так, чтобы по клику на заголовок группы содержимое скрывалось или показывалось. Для этого нужно настроить свойство "Поведение" и выбрать значение "Свертываемая".</li>
        <li><b>"Использование"</b> - есть такое свойство у реквизитов объектов конфигурации, у реквизитов форм такого не видел. Допустим у нас есть иерархический справочник Номенклатура с реквизитом ВидНоменклатуры и мы хотим обработкой заполнить этот реквизит значениями Перечисления - Товар, Услуга, Материал. Мы в форме обработки запросом получаем все элементы справочника и пытаемся в поле ВидНоменклатуры вставить значение, но вылезает ошибка - "Реквизит не доступен для группы". Это значит что при получении элементов справочника из БД мы получили и группы, в реквизит которых пытаемся записать значение, но стоит защита от такой записи для групп. Свойство "Использование" как раз и позволяет указать для каких эзаписей справочника доступна запись в реквизит. По умолчанию стоит "Для элемента", т.е не для группы. Но можно выбрать и для групп, хотя где это требуется пока не знаю.</li>
        <li><b></b></li>
    </ul>











    <h3 class="header-style2" id="1">Типы данных</h3>
    <p>1. <b>Простые типы</b>:  1)Строка - "", 2)Число - 2, 3)Дата - '19610412'(ггггммдд), 4)Логический тип(Булево) - Истина или Ложь(Выводит Да или Нет), 5)Неопределено - когда объявили переменную, но ничего туда пока не положили, 6)Тип - используется для того, чтобы хранить в себе описание типа данных. Обычно используется в условных операторах при сравнении с каким то типом, например: Если ТипЗнч(Номенклатура) = Тип("СправочникСсылка.Номенклатура") Тогда ... , 7)NULL - то же самое что и Неопределено, но только для БД используется в запросах. Обозначает что нет вообще ничего, пустота.</p>
    <p>Подробнее о <a href="#string">строках</a></p>
    <p>Подробнее о <a href="#num">числах</a></p>
    <p>Подробнее о <a href="#date">датах</a></p>
    <p class="title-size16"><b>Сложные типы данных</b>.</p>
    <ul class="list">
        <li><b>Ниже перечислены универсальные коллекции.</b>Большое количество коллекций нужно для решения своих каких то задач. В синтакс помошнике можно посмотреть справку по всем этим коллекциям в разделе "Универсальные коллекции значений"</li>
        <li><b><a href="#array">Массив</a></b></li>
        <li><b><a href="#structure">Структура</a></b></li>
        <li><b><a href="#accordance">Соответствие</a></b></li>
        <li><b><a href="#list">Список значений</a></b></li>
        <li><b><a href="#table">Таблица зачений</a></b>
            <ul class="list2">
                <li><a href="#table-1">Отображение виртуальной таблицы регистра накопления Остатки в таблице значений формы внешней обработки, документа или ещё чего.</a></li>
            </ul>
        </li>
        <li><b><a href="#tree">Дерево значений(ещё не описан)</a></b></li>
        <li><b><a href="#table-doc">Табличный документ(ещё не описан)</a></b></li>
    </ul>







    <h3 class="header-style2" id="1a">Преобразование типов данных</h3>
    <p>Чтобы преобразовывать типы есть встроенные методы. Например преобразовать другой тип в строку - <b>Строка(23)</b> -> "23". Или другой способ: "12" + 23 -> "1223". Наоборот уже не стработает - 23 + "12" -> 35(если левый операнд число, то правый операнд будет преобразован в число). И так тоже будет преобразовано в число - Истина + "12" -> 13(Истина преобразовалась к 1)</p>
    <p>Остальные методы - Число(), Булево(), Дата().</p>







    <h3 class="header-style2" id="structure-module">Структура модуля</h3>
    <p>Тут Чистов объясняет эту тему начиная с 32 минуты - https://www.youtube.com/watch?v=woEuN_YkfME&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=57</p>
    <p>Код в модуле интерпритируется с предварительной компиляцией. Что это значит? Это значит то, что до интерпритации кода(построчное считывание и выполнение кода, как скрипты) система проходит по коду и компилирует его. Как мы значем структура модуля следующая:</p>
    <img src="../img/1С-1/2023-08-10_09-20-08.png" class="screen" alt="">
    <p>Предварительная компиляция модуля происходит при первом обращении к модулю.</p>
    <p>Так что же такое предварительная компиляция? Система проходит по структуре модуля и создаёт таблицы. Когда она в области описания переменных, то она создаёт таблицу переменных, затем проходит по области описания процедур и функций и также создаёт таблицу процедур и функций. Если в этих областях есть объявленные переменные и процедуры, то система кроме того что создала таблицы, она сразу заносит в эти таблицы найденные переменные и процедуры.</p>
    <img src="../img/1С-1/2023-08-12_09-55-25.png" class="screen" alt="">
    <p>Для чего создаются таблицы при предварительной компиляции? Допустим прошла компиляция таблицы с переменными и процедурами созданы, начинается интерпритация кода, т.е. построчное чтение и выполнение. Мы доходим до процедуры и заходим в неё для выполнения, в внутри этой процедуры вызов другой процедуры, которая по коду ниже расположена, и благодаря предварительной компиляции интерпритатор будет знать из таблицы, что есть такая процедура и он переходит на выполнение этой другой процедуры. Короче, предварительная компиляция помогает интерпритатору находить части программы, если они разнесены по разным местам модуля.</p>
    <p>После того как таблицы созданы, интерпритатор начинает работу, можно сказать, с области описания инициализации переменных.</p>
    <p>Переменная, объявленная в области описания переменых через ключевое слово "Перем", видна во всём модуле, даже в процедурах и функциях, т.е. будет глобальной, она будет браться из таблицы переменных. Если же переменную объявить и сразу ей присвоить значение в области инициализации переменых, то такая переменная не видна в процедурах и функциях, чтобы процедуры увидели такую переменную, её нужно передать в неё как параметр.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-g">//вот так процедура не увидит переменную А</span>
            <span class="vue-r">Процедура</span> МояПроцедура<span class="vue-r">()</span>
                Сообщить<span class="vue-r">(</span>А<span class="vue-r">);
            КонецПроцедуры</span>      

            А <span class="vue-r">=</span> 13<span class="vue-r">;</span> 

            МояПроцедура<span class="vue-r">();</span>

            <span class="vue-g">//а вот так увидит</span>
            <span class="vue-r">Перем</span> А<span class="vue-r">;</span>

            <span class="vue-r">Процедура</span> МояПроцедура<span class="vue-r">()</span>
                Сообщить<span class="vue-r">(</span>А<span class="vue-r">);
            КонецПроцедуры</span>      

            А <span class="vue-r">=</span> 13<span class="vue-r">;</span> 

            МояПроцедура<span class="vue-r">();</span></span>
        </pre>
    </div>
    <p>Бывает такое, что в модуле будет пусто, а логика какя то отрабатывает. Это значит заранее модуль скомпилирован и находится в таком состоянии, а код, понятный человеку удалён.</p>



    




    <h3 class="header-style2" id="2">Операции сравнения</h3>
    <p>1. Равно - =, Не равно - &lt;>, Больше - >, Меньше - &lt;, Больше или равно - >=, Меньше или равно - &lt;=</p>
    <p>2. Операции сравнения со знаками > или &lt; можно производить только с одинаковыми примитивными типами. Например, нельзя сравнивать строку и число, число и дату и т.д.</p>





    <h3 class="header-style2" id="3">Функция Формат</h3>
    <p>Чтобы посмотреть в справке про разные сокращения форматной строки то открываем Справка - Поиск по справке, откроется окно поиска и там пишем "форматная строка", находим открываем и там будут обозначения формата.</p>
    <p>Часто приходится выводить(в те же отчёты) значения различных типов(строки, даты, числа, ...). У каждого из этих значений есть различные отображения. Например, одну и ту же дату('01.01.2005') можно представить в виде строки - "01.01.2005", "1 января 2005", "01.01.05". Всё это строки отображения одного и того же значения, для формировния которых используется функция <b>Формат()</b>. Что эта функция может:</p>
    <ul class="list">
        <li><b>Отключаем группировку разрядов</b> - нам нужно вывести число 10000, пишем Сообщить(10000); выводит 10 000. Так получилось, потому что 1С по умолчанию группирует по 3 цифры начиная справа и разделяет их пробелом. Чтобы отменить это правило напишем Сообщить(Формат(10000, "ЧГ=0")); выыведет 10000</li>
        <li><b>Выводим лидирующие нули</b> - часто нужно выводить лидирующие нули перед цифрой. Например, выведем лидирующий ноль перед цифрой 5 - в виде "05". пишем Сообщить(Формат(5, "ЧЦ=2; ЧВН=")); получим "05". Сообщить(Формат(5, "ЧЦ=3; ЧВН=")); получим "005". Более подробно описано в справке или тут на сайте - https://helpme1s.ru/vnutrennij-yazyk-programmirovaniya-1s-8-3-dlya-nachinayushhix-programmistov-urok-19-format-v-1s</li>
        <li><b>Меняем разделитель целой и дробной части</b> - выведем дробное число со звёздочкой вместо точки. Сообщить(Формат(100.38, "ЧРД=*")); получим 100*38</li>
        <li><b>Задаём разделитель групп</b>
            <ul class="list">
                <li>Формат(1000000, "ЧРГ=*");// 10*000*000</li>
            </ul>  
        </li>
        <li><b>Общее представлении даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДЛФ=Д");// <ins>01.01.2005</ins>.</li>
                <li>Формат('20050101', "ДЛФ=ДД");// <ins>1 января 2005</ins>.</li>
                <li>Покажем время - Формат('20050101', "ДЛФ=В");// <ins>20:01:03</ins>.</li>
                <li>Показ даты с временем - Формат('20050101', "ДЛФ=ДДВ");// <ins>1 января 2005 20:01:03</ins>.</li>
                <li>Показ даты с временем - Формат('20050101', "ДЛФ=ДВ");// <ins>01.01.2005 20:01:03</ins></li>
            </ul> 
        </li>
        <li><b>Отображение часа даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=ч");// 8</li>
                <li>Формат('20050101', "ДФ=чч");// 08</li>
                <li>Формат('20050101', "ДФ=Ч");// 20</li>
                <li>Формат('20050101', "ДФ=ЧЧ");// 20</li>
            </ul>
        </li>
        <li><b>Отображение минуты даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=м");// 1</li>
                <li>Формат('20050101', "ДФ=мм");// 01</li>
            </ul>
        </li>
        <li><b>Отображение секунды даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=с");// 3</li>
                <li>Формат('20050101', "ДФ=сс");// 03</li>
            </ul>
        </li>
        <li><b>Отображение дня недели даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=д");// 1</li>
                <li>Формат('20050101', "ДФ=дд");// 01</li>
                <li>Формат('20050101', "ДФ=ддд");// Сб</li>
                <li>Формат('20050101', "ДФ=дддд");// Суббота</li>
            </ul>
        </li>
        <li><b>Отображение месяца даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=М");// 1</li>
                <li>Формат('20050101', "ДФ=ММ");// 01</li>
                <li>Формат('20050101', "ДФ=МММ");// янв.</li>
                <li>Формат('20050101', "ДФ=ММММ");// Январь</li>
            </ul>
        </li>
        <li><b>Отображение года даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=г");// 5</li>
                <li>Формат('20050101', "ДФ=гг");// 05</li>
                <li>Формат('20050101', "ДФ=гггг");// 2005</li>
            </ul>
        </li>
        <li><b>Отображение квартала от года из даты</b>
            <ul class="list">
                <li>Формат('20050101', "ДФ=к");// 1</li>
            </ul>
        </li>
        <li><b>Округление дробной части через Формат()</b>
            <ul class="list">
                <li>Формат(125.368, "ЧДЦ=2"); // 125.37</li>
                <li>Формат(125.368, "ЧДЦ=1");// 125.4</li>
            </ul>
        </li>
        <li><b>Двигаем разряды числа</b>
            <ul class="list">
                <li>Формат(2, "ЧС=1");// 0.2</li>
                <li>Формат(2, "ЧС=-2");// 200</li>
            </ul>
        </li>
        <li><b>Задаём нулевое представление числа 0</b>
            <ul class="list">
                <li>Формат(0, "ЧН=ноль");// ноль</li>
            </ul>
        </li>
        <li><b>Задаём отображение булевого значения</b>
            <ul class="list">
                <li>Формат(Истина, "БЛ=""врёшь""");// врёшь</li>
                <li>Формат(Ложь, "БЛ=""правду говоришь""");// правду говоришь</li>
            </ul>
        </li>
    </ul>
    <div class="code-style">
        <pre>
            //примеры
            Пример1 = Формат(250.99, "ЧРД==");
            Сообщить(Пример1);//250=99

            Пример2 = Формат(5000, "ЧГ=0");
            Сообщить(Пример2);// 5000

            Пример3 = Формат(235325, "ЧРГ=*");
            Сообщить(Пример3);// 235*325

            Пример4 = Формат(3, "ЧЦ=2; ЧВН=");
            Сообщить(Пример4);// 03

            Пример5 = Формат(0, "ЧН=ноль");
            Сообщить(Пример5);// ноль

            Пример6 = Формат(1, "ЧС=3");
            Сообщить(Пример6);// 0,001

            Пример7 = Формат(10.567, "ЧДЦ=2");
            Сообщить(Пример7);// 10.57

            ПрописьЧисла1 = ЧислоПрописью(9999);
            Сообщить(ПрописьЧисла1);// девять тысяч девятсот девяносто девять 00

            ПрописьЧисла2 = ЧислоПрописью(25.99, ,"рубль,рубля,рублей,м,копейка,копейки,копеек,ж,2");
            Сообщить(ПрописьЧисла2);// двадцать пать рублей 99 копеек


            Квартал = Формат('20140101', "ДФ=к");
            Квартал = Строка(Квартал) + " квартал";
            Год = Формат('20140101', "ДФ=гггг");
            Итог = Квартал + " " + Год;
            Сообщить(Итог); // 1 квартал 2014
                    //или 2 способ
            ПК = ПредставлениеПериода(НачалоКвартала('20140101'),КонецКвартала('20140101'),"ФП=Истина");
            Сообщить(Пк);// 1 квартал 2014г.
            
            
            Пример8 = Формат('20140101', "ДЛФ=ДД");
            Сообщить(Пример8);// 1 января 2014г.

            Пример9 = Формат('20140101', "ДФ=дддд");
            Сообщить(Пример9);// среда

            Пример10 = Формат('20140101', "ДФ=ддд");
            Сообщить(Пример10);// Ср

            Пример11 = Формат('20140101', "ДФ=ММММ");
            Сообщить(Пример11);// Январь

            Пример12 = Формат('20140101', "ДФ=МММ");
            Сообщить(Пример12);// янв.

            Пример13 = Формат('20140101', "ДЛФ=Д");
            Сообщить(Пример13);// 01.01.2014

        </pre>
    </div>














    <h3 class="header-style2" id="4">Часто используемые методы Глобального контекста</h3>
    <p>. <span class="vue-b"><b>ВвестиЧисло(ЧислоА = 0)</b></span> - метод просит ввести число, предварительно укажем переменную по умолчанию в этом методе - ЧислоА. Когда пользователь вводит число, то это число сохраняется в этой переменной и дальше мы можем использовать эту переменную в вычислениях.</p>
    <p>. <span class="vue-b"><b>Ввести строку(Строка = "")</b></span> - тоже самое только строку вводим</p>
    <p>. <span class="vue-b"><b>ВвестиДату(Дата = '19610412')</b></span> - тоже самое</p>
    <p>. <span class="vue-b"><b>ОткрытьЗначение(...)</b></span> - метод выводит в модальном окне то, что вы в него положим, например результат вычисления чисел, которые мы просили у пользователя.</p>
    <p>. <span class="vue-b"><b>Сообщить(...)</b></span> - метод при запуске программы выводит сообщение в него переданное.</p>
    <p>. <span class="vue-b"><b>ТипЗнч(Переменная)</b></span> - метод покажет какой тип данных лежит в переменной(вывод такой - Строка, Число, Дата). Например, там лежит тип данных Число и если ещё раз посмотреть тип данных самого вывода Число, то тип данных будет Тип. Например в JS все типы данных выводятся в типе данных строка, а здесь в типе данных Тип.</p>
    <p>. <span class="vue-b"><b>Тип("Строка")</b></span> - с результатом этого метода сравнивают типы данных. Например, нам неизвестен тип данных находящийся в переменной ТруЛяЛя, а там лежит строка "красный", тода мы в условии сравниваем:</p>
    <div class="code-style">
        <pre>
            ТруЛяЛя = "красный";
            Если ТипЗнч(ТруЛяЛя) = Тип("Строка") Тогда
                Сообщить("Тип данных в переменной ТруЛяЛя является трокой");
            КонецЕсли;
            //условие сработает и вывод будет виден на экране

            //сравнения такое не сработает
            ТруЛяЛя = "красный";
            Если ТипЗнч(ТруЛяЛя) = "Строка" Тогда
                Сообщить("Тип данных в переменной ТруЛяЛя является трокой");
            КонецЕсли;
            //это условие не сработает, так не сравнивают

            //тоже самое из js
            let someVar = 'красный';
            if(typeof someVar == 'строка'){
                console.log("Тип данных в переменной ТруЛяЛя является трокой")
            }
        </pre>
    </div>
    <p>. <span class="vue-b"><b>ПоказатьОповещениеПользователя(Текст)</b></span> - методу передаём сообщение и он его показывает во всплывающем окне справа внизу угла экрана.</p>
    <p>. <span class="vue-b"><b>ЗаполнитьЗначениеСвойств(&lt;Приемник>, &lt;Источник>, &lt;СписокСвойств>, &lt;ИсключаяСвойства>)</b></span> - 1й и 2й параметр обязательны. Будут заполнены свойства примемника одноимёнными свойствами источника. У приемника и источника тип произвольный.</p>
    <p>. <span class="vue-b"><b>УстановитьКраткийЗаголовокПриложения("Мой заголовок");</b></span> - устанавливает указанный текст в заголовок всего прикладного решения. Можно указать этот метод в модуле приложения в обработчике события "ПриНачалеРаботыСистемы".</p>
    <p>. <span class="vue-b"><b>СтрШаблон(&lt;Шаблон>, &lt;Значение1-Значение10>);</b></span> - параметр "Шаблон" обязателен, тип строка. Строка содержит пометки вида %1, %2, %3 до %10. После этого параметра идут параметры-значения по порядку, которые соответствуют пометкам в строке, т.е. если параметр-значение идёт после праметра "Шаблон", то это считается первый параметр-значение по счёту и он соответствует пометке %1, в примере параметр "лесу" это первый параметр-значение и он вставится вместо пометки %1 и т.д. Если что остальное смотреть в справке. Например:
    <div class="code-style">
        <pre>
            <span class="vue-b">ПолученнаяСтрока <span class="vue-r">=</span> СтрШаблон<span class="vue-r">(</span><span class="vue-bl">"Мы были в %1 %2го числа во %3"</span><span class="vue-r">,</span> <span class="vue-bl">"лесу"</span><span class="vue-r">,</span> 8<span class="vue-r">,</span> <span class="vue-bl">"вторник"</span><span class="vue-r">);</span>
            Сообщить<span class="vue-r">(</span>ПолученнаяСтрока<span class="vue-r">);</span> -> <span class="vue-bl">"Мы были в лесу 8го числа во вторник"</span></span>
        </pre>
    </div>
    </p>
    <p>. <span class="vue-b"><b>РеквизитФормыВЗначение(Строка);</b></span> - обязательно описать</p>
    <p>. <span class="vue-b"><b>ЗначениеВРеквизитФормы(Объект, Строка);</b></span> - обязательно описать</p>
    <p>. <span class="vue-b"><b>ПредопределенноеЗначение();</b></span> - обязательно описать</p>
    <p>. <span class="vue-b"><b>ЗначениеЗаполнено();</b></span> - проверяет, заполнено ли значение.</p>
    <p>. <span class="vue-b"><b>ПустаяСТрока(строка);</b></span> - проверяет строку на наличие в ней значащих символои(пробелы, табуляции и пр.) и символов. Если ничего в строке нет, вернётся Истина, иначе Ложь.</p>
    <p>. <span class="vue-b"><b>ЧислоПрописью();</b></span> - </p>
    <p>. <span class="vue-b"><b>ЗаполнитьЗначенияСвойств(приёмник, источник);</b></span> - по соответсвию колонок из источника заполняются поля в приёмнике. Например:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">  
                --модуль объекта документа "..."

                <span class="vue-g">//ДанныеЗаполнения.Товары это таб. часть из другого документа
                //Товары это таб. часть документа, в модуле которого мы находимся</span>
                <span class="vue-b"><span class="vue-r">Для каждого</span> СтрокаТабЧасти <span class="vue-r">Из</span> ДанныеЗаполнения<span class="vue-r">.</span>Товары <span class="vue-r">Цикл</span>
                	НоваяСтрока <span class="vue-r">=</span> Товары<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                	ЗаполнитьЗначенияСвойств<span class="vue-r">(</span>НоваяСтрока<span class="vue-r">,</span>СтрокаТабЧасти<span class="vue-r">);
                КонецЦикла;</span></span>
            </span>
        </pre>
    </div>


    














    <h3 class="header-style2" id="4b">Проверка даты, строки, числа на пустоту</h3>
    <p>Не забываем что в свойствах реквизитов в форме есть такой параметр как "Проверка заполнения", где можно указать выделять ли поле красным цветом если поле не заполнено.</p>
    <p class="title-size16"><b>Проверка даты</b></p>. <p>Бывает нужно проверить ввёл ли пользователь дату или нет. Для этого надо проверить поле с датой на пустоту. Если в поле Дата не ввести ничего, то система автоматом вставит туда дату '00010101 0:00:00' и в коде нужно проверять на сравнение с этой датой, если равно этой дате, то пользователь ничего не ввёл.</p>
    <p>Другой способ это через функцию глобального контекста <span class="vue-b"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>.</p>
    <p class="title-size16"><b>Проверка строки</b>.</p> <p>Бывает мы хотим узнать пустая ли строка, например, ввёл ли пользователь в поле ввода что то, а вдруг он ввёл несколько пробелов и всё это пустая строка или нет? Для нас да это пустая строка, но тогда проверка ПолеВвода = "" не даст истину, потому что строка содержит пробелы и уже не считается пустой строкой. Для этого существует метод <span class="vue-b"><b>Пустая строка(&lt;Значение>)</b></span>, он проверяет значение на наличие пробелов и табуляций и если кроме них ничего больше в строке нет, то он вернёт истину(строка пустая). Ну и собственно если строка равна "", то также вернёт истину. Как я понял то же самое для строки сделает и функция <span class="vue-b"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>.</p>
     <p class="title-size16"><b>Проверка числа</b>.</p> <p>Сравниваем с 0 или можно использовать функцию <span class="vue-b"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>.</p>
     <p class="title-size16"><b>Проверка документа</b>.</p> <p>Есть поле "Документ" с типом ДокументСсылка.ИмяДокумента. Проверяем выбран ли в поле какой-то документ. Есть такая функция как <span class="vue-b"><b>ЗначениеЗаполнено(&lt;Значение>)</b></span>, передадим в неё значение поля "Документ". Она проверяет отличается ли значение от значения по умолчанию того же типа, если нет, значит не заполнено. Значением по умолчанию для поля "Документ" будет пустая ссылка.</p>













    <h3 class="header-style2" id="interactiv">Процедуры и функции для взаимодействия с пользователем</h3>
    <p>В синтакс помошнике про эти функции описано по пути Глобальный контекст -> Процедуры и функции для интерактивной работы. Если процедуры и функции взаимодействия с пользователем лежат в глобаном подтексте, это значит они доступны во всех модулях, наверно). Для тренировки я описываю их в форме обработки. Начнём.</p>
    <p id="interactiv-1"><b>1. Как показать пользователю текстовое сообщение.</b></p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//способ 1</span>
            Сообщить(&ltТекстСообщения> Обяз.,&ltСтатус>Необяз.)
            Статус это системное перечисление, обратиться мы можем к нему так - СтатусСообщения.Важное
            Через точку можно выбрать статус. Статусы видны в обычном приложении, а в управляемом указывать
            их особого смысла нет.
            <span class="vue-b">Сообщить<span class="vue-r">(</span><span class="vue-bl">"Текст сообщения"</span>, СтатусСообщения.ОченьВажное<span class="vue-r">);</span></span>

            <span class="vue-g">//способ 2(рекомендуется использовать вместо метода Сообщить)</span>
            Можно написать в коде "сообщ" и нажать Ввод и развернётся шаблон объекта.
            В чём разница между методом Сообшить() и объектом Сообшить? Объект Сообшить позволяет привязать
            какое то сообщение к конкретному элементу формы. Например, создадим в форме реквизит "Результат"
            и расположим его в элементах. У объекта есть свойство Поле, в котором нужно указать путь к
            реквизиту формы в виде строки. Понятно, что надо объект Сообшить создавать в подтексте этой формы.
            Как видно на картинке у элемента формы "Результат" появляется отдельное окошко с сообщением.
            С помощью такого механизма можно пользователю указать, что нужно заполнить именно это поле.
            <span class="vue-b">Сообщение <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span></span>
            <span class="vue-b">Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Постание для поля Результат"</span><span class="vue-r">;</span></span>
            <span class="vue-b">Сообщение<span class="vue-r">.</span>Поле <span class="vue-r">=</span> <span class="vue-bl">"Результат"</span><span class="vue-r">;</span>
            Сообщение<span class="vue-r">.</span>УстановитьДанные<span class="vue-r">();</span></span>
            <span class="vue-b">Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span></span>
            <img src="../img/1С-1/2023-01-24_08-44-57.png" alt="">

            <span class="vue-g">//способ 3</span>
            Предупреждение(&lt;ТекстПредупреждения>Обяз., &lt;Таймаут>Необяз., &lt;Заголовок>Необяз.).
            Выводит окно предупреждения. Выводится только при режиме использования модальности.
            <span class="vue-b">Предупреждение<span class="vue-r">(</span><span class="vue-bl">"Текст сообщения", , "Заголовок"</span><span class="vue-r">);</span></span>
            <img src="../img/1С-1/2023-01-24_09-03-50.png" alt="">

            <span class="vue-g">//способ 4</span>
            ПоказатьОповещениеПользователя(&lt;Текст>, &lt;ДействиеПриНажатии>, &lt;Пояснение>, &lt;Картинка>, &lt;СтатусОповещенияПользователя>, &lt;КлючУникальности>);
            При задании только 1го параметра мы увидем окошко с оповещением внизу справа экрана.
            Во 2м параметре можно указать ссылку, если параметр строка, и когда появляется окошко, то при
            нажатии на него перейдём по ссылке.
            <span class="vue-b">ПоказатьОповещениеПользователя<span class="vue-r">(</span><span class="vue-bl">"Текст сообщения"</span><span class="vue-r">);</span></span>
        </pre>
    </div>


    <p id="interactiv-2"><b>Модальное окно. Почему надо отказываться от модальности. Асинхронные методы.</b></p>
    <p>Выше мы уже описывали модальные методы(синхронные), например, метод Предупреждение, который открывает модальное окно. При разработке нужно придерживаться принципа отказа от модальности. Во встроенном языке для каждого модального(синхронного) метода есть соответствующий не модальный(асинхронный) метод. Для того же метода Предупреждение() есть соответствующий асинхронный метод ПоказатьПредупреждение(). Отличие их в том, что асинхронный метод по прежнему блокирует интерфейс пользователя, но не останавливает выполнение кода.</p>
    <p>Функции для вызова диалога ввода данных. Находятся в Глобальном контексте:</p>
    <p><span class="vue-r">Модальные(синхронные)</span>.</p>
    <ul class="list">
        <li>ВвестиЗначение()</li>
        <li>ВвестиЧисло()</li>
        <li>ВвестиСтроку()</li>
        <li>ВвестиДату()</li>
    </ul>
    <p><span class="vue-b">Не модальные(асинхронные)</span>.</p>
    <ul class="list">
        <li>ПоказатьВводЗначения()</li>
        <li>ВвестиЗначениеАсинх()</li>
        <li>ПоказатьВводЧисла()</li>
        <li>ВвестиЧислоАсинх()</li>
        <li>ПоказатьВводСтроки()</li>
        <li>ВвестиСтрокуАсинх()</li>
        <li>ПоказатьВводДаты()</li>
        <li>ВвестиДатуАсинх()</li>
    </ul>
    <p><span class="vue-r">Синхронные методы</span></p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//все эти методы работают только если включён режим использования модальности</span>	
	
            <span class="vue-g">//ввод числа синхронно</span>
            <span class="vue-b">ВведенноеЧисло <span class="vue-r">=</span> Неопределено;
            ОтветЧисло <span class="vue-r">=</span> ВвестиЧисло<span class="vue-r">(</span>ВведенноеЧисло, <span class="vue-bl">"Введите свой возраст"</span>, 3<span class="vue-r">)</span>;
            <span class="vue-g">//Цифра 0 тоже считается числом</span>
            <span class="vue-r">Если</span> ОтветЧисло <span class="vue-r">Тогда</span>
                Сообщение <span class="vue-r">=</span> Новый СообщениеПользователю;
                Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Ваш возраст:"</span> <span class="vue-r">+</span> ВведенноеЧисло;
                Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">()</span>;
            <span class="vue-r">КонецЕсли;</span>
            
            
            <span class="vue-g">//ввод строки синхронно</span>
            ВведённаяСтрока <span class="vue-r">=</span> Неопределено;
            ОтветСтрока <span class="vue-r">=</span> ВвестиСтроку<span class="vue-r">(</span>ВведённаяСтрока, <span class="vue-bl">"Введите ваше имя"</span>, 50<span class="vue-r">)</span>;
            <span class="vue-r">Если</span> ОтветСтрока  <span class="vue-r">И НЕ</span> ПустаяСтрока<span class="vue-r">(</span>ВведённаяСтрока<span class="vue-r">)</span> <span class="vue-r">Тогда</span>
                Сообщение <span class="vue-r">=</span> Новый СообщениеПользователю;
                Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Ваше имя:"</span> <span class="vue-r">+</span> ВведённаяСтрока;
                Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">()</span>;
            <span class="vue-r">КонецЕсли;</span> 
            
            
            <span class="vue-g">//ввод даты синхронно</span>
            ВведённаяДата <span class="vue-r">=</span> Неопределено;
            <span class="vue-g">//ЧастиДаты это системное перечисление, через точку имет 3 свойства: Дата, Время, ДатаВремя(по умолчанию)</span>
            ОтветДата <span class="vue-r">=</span> ВвестиДату<span class="vue-r">(</span>ВведённаяДата, <span class="vue-bl">"ВведитеДату"</span>, ЧастиДаты.Дата<span class="vue-r">)</span>;
            <span class="vue-r">Если</span> ОтветДата <span class="vue-r">Тогда</span>
                Сообщение <span class="vue-r">=</span> Новый СообщениеПользователю;
                Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Вы ввели дату: "</span> <span class="vue-r">+</span> ВведённаяДата;
                Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">()</span>;
            <span class="vue-r">КонецЕсли;</span> 
            
            
            <span class="vue-g">//ввод значения синхронно. Значение это не простой тип(число, строка), а это например, ссылка на элемент справочника или документа</span>  
            ВыбраннаяНоменклатура <span class="vue-r">=</span> Неопределено;
            <span class="vue-g">//3й параметр вводим либо Тип(), либо ОписаниеТипов</span>
            ОтветНоменклатура <span class="vue-r">=</span> ВвестиЗначение<span class="vue-r">(</span>ВыбраннаяНоменклатура, <span class="vue-bl">"ВыберитеТовар"</span>, Тип(<span class="vue-bl">"СправочникСсылка.Номенклатура"</span>)<span class="vue-r">)</span>;
            <span class="vue-r">Если</span> ОтветНоменклатура <span class="vue-r">Тогда</span>
                Сообщение <span class="vue-r">=</span> Новый СообщениеПользователю;
                Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Вы ввели товар: "</span> <span class="vue-r">+</span> ВыбраннаяНоменклатура;
                Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">()</span>;
            <span class="vue-r">КонецЕсли;</span></span>

            <span class="vue-g">//синхронный метод Вопрос()</span>
            <img src="../img/1С-1/2023-01-28_19-50-43.png" class="screen-3" alt="">
        </pre>
    </div>
    <p><span class="vue-b">Асинхронные методы с использованием функций отложенного вызова(с колбеками)</span>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ОбработкаАсинхронныхМетодов1<span class="vue-r">(</span>Команда<span class="vue-r">)</span>    
                <span class="vue-g">//отличие от синхронных методов в том, что теперь добавлен ещё 1 параметр
                //этот параметр соответствует функции отложенного вызова в JS(колбек)
                //тут это немножко по другому сделано. Тут мы создаём объект  ОписаниеОповещения, 
                //в котором описываем имя процедуры и текущий модуль.  Процедура будет вызвана по 
                //по окончанию ввода пользователем данных в модальном окне
                //Процедура должна быть экспортная.
                //Судя по справке, то асинхронные методы ничего не возвращают, всё делает 
                //процедура вызванная оповещением, в которую и передаются данные от пользователя
                
                
                //ввод числа асинхронно</span>
                ВведенноеЧисло <span class="vue-r">=</span> 0;
                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВводаЧисла"</span>, ЭтотОбъект<span class="vue-r">)</span>;
                ПоказатьВводЧисла<span class="vue-r">(</span>Оповещение, ВведенноеЧисло, <span class="vue-bl">"Сколько вам лет?"</span>, 3<span class="vue-r">)</span>; 
                
                
                <span class="vue-g">//ввод строки асинхронно</span>
                ВведеннаяСтрока <span class="vue-r">=</span> "";
                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВводаСтроки"</span>, ЭтотОбъект<span class="vue-r">)</span>;
                ПоказатьВводСтроки<span class="vue-r">(</span>Оповещение, ВведеннаяСтрока, <span class="vue-bl">"Ваше имя?"</span>, 50<span class="vue-r">)</span>; 
            
            
                <span class="vue-g">//показ Предупреждения асинхронного. 1й параметр с оповещением можно опустить
                //потому что нам не требуется обрабатывать ответ</span>
                ПоказатьПредупреждение<span class="vue-r">(</span> , <span class="vue-bl">"Какой то текст"</span><span class="vue-r">)</span>; 
            КонецПроцедуры

            <span class="vue-r">&НаКлиенте
            Процедура</span> ПослеВводаЧисла<span class="vue-r">(</span>Число, Параметры<span class="vue-r">) Экспорт</span> 
                <span class="vue-g">//в отличии от синхронного метода ввода числа, тут уже надо написать такое условие чтобы и 0 тоже выводился
                //всё из за того что переменная Число тут не булево значение имеет, а числовое</span>
                <span class="vue-r">Если НЕ</span> Число <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    Сообщение <span class="vue-r">= Новый</span> СообщениеПользователю;
                    Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Вам " <span class="vue-r">+</span> Число <span class="vue-r">+</span> " лет"</span>;
                    Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">()</span>;	
                <span class="vue-r">КонецЕсли;
            КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ПослеВводаСтроки<span class="vue-r">(</span>Строка, Параметры<span class="vue-r">) Экспорт</span> 
                <span class="vue-g">//в отличии от синхронного метода ввода числа, тут уже надо написать такое условие чтобы и 0 тоже выводился
                //всё из за того что переменная Число тут не булево значение имеет, а числовое</span>
                <span class="vue-r">Если НЕ</span> Строка <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    Сообщение <span class="vue-r">= Новый</span> СообщениеПользователю;
                    Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Ваше имя "</span> <span class="vue-r">+</span> Строка;
                    Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">()</span>;	
                <span class="vue-r">КонецЕсли;
            КонецПроцедуры;</span></span>




            <span class="vue-g">//асинхронный метод Вопрос()</span>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ЗадатьВопросАсинхронно<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                <span class="vue-g">//вопрос со стандартными кнопками</span>
                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеОтветаНаВопросСоСтандартнымиКнопками"</span>, ЭтотОбъект<span class="vue-r">)</span>; 
                <span class="vue-g">//РежимДиалогаВопрос это системное перечисление, которое позволяет выбрать 
                //надписи на кнопках и их количество. Кнопки можно самом делать</span>
                ПоказатьВопрос<span class="vue-r">(</span>Оповещение, <span class="vue-bl">"Вы хотите удалить этот блок?"</span>, РежимДиалогаВопрос<span class="vue-r">.</span>ДаНет<span class="vue-r">)</span>;


                <span class="vue-g">//вопрос со своими кнопками</span>
                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеОтветаНаВопросСоСвоимиКнопками"</span>, ЭтотОбъект<span class="vue-r">)</span>; 
                <span class="vue-g">//мы хотим создать свои кнопки. Пусть у 1й кнопки будет текст "Создать новый документ" 
                //у 2й "Открыть форму существующего документа" и 3я "Отмена" 
                //чтобы создать эти кнопки будем использовать СписокЗначений</span>
                СписокКнопок <span class="vue-r">= Новый</span> СписокЗначений;
                СписокКнопок<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"СоздатьНовый"</span>, <span class="vue-bl">"Создать новый документ"</span><span class="vue-r">)</span>;
                СписокКнопок<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"ОткрытьФорму"</span>, <span class="vue-bl">"Открыть форму существующего документа"</span><span class="vue-r">)</span>;
                СписокКнопок<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"Отмена"</span>, <span class="vue-bl">"Отмена"</span><span class="vue-r">)</span>;
                ПоказатьВопрос<span class="vue-r">(</span>Оповещение, <span class="vue-bl">"Выберите действие"</span>, СписокКнопок<span class="vue-r">)</span>;
            <span class="vue-r">КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПослеОтветаНаВопросСоСтандартнымиКнопками<span class="vue-r">(</span>Ответ, Параметры<span class="vue-r">) Экспорт</span> 
                <span class="vue-g">//в Ответ будет лежать разные значения в зависимости от того, кнопки создавали мы или 
                //использовали РежимДиалогаВопрос. Если 2е, то в ответе будет КодВозвратаДиалога</span>
                <span class="vue-r">Если</span> Ответ <span class="vue-r">=</span> КодВозвратаДиалога<span class="vue-r">.</span>Да <span class="vue-r">Тогда</span>
                    Сообщение <span class="vue-r">= Новый</span> СообщениеПользователю;
                    Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Хорошо, удаляем"</span>;
                    Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">()</span>;		
                <span class="vue-r">КонецЕсли;
            КонецПроцедуры  

            &НаКлиенте
            Процедура</span> ПослеОтветаНаВопросСоСвоимиКнопками<span class="vue-r">(</span>Ответ, Параметры<span class="vue-r">) Экспорт</span> 
                <span class="vue-g">//в Ответ теперь будет лежать выбранное значение списка кнопок, 
                //не представлениеЮ а именно значение</span>
                <span class="vue-r">Если</span> Ответ <span class="vue-r">=</span> <span class="vue-bl">"СоздатьНовый"</span> <span class="vue-r">Тогда</span>
                    <span class="vue-g">//делаем что то</span>
                <span class="vue-r">ИначеЕсли</span> Ответ <span class="vue-r">=</span> <span class="vue-bl">"ОткрытьФорму"</span> <span class="vue-r">Тогда</span>
                    <span class="vue-g">//делаем что то</span>
                <span class="vue-r">Иначе</span>
                    <span class="vue-g">//делаем что то</span>		
                <span class="vue-r">КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>














    <h3 class="header-style2" id="5">Условный оператор</h3>
    <p>Условный оператор описывается в 1с так:</p>
    <div class="code-style">
        <pre>
            <span class="vue-r">Если</span> <span class="vue-b">логическое выражение</span> <span class="vue-r">Тогда</span>
                Различные команды;
            <span class="vue-r">ИначеЕсли</span> <span class="vue-b">логическое выражение</span> <span class="vue-r">Тогда</span>
                Различные команды;
            <span class="vue-r">Иначе</span>
                Различные команды;
            <span class="vue-r">КонецЕсли;</span>
        </pre>
    </div>







    <h3 class="header-style2" id="5a">Тройной оператор</h3>
    <p>Есть такой оператор, заменяющий в некоторых случаях условный оперратор:</p>
    <div class="code-style">
        <pre>
            //тройной оператор обязательно должен быть в выражении, сам по себе не используется
            Буква = ?(2 >3, "А", "Б"); 
            Сообщить(Буква);// "А"
        </pre>
    </div>








    <h3 class="header-style2" id="6">Циклы</h3>
    <p>В 1С бывает 3 цикла: <b>Цикл Для</b>, <b>Цикл Пока</b> и <b>Для каждого</b>.</p>
    <p class="title-size16"><b>Цикл Для</b>. Синтаксис цикла выглядит так:</p>
    <div class="code-style">
        <pre>
            <span class="vue-r">Для</span> <span class="vue-b">Имя</span> <span class="vue-r">=</span> <span class="vue-b">Начальное число</span> <span class="vue-r">По</span> <span class="vue-b">Конечное число</span> <span class="vue-r">Цикл</span>
                <span class="vue-b">Команда1<span class="vue-r">();</span></span>
                <span class="vue-b">Команда2<span class="vue-r">();</span></span>
                <span class="vue-r">...</span>
            <span class="vue-r">КонецЦикла;</span>

            <span class="vue-g">//пример</span>
            <span class="vue-r">Для</span> <span class="vue-b">Шаг</span> <span class="vue-r">=</span> <span class="vue-b">1</span> <span class="vue-r">По</span> <span class="vue-b">5</span> <span class="vue-r">Цикл</span>
                <span class="vue-b">Сообщить<span class="vue-r">("Круг " + <span class="vue-b">Шаг</span>);</span></span>
            <span class="vue-r">КонецЦикла;</span>
            Вывод: 
                Круг 1
                Круг 2
                Круг 3
                Круг 4
                Круг 5
            <span class="vue-g">//Шаг увеличивается на 1 каждый круг самостоятельно и сравнивается с конечным числом оператором &lt;=</span>
        </pre>
    </div>
    <p class="title-size16"><b>Цикл Пока</b>. Команды заключённые между словами Цикл и ЦонецЦикла выполняются пока Логическое выражение равно Истине. Синтаксис цикла выглядит так:</p>
    <div class="code-style">
        <pre>
            <span class="vue-r">Пока</span> <span class="vue-b">Логическое выражение</span> <span class="vue-r">Цикл</span>
                <span class="vue-b">Команда1<span class="vue-r">();</span></span>
                <span class="vue-b">Команда2<span class="vue-r">();</span></span>
                <span class="vue-r">...</span>
            <span class="vue-r">КонецЦикла;</span>

            <span class="vue-g">//пример</span>
            <span class="vue-b">Шаг = 1</span>
            <span class="vue-r">Пока</span> <span class="vue-b">Шаг</span> <span class="vue-r">&lt;=</span> <span class="vue-b">5</span> <span class="vue-r">Цикл</span>
                <span class="vue-b">Сообщить<span class="vue-r">(<span class="vue-b">Шаг</span>);</span></span>
                <span class="vue-b">Шаг<span class="vue-r"> = </span><>Шаг<span class="vue-r"> + </span>1</span><span class="vue-r">;</span>
            <span class="vue-r">КонецЦикла;</span>
            Вывод: 
                Шаг 1
                Шаг 2
                Шаг 3
                Шаг 4
                Шаг 5
            <span class="vue-g">//этот цикл по своей структуре очень похож на цикл while() из js</span>
            <span class="vue-g">//в этом цикле как я понял уже можно менять и занк сравнения и указывать шагам увеличиваться им или уменьшаться в отличии от первого цикла</span>
        </pre>
    </div>
    <p class="title-size16"><b>Цикл для каждого</b>. Этот цикл перебирает все коллекции.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">МассивЧисел <span class="vue-r">= Новый</span> Массив<span class="vue-r">(</span>4<span class="vue-r">);</span></span>
            <span class="vue-b">МассивЧисел[0]<span class="vue-r"> = 9;</span></span>
            <span class="vue-b">МассивЧисел[1]<span class="vue-r"> = "Строка";</span></span>
            <span class="vue-b">МассивЧисел[2]<span class="vue-r"> = Истина;</span></span>
            <span class="vue-b">МассивЧисел[3]<span class="vue-r"> = 23;</span></span>
            <span class="vue-r">Для каждого</span> <span class="vue-b">ЗначениеМассива</span> <span class="vue-r">Из</span> <span class="vue-b">МассивЧисел</span> <span class="vue-r">Цикл</span>
                <span class="vue-b">Сообщить<span class="vue-r">(</span>ЗначениеМассива<span class="vue-r">);</span></span>
            <span class="vue-r">КонецЦикла;</span>
            Вывод: 
                9
                Строка
                Да
                23
        </pre>
    </div>






    <h3 class="header-style2" id="string">Тип данных - строки</h3>
    <p>Тут подробно работа со строками - https://helpme1s.ru/stroki-v-yazyke-1s-8-v-primerax</p>
    <p>Чтобы написать имя фирмы вот такое - ООО "Блины со сгущонкой" в строке нужно экранировать двойные кавычки внутри строки, т.к. строка сама по себе обозначается двойными кавычками, то экранирование в 1С происходит также двойными кавычками, вот пример - НазваниеФирмы = "ООО ""Блины со сгущонкой""". Ну по крайней мере с названием фирмы так, как там далее обстоят дела узнаем дальше.</p>
    <p class="title-size16"><b>СЛОЖЕНИЕ СО СТРОКОЙ</b> будет только если строка находится слева, справо число преобразуется в строку и строки складываются. Если слева число, а справа строка "яблоко", то будет ошибка, но если справа строка "100", то она преобразуется в число 100. Если слева число всё же надо сложить со строкой, то приводим число слева к строке и слаживаем - <span class="vue-r">Строка(25)</span> + "10"</p>
    <p class="title-size16"><b>Привести к строке число</b> - Число = 12; Стр = <span class="vue-r">Строка(Число)</span>; <span class="vue-r">Сообщить(ТипЗнч(Стр));</span> - Строка</p>
    <p class="title-size16"><b>Ввод строки от поль-ля</b> - Строка= ""; <span class="vue-r">ВвестиСтроку(Строка)</span>;</p>
    <p class="title-size16"><b>Из чего состоит строка</b> - строка состоит из символов и мы можем обращаться к ним также как и к элементам массива, но у строки обращение к начальному символу начинается не 0, а с 1.</p>
    <p class="title-size16"><b>Узнать кол-во символов с строке</b> - Строка = "привет"; <span class="vue-r">СтрДлина(Строка)</span>; вернёт 6, поэтому обходить строку можно в обычном цикле по счётчику.</p>
    <p class="title-size16"><b>Получить подстроку в строке</b> - для этого есть не одна функция, вот пример одной из них. Функция <span class="vue-r">Сред(стр, номер, кол-во)</span>; стр - это сама строка из котрой мы получаем подстроку; номер - это начальная позиция символа/ов, который/е хотим получить; кол-во - это кол-во символов, котрое хотим получить. Как я понял, все 3 параметра обязательны.</p>
    <p class="title-size16"><b>Что представляет из себя символ</b> - каждому символу соответствует числовое значение, его код. Зачем может понадобится код символа? Ответ - для шифрования и дешифрования текстов. За перевод символа в числовой код отвечает функция <span class="vue-r">КодСимвола(строка, позицияСимвола)</span>. За перевод обратно числовго кода в символ отвечает функция <span class="vue-r">Символ(код)</span></p>
    <p class="title-size16"><b>Поиск в строке</b> - чтобы найти подстроку в строке есть функция <span class="vue-r">СтрНайти(строка, подстрока)</span>. параметров в ней больше, но обязательны эти 2. Функция возвращает 0 если позиция не найдена и позицию, если позиция найдена. Функция ищет только первое вхождение подстроки в строку.</p>
    <p class="title-size16"><b>Замена в строке</b> - за замену одной подстроки на другую в строке отвечает функция <span class="vue-r">СтрЗаменить(строка, искомаяСтрока, заменяемаяСтрока)</span>. Функция возвращает новую строку, полученную в результате замены, старая строка остаётся неизменной. Если замена не удаласьЮ но возвращается старая строка, насколько я понял. Функция заменяет все вхождения в строку.</p>
    <p class="title-size16"><b>Верхний и нижний регистр</b> - строки тут сравниваются через знак равенства =, наверно точно также как и в js. Верхний и нижний регистры имеют разные коды. Чтобы привести строку в разные регистры есть 2 функции - <span class="vue-r">Нрег(строка); - нижний регистр и Врег(строка); - верхний регистр</span>. Потому что разные регистры имеют разные коды, мы не найдём в строке - "какое счастье просыпаться по утрам" слово "Счастье", поэтому мы приводим всё к нижнему регистру и ищем.</p>
    <p>Тут приведено далеко не все функции работы со строками, по ходу дела буду добавлять их сюда с примерами.</p>
    <p>Многострочный режим строки:</p>
    <img src="../img/1С-1/2023-01-25_18-22-20.png" alt="">






    <h3 class="header-style2" id="num">Тип данных - числа</h3>
    <p>Подробнее о <b>числах</b>. Рассмотрим наиболее часто используемые функции для чисел.</p>
    <p>Чтобы убрать минус у числа перемножим это число на -1</p>
    <ul class="list">
        <li><span class="vue-b"><b>Окр(число, разрядность, режим округления)</b></span> - например возмём дробное число 100.384 и округлим до первого дробного знака - Окр(100.384, 1);, получим 100.4, почему 100.4, а не 100.3, потому что округление идёт до ближайшего целого. Есть правило, что когда мы округляем до N знака(в нашем случае 3), то смотрим на N + 1 знак(8) и если он меньше 5, то N знак оставляем как есть, а если >= 5, то увеличиваем на 1.   8 больше 5, значит 3 увеличиваем на 1. Также есть 3й параметр у этой функции - режим округления, по умолчанию стоит Окр15как20(можно обозначать цифрой 1), а кр15как10(можно обозначать цифрой 0). Этот режим будет работат только если после 3 идёт 5, а за 5 стоят все нули, тогда этим режимом можно регулировать в большую или в меньшую округлить 3. Например, Окр(100.350, 1, РежимОкругления.Окр15как20); будет округлено в большую сторону, т.е. получим 100.4, а если Окр(100.350, 1, РежимОкругления.Окр15как10) то коруглится в меньшую сторону - 100.3. Ещё раз внимание. 3й параметр влияет только тогда когда - 1)Округляем до N знака, 2)N + 1 равен 5, 3)а все знаки с N + 2 равны 0.</li>
        <li><span class="vue-b"><b>Цел(100.384);</b></span> - получим целую часть - 100.</li>
        <li><span class="vue-b"><b>Pow(10, 3);</b></span> - возведём число в степень -  получим 1000</li>
        <li><span class="vue-b"><b>Sqrt(25);</b></span> - извлечём квадратный корень из числа -  получим 5</li>
        <li><span class="vue-b"><b>Макс(25, 12, 4, -2);</b></span> - получим наибольшее число - 25</li>
        <li><span class="vue-b"><b>Мин(2, -4, 545, -8)</b></span> - получим наименьшее число - -8</li>
        <li><span class="vue-b"><b>ГСЧ = Новый ГенераторСлучайныхЧисел; Сообщить(ГСЧ.СлучайноеЧисло(0, 2));</b></span> - создание случайного числа от заданных параметров, включая эти параметры.</li>
        <li><span class="vue-b"><b>ЧислоРописью(&lt;Число>, &lt;ФорматнаяСтрока>, &lt;ПараметрыПредметаИсчисления>)</b></span> - формирует представление переданного числа прописью в соответствии с заданными форматной строкой и параметрами предмета исчисления.
        <div class="code-style">
            <pre>
                <span class="vue-g">//форматная строка задаёт параметры, перечисляемые через ;
                //Л - означает код локализации, по умолчанию стоит тот, который в винде
                //ДП - дробную часть выводить прописью если Истина, по умолчанию - Ложь(Числом);
                //остальные параметры в синтакс помошнике</span>
                <span class="vue-b">ФормСтрока <span class="vue-r">=</span> "Л = ru_RU; ДП = Истина"<span class="vue-r">;</span></span>

                <span class="vue-g">//строка ПарПредмета передаёт в падежах название денежной ценности
                //м - мужской род, ж - женский род
                //2 - кол-во разрядов дробной части, по умолчанию 2, можно не указывать</span>
                <span class="vue-b">ПарПредмета <span class="vue-r">=</span> "рубль,рубля,рублей,м,копейка,копейки,копеек,м,2"<span class="vue-r">;</span></span>

                <span class="vue-b">ПрописьЧисла <span class="vue-r">=</span> ЧислоПрописью<span class="vue-r">(</span>2341.56, ФормСтрока, ПарПредмета<span class="vue-r">)</span><span class="vue-r">;</span></span>
                Сообщить(ПрописьЧисла);-> две тысячисорок один рубль пятьдесят шесть копеек

                <span class="vue-g">//ещё пример</span>
                <span class="vue-b">ПрописьЧисла <span class="vue-r">=</span> ЧислоПрописью<span class="vue-r">(</span>123.65<span class="vue-r">)</span><span class="vue-r">;</span></span>
                Сообщить(ПрописьЧисла);-> сто двадцать три 65

                <span class="vue-g">//ещё пример</span>
                <span class="vue-b">ПрописьЧисла <span class="vue-r">=</span> ЧислоПрописью<span class="vue-r">(</span>123.65, "рубль, рубля, рублей, м, копейка, копейки, копеек, ж, 2"<span class="vue-r">)</span><span class="vue-r">;</span></span>
                Сообщить(ПрописьЧисла);-> сто двадцать три рубля 65 копеек
            </pre>
        </div>
        </li>
        <li></li>
        <li></li>
    </ul>








    <h3 class="header-style2" id="date">Тип данных - дата</h3>
    <p>Подробнее о <b>датах</b>.</p>
    <p>Дата во строенном языке должна задаваться в одинарных кавычках  - '20220405090000' - год, месяц, день. Также можно продолжить и дописать часы, минуты, секунды.</p>
    <p>А может задаваться и так - '2022.04.05 09:00:00'. Главное чтобы соблюдалась очерёдность - год, месяц, день, часы , минуты и секунды.</p>
    <p>К датам можно прибавлять и отнимать. Чтобы прибавить к дате сутки нужно прибавить кол-во секунд. Например, ЗавтрашняяДата = '20230412' + 3600 * 24; или наоборот отнять сутки - ВчерашняяДата = '20230412' - 3600 * 24;</p>
    <p>Даты можно вычитать друг из друга, результатом будет кол-во секунд. Получить из какой то даты количество секунд нельзя, я так понимаю, что тут у дат нету отсчёта от какого то времени. Чтобы вычислить секунды, надо вычислять самостоятельно от какой то даты, например, от текущей даты или от какой то другой даты путём вычитания и сложения.</p>
    <p class="title-size16"><b>Текущая дата</b> - </p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Сегодня <span class="vue-r">=</span> ТекущаяДата<span class="vue-r">();</span></span> 
            <span class="vue-b">Сегодня <span class="vue-r">=</span> ТекущаяДата<span class="vue-r">()<span class="vue-b"> + 1</span>;</span></span> <span class="vue-g">// прибавили секунду</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>Сегодня<span class="vue-r">);</span></span> <span class="vue-g">// 14.10.2022 18:40:34</span>
        </pre>
    </div>
    <p class="title-size16"><b>Получение года, месяца и дня из даты</b> - </p>
    <div class="code-style">
        <pre>
            <span class="vue-b">МояДата<span class="vue-r">=</span> '19610412'<span class="vue-r">;</span></span> 
            <span class="vue-b">Г <span class="vue-r">=</span> Год<span class="vue-r">(</span>МояДата<span class="vue-r">);</span></span><span class="vue-g">// 2013</span> 
            <span class="vue-b">М <span class="vue-r">=</span> Месяц<span class="vue-r">(</span>МояДата<span class="vue-r">);</span></span> <span class="vue-g">// 7</span>
            <span class="vue-b">Д <span class="vue-r">=</span> День<span class="vue-r">(</span>МояДата<span class="vue-r">);</span></span> <span class="vue-g">// 24</span>
            <span class="vue-b">Ч <span class="vue-r">=</span> Час<span class="vue-r">(</span>МояДата<span class="vue-r">);</span></span> <span class="vue-g">// 13</span>
            <span class="vue-b">Ми <span class="vue-r">=</span> Минута<span class="vue-r">(</span>МояДата<span class="vue-r">);</span></span> <span class="vue-g">// 25</span>
            <span class="vue-b">С <span class="vue-r">=</span> Секунда<span class="vue-r">(</span>МояДата<span class="vue-r">);</span></span> <span class="vue-g">// 6</span>
        </pre>
    </div>
    
    <p class="title-size16"><b>Добавление месяца к дате</b> - </p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>ДобавитьМесяц<span class="vue-r">(</span>ТекущаяДата<span class="vue-r">(),</span> 1<span class="vue-r">));</span></span><span class="vue-g">// прибавили месяц</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>ДобавитьМесяц<span class="vue-r">(</span>ТекущаяДата<span class="vue-r">(),</span> - 1<span class="vue-r">));</span></span><span class="vue-g">// отняли месяц</span>
        </pre>
    </div>

    <p class="title-size16"><b>Другие функции</b> - </p>
    <img src="../img/1С-1/2022-10-26_20-25-04.png" class="screen" alt="">

    <p class="title-size16"><b>Коструктор Дата()</b> - можно задать дату через встроенный конструктор Дата() - </p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ПервыйДеньЛета <span class="vue-r">=</span> Дата<span class="vue-r">(</span>2022, 06, 01<span class="vue-r">);</span></span> 
            <span class="vue-b">Сообщить<span class="vue-r">(</span>ПервыйДеньЛета<span class="vue-r">);</span></span> <span class="vue-g">// 01.06.2022 00:00:00</span>
        </pre>
    </div>
    <p>Также можно через встроенную функцию ВвестиДату() запросить у пользователя ввод даты.</p>

    <p class="title-size16"><b>Переводим строку с датой в дату</b> - </p>
    <div class="code-style">
        <pre>
            <span class="vue-b">МояДата <span class="vue-r">=</span> Дата<span class="vue-r">(</span>"20130724"<span class="vue-r">);</span></span> <span class="vue-g">// 24.07.2013</span>
        </pre>
    </div>

    <p class="title-size16"><b>Указываем в дате часы, минуты и секунды</b> - </p>
    <div class="code-style">
        <pre>
            <span class="vue-b">МояДата <span class="vue-r">=</span> '20130724132506'<span class="vue-r">;</span></span> <span class="vue-g">// 24 июля 2013 г. 13 ч. 25 мин. 6 сек</span>
        </pre>
    </div>
    <p class="title-size16"><b>Задача</b></p>
    <p>Сообщите на какой день недели выпадает 31 декабря в ближайшие 10 лет. Название дня недели нужно выдать в текстовом виде, например – понедельник, вторник, …</p>
    <p>Решение</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Дата <span class="vue-r">=</span> <span class="vue-bl">'20231231'</span><span class="vue-r">;</span> 
            ДниНедели <span class="vue-r">= Новый</span> Соответствие<span class="vue-r">();</span> 
            ДниНедели<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>1<span class="vue-r">,</span> <span class="vue-bl">"Понедельник"</span><span class="vue-r">);</span>
            ДниНедели<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>2<span class="vue-r">,</span> <span class="vue-bl">"Вторник"</span><span class="vue-r">);</span>
            ДниНедели<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>3<span class="vue-r">,</span> <span class="vue-bl">"Среда"</span><span class="vue-r">);</span>
            ДниНедели<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>4<span class="vue-r">,</span> <span class="vue-bl">"Четверг"</span><span class="vue-r">);</span>
            ДниНедели<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>5<span class="vue-r">,</span> <span class="vue-bl">"Пятница"</span><span class="vue-r">);</span>
            ДниНедели<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>6<span class="vue-r">,</span> <span class="vue-bl">"Суббота"</span><span class="vue-r">);</span>
            ДниНедели<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>7<span class="vue-r">,</span> <span class="vue-bl">"Воскресенье"</span><span class="vue-r">);</span>
            <span class="vue-r">Для</span> Шаг <span class="vue-r">=</span> 1 <span class="vue-r">По</span> 10 <span class="vue-r">Цикл</span>
                <span class="vue-r">Если</span> Шаг <span class="vue-r">=</span> 1 <span class="vue-r">Тогда</span>
                    День <span class="vue-r">=</span> ДеньНедели<span class="vue-r">(</span>Дата<span class="vue-r">);
                Иначе</span>
                    <span class="vue-g">//вот таким образом увеличиваю год</span>
                    День <span class="vue-r">=</span> ДеньНедели<span class="vue-r">(</span>ДобавитьМесяц<span class="vue-r">(</span>Дата<span class="vue-r">,</span> 12 <span class="vue-r">*</span> Шаг<span class="vue-r">));
                КонецЕсли;</span>
                Сообщить<span class="vue-r">(</span>ДниНедели<span class="vue-r">[</span>День<span class="vue-r">]);	
            КонецЦикла</span></span>

            <span class="vue-g">//вот ещё способ увеличить год</span>
            КонецГода = КонецГода(ТекущаяДата()); - это начальная дата
            КонецГода = КонецГода(КонецДня(КонецГода) + 1); - а это в цикле будет прибавляться на год
        </pre>
    </div>















    <h3 class="header-style2" id="array">Тип данных - Массив</h3>
    <img src="../img/1С-1/2022-10-21_10-03-43.png" class="screen" alt="">
    <p>Массив доступен и на клиенте и на сервере.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//если мы объявляем пустой массив, то заполнять его надо через метод Вставить()</span>
            <span class="vue-b">МойМассив<span class="vue-r"> = Новый</span> Массив<span class="vue-r">();</span></span>
            <span class="vue-bl">Результат: МойМассив -> []</span>

            <span class="vue-g">//попытаемся обратиться к его первому элементу</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>МойМассив<span class="vue-r">[</span>0<span class="vue-r">]</span><span class="vue-r">);</span></span>//<span class="vue-g">Ошибка! Массив пока не содержит элементов</span>
            <span class="vue-g">//то же самое</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>МойМассив<span class="vue-r">.</span>Получить<span class="vue-r">(</span>0<span class="vue-r">));</span></span>//<span class="vue-g">Ошибка! Массив пока не содержит элементов</span>


            <span class="vue-g">//добавление в конец массива значения</span>
            <span class="vue-b">МойМассив<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"Иванов"</span><span class="vue-r">);</span></span>
            <span class="vue-b">МойМассив<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"Петров"</span><span class="vue-r">);</span></span>
            <span class="vue-bl">Результат: МойМассив -> ["Иванов", "Петров"]</span>

            <span class="vue-g">//можно вставить элемент в любое место массива, если вставка между элементами, то
            //вставляемый элемент расталкивает другие элементы, заставляя их передвигаться на новые позиции</span>
            <span class="vue-b">МойМассив<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>1<span class="vue-r">,</span> <span class="vue-bl">"Сидоров"</span><span class="vue-r">);</span></span>
            <span class="vue-bl">Результат: МойМассив -> ["Иванов", "Сидоров", "Петров"]</span>

            <span class="vue-g">//мы можем заменить элемент массива на другой, для это есть метод Установить()</span>
            <span class="vue-b">МойМассив<span class="vue-r">.</span>Установить<span class="vue-r">(</span>0<span class="vue-r">,</span> <span class="vue-bl">"Николаев"</span><span class="vue-r">);</span></span>
            <span class="vue-g">//делает то же самое</span>
            <span class="vue-b">МойМассив<span class="vue-r">[</span>0<span class="vue-r">] = </span> <span class="vue-bl">"Николаев"</span><span class="vue-r">;</span></span>
            <span class="vue-bl">Результат: МойМассив -> ["Николаев", "Сидоров", "Петров"]</span>

            <span class="vue-g">//поиск элемента в массиве
            //если нашёл, вернёт индекс, если нет - Неопределено</span>
            <span class="vue-b">ЗначениеПоиска <span class="vue-r">=</span> МойМассив<span class="vue-r">.</span>Найти<span class="vue-r">(</span><span class="vue-bl">"Иванов"</span><span class="vue-r">);</span></span>
            <span class="vue-bl">Результат: ЗначениеПоиска -> Неопределено</span>

            <span class="vue-g">//есть такой метод как ВГраница() он
            //возвращает наибольший индекс элемента массива</span>
            <span class="vue-g">//это то же самое что МойМассив.Количество() - 1</span>
            <span class="vue-g">//но если массив пуст, то ВГраница() вернёт -1</span>
            <span class="vue-b">НаибольшийИндекс <span class="vue-r">=</span> МойМассив<span class="vue-r">.</span>ВГраница<span class="vue-r">();</span></span>
            <span class="vue-bl">Результат: НаибольшийИндекс -> 2</span>

            <span class="vue-g">//Удаление элемента из массива</span>
            <span class="vue-b">Индекс <span class="vue-r">=</span> МойМассив<span class="vue-r">.</span>Найти<span class="vue-r">(</span><span class="vue-bl">"Сидоров"</span><span class="vue-r">);</span>
            <span class="vue-r">Если НЕ</span> Индекс <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                <span class="vue-b">МойМассив<span class="vue-r">.</span>Удалить<span class="vue-r">(</span>Индекс<span class="vue-r">)</span>;</span>    
            <span class="vue-r">КонецЕсли;</span></span>
            <span class="vue-bl">Результат: МойМассив -> ["Николаев", "Петров"]</span>
            
            <span class="vue-g">//если объявляем массив с заранее известным числом элементов, то заполняем так</span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r"> = Новый</span> Массив<span class="vue-r">(</span>3<span class="vue-r">);</span></span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r">[</span>0<span class="vue-r">]</span><span class="vue-r"> =</span> 9<span class="vue-r">;</span></span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r">[</span>1<span class="vue-r">]</span><span class="vue-r"> =</span> "Строка"<span class="vue-r">;</span></span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r">[</span>2<span class="vue-r">]</span><span class="vue-r"> =</span> Истина<span class="vue-r">;</span></span>
            <span class="vue-g">//если захотим добавить 4й элемент, то через
            //квадратные скобки не получится, но получится через методы
            //Добавить() и Вставить()
            //Вообще, если заранее известно количество элементов в массиве
            //то лучше создать такой массив с заранее заданными ячейками
            //потому что метод Добавить() создаёт новый массив, копирует из старого
            //в него все элементы и добавляет текущий элемент.
            //На больших массивах это будет чувствительной операцией</span>
            <span class="vue-bl">Результат: МассивРазныхТипов -> [9, "Строка", Истина]</span>


            <span class="vue-g">//чтобы узнать число элементов в массиве(длину массива)</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>МассивРазныхТипов<span class="vue-r">.</span>Количество<span class="vue-r">()</span><span class="vue-r">);</span></span>//<span class="vue-g">3</span>

            <span class="vue-g">//Очищение массива</span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r">.</span>Очистить<span class="vue-r">();</span></span>
            <span class="vue-bl">Результат: МассивРазныхТипов -> []</span>

            <span class="vue-g">//обход массива в цикле</span>
            <span class="vue-g">//в переменную Элемент попадает значение элемента массива, а не ключ</span>
            <span class="vue-b">МассивЗначений <span class="vue-r">= Новый</span> Массив<span class="vue-r">(</span>4<span class="vue-r">);</span></span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r">[</span>0<span class="vue-r">]</span><span class="vue-r"> =</span> 9<span class="vue-r">;</span></span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r">[</span>1<span class="vue-r">]</span><span class="vue-r"> =</span> "Строка"<span class="vue-r">;</span></span>
            <span class="vue-b">МассивРазныхТипов<span class="vue-r">[</span>2<span class="vue-r">]</span><span class="vue-r"> =</span> Истина<span class="vue-r">;</span></span>
            <span class="vue-r">Для каждого</span> <span class="vue-b">Элемент</span> <span class="vue-r">Из</span> <span class="vue-b">МассивРазныхТипов</span> <span class="vue-r">Цикл</span>
                <span class="vue-b">Сообщить<span class="vue-r">(</span>Элемент<span class="vue-r">);</span></span>
            <span class="vue-r">КонецЦикла;</span>
            Вывод: 
                9
                Строка
                Да

            <span class="vue-g">//ОБРАБОТКА ОШИБОК. Хорошим тоном считается обрабатывать не только успешные действия
            //но и ошибочные. Например метод Найти() возвращает индекс найденного элемента, либо Неопределено.
            //Так вот мы не всегда знаем, какие есть элементы в массиве, а каких нет, поэтому метод может 
            //вернуть Неопределено и чтобы потом не производить опреции с этим типом и не вызвать ошибок мы и 
            //будм обрабатывать её.</span>
            <span class="vue-b">ИндексЗначенияСтрока <span class="vue-r">=</span> МассивЗначений<span class="vue-r">.</span>Найти<span class="vue-r">(</span><span class="vue-bl">"Строка"</span><span class="vue-r">);

            Если</span> ИндексЗначенияСтрока <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                ПоказатьПредупреждение<span class="vue-r">(,</span> <span class="vue-bl">"Значение Строка не найдено"</span><span class="vue-r">);
                Возврат;
            КонецЕсли;</span>

            Сообщить<span class="vue-r">(</span>ИндексЗначенияСтрока<span class="vue-r">);</span></span>
        </pre>
    </div>
    <p>Если что то по массивам будет не хватать, то во тут побольше описано - https://helpme1s.ru/massivy-v-yazyke-1s-8-v-primerax</p>
    <p class="title-size16"><b>Типовые ошибки массивов</b></p>
    <img src="../img/1С-1/2022-10-21_10-03-43-2.png" class="screen" alt="">
    <p>В первом случае ошибка говорит о том, что нет такого индекса в массиве. И поэтому лучше делать условные проверки на наличии в массиве количество значений, а уже потом делать обращение к массиву, дабы избежать ошибок. Во втором случае похожая картина, но только встречается она когда пытаются удалить из массива несуществующий индекс. И опять же нужно проверять на наличие такого индекса, а потом удалять.</p>















    <h3 class="header-style2" id="structure">Тип данных - Структура(объект)</h3>
    <img src="../img/1С-1/2022-10-21_10-04-58.png" class="screen" alt="">
    <p>Структура доступна и на клиенте и на сервере. В ключе свойства структуры в строковом идентификаторе не допустимы пробелы, а вот в соотвествии такие ключи возможны.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//структура в отличии от массива позволяет использовать строковый ключ
            //именно строковый, никакой больше ключ там не подойдёт. Эта строка должна начинаться со знака _, либо
            //с буквы, и не должна содержать спец. символов: пробелы, запятые и прочее</span>

            <span class="vue-g">//структура как и массив доступна и на клиенте и на сервере</span>    

            <span class="vue-g">//как создать и заполнить структуру(1й способ)</span>
            <span class="vue-b">ЛичныеДанные<span class="vue-r"> = Новый</span> Структура<span class="vue-r">;</span></span>
            <span class="vue-g">//заполняем эти свойства
            //Метод Вставить() вставляет по указанному ключу значение, если такой ключ уже есть
            //то он заменяется на новый</span>
            <span class="vue-b">ЛичныеДанные<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>"Фамилия", "Иванов"<span class="vue-r">);</span></span>
            <span class="vue-b">ЛичныеДанные<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>"Имя", "Иван"<span class="vue-r">);</span></span>
            <span class="vue-b">ЛичныеДанные<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>"ДатаРождения", '19800802'<span class="vue-r">);</span></span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>ЛичныеДанные<span class="vue-r">.</span>Фамилия<span class="vue-r">);</span></span>//<span class="vue-g">Иванов</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>ЛичныеДанные<span class="vue-r">[</span>"Фамилия"<span class="vue-r">]);</span></span>//<span class="vue-g">Иванов</span>


            <span class="vue-g">//как создать и заполнить структуру(2й способ)</span>
            <span class="vue-b">Время<span class="vue-r"> = Новый</span> Структура<span class="vue-r">(</span>"Часы,Минуты,Секунды", 12, 45, 33<span class="vue-r">);</span></span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>"Время " <span class="vue-r">+</span> Время<span class="vue-r">.</span>Часы<span class="vue-r"> + <span class="vue-b">":"</span> + </span>Время<span class="vue-r">.</span>Минуты<span class="vue-r">);</span></span>//<span class="vue-g">Время 12:45</span>



            <span class="vue-g">//как создать и заполнить структуру(3й способ)</span>
            <span class="vue-b">Человек<span class="vue-r"> = Новый</span> Структура<span class="vue-r">("Фамилия, Имя, Отчество");</span></span>
            <span class="vue-g">//заполняем эти свойства</span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Фамилия<span class="vue-r"> = </span>"Пупкин"</span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Имя<span class="vue-r"> = </span>"Василий"</span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Отчество<span class="vue-r"> = </span>"Иванович"</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>Человек<span class="vue-r">.</span>Отчество<span class="vue-r">);</span></span>//<span class="vue-g">Иванович</span>


            <span class="vue-g">//перезапись значения поля "Фамилия"(1й способ)</span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>"Фамилия", "Сидоров"<span class="vue-r"></span>);</span></span>
            
            
            <span class="vue-g">//перезапись значения поля "Фамилия"(2й способ)</span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Фамилия<span class="vue-r"> = </span>"Сидоров"</span>
            <span class="vue-b">Человек<span class="vue-r">[</span>"Фамилия"<span class="vue-r">] = </span>"Сидоров"</span>



            <span class="vue-g">//узнаём количество свойств в структуре</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>Человек<span class="vue-r">.</span>Количество()<span class="vue-r">);</span></span>//<span class="vue-g">4</span>




            <span class="vue-g">//ищем в структуре по ключу наличие значения этого ключа, возвращает булево значение
            //и если что то по ключу нашёл, то записывает значение этого ключа в переменную НайденноеЗначение
            //ВАЖНО! А также проверяет, есть ли указанный ключ и свойство в целом в структуре</span>
            <span class="vue-b">НайденноеЗначение <span class="vue-r">=</span> Неопределено<span class="vue-r">;</span></span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Свойство<span class="vue-r">(</span>"Имя", НайденноеЗначение<span class="vue-r">);</span></span>//<span class="vue-g">Да</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>НайденноеЗначение<span class="vue-r">);</span></span>//<span class="vue-g">Василий</span>
            <span class="vue-g">//говорят, что этот способ хорош для получения значения свойства по ключу, потому как</span>
            <span class="vue-g">//если по ключу ничего не будет, то ошибки не будет, просто в НайденноеЗначение запишется Неопределено</span>
            <span class="vue-g">//а вот если получать значение так Человек.Имя или так Человек["Имя"], то если по ключу ничего нет</span>
            <span class="vue-g">//то выдаст ошибку и надо будет делать дополнительные проверки</span>
            <span class="vue-g">//но на практике всё же чаще пользуются получением через точку и скобки</span>

            <span class="vue-g">//Обработка ОШИБОК! Хотя даже если мы используем метод Свойство() и ничего не нашлось по ключу
            //то в переменной НайденноеЗначение останется значение Неопределено, а значит с этим значением где то может 
            //дальше по коду могут проводится разные операции, что вызовет опять же ошибку, так что неудачные 
            //значения нужно обрабатывать
            </span>



            <span class="vue-g">//очищаем структуру польностью</span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Очистить<span class="vue-r">();</span></span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>Человек<span class="vue-r">.</span>Количество()<span class="vue-r">);</span></span>//<span class="vue-g">0</span>



            <span class="vue-g">//удаляем свойство из структуры</span>
            <span class="vue-b">Человек<span class="vue-r">.</span>Удалить<span class="vue-r">(</span>"Отчество"<span class="vue-r"></span>);</span></span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>Человек<span class="vue-r">.</span>Отчество<span class="vue-r">);</span></span>//<span class="vue-g">Ошибка! Поле объекта не обнаружено</span>


            <span class="vue-g">//обход элементов структуры в цикле</span>
            <span class="vue-g">//заметим, что в переменную Элемент попадает не значение элемента структуры, а объект</span>
            <span class="vue-g">//у которого есть 2 свойства - Ключ и Значение и вызваем то что нам нужно</span>
            <span class="vue-b"><span class="vue-r">Для Каждого</span> Элемент <span class="vue-r">Из</span> ЛичныеДанные <span class="vue-r">Цикл</span></span>
                <span class="vue-b">Сообщить<span class="vue-r">(</span>Элемент<span class="vue-r">.</span>Ключ <span class="vue-r">+</span> " " <span class="vue-r">+</span> Элемент<span class="vue-r">.</span>Значение</span><span class="vue-r">);</span></span>
            <span class="vue-r">КонецЦикла;</span>

            <span class="vue-g">//В отличии от массива, который в элементах содержит простые типы(строка, число, булево),
            //в структуре элемент это объект с типом "КлючИЗначение", этот объект связывает ключ и его значение
            //и можно получить из него имя ключа или значение, что и видно в цикле выше.</span>
        </pre>
    </div>
    <p class="title-size16"><b>Типовые ошибки связанные со структурой</b>.</p>
    <img src="../img/1С-1/2022-10-21_10-04-58-2.png" class="screen" alt="">
    <p class="title-size16"><b>В первом случае</b> ошибка возникает при неправильном имени ключа, например, назвали "1Сотрудник", это неправильно, потому что первыми символами должны быть буквы или подчёркивания, имя не должно начинаться с цифр. Приведём пример, часто бывает нужно перевести данные из одной коллекции в другую. Переведём данные из массива в структуру, массив содержит набор чисел:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">
            МассивЧисел = Новый Массив;
            Для Число = 1 По 2000 Цикл
                МассивЧисел.Добавить(Число);
            КонецЦикла;

            СтруктураЧисел = Новый Структура;
            Для каждого Элемент Из МассивЧисел Цикл
                ИмяКлюча = "Число_" + МассивЧисел.Найти(Элемент);
                СтруктураЧисел.Вставить(ИмяКлюча, Элемент);
            КонецЦикла; 
            </span>
        </pre>
    </div>
    <p>Вроде бы всё правильно и должны получить структуру вида: "Число_0: 1", "Число_1: 2", "Число_2: 3" и т.д., но будет ошибка из первого случая, потому что подойдя до 1000 система автоматом разделяет такие числа по 3 символа пробелами и на этом числе у нас будет имя ключа такое - "Число_1 000", а пробелы недопустимы в имени. Исправить ошибку можно форматом чисел, который убирает эти пробелы - Формат(МассивЧисел.Найти(Элемент), "ЧГ=0").</p>
    <p>Представим мы не знаем в чём проблема и на каком круге цикла вознакает проблема. Нам может помочь такая конструкция языка как Попытка ... Исключение. Мы в Попытка вставляем код, где в структуру добавляются ключи с значениями и если добавление какого то ключа вдруг вызовет ошибку, то конструкция сразу перейдёт к выполнению кода в Исключение:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">
            МассивЧисел = Новый Массив;
            Для Число = 1 По 2000 Цикл
                МассивЧисел.Добавить(Число);
            КонецЦикла;

            СтруктураЧисел = Новый Структура;
            Для каждого Элемент Из МассивЧисел Цикл
                ИмяКлюча = "Число_" + МассивЧисел.Найти(Элемент);
                Попытка
                    СтруктураЧисел.Вставить(ИмяКлюча, Элемент);
                Исключение
                    Сообщить(МассивЧисел.Найти(Элемент));
                КонецПопытки;
            КонецЦикла; 
            </span>
        </pre>
    </div>
    <p>Этот код начнёт нам выдавать сообщения начиная с 1 000</p>
    <p class="title-size16"><b>Ну и второй случай</b> это когда обращаемся к ключу, которого нет, а занчит опять же нужно делать проверки.</p>
















    <h3 class="header-style2" id="accordance">Соответствие(Map)</h3>
    <img src="../img/1С-1/2022-10-21_10-05-59.png" class="screen" alt="">
    <p>В отличии от Структуры в коллекции Соответствие в ключах можно использовать любые типы данных(число, строка, дата, ссылка и т.д.). Дата и ссылка частые ключи для соответствия. В ключе даже можно использовать строку внутри с пробелами, чего нельзя делать в ключе Структуры. Точно также как и массив и структура, соответствие доступно и на клиенте и на сервере. В Соответствии тяжелей получить ошибку в работе с элементами.</p>
    <p class="title-size16"><b>Создание Соответствия</b>. В отличии от Массива и Структуры создание Соответствия происходит одним способом указаном ниже в примере.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СоответствиеРазмеров <span class="vue-r">= Новый</span> Соответствие;</span>
        </pre>
    </div>
    <p class="title-size16"><b>Вставить ключ с значением</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СоответствиеРазмеров <span class="vue-r">.</span>Вставить<span class="vue-r">(</span>36, "XS"<span class="vue-r">);</span></span>
            <span class="vue-b">СоответствиеРазмеров <span class="vue-r">.</span>Вставить<span class="vue-r">(</span>38, "S"<span class="vue-r">);</span></span>
            <span class="vue-b">СоответствиеРазмеров <span class="vue-r">.</span>Вставить<span class="vue-r">(</span>40, "М"<span class="vue-r">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Количество элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">КоличествоЭлементов <span class="vue-r">=</span> СоответствиеРазмеров<span class="vue-r">.</span>Количество<span class="vue-r">();</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Получить элемент</b>. Если элемент не найден по ключу, то вернёт Неопределено. Желательно делать проверку на Неопределено и выводить уже затем ответ. Ошибки не будет, если по ключу ничего не найдено.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Размер36 <span class="vue-r">=</span> СоответствиеРазмеров<span class="vue-r">.</span>Получить<span class="vue-r">(</span>36<span class="vue-r">);</span><span class="vue-g">// XS</span>
            <span class="vue-r">Если</span> Размер36 <span class="vue-r">&lt;></span> Неопределено <span class="vue-r">Тогда</span>
                Сообщить<span class="vue-r">(</span>Размер36<span class="vue-r">)</span>;
            <span class="vue-r">КонецЕсли;</span></span>
            <span class="vue-g">//или</span>
            <span class="vue-b">Размер40 <span class="vue-r">=</span> СоответствиеРазмеров<span class="vue-r">[</span>40<span class="vue-r">];</span></span><span class="vue-g">// M</span>
        </pre>
    </div>
    <p class="title-size16"><b>Изменить элемент</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СоответствиеРазмеров<span class="vue-r">[</span>40<span class="vue-r">] =</span> "MM"<span class="vue-r">;</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Обход элементов</b>. Из за того что в ключе могут быть любые типы, то при сложении со строкой ключа следует перерд ним указать строку - ("" +) или ключ привести к строке. Тут также как и в структуре в переменную Элемент попадает тип КлючИЗначение, т.е. содержит и ключ и значение.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Для Каждого</span> Элемент <span class="vue-r">Из</span> СоответствиеРазмеров <span class="vue-r">Цикл</span></span>
                <span class="vue-b">Сообщить<span class="vue-r">(</span>"" + Элемент<span class="vue-r">.</span>Ключ <span class="vue-r">+</span> " " <span class="vue-r">+</span> Элемент<span class="vue-r">.</span>Значение</span><span class="vue-r">);</span></span>
            <span class="vue-r">КонецЦикла;</span>
        </pre>
    </div>
    <p class="title-size16"><b>Удалить элемент</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СоответствиеРазмеров<span class="vue-r">.</span>Удалить<span class="vue-r">(</span>36<span class="vue-r">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Очистить коллекцию</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СоответствиеРазмеров<span class="vue-r">.</span>Очистить<span class="vue-r">(</span><span class="vue-r">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Узнать тип коллекции</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Если</span> ТипЗнч<span class="vue-r">(</span>СоответствиеРазмеров<span class="vue-r">)</span> <span class="vue-r">=</span> Тип<span class="vue-r">(</span>"Соответствие"<span class="vue-r">)</span> <span class="vue-r">Тогда</span>
                Сообщить<span class="vue-r">(</span><span style="color:black;">"Это коллекция Соответствие"</span><span class="vue-r">)</span>;
            <span class="vue-r">КонецЕсли;</span></span>
        </pre>
    </div>
    <p>Если тут также обратиться к ключу, которого нет в соответствии, как и в структуре, то ошибки тут не будет, в отличии от структуры. Просто выведет пустое значение, а тип будет Неопределено.</p>














    <h3 class="header-style2" id="list">Тип данных - Список значений</h3>
    <img src="../img/1С-1/2022-10-21_10-01-13.png" class="screen" alt="">
    <p>Если чего то тут нет, может будет тут - https://helpme1s.ru/spisok-znachenij-v-yazyke-1s-8-v-primerax</p>
    <p>Список значений уместно использовать вместо массива в случаях, когда требуется взаимодействие с пользователем в части выбора элементов из этого списка в окне и если требуются какие-то особые возможности(например, сортировка). Доступен и на клиенте и на сервере. Так как он нужен и для работы с пользователем, то тогда надо использовать на клиенте.</p>
    <p class="title-size16"><b>Создание списка</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СписокДней<span class="vue-r"> = Новый</span> СписокЗначений<span class="vue-r">;</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Задать тип данных для значений</b>.</p>
    <p>Для чего задавать тип значений? Пока я встретил только один случай такого применения. Когда решал задачу нахождения наибольшего количества повторений букв в тексте, то можно все буквы с их количеством записать в список значений и потом использовать этот список как таблица для запроса, чтобы в запросе можно было сгруппировать и отсортировать буквы. Так вот просто так запрос не примет список значений, он будет ругаться на то, что тип значений не задан, вот тут то и нужно задать тип значений, какой мы собираемся хранить. Если что пример можно найти в разделе 1С -> Примеры задач -> Работа со строками -> Найти в тексте букву повторяющуюся больше всех.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//задаём для значений элементов списка тип число. Как я понимаю, другие типы уже нельзя добавить в список, только числа</span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>ТипДанных<span class="vue-r"> = Новый</span> ОписаниеТипов<span class="vue-r">(</span><span class="vue-bl">"Число"</span><span class="vue-r">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Добавлениеи и вставка элементов</b>. При добавлении элемент ставится в конец списка, при вставке по индексу элементы справа сдвигаются вправо. Важно также помнить, что в ключах у списка мы тоже можем писать разные типы данных.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">&lt;Значение></span><span class="vue-r">,</span> <span class="vue-bl">&lt;Представление></span><span class="vue-r">,</span> <span class="vue-bl">&lt;Пометка></span><span class="vue-r">,</span> <span class="vue-bl">&lt;Картинка></span><span class="vue-r">);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">&lt;Индекс></span><span class="vue-r">,</span> <span class="vue-bl">&lt;Значение></span><span class="vue-r">,</span> <span class="vue-bl">&lt;Представление></span><span class="vue-r">,</span> <span class="vue-bl">&lt;Пометка></span><span class="vue-r">,</span> <span class="vue-bl">&lt;Картинка></span><span class="vue-r">);</span></span>

            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Пн", "Понедельник"<span class="vue-r">);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Вт", "Вторник"<span class="vue-r">);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Ср", "Среда"<span class="vue-r">);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Чт", "Четверг"<span class="vue-r">);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Пт", "Пятница"<span class="vue-r">);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Сб", "Суббота"<span class="vue-r">);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Вс", "Воскресенье"<span class="vue-r">);</span></span>
        </pre>
    </div>
    <p>Вот так выглядить список занчений в отладчике, который мы только создали:</p>
    <img src="../img/1С-1/2023-01-17_13-44-56.png" class="screen" alt="">
    <p class="title-size16"><b>Добавление картинки</b>.</p>
    <p>Чтобы добавить картинку будем пользоваться стандартными картинками, которые можно получить из глобального подтекста через объект <span class="vue-b">БибилиотекаКартинок</span>. Ставим точку после этого объекта и нам вылетет целый список с названиями стандартных картинок:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ЗапуститьСписокЗначений(Команда)
                СписокДней = Новый СписокЗначений;
                СписокДней.Добавить("Пн", "Понедельник", , БиблиотекаКартинок.АктивироватьЗадачу);
                СписокДней.Добавить("Вт", "Вторник", , БиблиотекаКартинок.БизнесПроцесс);
                СписокДней.Добавить("Ср", "Среда", , БиблиотекаКартинок.АктивныеПользователи);
                СписокДней.Добавить("Чт", "Четверг", , БиблиотекаКартинок.БизнесПроцессОбъект);
                СписокДней.Добавить("Пт", "Пятница", , БиблиотекаКартинок.ВводНаОсновании);
                СписокДней.Добавить("Сб", "Суббота", , БиблиотекаКартинок.ВидРасчета);
                СписокДней.Добавить("Вс", "Воскресенье", , БиблиотекаКартинок.ВложеннаяТаблица); 
                
                ВыбранныйЭлемент = СписокДней.ВыбратьЭлемент("Выберите день");
            КонецПроцедуры
        </pre>
    </div>
    <img src="../img/1С-1/2023-01-18_10-16-24.png" alt="">
    <p class="title-size16"><b>Количество элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">КоличествоЭлементов <span class="vue-r">=</span> СписокДней<span class="vue-r">.</span>Количество<span class="vue-r">();</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Поиск элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>НайтиПоЗначению<span class="vue-r">(</span>"Пн"<span class="vue-r">);</span></span><span class="vue-g">// ЭлементСпискаЗначений</span>
            <span class="vue-g">// ЭлементСпискаЗначений это как бы объект, который содержит все поля выбранного элемента</span>
            <span class="vue-g">// это и индекс и значение и представление и пометка и картинка</span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>НайтиПоИдентификатору<span class="vue-r">(</span>2<span class="vue-r">);</span></span><span class="vue-g">// ЭлементСпискаЗначений</span>

            <span class="vue-g">// если вывести через Сообщить() или ОткрытьЗначение(), то автоматом будет </span>
            <span class="vue-g">// вызвано свойство Представление и мы увидим Понедельник в 1м случае и Среда во втором</span>
        </pre>
    </div>
    <p class="title-size16"><b>Получение элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Получить<span class="vue-r">(3);</span></span><span class="vue-g">// Четверг</span>
            <span class="vue-b">СписокДней<span class="vue-r">[</span>3<span class="vue-r">];</span></span><span class="vue-g">// Четверг</span>
            <span class="vue-b">СписокДней<span class="vue-r">[</span>3<span class="vue-r">].</span>Значение<span class="vue-r">;</span></span><span class="vue-g">// Чт</span>
        </pre>
    </div>
    <p class="title-size16"><b>Обход в цикле</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-r">Для каждого</span> <span class="vue-b">Элемент</span> <span class="vue-r">Из</span> <span class="vue-b">СписокДней</span> <span class="vue-r">Цикл</span>
                    <span class="vue-b">Сообщить<span class="vue-r">(</span>Элемент<span class="vue-r">.</span>Значение<span class="vue-r">);</span></span>
                    <span class="vue-b">Сообщить<span class="vue-r">(</span>Элемент<span class="vue-r">.</span>Представление<span class="vue-r">);</span></span>
                    <span class="vue-b">Сообщить<span class="vue-r">(</span>Элемент<span class="vue-r">.</span>Пометка<span class="vue-r">);</span></span>
                    <span class="vue-b">Сообщить<span class="vue-r">(</span>Элемент<span class="vue-r">.</span>Картинка<span class="vue-r">);</span></span>
            <span class="vue-r">КонецЦикла;</span>
        </pre>
    </div>
    <p>В обычном массиве в переменной Элемент лежали бы сразу значения элемента, но в списке значений в переменной Элемент лежит объект с полями(Значение(может иметь произвольный тип) и Представление(тип Строка)), Пометка и Картинка.</p>
    <p class="title-size16"><b>Метод ВыбратьЭлемент для выбора одного значения</b>. В этом и состоит главное отличие от массива. Это делает список значений удобным для взаимодействия с пользователем. Список с помощью метода ВыбратьЭлемент() выводит пользователю окно со списком событий описанных в сво-ве Представление(2й парметр при добавлении события), выбирая событие метод возвращает объект с типом "ЭлементСпискаЗначений" или возвращает Неопределено при отмене:</p>
    <div class="code-style">
        <pre>
            Список = Новый СписокЗначений;
            Список.Добавить(1861, "Отмена рабства");
            Список.Добавить(1961, "Полёт в космос");

            <span class="vue-r">//при использовании модальности в конфигурации</span>
            ВыбранныйЭлемент = <span class="vue-b">Список<span class="vue-r">.</span>ВыбратьЭлемент<span class="vue-r">(</span>"Выберите событие"<span class="vue-r">);</span></span>

            Если ВыбранныйЭлемент &lt;> Неопределено Тогда
                Сообщить("Это событие произошло в " + ВыбранныйЭлемент.Значение);
            КонецЕсли;

            //<span class="vue-g">ответом при выборе одного из событий будет год, но год выведется так - 1 961, это из за форматирования чисел по умолчанию, 1С ставит пробел через каждые 3 разряда, начиная справа</span>
            //<span class="vue-g">можно исправить так</span>
            Если ВыбранныйЭлемент &lt;> Неопределено Тогда
                Сообщить("Это событие произошло в " + Формат(ВыбранныйЭлемент.Значение, "ЧГ=0"));
            КонецЕсли;


            <span class="vue-r">//при НЕ использовании модальности у конфигурации</span>
            <span class="vue-g">//что тут ниже просиходит можно посмотреть в этом видео https://www.youtube.com/watch?v=RU2LyuhgWNo&t=3526s с 01:23:00</span>
            ЧтоДелатьПослеВыбора = Новый ОписаниеОповещения("ПослеВыбораЗначения", ЭтотОбъект);
            ВыбранныйЭлемент = Список.ПоказатьВыборЭлемента(ЧтоДелатьПослеВыбора, "Выберите событие");

            <span class="vue-g">//эта процедура выполнится если запущен способ при НЕ использовании модальности у конфигурации</span>
            &НаКлиенте
            Процедура ПослеВыбораЗначения(ВыбранныйЭлемент, ДополнительныеПараметры)
                Если ВыбранныйЭлемент = Неопределено Тогда
                    Возврат;
                КонецЕсли;
                Сообщить("Это событие случилось в " + ВыбранныйЭлемент + " году");
            Конецпроцедуры
        </pre>
    </div>
    <p class="title-size16"><b>Метод ОтметитьЭлементы() для выбора нескольких элементов</b>. </p>
    <div class="code-style">
        <pre>
            <span class="vue-r">//этот модальный</span>
            <span class="vue-g">//для выбора нескольких элементов из списка пользователю предоставляет метод ОтметитьЭлементы()
            //очень важно!!! метод ОтметитьЭлементы() не возвращает список отмеченных элементов
            //он возвращает булево значение - Истина, если отмечен хоть 1 элемент и Ложь при не отмеченных или Отмене
            //но перебирать же что то надо, чтобы понять что выбрано, а перебирать будем наш Список
            //при переборе проверяем Элемент.Пометка, вот в этом сво-ве и будет стоять пометка выбран он или нет</span>
            ВыбранныеЭлементы = Список.ОтметитьЭлементы("Выберите несколько событий");
            ГодаВыбранныхСобытий = "";
            Если ВыбранныеЭлементы &lt;> Неопределено Тогда
                Для каждого Элемент из Список Цикл
                    Если Элемент.Пометка Тогда							
                        ГодаВыбранныхСобытий = ГодаВыбранныхСобытий + Элемент.Значение + " ";		
                    КонецЕсли;		
                КонецЦикла;
                Сообщить("Выбранные события случились в " + ГодаВыбранныхСобытий + " годах");
            КонецЕсли;


            <span class="vue-r">//а это не модальный</span>
            <span class="vue-g">//ЧтоДелатьПослеОтметки = Новый ОписаниеОповещения("ПослеОтметкиЗначения", ЭтотОбъект);
            //ВыбранныйЭлемент = Список.ПоказатьВыборЭлемента(ЧтоДелатьПослеОтметки, "Выберите несколько событий");</span>
            &НаКлиенте
            Процедура ПослеОтметкиЗначения(Список, ДополнительныеПараметры)
                Если Список = Неопределено Тогда
                    Возврат;
                КонецЕсли;
                ГодаВыбранныхСобытий = "";
                Для каждого Элемент из Список Цикл
                    Если Элемент.Пометка Тогда							
                        ГодаВыбранныхСобытий = ГодаВыбранныхСобытий + Элемент.Значение + " ";		
                    КонецЕсли;		
                КонецЦикла;
                Сообщить("Выбранные события случились в " + ГодаВыбранныхСобытий + " годах");
            Конецпроцедуры

        </pre>
    </div>
    <p class="title-size16"><b>Удаление и очищение элементов</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Удалить<span class="vue-r">(2);</span></span>
            <span class="vue-b">СписокДней<span class="vue-r">.</span>Очистить<span class="vue-r">();</span></span>
        </pre>
    </div>
    <p>Так выглядит список значений у пользователя:</p>
    <img src="../img/1С-1/2023-01-18_09-17-58.png" class="screen" alt="">

    <p class="title-size16"><b>Список значений можно использовать в качестве реквизита формы</b>.</p>
    <p>Это нужно, чтобы пользователь видел сам этот список у себя в 1с предприятии. Сделаем, например, форму у любого прикладного объекта, у той же внешней обработки и создадим у него реквизит "ДниНедели" с типом "Список значений". После этого сразу реквизит станет списком со своими свойствами, можно нажать на "+" и посмотреть свойства. Перенесём этот реквизит в элементы формы слева куда нам надо и система спросит нас как отображать этот список: таблицей или полем. Выберем сначало Таблица. Видим появиласт таблица похожая на табличную часть с 2мя кнопками "Добавить" и "Подбор". Кнопка "Добавить" понятно что делает, добавляет новое значение, а кнопка "Подбор" будет работать только если у нас есть значения ссылочного типа, когда нужно будет подобрать значения из справочника, документов и т.д. Также можно перетащить ещё раз этот реквизит, теперь уже в виде поля.В поле спрва будет кнопка с ..., по нажатию на которую откроется список со значениями и можно выбирать их там.</p>
    <p>Если в пользовательской части попробовать добавить значение, то выведется список типов нового значения из него выбираем какой тип нам нужен, а можно в форме реквизиту зразу задать "Тип значения" какой нам нужен, например выбор из какого-нибудь справочника(СправочникСсылка.Имя). Тепер при добавлении значения откроется список элементов из установленного справочника. И теперь кнопка "Подбор" также заработае, она позволяет не закрывая справочник выбирать много элементов тыкая по ним и они один за другим добавляются в наш список значений. Вот показан один из способов заполнить список значений, можно заполнять список и программно.</p>
    
    <p class="title-size16"><b>Умеет сортировать</b>. Список может сам отсортировать свои значения - <span class="vue-b">Список.СортироватьПоЗначению(НаправлениеСортировки.Возр/НаправлениеСортировки.Убыв);</span>. Как я заметил отсортируются по возрастанию лет, указанных 1м параметром при добавлении. В случае с обычным массивом нам бы пришлось делать сортировку по алгоритму "пузырёк".</p>
    <p class="title-size16"><b>Умеет искать</b>. Также как и массив, список умеет сам искать свои элементы. Например, мы хотим выяснить, присутствует ли введёное пользователем число в нашем списке:</p>
    <div class="code-style">
        <pre>
            Список = Новый СписокЗначений;
            Список.Добавить(1861, "Отмена рабства");
            Список.Добавить(1961, "Полёт в космос");

            Число = 0;
            ВвестиЧисло(Число);

            <span class="vue-b"></span>НайденныйЭлемент <span class="vue-r">=</span> Список<span class="vue-r">.</span>НайтиПоЗначению<span class="vue-r">(</span>Число<span class="vue-r">);</span></span>

            Если <span class="vue-b">НайденныйЭлемент</span> = <span class="vue-r">Неопределено</span> Тогда
                ОткрытьЗначение("Список не содержит такое число");
            Иначе
                ОткрытьЗначение("Число " + Число + " присутствует в списке. Вот оно: " + <span class="vue-b">НайденныйЭлемент<span class="vue-r">.</span>Значение</span>);
            КонецЕсли;
        </pre>
    </div>
    <p class="title-size16"><b>Поддерживает вставку и удаление</b>. Список также как и массив поддерживает вставку и удаление элементов:</p>
    <div class="code-style">
        <pre>
            //<span class="vue-g">втавляем 1000 в начало списка</span>
            <span class="vue-b">Список<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>0, 1000<span class="vue-r">);</span></span>

            //<span class="vue-g">и тут же удаляем её из списка</span>
            <span class="vue-b">Список<span class="vue-r">.</span>Удалить<span class="vue-r">(</span>0<span class="vue-r">);</span></span>

            //<span class="vue-g">вставляем 13 в конец списка</span>
            <span class="vue-b">Список<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>Список<span class="vue-r">.</span>Количество<span class="vue-r">(), </span>13<span class="vue-r">);</span></span>

            //<span class="vue-g">выводим последний элемент списка</span>
            <span class="vue-b">Сообщить<span class="vue-r">(</span>Список<span class="vue-r">[</span>Список<span class="vue-r">.</span>Количество<span class="vue-r">()</span> - 1<span class="vue-r">]</span><span class="vue-r">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Поддерживает квадратные скобки</b>. Нумерация элементов списка также идёт с нуля и мы можем обратиться к любому элементу по его индексу через квадратные скобки:</p>
    <div class="code-style">
        <pre>
            Сообщить(Список[1].Значение);

            //мы также можем пробежаться по элемента списка через цикл для:
            Для А = 0 По Список.Количество() - 1 Цикл
                Сообщить(Список[А].Значение);
            КонецЦикла;
        </pre>
    </div>
    <p class="title-size16"><b>Умеет создавать свою копию</b>. У списка значений есть просто отличная возвожность создавать свою копию.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">КопияСписка <span class="vue-r">=</span> Список<span class="vue-r">.</span>Скопировать<span class="vue-r">();</span></span>

            //<span class="vue-g">теперь у нас есть копия КопияСписка, мы можем делать с ней что хотим, при этом оригинал не изменится</span>
        </pre>
    </div>
    <p class="title-size16"><b>Умеет превращаться в массив</b>. Мы можем легко выгрузить все значения элементов списка в массив:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">МассивЧисел <span class="vue-r">=</span> Список<span class="vue-r">.</span>ВыгрузитьЗначения<span class="vue-r">();</span></span>
            //<span class="vue-g">теперь МассивЧисел является массивом</span
        </pre>
    </div>
    <p class="title-size16"><b>Умеет загружать массив</b>. Мы можем загрузить в список значений, например, колонку из таблицы значений, для этого у ТЗ есть метод ВыгрузитьКолонку("Имя колонки"), этот метод возвращает массив, как раз то, что и нужно на вход в список значений:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
            ТЗ <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выгрузить<span class="vue-r">();</span>
            
            СЗ <span class="vue-r">= Новый</span> СписокЗначений<span class="vue-r">;</span>
            СЗ<span class="vue-r">.</span>ЗагрузитьЗначения<span class="vue-r">(</span>ТЗ<span class="vue-r">.</span>ВыгрузитьКолонку<span class="vue-r">(</span><span class="vue-bl">"СрокГодности"</span><span class="vue-r">);</span></span>
        </pre>
    </div>
    <p class="title-size16"><b>Использование списка значений на форме, начинается в видео с 01:35:00</b></p>











    
    <h3 class="header-style2" id="table">Таблица значений</h3>
    <img src="../img/1С-1/2023-01-18_11-16-33.png" class="screen" alt="">
    <p>Таблица значений используется в том случае если нужно в коде работать с табличными данными. Например, запрос к виртуальной таблице остатков товаров вернёт таблицу с типом "ТаблицаЗначений" и т.д.</p>
    <p>При создании таблицы значений нужно определить какие колонки в этой таблице будут. Имя колонки указываются в виде строки. У каждой строки есть индекс, а в значениях колонок может быть произвольный тип данных. Таблица значений как коллекция довольна тяжела в смысле использования ею ресурсов компьютера, поэтому она <b>не доступна на клиенте</b>, поэтому когда я для тренировки создавал внешнюю обработку с формой и на форме размещал кнопку для запуска примеров с таблицей значений, то действие для этой кнопки будет процедура на клиенте с запуском процедуры на сервере. Таблица значений это как массив содержащий структуры. Рассмотрим как работать с таблицей значений.</p>
    <p>Таблицу значений можно получить выгрузив из результата запроса данные с помощью метода Выгрузить(). Также таблицу значений можно получить выгрузив данные из табличной части опять с помощью метода Выгрузить(). Для более подробных сведений смотреть синтакс помошник.</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ЗапуститьТаблицуЗначений(Команда)
                ЗапуститьТаблицуЗначенийНаСервере();
            КонецПроцедуры


            &НаСервере
            Процедура ЗапуститьТаблицуЗначенийНаСервере()
                <span class="vue-g">//тут будет весь код по созданию таблицы</span>
            КонецПроцедуры
        </pre>
    </div>
    <p>Будем создавать таблицу с товарами, в которой будут поля Артикул, Наименование, Количество, ЦенаЗакупки, ЦенаПродажи и Сумма.</p>

    <p class="title-size16"><b>Создаём таблицу значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r"> = Новый</span> ТаблицаЗначений<span class="vue-r">;</span></span>
        </pre>
    </div>

    <p class="title-size16"><b>Добавляем колонки таблицы</b>. У созданной таблицы есть свойство Колонки, это свойство содержит коллекцию колонок данной таблицы(что то типо набора записей у регистра). Эта коллекция колонок имеет ряд методов работы с колонками. Нам нужно добавить колонки:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//все параметры метода Добавить необязательны</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>&lt;Имя>,&lt;Тип>,&lt;Заголовок>,&lt;Ширина><span class="vue-r">)</span>;</span>

            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Группа"<span class="vue-r">)</span>;</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Артикул"<span class="vue-r">)</span>;</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Наименование"<span class="vue-r">)</span>;</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Количество"<span class="vue-r">)</span>;</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"ЦенаЗакупки"<span class="vue-r">)</span>;</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"ЦенаПродажи"<span class="vue-r">)</span>;</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Сумма"<span class="vue-r">)</span>;</span>
        </pre>
    </div>
    <p><span class="vue-r">Важно!!!</span>. Для колнок также обязательно нужно установить 2м параметром тип колонок, как это делать описано <a href="#typeColumn">ниже</a>.</p>

    <p class="title-size16"><b>Выгружаем колонку в список значений</b>. 
    <div class="code-style">
        <pre>
            <span class="vue-b">РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
            ТЗ <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выгрузить<span class="vue-r">();</span>
            
            СЗ <span class="vue-r">= Новый</span> СписокЗначений<span class="vue-r">;</span>
            СЗ<span class="vue-r">.</span>ЗагрузитьЗначения<span class="vue-r">(</span>ТЗ<span class="vue-r">.</span>ВыгрузитьКолонку<span class="vue-r">(</span><span class="vue-bl">"СрокГодности"</span><span class="vue-r">);</span></span>
        </pre>
    </div>

    <p class="title-size16"><b>Добавляем/вставляем элементы(строки) в таблицу значений</b>. Метод Добавить() добавляет строку в конец таблицы, не имеет параметров и возвращает объект с типом "СтрокаТаблицыЗначений"</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//добавляем первую строку</span>
            <span class="vue-b">НоваяСтрока <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-r">)</span>;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Группа <span class="vue-r">=</span> "Компьютерные комплектующие";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Артикуль <span class="vue-r">=</span> "А12344";</span> <span class="vue-g">//или</span> <span class="vue-b">НоваяСтрока<span class="vue-r">[</span>"Артикуль"<span class="vue-r">]</span> <span class="vue-r">=</span> "А12344";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Наименование <span class="vue-r">=</span> "Мышь Logitec";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Количество <span class="vue-r">=</span> 3;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>ЦенаЗакупки <span class="vue-r">=</span> 120;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>ЦенаПродажи <span class="vue-r">=</span> 350;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> 1050;</span>

            <span class="vue-g">//добавляем вторую строку</span>
            <span class="vue-b">НоваяСтрока <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-r">)</span>;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Группа <span class="vue-r">=</span> "Компьютерные комплектующие";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Артикуль <span class="vue-r">=</span> "А32112";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Наименование <span class="vue-r">=</span> "Клавиатура Logitec";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Количество <span class="vue-r">=</span> 1;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>ЦенаЗакупки <span class="vue-r">=</span> 2000;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>ЦенаПродажи <span class="vue-r">=</span> 4500;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> 4500;</span>

            <span class="vue-g">//добавляем третью строку</span>
            <span class="vue-b">НоваяСтрока <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-r">)</span>;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Группа <span class="vue-r">=</span> "Микрофоны";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Артикуль <span class="vue-r">=</span> "Б36712";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Наименование <span class="vue-r">=</span> "Микрофон Rode NT-32";</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Количество <span class="vue-r">=</span> 2;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>ЦенаЗакупки <span class="vue-r">=</span> 3000;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>ЦенаПродажи <span class="vue-r">=</span> 5500;</span>
            <span class="vue-b">НоваяСтрока<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> 11000;</span>

            <span class="vue-g">//добавление строк конечно нужно делать в цикле</span>
        </pre>
    </div>

    <p class="title-size16"><b>Получение количества элементов(строк) в таблице значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">КоличествоСтрок <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>Количество<span class="vue-r">(</span><span class="vue-r">)</span>;</span>
        </pre>
    </div>

    <p class="title-size16"><b>Поиск элемента/элементов(строки/строк) в таблице значений</b>. Для этого есть 2 метода Найти(&lt;Значение>, &lt;Колонки>), который ищет один элемент таблицы, и НайтиСтроки(&lt;ПараметрыОтбора>) ищущий несколько строк. Метод Найти() возвращает объект строки с типом "СтрокаТаблицыЗначений", либо Неопределено.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//найдём одну строку с наименованием "Мышь logitec"</span>
            <span class="vue-b">Мышь <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>Найти<span class="vue-r">(</span>"Мышь logitec", "Наименование"<span class="vue-r">)</span>;
            <span class="vue-r">Если</span> Мышь <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                Сообщить<span class="vue-r">(</span>"Товар Мышь не найдена в таблице"<span class="vue-r">)</span>;
            <span class="vue-r">КонецЕсли;</span></span>

            <span class="vue-g">//если мы пытаемся найти по значению колонки и это значение повторяется
            //у нескольких строк, то будет возвращена строка найденая первая с таким значением
            //ну например мы ищем по значению "Компьютерные комплектующие" колонки Группа
            //такое значение колонки есть у нескольких строк, поэтому чтобы получить все строки с таким значением
            //нужно использовать другой метод НайтиСтроки(). Этот метод принимает ПараметрОтбора
            //в виде структуры. Структура вообще часто выступает параметром отбора для разных методов,
            //потому что у неё удобное хранение данных(Ключ-Значение) для таких отборов</span>
            <span class="vue-b">ПараметрОтбора <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span>"Группа", "Компьютерные комплектующие"<span class="vue-r">)</span>;
            ВсеКомплектующие <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>НайтиСтроки<span class="vue-r">(</span>ПараметрОтбора<span class="vue-r">)</span>;</span>
            <span class="vue-g">//метод НайтиСтроки() возвращает массив объектов с типом 
            //"СтрокаТаблицыЗначений"</span>
            <span class="vue-b"><span class="vue-r">Если</span> ВсеКомплектующие<span class="vue-r">.</span>Количество<span class="vue-r">() =</span> 0 <span class="vue-r">Тогда</span>
                Сообщить<span class="vue-r">(</span>"Элементов таблицы не найдены с таким значением"<span class="vue-r">)</span>;
            <span class="vue-r">КонецЕсли;</span>
            <span class="vue-r">Для каждого</span> СтрокаТаблицы <span class="vue-r">Из</span> ВсеКомплектующие <span class="vue-r">Цикл</span>
                <span class="vue-g">//в переменной СтрокаТаблицы на каждом круге будет объект
                //у этого объекта доступны все колонки таблицы через точку или скобки</span>
                Сообщить<span class="vue-r">(</span>СтрокаТаблицы<span class="vue-r">.</span>Артикул<span class="vue-r">)</span>;
            <span class="vue-r">КонецЦикла;</span></span>
        </pre>
    </div>

    <p class="title-size16"><b>Создание копии таблицы значений</b>. Ну например нам нужно с пришедшей таблицей что то сделать, но при этом не трогая исходную таблицу. Для этого есть 2 способа копирования: 1)Целиком вместе с данными, 2)Можно копировать в части описания колонок, без данных. Для первого случая есть метод Скопировать(&lt;Строки>, &lt;Колонки>), этот метод может даже отфильтровать какие строки мы можем скопировать, например мы хотим не всю таблицу скопировать, а только те строки, где есть значения "Компьютерные комплектующие" колонки Группа. В параметр &ltСтроки> нужно передать массив строк, выше мы уже отобрали такие строки и они лежат в переменной ВсеКомплектующие, вот их и передадим для копирования. Если ничего не передавать, будут скопированы все строки. Также если вторым параметром указать в строке перечисленные названия колонок, то будут добавлены только эти колонки, а не все. Давайте добавим только колонку Наименования скопированных комплектующих.</p>
    <p>Для второго случая есть метод СкопироватьКолонки(&lt;Колонки>), тут указываются в виде строки названия колонок, копирование идёт без значений колонок.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//1й способ</span>
            <span class="vue-b">ТаблицаКомплектующих <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>Скопировать<span class="vue-r">(</span>ВсеКомплектующие, "Наименование, ЦенаПродажи"<span class="vue-r">)</span>;</span>

            <span class="vue-g">//2й способ</span>
            <span class="vue-b">ПолнаяКопияБезДанных <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>СкопироватьКолонки<span class="vue-r">(</span><span class="vue-r">)</span>;</span>
            <span class="vue-g">//теперь в переменной ПолнаяКопияБезДанных лежит таблица значений, у которой
            //есть свойство Колонки(КоллекцияКолонокТаблицыЗначений), эта коллекция содержит объекты колонок
            //из этих объектов колонок можно получить имена колонок и т.д.
            //для чего такая копия нужна пока не знаю. 
            </span>
        </pre>
    </div>

    <p class="title-size16"><b>Выполняем сортировку в таблице значений</b>. Если мы запросили остатки товаров, то к нам приходит ТаблицаЗначений, вот мы её можем на месте отсортировать по убыванию или возрастанию, если это не сделано в запросе. Для этого есть метод Сортировать(&lt;Колонки>, &lt;ОбъектСравнения>). Второй параметр используется не часто, чаще первый. У нас есть скопированная таблица комплектующих с 2мя колонками - Наименование и ЦенаПродажи, отсортируем по ЦенаПродажи по убыванию:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//по возрастанию ЦенаПродажи, стоит по умолчанию</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Сортировать<span class="vue-r">(</span>"ЦенаПродажи"<span class="vue-r">)</span>;</span>

            <span class="vue-g">//по убыванию ЦенаПродажи</span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Сортировать<span class="vue-r">(</span>"ЦенаПродажи Убыв"<span class="vue-r">)</span>;</span>
        </pre>
    </div>

    <p class="title-size16"><b>Получение итогов по числовой колонке</b>. Для этих целей есть метод Итог(&lt;Колонка>). В параметр передаётся имя колонки, по которой необходимо посчитать итог. Можно конечно и в цикле обойти строки и просуммировать значения колонки, но есть способ проще, просто метод Итог():</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//как помним в ТаблицаКомплектующих лежит скопированная таблица строк
            //только комплектующих товаров с 2 мя колонками "Наименование" и "ЦенаПродажи"
            </span>
            <span class="vue-b">ИтогЦеныПродажи<span class="vue-r"> = </span>ТаблицаКомплектующих<span class="vue-r">.</span>Итог<span class="vue-r">(</span>"ЦенаПродажи"<span class="vue-r">)</span>;</span>
        </pre>
    </div>

    <p class="title-size16"><b>Свёртывание(Группировка) строк таблицы значений</b>. Есть метод Свернуть(), он такой же как в запросах мы групируем по одному полю и например суммируем по другому. Насколько я заметил, то тут есть одно отличие от группировки в запросах. Мы укажем по какой колонке надо свернуть, а другая колонка, ну например Договор из картинки ниже сама исчезнет из результатирующей таблицы. В запросах я точно не помню, но там если есть такое поле как Договор, то с ним тоже надо что то делать, сам по себе он не пропадёт, его надо будет тоже в группирующее поле помещать.</p>
    <img src="../img/1С-1/2023-01-19_10-41-18.png" class="screen" alt="">
    <div class="code-style">
        <pre>
            <span class="vue-g">//важно помнить, что мы сворачиваем основную таблицу товаров и после
            //свёртки она изменится, ну во-первых колонки останутся только 2(Группа, Сумма) 
            //и второе они будут свёрнуты
            </span>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Свернуть<span class="vue-r">(</span><span class="vue-bl">"Контрагент"</span><span class="vue-r">,</span> <span class="vue-bl">"Сумма"</span><span class="vue-r">)</span>;</span>
        </pre>
    </div>

    <p class="title-size16"><b>Заполнение зачениями колонки таблицы</b>.</p>
    <p>Допустим мы хотим к таблице добавить колонку, добавляем её, даём имя и надо чем то заполнить в каждой строке эту колонку. Для этого есть метод ЗаполнитьЗначениями(), 1й параметр это значение, второй параметр имя колонки, в которую заполняем:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Склад"<span class="vue-r">);</span>
            ТаблицаТоваров<span class="vue-r">.</span>ЗаполнитьЗначения<span class="vue-r">(</span>Склад<span class="vue-r">,</span> "Склад"<span class="vue-r">);</span>
        </pre>
    </div>
    <p>В переменной Склад, например, лежит слово Основной, значит во всех строках этой колонки заполнится значение Основной.</p>

    <p class="title-size16"><b>Обход всех строк(элементов) таблицы значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//из за того что мы выше свернули основную таблицу и поля в ней урезались
            //то часто быввает что об этом забывают и пытаются при переборе получить поля, которых нет
            //об этом надо помнить, либо копировать всю таблицу и уже копированнную свёртывать
            //чтобы основная была не тронута
            </span>
            <span class="vue-r">Для каждого</span> <span class="vue-b">СтрокаТаблицы</span> <span class="vue-r">Из</span> <span class="vue-b">ТаблицаТоваров</span> <span class="vue-r">Цикл</span>
                <span class="vue-b">Сообщить<span class="vue-r">(</span>Элемент<span class="vue-r">.</span>Значение<span class="vue-r">);</span></span>
            <span class="vue-r">КонецЦикла;</span>
        </pre>
    </div>

    <p class="title-size16"><b>Удалить строку из таблицы значений</b>. Есть 2 способа удаления: 1)по объекту, указываем в параметре объект строку, 2)по индексу, указываем индекс.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//1й способ по объекту. При удалении по объекту нужно найти этот объект
            //ещё раз напомню основная таблица свёрнута и не имеет поля Наименование
            </span>
            <span class="vue-b">Мышь <span class="vue-r">=</span> ТаблицаТоваров<span class="vue-r">.</span>Найти<span class="vue-r">(</span>"Мышь logitec", "Наименование"<span class="vue-r">)</span>;
            <span class="vue-r">Если</span> Мышь <span class="vue-r">&lt;></span> Неопределено <span class="vue-r">Тогда</span>
                <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Удалить<span class="vue-r">(</span>Мышь<span class="vue-r">)</span>;</span>
            <span class="vue-r">КонецЕсли;</span></span>

            <span class="vue-g">//удаление по индексу, важно тоже проверять на наличие удаляемого      
            //индекса, можно проверить количеством строк
            </span>
        </pre>
    </div>

    <p class="title-size16"><b>Очиска таблицы значений</b>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Очистить<span class="vue-r">(</span><span class="vue-r">)</span>;</span>
        </pre>
    </div>

    <p class="title-size16"><b>Особенности работы с таблицей значений</b>. 
    <p class="title-size16"><b>1 особенность</b></p>
    <p>Часто таблицы значений могут быть большими(1000, 10000, 1000000 строк) и поиск по такой таблице может затянуться. Чтобы избежать затяжного поиска у таблицы есть свойство Индексы. Это свойство содержит коллекцию индексов таблицы значений. Что это такое? Возьмём например толстую книгу и нам нужно найти какой то текст в этой книге, мы можем листая каждую страницу просматривать на совпадение с искомым текстом, это займёт очень много времени. А можно просто посмотреть в оглавление и узнать на какой странице наш искомый текст. Вот также работает свойство Индексы. У этой коллекции есть методы Добавить(&lt;Колонки>), Удалить(), Количество() и Очистить(). Мы например знаем по каким колонкам мы будем искать, пусть мы ищем по Артикулам, значит нам надо перед поиском провести индексацию по полю Артикул:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ТаблицаТоваров<span class="vue-r">.</span>Индексы<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>"Артикул"<span class="vue-r">)</span>;</span>

            <span class="vue-g">//ну и далее уже можно искать</span>
        </pre>
    </div>
    <p class="title-size16"><b>2 особенность</b></p>
    <p id="typeColumn">Работа с таблицей значений, созданной в тексте программы, в запросе. Часто бывают ситуации, когда нашу таблицу значений, лежащей в оперативной памяти нужно перенести в запрос, для того чтобы в запросе выполнить соединение нашей таблицы с таблицей из запроса. Открываем к коде конструктор запросов и выше центральной колонки есть кнопка "Создать описание временной таблицы", как я понял это кнопка служит для того чтобы в конструктор ввести описание внешней таблицы для помещения её во временную таблицу и эта таблица уже будет доступна в конструкторе для дальнейшей работы с ней. Итак открываем окно описания и вносим имя таблицы "ТаблицаТоваров" и также вносим все поля, которые у нас есть в таблице значений - Артикул, Наименование, Количество, ЦенаЗакупки, ЦенаПродпжи, Сумма. Нажимаем ОК и у нас в центральной колонке появилась наша таблица, из неё выносим получение полей в правую колонку и теперь надо поместить её во временную таблицу на вкладке Дополнительно. Дадим имя временной таблице ВТ_Товары и далее во вкладке "Пакет запросов" жмём создать второй запрос по плюсику и уже можно писать новый запрос используя временную нашу таблицу. Мы можем соединить нашу временную таблицу с таблицей из БД и т.д. Когда конструктор собрал запрос и мы увидели этот запрос в тексте программы, то запрос пока ещё не понимает как ему взять в запрос нашу таблицу значений ТаблицаТоваров, для этого нужно указать в запросе, что ТаблицаТоваров это параметр и надо дописать строку с установкой параметра для ТаблицыТоваров, на примере будет всё понятно:</p>
    <img src="../img/1С-1/2023-01-20_09-28-19.png" class="screen" alt="">
    <p>На запрос особо нечего засматриваться, там ничего интересного, просто показано как таблицу из кода внести в запрос для работы.</p>
    <p><span class="vue-r">Ошибка!!!</span>. Если запустить этот код, то будет ошибка, что поле Артикул не может быть найдено, это происходит потому, что наши колонки в таблице значений не типизированны, а у них должно быть обязательно указаны типы, иначе такой запрос ситема выполнить не моджет. Выход следующий, когда мы добавляли колонки в таблицу, то 2й параметр у метода Добавить() это Тип, нужно добавить типы колонок. Чтобы описать тип используется объект <span class="vue-b">ОписаниеТипов</span>. В этом видео про это рассказывается с 02:25:00 - https://www.youtube.com/watch?v=RU2LyuhgWNo&list=PLnhTnXRFDQ7en_MVaepKmkL2g23zOXQMx&index=8:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//опишем тип число
            //квалификаторы какого то типа это, например для числа это описание лоп. настроек как 
            //длина, точность, отрицательное или нет</span>
            <span class="vue-b">
            КвалификаторыЧисла = Новый КвалификаторыЧисла(10, 2);
            ОписаниеТипаЧисло = Новый ОписаниеТипов("Число", , , КвалификаторыЧисла)</span>

            <span class="vue-g">//опишем тип строка
            //квалификаторы для строки такие как длина строки, допустимая длина
            //важно заметить что квалификатор для строки в описании типов будет стоять 5м параметром
            </span>
            <span class="vue-b">
            КвалификаторыСтроки = Новый КвалификаторыСтроки(100);
            ОписаниеТипаСтрока = Новый ОписаниеТипов("Строка", , , , КвалификаторыСтроки)</span>

            <span class="vue-g">//когда мы создаём какой то объект конфигурации, то там мы указываем типы и квалификаторы
            //для реквизитов просто выбирая из списка типов или ставя галочки, вот тут то же самое
            //только в программном виде</span>
        </pre>
    </div>
    <p>Мы создали типы для наших колонок, вот их и надо добавить 2м параметом в метод Добавить() коллекции Колонки -> ТаблицаТоваров.Колонки.Добавить("Артикуль", ОписаниеТипаСтрока); и так далее для всех колонок.</p>
    <p>Колонки должны быть типизированы, если мы хотим использовать нашу таблицу значений в запросе.</p>
    <img src="../img/1С-1/2023-01-20_10-14-22.png" class="screen" alt="">

    <p id="table-1"><b>Работа с таблицей значений на форме</b>. Точно так как и список значений мы можем разместить на форме реквизит с типом "ТаблицаЗначений". Например создадим реквизит "ТаблицаОстатки" и укажем ей этот тип. Как только мы этому реквизиту указали тип "ТаблицаЗначений", то сверху в панельке кнопок стала доступка кнопка "Добавить колонку реквизита". Нажав на неё внутри реквизита появится колонка реквизит, ей зададим имя такое как и у регистра накопления называются измерения и русурс. Мы хотим показывать в этой таблице какую нибудь таблицу регистра накопления "ОстаткиНоменклатуры". У регистра есть 2 измерения Товар и Склад и ресурс Количество, значит называем реквизит колонку Товар с типом СправочникСсылка.Номенклатура, затем добавим реквизит колонку Склад, с типом СправочникСсылка.Склад и колонку Количество с типом Число. Перетаскиваем реквизит "ТаблицаОстатки" влево на элементы формы. Смотрим что получилось, пока это просто таблица, в которую можно добавлять товары и склады из справочников. Мы же хотим при открытии этой формы заполнения остатками из регистра. Для этого для события формы "ПриСозданииНаСервере" напишем обработчик. В обработчике конструируем запрос из таблицы регистра накопления ОстаткиНоменклатуры.Остатки. Обход результата запроса нам не нужен, а нужен метод РезультатЗапроса.Выгрузить();. Как известно этот метод выгружает результат в таблицы. Но просто так выгрузить в реквизит "ТаблицаОстатки" не получится, потому что у реквизита с типом таблица значений есть свой метод Загрузить(). Поэтому сначала выгружаем из результата во временную переменную, а потом в "ТаблицаОстатки" загружаем из этой временной переменной.</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)	
                Запрос = Новый Запрос;
                Запрос.Текст = 
                    "ВЫБРАТЬ
                    |	ОстаткиНоменклатурыОстатки.Номенклатура КАК Номенклатура,
                    |	ОстаткиНоменклатурыОстатки.Склад КАК Склад,
                    |	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество
                    |ИЗ
                    |	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки";
                
                РезультатЗапроса = Запрос.Выполнить();
                ТаблицаЗапроса = РезультатЗапроса.Выгрузить();
                ТаблицаОстатки.Загрузить(ТаблицаЗапроса);
            КонецПроцедуры
        </pre>
    </div>
    <p>Хотя если посмотреть в форме какой тип показывает у реквизита "ТаблицаОстатки", то там в скобках написано (ТаблицаЗначений), если в таких скобках, значит это не совсем таблица значений, хотя методы у неё такие как и у таблицы занчений, но не все, например, метода Свернуть() нет. Посмторел в отладчике, тип на самом деле у этого реквизита  - ДанныеФормыКоллекция. Чтобы получить таблицу значений из этого реквизита, есть такой метод как <span class="vue-b">РеквизитФормыВЗначение("ТаблицаОстатки")</span> аернёт таблицу значений.</p>
    <p>Таким не хитрым способом можно отображать регистры(и не только) в формах обработки, документа или ещё где то.</p>










    <h3 class="header-style2" id="tree">Дерево занчений</h3>
    <p>Дерево значений это коллекция, которая позволяет хранить данные почти в таком же виде как и таблица значений, за исключением того, что в таблице значений у нас все строки равнозначны. Дерево же значений позволяет работать со строками таблицы в режиме подчинения одной строки другой, т.е. присутствие иерархии. У нас появилось новое поле "Родитель", которое указывает на строку-родитель текущей строки. На картинке ниже строка с индексом 0 является родителем строк с индексами 1 и 2. Пример дерева значений это справочник Номенклатура с иерархией по группам и элементам. Даже в пользовательской части при просмотре этого справочника есть возможность включить режим просмотра "Дерево". Вот это и есть дерево значений. Теперь нужно научиться программно такое создавать. Дерево значений доступно только на сервере.</p>
    <img src="../img/1С-1/2023-01-21_08-29-27.png" class="screen" alt="">
    <p>На примере создадим дерево значений хранящее данные об остатках товаров.</p>
    <div class="code-style">
        <pre>
            <span class="vue-r">Создание</span>
            ДеревоОстатки = Новый ДеревоЗначений;

            <span class="vue-r">Добавление колонок в дерево значений</span>
            ДеревоОстатки.Колонки.Добавить("Товар");
            ДеревоОстатки.Колонки.Добавить("Склад");
            ДеревоОстатки.Колонки.Добавить("Количество");

            <span class="vue-r">Добавление элементов(строк) в дерево значений</span>
            <span class="vue-g">//у дерева значений есть свойство Строки, это свойство содержит КоллекциюСтрокДереваЗначений
            //только 1го уровня, остальные уровни строк можно получить обращаясь к уже имеющимся строкам
            //создадим 1й уровень строк остатки по складам</span>
            <span class="vue-g">//добавим 1го уровня по основному складу</span>
            ОстаткиПоОсновномуСкладу = ДеревоОстатки.Строки.Добавить();
            ОстаткиПоОсновномуСкладу.Склад = "Основной";
            ОстаткиПоОсновномуСкладу.Количество = 160;

            <span class="vue-g">//Далее добавляем детальные строки по складу Основной. Эти строки уже имеют 2й уровень</span>
            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Основной";
            ДетальнаяСтрока.Товар = "Груши";
            ДетальнаяСтрока.Количество = 10;

            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Основной";
            ДетальнаяСтрока.Товар = "Яблоки";
            ДетальнаяСтрока.Количество = 50;

            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Основной";
            ДетальнаяСтрока.Товар = "Арбуз";
            ДетальнаяСтрока.Количество = 100;

            <span class="vue-g">//добавим 1го уровня по доп. складу</span>
            ОстаткиПоДопСкладу = ДеревоОстатки.Строки.Добавить();
            ОстаткиПоДопСкладу.Склад = "Дополнительный";
            ОстаткиПоДопСкладу.Количество = 100;

            <span class="vue-g">//Далее добавляем детальные строки по складу Дополнительный. Эти строки уже имеют 2й уровень</span>
            ДетальнаяСтрока = ОстаткиПоДопСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Дополнительный";
            ДетальнаяСтрока.Товар = "Арбуз";
            ДетальнаяСтрока.Количество = 30;

            ДетальнаяСтрока = ОстаткиПоОсновномуСкладу.Строки.Добавить();
            ДетальнаяСтрока.Склад = "Дополнительный";
            ДетальнаяСтрока.Товар = "Апельсины";
            ДетальнаяСтрока.Количество = 70;

            <span class="vue-r">Получение количества строк в дереве значений. Тут немного всё по сложней</span>
            <span class="vue-g">//общее количество не так просто получить, потому что нет метода Количество()
            //у дерева значений, но есть такой метод у строк</span>
            КоличествоСтрокВерхнегоУровня = ДеревоОстатки.Строки.Количество(); -> 2(Основной, Дополнительный)
            КоличествоСтрокОсновногоСклада = ОстаткиПоОсновномуСкладу.Строки.Количество(); -> 2(детальные)
            КоличествоСтрокДопСклада = ОстаткиПоДопСкладу.Строки.Количество(); -> 2(детальные)
            <span class="vue-g">//в сумме получается 6 строк. Но как правило получать общее количество
            //и не нужно, хватает понимания количества на каком то конкретном уровне</span>

            <span class="vue-r">Находим один элемент в дереве значений</span>
            <span class="vue-g">//есть метод Найти(&lt;Значение>,&lt;Колонки>,&lt;ВключатьПодчиненные>)
            //не у дерева, а у строк. В Значение указывем Что иы ищем, а в Колонки - Где, ВключатьПодчиненные
            //это Истина или Ложь, указываем искать во вложенных строках или нет
            //найдём, например, строку с товаром Арбуз
            //вернёт Неопределено, потому что Арбуз находится в подчиненных строках
            //а параметр ВключатьПодчиненные по умолчанию стоит в положении Ложь</span>
            СтрокаСАрбузом = ДеревоОстатки.Строки.найти("Арбуз", "Товар");

            <span class="vue-g">//а так вернёт объект СтрокаДереваЗначений у которого через точку можно получить товар
            //так как у нас есть 2 товара арбуз на разных складах, то этот метод найдёт первую попавшую строку
            </span>
            СтрокаСАрбузом = ДеревоОстатки.Строки.Найти("Арбуз", "Товар", Истина);
            Если СтрокаСАрбузом &lt;> Неопределено Тогда
                Сообщить(СтрокаСАрбузом.Товар);
                Сообщить(СтрокаСАрбузом.Количество);
            Иначе
                Сообщить("Такой строки нет");
            КонецЕсли;

            <span class="vue-r">Находим все строки дерева значений, которые удовлетворяют условию поиска</span>
            <span class="vue-g">//для этого есть метод у строк НайтиСтроки(&lt;ПараметрыОтбора>, &lt;ВключатьПодчиненные>)
            //параметр Параметрыотбора это структура, 2й параметр уже известено что значит. Метод возвращает массив</span>
            Отбор = Новый Структура("Товар", "Арбуз");
            ВсеСтрокиСАрбузами = ДеревоОстатки.Строки.НайтиСтроки(Отбор, Истина);
            Если ВсеСтрокиСАрбузами.Количество() &lt;> 0 Тогда
                Сообшить("Найдено строк: " + ВсеСтрокиСАрбузами.Количество());
            КонецЕсли;

            <span class="vue-r">Создаём копию дерева значений с данными</span>
            <span class="vue-g">//ни у самого дерева значений, ни у его строк нет метода, который бы копировал
            //всю таблицу, поэтому чтобы сделать копию придётся создать новую таблицу дерево значений 
            //и в цикле обойти всю таблицу и перекопировать все строки</span>



            <span class="vue-r">Удаление строки дерева значений</span>
            <span class="vue-g">//удаление есть у строк и их 2 способа</span>
            <span class="vue-g">//метод Удалить(&lt;Строка>). Чтобы удалить, строку нужно найти. Удалим, например 
            //строку с товаром Арбуз, выше в примере мы уже находили эту строку и объект этой строки лежит
            //в переменной СтрокаСАрбузом, в которой лежит первая попавшаяся строка с товаром Арбуз
            //Важно!!! Удалить можно только строку из того же уровня данной коллекции строк
            //т.е. удалить из коллекции строк 1 уровня нельзя строку 2 уровня</span>
            ОстаткиПоОсновномуСкладу.Строки.Удалить(СтрокаСАрбузом);

            <span class="vue-g">//у нас есть 2 товара Арбуз в разных складах. А что если мы хотим удалить
            //не первый попавшийся, а конкретную строку товара Арбуз? Тогда используем метод НайтиСтроки()
            //чем он нам поможет? А тем, что мы в него можем передавать Отбор, а в отборе мы можем указать
            //товар и склад. Из за того, что метод возвращает массив, обходим в цикле и удаляем
            //тут также, раз мы нашли товар в коллекции ОстаткиПоДопСкладу, то и удалять нужно из этой коллекции
            </span>
            Отбор = Новый Структура("Товар, Склад", "Арбуз", "Дополнительный");
            АрбузСДопСклада = ДеревоОстатки.Строки.НайтиСтроки(Отбор, Истина);
            Для каждого Строка Из АрбузСДопСклада Цикл
                ОстаткиПоДопСкладу.Строки.Удалить(Строка);
            КонецЦикла;

            <span class="vue-r">Сортировка в дереве значений</span>
            <span class="vue-g">//для этого есть метод Сортировать(&lt;СтрокаСортировки>, &lt;ВключатьПодчиненные>, &lt;ОбъектСравнения>)
            //1й параметр это список имен колонок, разделенных запятыми</span>
            ДеревоОстатки.Строки.Сортировать("Количество Убыв", Истина);

            <span class="vue-r">Обход элементов дерева значений</span>
            <span class="vue-g">//из-за того, что мы заранее не знаем сколько уровней в дереве нам сложно определить
            //как в цикле обойти всё дерево, поэтому тут логично использовать такой цикл как рекурсия
            //сделаем отдельно процедуру, которой передадим строки верхнего уровня, а внутри процедура
            //будет проверять есть ли что то в строке верхнего уровня и если да, то для неё опять запускается
            //эта же процедура</span>
            ОбходДереваЗначений(ДеревоОстатки.Строки);
            
            <span class="vue-r">Очистка дерева значений</span>
            ДеревоОстатки.Строки.Очистить();


            Процедура ОбходДереваЗначений(КоллекцияСтрок)
                Для каждого Строка Из КоллекцияСтрок Цикл
                    <span class="vue-g">//у строки есть метод Уровень(), который покажет в виде числа уровень строки
                    //важно, не у коллекции строк есть такой метод, а у отдельной строки
                    //уровень мы будем показывать просто для того чтобы показать обход всех строк</span>
                    Сообщить("Уровень: " + Строка.Уровень() + "; " + Строка.Товар + "; " + Строка.Склад + "; " + Строка.Количество);
                    <span class="vue-g">//проверяем, есть ли в строке подчинённые строки</span>
                    Если Строка.Строки.Количество() > 0 Тогда
                        ОбходДереваЗначений(Строка.Строки);
                    КонецЕсли;
                КонецЦикла;
            КонецПроцедуры
        </pre>
    </div>

    <p class="title-size16"><b>Работа с деревом значений на форме</b>. Как правило создавать дерево значений с нуля нужно не часто, обычно его получают в результате какого то метода. И самый частый способ получения такого дерева это запрос. В форме создадим реквизит "ДеревоОстатков" в типом "ДеревоЗначений" и в него будем выводить остатки Товаров подчинённые складам. Также как и для таблицы значений вверху используем кнопку добавления колонок для реквизита. Добавим 3 колонки - Товар(с типом СправочникСсылка.Номенклатура), Склад(с типом справочникСсылка.Склады) и Количество(с типом число и квалификаторами длина 15, точность 3). Переносим реквизит "ДеревоОстатков" влево куда нам нужно.</p>
    <p>Также будем использовать обработчик события формы "ПриСозданииНаСервере". В нём напишем запрос к виртуальной таблице регистра накопления Остатки по номенклатуре. Нам нужны подсчёты количества товаров по складам, поэтому в запросе будем использовать итоги. В конструкторе создали запрос и вывели в код. В метод Выбрать() из результата запроса конструктор подставил параметр "ОбходРезультатаЗапроса.ПоГруппировкам". Этот параметр, как я понял, в выборку добавляет записи с группой помимо детальных. Чтобы выгрузить данные из запроса в наше дерево значений используем метод Выгрузить() и передаём также в него ТипОбхода такой же, как и для выборки. Здесь будет отличие в выгрузке в дерево значений от выгрузки в таблицу значений. Как мы видим в форме в окне реквизитов, ДеревоОстатков имет тип в скобках (ДеревоЗначений), что нам говорит о том, что это её не настоящий тип, настоящий тип <b>ДанныеФормыДерево</b>. Если для реквизита "ТаблицаОстатки", с ненастоящим типом (ТаблицаЗначений), был метод Загрузить(), он загружал выгруженную таблицу с данными запроса в этот реквизит, то для реквизита "ДеревоОстатки" такого метода нет. Если мы напрямую выгрузим в этот рекизит результат запроса, то будет ошибка, потому что выгрузка из результата запроса будет иметь настоящий тип "ДеревоЗначений", а реквизит "ДеревоОстатков" имеет тип ДанныеФормыДерево. Тут нужно вспомнить метод РеквизитФормыВЗначение(), переведём реквизит "ДеревоОстатков" в настоящий тип "ДеревоЗначений", запишем в него данные запроса и переведём обратно в ДанныеФормыДерево</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)		
                Запрос = Новый Запрос;
                Запрос.Текст = 
                    "ВЫБРАТЬ
                    |	ОстаткиНоменклатурыОстатки.Номенклатура КАК Товар,
                    |	ОстаткиНоменклатурыОстатки.Склад КАК Склад,
                    |	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК Количество
                    |ИЗ
                    |	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки
                    |ИТОГИ
                    |	СУММА(Количество)
                    |ПО
                    |	Склад";
                
                РезультатЗапроса = Запрос.Выполнить(); 
                ДеревоОбъект = РеквизитФормыВЗначение("ДеревоОстатков");
                ДеревоОбъект = РезультатЗапроса.Выгрузить(ОбходРезультатаЗапроса.ПоГруппировкам);
                ЗначениеВРеквизитФормы(ДеревоОбъект, "ДеревоОстатков");
            КонецПроцедуры
        </pre>
    </div>
    <p>Ctrl + Shift + Плюс - развернуть дерево значений в пользовательском режиме, + Минус - свернуть.</p>
















    <h3 class="header-style2" id="table-doc">Табличный документ</h3>
    <p>Пока накидаю то что не забыл. Создаётся от класса ТабличныйДокумент. Можно реквизиту формы задать тип "ТабличныйДокумент", это как будто мы создали объект от класса и присвоили полю этот тип данных. Табличный документ можно показать только на клиенте, а заполнить данными только на сервере. Если мы создавали объект от класса и заполнили его на сервере, то на клиенте его нужно показать через метод Показать(). А если мы используем реквизит формы с типом данных "ТабличныйДокумент", то достаточно просто через метод Вывести() вывести данные в этот реквизит и он сам их покажет. В метод Паказать() можно перетать строковый текст, который будет заголовком табличного документа.</p>














    <h3 class="header-style2" id="7">Процедуры и функции</h3>
    <div class="code-style">
        <pre>
            <span class="vue-r">Процедура <span class="vue-b">ИмяПроцедуры</span>()
                //код...
            КонецПроцедуры
            </span>

            <span class="vue-r">Функция <span class="vue-b">ИмяФункции</span>()
                <span class="vue-b">ЧислоА = 12;
                ЧислоБ = 4;
                СуммаЧисел = ЧислоА + ЧислоБ;</span>
                Возврат <span class="vue-b">СуммаЧисел</span>;
            КонецФункции
            </span>

            <span class="vue-b">Результат <span class="vue-r">=</span> ИмяФункции<span class="vue-r">(</span><span class="vue-r">);</span></span>
        </pre>
    </div>
    <p>Задача процедуры как и функции обернуть в себя какой то код и вызывать его в любом месте программы. Функция в отличии от процедуры может возвращать результат выполнения функции через оператор <b>Возврат</b>. Процедуры тоже могут использовать оператор Возврат, но только для досрочного завершения процедуры, ничего возвращать из процедуры они не могут, а используются одиночно.</p>
    <p>Если в процедуре или в функции объявлены параметры, то при вызове их нужно обязательно передавать эти параметры, иначе ошибка. Здесь построже чем в js, там можно и не передавать параметры, просто там параметрам присвоится undefined и всё. Но можно и не передавать праметры в функцию если в этой функции параметрам заранее прописать значения по умолчанию, они здесь задаются также как и в js. Те параметры, которым не указалось значения по умолчанию, должны быть переданы:</p>
    <div class="code-style">
        <pre>
            Функция ПосчитатьЗначения(Парам1, Парам2 = 2, Парам3 = 5)
                СуммаЧисел = Парам1 + Парам2 + Парам3;
                Возврат СуммаЧисел;
            КонецФункции

            Сообщить(ПосчитатьЗначения(53)); // 60
        </pre>
    </div>
    <p>Те параметры, которые передаются пишем левее, а с значениями по умолчанию пишем правее. Мы можем передать все 3 параметра и тогда они станут в то значение, которые им присвоится при передаче, а не то, которое у них стоит по умолчанию.</p>
    <p>Парметр по умолчанию часто используеся при доработке чужой функции, она уже имеет какие то параметры и во многих местах вызывается с этими параметрами, а нам нужно ввести ещё какой то параметр, тут то мы в функцию и дописываем свой параметр и стаим ему значение по умолчанию и внутри самой функции например добавляем наш параметр в какую-нибудь формулу, и она отработает спокойно не переделывая её полностью. Если мы поставим свой параметр не по умолчанию, то он станет обязательным и вот тогда может всё нарушиться.</p>








    <h3 class="header-style2" id="7a">Переменные передаются по ссылке в процедуры и функции. Оператор</h3>
    <p>Есть такой код:</p>
    <div class="code-style">
        <pre>
            Процедура ПроверитьЧисло(Число)
                Если  Число > 0 Тогда
                    Сообщить("Число положительное");
                Иначе
                    Сообщить("Число отрицательное"); 
                КонецЕсли;  
                Число = 1;
            КонецПроцедуры  

            А = -1;

            ПроверитьЧисло(А);
            Сообщить(А);
            ПроверитьЧисло(А);

            //ответом будет 3 сообщения
            Число отрицательное
            1
            Число положительное

            //Как видно в первую процедуру мы передали переменную по ссылке, теперь А и Число ссылаются на одну и ту же переменную
            //Число проверяется и выводится результат, затем в Число пишется новое значение, а значит по ссылке А также теперь ссылается
            //на новое значение 1. Короче точно так же как в JS объекты передаются по ссылке, а не копируются.
            //Если често то это вводит немного в ступор, вот так легко можно поменять глобальную переменную А внутри процедуры и не заметить этого.
        </pre>
    </div>
    <p>Может быть далее по изучению я узнаю почему так сделано. Узнал. Оказывается в параметр процедуры рядом можно вписать слово Знач и теперь переменная А будет копироваться в переменную Число не по ссылке, а именно копироваться и теперь поведение будет как в JS. Официально слово Знач означает запрет на изменение передаваемой переменной А:</p>
    <div class="code-style">
        <pre>
            Процедура ПроверитьЧисло(<span class="vue-b">Знач</span> Число)
                Если  Число > 0 Тогда
                    Сообщить("Число положительное");
                Иначе
                    Сообщить("Число отрицательное"); 
                КонецЕсли;  
                Число = 1;
            КонецПроцедуры 

            А = -1;

            ПроверитьЧисло(А);
            Сообщить(А);
            ПроверитьЧисло(А);

            //ответом будет 3 сообщения
            Число отрицательное
            -1
            Число отрицательное
        </pre>
    </div>












    <h3 class="header-style2" id="10">Не срабатывает метод Сообщить</h3>
    <p>Если в нашей программе вызывается одна из следующих команд ВвестиЧисло, ВвестиДату, ВвестиСтроку, то следующие команды Сообщить мы просто не успеваем увидеть. Вызов перечисленных команд приводит к тому, что перед пользователем появляется отдельное окно (для ввода информации), которое ломает стандартный механизм вывода сообщений через команду Сообщить. В этом случае результаты команды Сообщить выводятся не в главное, а в диалоговое окно, которое закрывается сразу после ввода значения.</p>
    <p class="title-size16"><b>Простой способ решения</b></p>
    <p>Если в нашем коде встречается одна из команд ВвестиЧисло, ВвестиДату, ВвестиСтроку, вместо Сообщить используем команду ОткрытьЗначение.</p>
    <p class="title-size16"><b>Правильный способ решения</b></p>
    <p>Поместите в модуль управляемого приложения событие ПриНачалеРаботыСистемы и пишите весь код в нём. Это событие вызывается уже после того как создано главное окно 1С.</p>
    <div class="code-style">
        <pre>
            Процедура ПриНачалеРаботыСистемы()
                //код;
            КонецПроцедуры
        </pre>
    </div>
















    <h2 class="header-style" id="11">Объекты конфигурации</h2>
    <p class="title-size16"><b>Виды данных</b>.</p>
    <ul class="list">
        <li><b>"Общие" - "общие модули"</b> - Общие модули это те модули, в которые мы добавляем свои процедуры и функции с указанием ключевого слова "Экспорт". Получается своеобразная библиотека, процедуры и функции которой в дальнейшем можно вызывать из различных мест конфигурации. Создадим общий модуль и назовём его, например, "Библиотека" и напишем там процедуру, затем из любого места конфигурации вызываем эту процедуру - <span class="vue-b"><b>Бибилиотека.НазваниеПроцедуры();</b></span></li>
        <li><b>Константы</b> - один из самых простых объектов конфигурации, который позволяет сохранить в инфобазе какое-то одно постоянное или условно-постоянное значение. Например, создадим постоянное значение и назовём его "НазваниеОрганизации", в режиме предприятия появится команда "Сервис", в котрой мы найдём название, котрое ввели, кликнем по нему и откроется форма для ввода названия организации. Ну или например можно добавить постоянное значение "ИНН", чтобы вводить ИНН организации или "ДатаРегистрации" и т.д.</li>
        <li><b>"Справочники"</b> - Справочники позволяют хранить данные, имеющие одинаковую структуру и списочный характер. Это может быть, например, список сотрудников, перечень товаров, список поставщиков или покупателей. Каждый элемент справочника в обязательном порядке имеет поля КОД и НАИМЕНОВАНИЕ, но к ним могут добавляться и любые другие поля.</li>
        <li><b>"Документы"</b> - Документы позволяют хранить информацию о совершённых операциях или о событиях, произошедших в "жизни" предприятия вообще. Это могут быть, например, приходные накладные, приказы о приёме на работу, счета, платёжные поручения и т.д. Каждый документ в обязательном порядке имеет поля НОМЕР, ДАТА и ВРЕМЯ</li>
        <li><b>"Отчёты"</b> - Отчёты обрабатывают и выводят накопленную информацию в удобном для просмотра и анализе виде. Это может быть отчёт, который выводит остатки товара на складе или продажи за период. Каждый отчёт в обязательном порядке имеет некоторую печатную форму, которую можно не только посмотреть, но и вывести на принтер.</li>
        <li><b>"Обработки"</b> - Обработки предназначены для выполнения различных действий над информацией в базе. Например, с их помощью можно выполнить удаление из системы устаревших данных, импорт информации из других систем и многое другое. В результате действия обработки информация, хранящаяся в системе, претерпевает какие-либо изменения.</li>
        <li><b>"Перечисления"</b> - Перечисления - это прикладной объект, это особенный объект. В отличии от справочников и документов все возможные значения перечислений задаются на этапе конфинурирования и не могут быть в дальнейшем изменены в пользовательском режиме. Неизменность - это их главный козырь. Это своего рода константы БД. И если программист в режиме конфигурирования создал перечисление с именем Пол и значениями Мужской и Женский, то при написании программыон может быть уверен, что в дальнейшем значения этого перечисления не изменятся. Поэтому он может смело обращаться к этим значениям из кода. Представьте, что будет, если он для этого использует справочник? Во первых пользователь может легко изменить значения справочника, а другой пользователь может удалить один из полов. Программа от этого сломается. Вот для этого и существуют перечисления, чтобы один раз на этапе конфигурирования жёстко задать все возможные варианты значений и в дальнейшем использовать их в коде программы.
        В конфигурации перечисления, как правило, используются не самостоятельно, а в совокупности с другими типами данных. Так, перечисления применяются для ввода ограниченного количества значений реквизитов справочников и документов.</li>
        <li><b>Регистры накопления</b> - слово регистр переводится как запись, записаться, отметиться. Я бы перевёл его как объект записывальщик данных в данном случае для их накопления. 
        </li>
    </ul>











    <h3 class="header-style" id="prop-root-config"><b>Свойства корня конфигурации</b></h3>

    <p class="title-size16"><b id="prop-root-config-1">"Режим управления блокировкой данный"</b></p>
    <p>Передумал записывать, слишком много. На экзамене можут встретится вопрос про это свойство, поэтому знать нужно. Посмотреть можно в этом видео - https://www.youtube.com/watch?v=GlgVZfDPvoU&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=43.   Там Чистов объясняет эту тему начиная с 00:59:30. Это видео с названием "СпецКурс. 012"</p>















    <h3 class="header-style" id="konst"><b>Работа с константами</b></h3>
    <p class="title-size16"><b id="konst1">Константа и её свойства</b></p>
    <p>Константы намного проще других объектов конфигурации. В них хранятся условно-постоянные записи - названия организации, ставка налога, название основного склада нашего предприятия и т.д.</p> 
    <p>Например, создадим и будем хранить в константе название организации. Почему именно в константе? Мы могли бы указывать название нашей организации в печатях или в других местах кода прям вписывая строкой название, но потом когда нужно будет сменить название, то запаримся бегать по разным местам и переименовывать. Проще хранить название где то в одном месте и использовать значение этой константы в разных местах, в тех же печатях. Разработчик указывает константу где то в коде, а пользователь сам задаёт название организации и она подставляется автоматом.</p>
    <p>При создании константы указываем в свойствах её Имя и Синоним, тип Строка и Длину. Если указать Неограниченная длина, то значение константы будет храниться не в таблице констант, а в другой таблице, в которой будет 3 колонки: в 1й хранится ссылка на элемент константы для которой мы сохраняем значение, во 2й сохраняется значение индекса записи(сколько требуется строк для хранения значения), а в 3й колонке содержится само значение(длина 100 знаков, если значение константы имеет 115 знаков, значит для хранения значения будет отведено 2 строки(записи), эта цифра 2 как раз и будет во 2й колонке в виде индекса). Записи константы с неограниченной длиной не индексируются никак. И при попытке вытащить данные из БД система скажет что нужно обязательно данные типизировать, привести к конкретной строке.</p>
    <img src="../img/1С-1/2023-08-14_10-41-13.png" class="screen" alt="">
    <p>Каждая константа хранится в своей отдельной таблице и в общей таблице Константы. Вообще если посмотреть в БД, то там вот так хранятся в таблицах константа "НазваниеОрганизации" и константа "Адрес Организации":</p>
    <img src="../img/1С-1/2023-08-14_20-25-12.png" class="screen-2" alt="">
    <p>Можно выбрать как одну таблицу со всеми константами, так и по отдельности.</p>
    <p>После создания константы система помещает команду открытия этой константы в меню "Сервис", куда обычно помещаются обработки. Может система и создаёт маленькую обработку, которая при открытии показывает стандартную форму с уже созданными кнопками записи константы в базу.</p>
    <p>В палитре свойств есть свойство <i style="text-decoration: underline;">"Допустимая длина"</i>. Это свойство имеет 2 значения: переменная и фиксированная. Когда мы для константы задали тип "Строка" с длиной 60, то при значении "Переменная" мы получим из БД значение константы длиной такой какая есть у значения константы. Например, в значении константы у нас название фирмы "1С", а длина задана 60, мы получим из БД значение в 2 символа - "1С". А вот при значении фиксированная мы получим из БД все 60 символов, т.е. "1С" и 58 пробелов. Это увидить в пользовательском режиме трудно, но вот программно получив и замерив длину можно увидеть разницу при разных значениях этого свойства. </p>
    <p>Для чего нужно значение "Фиксированная"? Как я понял, в печатных документах есть такие поля с пробелами, куда вписывается ручкой что-то. И при значении "Фиксированная" мы в документ подставляем константу с заранее заданной длиной и не нужно потом от руки добивать пробелами до нужной длины. Что-то в этом роде. Но это довольно редко используется.</p>
    <p>У константы есть 2 модуля: <i style="text-decoration: underline;">модуль менеджера</i> и <i style="text-decoration: underline;">модуль менеджера значения</i>. Модуль менеджера значения позволяет отледить событие записи константы. Например меняется ставка НДС и мы хотим что то в системе поменять при смене этой ставки.</p>
    <p><b>Закладка "Представление"</b></p>
    <p>В свойствах есть закладка "Представление". Свойства этой закладки указывают как будет отображаться константа в пользовательском интерфейсе. Галочка у свойства <i style="text-decoration: underline;">"Использовать стандартные команды"</i> говорит о том, что система сама создаст команду в стандартной группе "Сервис" для открытия формы с этой константой.</p>
    <p>Свойство <i style="text-decoration: underline;">"Расширенное представление"</i> говорит о том, как будет называться команда вызова константы, по умолчанию берётся из синонима.</p>
    <p>Свойство <i style="text-decoration: underline;">"Подсказка"</i> будет показвать тот текст, который мы в нём укажем, при наведении мыши на команду открытия константы.</p>
    <p>Свойство <i style="text-decoration: underline;">"Многострочный режим"</i> позволяет пользователю вводить знаки переноса строки.</p>
    <p>Свойство <i style="text-decoration: underline;">"Расширенное редактирование"</i> позволит включить поиск по значению константы через комбинацию клавиш Ctrl + F.</p>

    <p class="title-size16"><b id="konst2">Пример работы с константами</b></p>
    <p>В модуле приложения в предопределённом обработчике "ПриНачалеРаботыСистемы" вызовем функцию из обшего модуля, которая получит из базы значение константы "Название организации" и вернёт его, и если значение пустое, то сообщим это пользователю, мол пусть заполнит название:</p>
    <div class="code-style">
        <pre>
            --модуль приложения
            <span class="vue-b"><span class="vue-r">Процедура</span> ПриНачалеРаботыСистемы<span class="vue-r">()</span>
                <span class="vue-r">Если НЕ</span> ЗначениеЗаполнено<span class="vue-r">(</span>Тренирововчная<span class="vue-r">.</span>ПолучитьКонстанту<span class="vue-r">()) Тогда</span>
                    Сообщить<span class="vue-r">(</span><span class="vue-bl">"Заполните название организации, оно сейчас пустое"</span><span class="vue-r">);
                КонецЕсли; 
            КонецПроцедуры</span></span>


            --общий модуль Тренирововчная
            <span class="vue-b"><span class="vue-r">Функция</span> ПолучитьКонстанту<span class="vue-r">() Экспорт
                Возврат</span> Константы<span class="vue-r">.</span>НазваниеОрганизации<span class="vue-r">.</span>Получить<span class="vue-r">();	
            КонецФункции</span></span>
        </pre>
    </div>












    <h3 class="header-style" id="spravochnik">Работа со справочником</h3>
    <p class="title-size16"><b id="spravochnik-base">Что такое и для чего нужен справочник</b></p>
    <p>Объект конфигурации Справочник предназначен для работы со списками данных. Как правило, в работе любой фирмы используются списки сотрудников, списки товаров, списки клиентов, поставщиков и т.д. Свойства и структура этих списков описываются в объектах конфигурации Справочник, на основе которых платформа создает в базе данных таблицы для хранения информации из этих справочников.</p>
    <p>Справочник состоит из <i style="text-decoration: underline;">элементов</i>. Например, для справочника сотрудников элементом является сотрудник, для справочника товаров – товар и т.д</p>
    <p>В базе данных каждый элемент справочника представляет собой отдельную запись в основной таблице, хранящей информацию из этого справочника и называется объектом данных.</p>
    <p>Каждый элемент справочника, как правило, содержит некоторую дополнительную информацию, которая подробнее описывает этот элемент. Например, все элементы справочник Товары могут содержать дополнительную информацию о производителе, сроке годности и др. Набор такой информации является одинаковым для всех элементов справочника, и для описания такого набора используются реквизиты объекта конфигурации Справочник, которые также, в свою очередь, являются объектами конфигурации.</p>
    <p>Большинство реквизитов разработчик создает самостоятельно, однако у каждого объекта конфигурации Справочник по умолчанию существует набор стандартных реквизитов: <i style="text-decoration: underline;">Код</i> и <i style="text-decoration: underline;">Наименование</i> и пр. Причем доступность стандартных реквизитов зависит от свойств справочника. Например, если справочник иерархический, у него будет доступен стандартный реквизит Родитель. Если справочник подчинен другом объекту конфигурации, у него будет доступен реквизит Владелец.</p>
    <p>Если установить длину стандартного реквизита Код равной нулю, то у справочника будет недоступен этот реквизит. То же самое относится к реквизиту Наименование. Однако как минимум либо Код, либо Наименование должны присутствовать в реквизитах справочника, иначе такой справочник не имеет смысла.</p>
    <p>Таким образом, в базе данных справочник хранится в виде таблицы, в строках которой расположены элементы списка, а каждому реквизиту (стандартному или созданному разработчиком) в этой таблице соответствует отдельный столбец.</p>
    <p>Кроме этого, каждый элемент справочника может содержать некоторый набор информации, которая одинакова по своей структуре, но различна по количеству и предназначена для разных элементов справочника.</p>
    <p>Так, например, каждый элемент справочника Сотрудники может содержать информацию о составе семьи сотрудника. Для одного сотрудника это будет только супруга, а у другого семья может состоять из супруги, сына и дочери. Для описания подобной информации могут быть использованы табличные части объекта конфигурации Справочник, являющиеся подчиненными ему объектами конфигурации. В этом случае в базе данных будут созданы дополнительные таблицы для хранения табличных частей, подчиненных конкретному элементу справочника.</p>
    <p>Для удобства использования элементы справочника могут быть сгруппированы пользователем по какому-либо принципу.</p>
    <p>Например, в справочнике Товары могут быть созданы следующие группы: Холодильники, Телевизоры, Стиральные машины и т.д. Возможность создания таких групп в справочнике задается свойством <i style="text-decoration: underline;">Иерархический</i> объекта конфигурации Справочник. В этом случае элемент справочника, представляющий собой группу, будет являться родителем для всех элементов и групп, входящих в эту группу. Такой вид иерархии называется <i style="text-decoration: underline;">иерархией групп и элементов</i>.</p>
    <p>Возможен и другой вид иерархии – <i style="text-decoration: underline;">иерархия элементов</i>. В этом случае в качестве родителя выступает не группа элементов справочника, а непосредственно один из его элементов. Например, такой вид иерархии можно использовать при создании справочника Подразделения, когда одно подразделение является родителем для нескольких других, входящих в его состав.</p>
    <p>Элементы одного справочника могут быть подчинены элементам или группам другого справочника. Например, справочник ЕдиницыИзмерения может быть подчинен справочнику Товары. Тогда для каждого элемента справочника Товары мы сможем указать единицы измерения, в которых этот товар поступает на склад.</p>
    <p>Порой возникают ситуации, когда необходимо, чтобы в справочнике некоторые элементы существовали всегда, независимо от действий пользователя. Допустим, логика бизнес-процессов на предприятии такова, что все товары сначала поступают на основной склад, а затем по мере надобности перемещаются на другие склады. В этом случае в справочнике Склады всегда должен существовать склад Основной, иначе приходование товаров будет выполнено неправильно. Объект конфигурации Справочник позволяет описать любое количество таких элементов справочника. Они называются предопределенными элементами справочника.</p>
    <p>Предопределенные элементы отличаются от обычных тем, что они создаются в конфигураторе и что к ним можно обращаться из встроенного языка. </p>
    <p><b>Код и наименование справочника</b></p>
    <p>Откроем окно редактирования объекта конфигурации Справочник и нажмём на закладку Данные. Здесь для нас представляют интерес длина кода и длина наименования. Длина кода – важное свойство справочника. Как правило, код справочника используется для идентификации элементов справочника и содержит уникальные для каждого элемента справочник  значения. Платформа может сама контролировать уникальность кодов и поддерживать автоматическую нумерацию элементов справочника. Поэтому от длины кода будет зависеть количество элементов, содержащихся в справочнике.</p>
    <p>Мы можем изменить синоним стандартного реквизита Наименование.</p>

    <p class="title-size16"><b id="spravochnik-prop">Свойства реквизитов справочника</b></p>
    <p><b>Свойство "Быстрый выбор"</b></p>
    <p>К примеру у нас есть справочник склады и там всего 3 склада. Позже мы в поле некоторой формы выбираем склад и обычно открывается форма выбора справочника Склады и в этой форме мы выбираем склад, но можно сделать так, чтобы не открывать форму выбора, а просто выдать небольшой выпадающий список. Чтобы такое сделать нужно в редакторе объекта справочника Склады на вкладке "Поле ввода" поставить галочку у свойства "Быстрый выбор". Эта отметка скажет системе, что не нужно открывать форму выбора, а выдавать склады в виде списка. Такое можно желать когда справочник небольшой и имеет несколько значений.</p>
    <p><b>Свойство "Маска" в закладке "Представление"</b></p>
    <p>Приведу пока один пример как сделать маску для номера телефона у нас по России - +7(918)123-45-67. В значении свойства "Маска" так и пишем шаблон, вместо любой цифры выступает цифра 9 - +9(999)999-99-99. Всё, при заполнении этого реквизита в пользовательской части мы просто пишем цифры, а система сама по маске расставляет их.</p>
    <p><b>Свойство "Использование" в закладке "Использование"</b></p>
    <p>Это свойство указывает, где будет отображаться значение текущего реквизита. По умолчанию стоит "Для элемента", это значит значение реквизита будет только для элемента, а для групп не будет видно. Можно поставить только для групп, а можно и для того и другого.</p>
    <p><b>Свойство "Значение заполнения"</b></p>
    <p><a href="#document-prop-1">Тут</a>.</p>

    <p class="title-size16"><b id="spravochnik-dogovor">Подчинённый справочник. Реквизит "Владедец"</b></p>
    <p>Хочу описать тут пару моментов связанных с этим справочником. При наличии справочника "Контрагенты" мы создаём подчинённый справочник "Договора" справочнику "Контрагенты". Первое, при таком подчинении система сама добавляет в элементы справочника "Контрагенты" в панель навигации стандартную параметризуемую команду "Договора", которая будет открывать договора с отбором по текущему элементу справочника "Контрагенты". Второе, при удалении элемента справочника "Контрагенты" удаляется и привязанный к нему договор, по типу как свойство "Ведущее".</p>

    <p class="title-size16"><b id="spravochnik1">Типы данных у справочника</b></p>
    <p>Пока не создан ни один справочник есть толко один тип это СправочникиМенеджер. Как только создали справочник, например, Номенклатура, так и создались объекты встроенного языка:</p>
    <ul class="list">
        <li><b>СправочникМенеджер.Номенклатура</b> - нужен для того, чтобы создавать новые элементы,находить существующие элементы, выбирать все или некоторые элементы справочника. Если образно, то это облочка над всеми элементами-объектами(СправочникОбъект.Номенклатура) созданного справочника, которая командует ими.</li>
        <li><b>СправочникСсылка.Номенклатура</b> - нужен для того, чтобы отображать элементы справочника в интерфейсе: в списках, в полях ввода. Также он нужен для того, чтобы указывать на конкретный элемент справочника.</li>
        <li><b>СправочникОбъект.Номенклатура</b> - нужен для того, чтобы получать, изменять, удалять элемент справочника. </li>
        <li><b>СправочникВыборка.Номенклатура</b> - нужен для того, чтобы последовательно, друг задругом, перебирать те элементы, которые были выбраны из базы данных, с помощью объектной модели запроса(Выборка = СправочникМенеджер.Номенклатура.Выбрать())</li>
        <li><b>СправочникСписок.Номенклатура</b> - это наследие прошлых версий платформы, которое сейчас практически нигде не используется.</li>
    </ul>
    <p>Почему эти типы появляются только при создании какого то справочника? Потому что заполняются они только при создании конкретного справочника его значениями(реквизитами, табличными частями, настройками свойств и прочим).</p>
    <p>Графическая схема:</p>
    <img src="../img/1С-1/2023-05-27_22-09-22.png" class="screen" alt="">

    <p class="title-size16"><b id="spravochnik2">Получение данных справочника из базы через объектную модель</b></p>
    <p><i>Пример первый.</i></p>
    <p>Для примера создадим внешнюю обработку. В форме сделаем кнопку, перетащим её в элементы формы и назовём, например, ОбъектнаяМодель. Далее нужно задать действие для этой кнопки. При создании обработчика выберем в открывшемся окошке "Создать на клиенте и процедуру на сервере", откроется модуль с 2мя процедурами, одна на клиенте, вторая на сервере. Итак опишем серверную процедуру, которая получает данные из Справочника "Сотрудники". Для доступа к данным справочника используется управляющий(тот самый СправочникиМенеджер), доступ к которому осуществляется так: Управляющий = Справочники.Сотрудники; "Управляющий" это просто переменная и имя может быть любым, она просто отражает то, что возвращает Справочники.Сотрудники. В переменную "Управляющий" возвращаются ещё не сами данные справочника, а некоторый программный объект, через который мы можем что-либо делать со справочником. Управляющий объект справочника это как бы прослойка между нашим кодом и данными справочника. И получается, что, если мы хотим прочитать все элементы справочника, то мы не можем сделать это напрямую. Мы можем только поросить об этом нашу прослойку между нами и справочником. Чтобы сделать это - необходимо вызвать встроенный в управляющий объект метод "Выбрать". Вызывается он через точку после имени переменной "Управляющий" и возвращает коллекцию элементов справочника:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//в выборку возвращается объект с типом "СпрвочникВыборка.&lt;ИмяСправочника>"</span>
            <span class="vue-b">Выборка <span class="vue-r">=</span> Справочники<span class="vue-r">.</span>Сотрудники<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span></span>

            <span class="vue-g">//также есть метод ВыбратьИерархически(), который позволяет выбрать записи внутри указанной группы(папки)</span>
            <span class="vue-b">Выборка <span class="vue-r">=</span> Справочники<span class="vue-r">.</span>Сотрудники<span class="vue-r"></span>.ВыбратьИерархически<span class="vue-r">(</span><span class="vue-bl">&lt;Группа></span><span class="vue-r">);</span></span>
            <span class="vue-g">//параметр Группа должен иметь тип СправочникСсылка.&lt;Имя спрвочника>, как получить такую группу
            //допустим у нас есть поле ввода, поле имеет тип СправочникСсылка.&lt;Имя спрвочника>, мы выбираем из списка
            //имя группы из справочника(не эелемента) и передаём это имя в метод. Чтобы иметь возможность выбрать группу из списка
            //для этого поля в форме в свойствах нужно указать в параметре ВыборГруппИЭлементов значение Группа
            //потому что по умолчанию нельзя выбирать группы, только элементы</span>
        </pre>
    </div>
    <p>Что представляет из себя выборка? Выборка представляет из себя коллекцию, но не такую, как массив или список значений. Выборка представляет из себя опять объект. Особенность этого объекта в том, что он умеет перебирать элементы нужного нам справочника. Причём перебирает он их динамически. Это означает, что считывание элементов справочника происходит не сразу, а порциями из базы данных. Такой подход позволяет быстро обходить большие списки справочников, не загружая в память компьютера все сразу.
    Чтобы получить очередную порцию данных из выборки, надо вызывать у выборки встроенный метод "Следующий". Получение порций данных(одна порция соответствует одному элементу справочника) обычно происходит в цикле. Когда данные(элементы справочника) в выборке закончатся, метод "Следующий" вернёт Ложь и цикл остановится. После каждого вызова метода "Следующий"(если он вернул Истина) выборка будет содержать в себе все поля с данными только что считанного элемента справочника:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//бывает, что в выборку попадают элементы группы
            //и при переборе в цикле группа будет засчитываться как элемент
            //а значит Выборка.Слудующий() вернёт Истина при проходе по самой папке
            //но папка не содержит полей, а значит все поля вернут пустоту
            //для этого делаем проверку Выборка.ЭтоГруппа, если вернёт Истина
            //просто пишем оператор Продолжить и пропускаем круг цикла</span>
            <span class="vue-b"><span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>ЭтоГруппа <span class="vue-r">Тогда
                    Продолжить
                КонецЕсли;</span>
                Сообщение <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    Выборка<span class="vue-r">.</span>Наименование <span class="vue-r">+</span> <span class="vue-bl">" "</span> <span class="vue-r">+</span> 
                    Выборка<span class="vue-r">.</span>ДатаРождения <span class="vue-r">+</span> <span class="vue-bl">" "</span> <span class="vue-r">+</span>
                    Выборка<span class="vue-r">.</span>НомерПаспорта <span class="vue-r">+</span> <span class="vue-bl">" "</span> <span class="vue-r">+</span>
                    Выборка<span class="vue-r">.</span>СерияПаспорта <span class="vue-r">+</span> <span class="vue-bl">" "</span> <span class="vue-r">+</span>
                    Выборка<span class="vue-r">.</span>Должность <span class="vue-r">+</span> <span class="vue-bl">" "</span><span class="vue-r">;</span>
                Сообщение<span class="vue-r">.</span>Сообшить<span class="vue-r">();
            КонецЦикла;</span></span>

            <span class="vue-g">//часто бывает нужно записать какие то данные
            //Чтобы в объект записать, нужно его получить
            //в цикле мы перемещаемся по объектам(записям) в колекции Выборка, 
            //значит если хотим записать во все объекты,
            //то в цикле получаем каждый объект и пишем в него</span>
            <span class="vue-b"><span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>ЭтоГруппа <span class="vue-r">Тогда
                    Продолжить
                КонецЕсли;</span>
                ОбъектСправочника <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>ПолучитьОбъект<span class="vue-r">();</span>
                ОбъектСправочника<span class="vue-r">.</span>&lt;какое то поле> <span class="vue-r">=</span>  &lt;какое то значение><span class="vue-r">;</span>
                ОбъектСправочника<span class="vue-r">.</span>Записать<span class="vue-r">();
            КонецЦикла;</span></span>
        </pre>
    </div>
    <p>Получается, что в один миг мы можем работать с данными только с одним из элементов справочника. И тут мы можем или сразу их выводить пользователю или можно сложить их в массив и уже из массива потом сразу с ними со всеми что то сделать.</p>
    <p><i>Пример второй.</i></p>
    <p>Есть справочник "Сотрудники" и хотим получить всех сотрудников с датой рождения на сегодняшнее число. Применить метод НайтиПоРеквизиту() тут не очень подходит, потому что мы можем 2м параметром задать всю дату вместе с годом, но нам это не подходит, нам нужны те сотрудники, кто родился сегодняшним числои в текущий месац. И второе почему нам этот метод не подходит это то, что он возвращает ссылку на первого попавшегося сотрудника, а нам нужны все, кто подпадает под выборку. Поэтому другого выхода нет как выбрать всех сотрудников из базы со всеми их данными с помощью метода Выбрать().</p>
    <p>Писать код будем в модуле управляемого приложения на клиенте и в общем модуле для работы на сервере. Вот алгоритм:</p>
    <div class="code-style">
        <pre>
            --модуль приложения
            <span class="vue-b"><span class="vue-r">Процедура</span> ПриНачалеРаботыСистемы<span class="vue-r">()</span>
                Сотрудники <span class="vue-r">=</span> ОбщийМодуль1<span class="vue-r">.</span>ПолучитьСотрудников<span class="vue-r">();</span>

                <span class="vue-r">Для каждого</span> Сотрудник <span class="vue-r">Из</span> Сотрудники <span class="vue-r">Цикл</span>
                    Сообщить<span class="vue-r">(</span>Сотрудник<span class="vue-r">);
                КонецЦикла;
            КонецПроцедуры</span></span>


            --процедура в общем модуле ОбщийМодуль1
            <span class="vue-b"><span class="vue-r">Функция</span> ПолучитьСотрудников<span class="vue-r">() Экспорт</span>
                СсылкаНаЭлемент <span class="vue-r">=</span> Справочники<span class="vue-r">.</span>Сотрудники<span class="vue-r">.</span>Уволенные<span class="vue-r">;</span>

                Сотрудники <span class="vue-r">= Новый</span> Массив<span class="vue-r">;</span>

                ТекМесяц <span class="vue-r">=</span> Месяц<span class="vue-r">(</span>ТекущаяДата<span class="vue-r">());</span>
                ТекДень <span class="vue-r">=</span> День<span class="vue-r">(</span>ТекущаяДата<span class="vue-r">());</span>

                Выборка <span class="vue-r">=</span> Справочники<span class="vue-r">.</span>Сотрудники<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                    <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>ЭтоГруппа <span class="vue-r">ИЛИ</span> Выборка<span class="vue-r">.</span>Родитель <span class="vue-r">=</span> СсылкаНаЭлемент <span class="vue-r">Тогда
                        Продолжить;
                    КонецЕсли;</span>

                    Месяц <span class="vue-r">=</span> Месяц<span class="vue-r">(</span>Выборка<span class="vue-r">.</span>ДатаРождения<span class="vue-r">);</span>
                    День <span class="vue-r">=</span> День<span class="vue-r">(</span>Выборка<span class="vue-r">.</span>ДатаРождения<span class="vue-r">);</span>

                    <span class="vue-r">Если</span> Месяц <span class="vue-r">=</span> ТекМесяц <span class="vue-r">И</span> День <span class="vue-r">=</span> ТекДень <span class="vue-r">Тогда</span>
                        Сотрудники<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>Выборка<span class="vue-r">.</span>Наименование<span class="vue-r">);
                    КонецЕсли;	
                КонецЦикла;</span>

                <span class="vue-r">Возврат</span> Сотрудники<span class="vue-r">;
            КонецФункции</span></span>
        </pre>
    </div>
    <p>Нужно не забывать про то, что в настройках общего модуля нужно указать галочку "Сервер" и галочку "Вызов сервера", чтобы модуль приложения смог его вызвать на стороне сервера.</p>


    <p class="title-size16"><b id="spravochnik3">Получение данных из справочника через ссылку объектным способом и табличным</b></p>
    <p>Предположим у нас есть справочник "СтавкиНДС":</p>
    <img src="../img/1С-1/2022-12-04_17-55-18.png" class="screen" alt="">
    <p>И есть документ "РасходнаяНакладная":</p>
    <img src="../img/1С-1/2022-12-04_18-00-01.png" class="screen" alt="">
    <p>В документе в табличной части есть поле "СуммаНДС", чтобы вычислить это поле, нужно получить процент из поля "СтавкаНДС", чтобы получить число процента, нужно из БД его как то взять. 1й способ это через табличную модель:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаСервере
            Функция</span> ПолучитьСтавкуНДСЧислом<span class="vue-r">(</span>СтавкаНДС<span class="vue-r">)</span>
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |   СтавкиНДС.Ставка КАК Ставка
                    |ИЗ
                    |   Справочник.СтавкиНДС КАК СтавкиНДС
                    |ГДЕ
                    |	СтавкиНДС.Ссылка = &СтавкаНДС"</span><span class="vue-r">;</span>
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"СтавкаНДС"<span class="vue-r">,</span> СтавкаНДС<span class="vue-r">);</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                ВыборкаДетальныеЗаписи <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                ВыборкаДетальныеЗаписи<span class="vue-r">.</span>Следующий<span class="vue-r">();</span>
                <span class="vue-r">Возврат</span> ВыборкаДетальныеЗаписи<span class="vue-r">.</span>Ставка<span class="vue-r">;

                <span class="vue-g">//из РезультатЗапроса можно выбрать, а можно выгрузить в таблицу значений
                //зачем это нужно. Я когда раньше делал выборку из БД, никак не мог понять как можно посмотреть, что я там выбрал
                //вот это как раз то, что я хотел. В отладке смотрим, что выгрузилось из Результата и там в виде таблицы
                //все записи из базы
                //Таблица = РезультатЗапроса.Выгрузить();</span>
            КонецФункции</span></span>
        </pre>
    </div>
    <p>2й способ то через объектную модель:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаСервере
            Функция</span> ПолучитьСтавкуНДСЧислом<span class="vue-r">(</span>СтавкаНДС<span class="vue-r">)</span>
                <span class="vue-g">//СтавкаНДС это ссылка на элемент справочника "СтавкиНДС"
                //при таком способе получения данных из базы мы выбираем не конкретное поле
                //"Ставка", а мы получаем по ссылке весь объект со всеми полями
                //и только потом система из этого объекта получает значение поля "Ставка"
                //так что это не совсем правильный способ получения данных из базы
                //всё же правильней делать запрос с помощью языка запроса как в примере выше
                //даже если у объекта базы данных будет в подчинении таблица с чтабличной частью
                //система даже эту табличную часть прочитает</span>
                <span class="vue-r">Возврат</span> СтавкаНДС<span class="vue-r">.</span>Ставка<span class="vue-r">;
            КонецФункции</span></span>
        </pre>
    </div>
    <p>В обоих случаях мы передаём функции параметр СтавкаНДС. СтавкаНДС мы получаем из текущей строки табличной части - Элементы.Товары.ТекщуиеДанные.СтавкаНДС. В этом поле содержится не строка, а ссылка на элемент списка справочника СтавкиНДС. Чтобы заработал 1й способ с запросом, нужно привести этот реквизит в типу строка вот так - Строка(Элементы.Товары.ТекщуиеДанные.СтавкаНДС) и передать параметром в функцию. Во 2м способе, мы так и оставляем ссылочный тип и передаём эту ссылку в функцию. Функция выполняясь на сервере получает эту ссылку, в ссылке содержится элемент списка справочника СтавкиНДС, а значит нам доступны все поля этого элемента, в том числе и поле Ставка, которое нам вернёт числовое значение ставки.</p>

    <p class="title-size16"><b id="spravochnik4">Получение ссылки на элемент справочника</b>.</p>
    <p>Чтобы получить ссылку элемента справочника есть несколько путей.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ОткрытьФормуНоменклатуры<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                СсылкаНаНоменклатуру <span class="vue-r">=</span> ПолучитьНоменклатуруПоКоду<span class="vue-r">(</span><span class="vue-bl">"000000004"</span><span class="vue-r">);
            КонецПроцедуры </span></span>   

            <span class="vue-b"><span class="vue-r">&НаСервере
            Функция</span> ПолучитьНоменклатуруПоКоду<span class="vue-r">(</span>Код<span class="vue-r">)</span>
                <span class="vue-g">//Возврат Справочники.Номенклатура.НайтиПоНаименованию();</span>
                <span class="vue-g">//Возврат Справочники.Номенклатура.НайтиПоРеквизиту();</span>
                <span class="vue-r">Возврат</span> Справочники<span class="vue-r">.</span>Номенклатура<span class="vue-r">.</span>НайтиПоКоду<span class="vue-r">(</span>Код<span class="vue-r">);
            КонецФункции</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="spravochnik5">Метод ПолучитьОбъект() у разных типов данных справочника и документа</b></p>
    <p>Какие типы имеются ввиду? Типы - СправочникВыборка.ИмяСправчоника и ВыборкаИзРезультатаЗапроса.</p>
    <p>Существуют разные типы выборки, например, у справочника. Если мы выбрали данные справочника через объектную модель вот так:</p>
    <div class="code-style">
        <pre>
            Выборка = Справочники.номенклатура.Выбрать();
            
            Пока Выборка.Следующий() Цикл
                СправочникОбъект = Выборка.ПолучитьОбъект();
            КонецЦикла;
        </pre>
    </div>
    <p>То в переменой Выборка будут лежать записи из БД и эта выборка будет иметь тип "СправочникВыборка.Номенклатура". У такой выборки сразу есть метод ПолучитьОбъект(), т.е. на каждом круге цикла мы вызывая этот метод получаем объект каждой записи из БД.</p>
    <p>Но есть и другоая выборка, которую мы получаем через табличную модель запроса, вот так:</p>
    <div class="code-style">
        <pre>
            Запрос = Новый Запрос;
            ... 
            РезультатЗапроса = Запрос.Выполнить();
            Выборка = РезультатЗапроса.Выбрать();
        </pre>
    </div>
    <p>В этом случае в переменной Выборка также будут лежать записи из БД и тип выборки будет уже "ВыборкаРезультатаЗапроса". У этой выборки нет уже родного метода ПолучитьОбъект(), чтобы получить объект нужно заранее прописать в запросе получение поля Ссылка и вот уже у этого поля есть метод ПолучитьОбъект(). Вызов Выборка.Ссылка будет иметь тип "СправочникСсылка.Номенклатура" и этого типа данных есть такой метод.</p>
    <div class="code-style">
        <pre>
            Запрос = Новый Запрос;
            ... 
            РезультатЗапроса = Запрос.Выполнить();
            Выборка = РезультатЗапроса.Выбрать();

            Пока Выборка.Следующий() Цикл
                СправочникОбъект = Выборка.Ссылка.ПолучитьОбъект();
            КонецЦикла;
        </pre>
    </div>
    <p>Наверно у документов это работает также.</p>

    <p class="title-size16"><b id="spravochnik6">Метод СоздатьЭлемент() у менеджера справочника и перемещение созданного элемента в группу</b></p>
    <p>Метод доступен на сервере.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//в переменную НовыйЭлемент вернётся объект типа СправочникОбъект.Номенклатура</span>
	        НовыйТовар = Справочники.Номенклатура.СоздатьЭлемент(); 
	        НовыйТовар.Наименование = "Стиралка";

            <span class="vue-g">//созданный элемент я хочу поместить в группу "Ластики", для того нужно получить ссылку на эту группу</span>
            ГруппаЛастики = Справочники.Номенклатура.НайтиПоНаименованию("Ластики");

            <span class="vue-g">//проверяем есть ли группа, проверкой пустоты ссылки и проверяем не лежит ли там </span>
            <span class="vue-g">//значение Неопределено, при отсутствии такого наименования группы</span>
            Если ГруппаЛастики.Пустая() Тогда
                Сообщить("Ссылка пустая");
                Возврат;
            ИначеЕсли ГруппаЛастики = Неопределено Тогда
                Сообщить("Не верное Наименование группы");
                Возврат;
            КонецЕсли;

            <span class="vue-g">//Дошил сюда, значит всё нормально и для нового товара пишем в поле Родитель ссылку на найденную группу</span>
	        НовыйТовар.Родитель = ГруппаЛастики;

            <span class="vue-g">//ну и записываем объект в базу</span>
            НовыйЭлемент.Записать();
        </pre>
    </div>

    <p class="title-size16"><b id="spravochnik7">Предопределенные элементы</b></p>
    <p>При создании предопределенных элементов справочника задаётся - Имя, Код, Наименование. Наименование и Код отображаются пользователю, а Имя использует разработчик в коде.</p>
    <p>Пока не забыл про предопределенные элементы, для чего они нужны, первое, их можно указывать по умолчанию в других местах. Например в справочнике Номенклатура у элемента товара есть поле ЕдИзм и для товара часто используются одни и те же единицы измерения товара - Шт., вот можно создать справочник ЕдиницыИзмерения и сделать в нём предопределенный элемент Шт. и указывать его по умолчанию. В спрвочнике Номенклатура укажем реквизит ЕдИзм с типом СправочникСсылка.ЕдиницыИзмерения и в его палитре свойств есть свойство "ЗначениеЗаполнения", вот там и можно будет выбрать имя предопределенного элемента для отображения по умолчанию.</p>
    <p>Второе, можно на стороне сервера получить ссылку на объект с предопределенными данными вот так - СправочникМенеджер.&lt;Имя справочника>.&lt;Имя предопределенного элемента справочника>. Т.е. просто через точку указываем имя предопределенного элемента и получаем ссылку на объект с данными для этого элемента из базы. Например, Справочники.ЕдиницыИзмерения.Шт вернёт ссылку на объект БД с данными этого элемента. Так как ссылка отображается в виде Наименования, то вернётся значение - "Шт." с типом СправочникСсылка.ЕдиницыИзмерения.</p>
    <p>Предопределённые элементы только для чтения пользователем, изменять он может только наименование, имя не может поменять, которое дал разработчик, удалить также пользователь не может их.</p>
    <p>Ещё одно назначение предопределенных элементов в том, что разработчик может заранее создать какие то элементы и использовать их в программном коде, зная, что пользователь не сможет их удалить. Разработчик кстати тоже не может изменить предопределенный элемент, только удалить и создать новый.</p>
    <p>Пока просто хаотично записываю всё, что встречаю по предопределенным элементам.</p>

    <p class="title-size16"><b id="spravochnik8">Как автоматом ставить галочку в поле "Услуга" для новых создаваемых элементов справочника Номенклатура? Для элементов внутри группы Товары в поле Услуга ставится Ложь, а для элементов внутри группы Услуги - Истина. Событие "ОбработкаЗаполнения"</b></p>
    <p>Для документов это наверно примерно также работает.</p>
    <p>Если что то вот это видео - https://www.youtube.com/watch?v=dkHZGoUvoxs&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=4.  Там примерно с самого начала эта тема.</p>
    <p>Для начала нам надо группы справочника Номенклатура также пометить признаком Услуга как и элементы. Когда мы создаём реквизит Услуга, то по умолчанию система отображает в пользовательском режиме это поле только для элементов, нам же надо, чтобы это поле отображалось и для групп. Для этого в палитре свойств есть вкладка Использование, а в ней свойство также "Использование" и в этом свойстве выбираем "Для групп и элементов". Теперь для групп тоже отображается поле Услуга. В пользовательском режиме отметим галочкой поле Услуга для группы "Услуги". И теперь при создании нового элемента мы хотели бы, чтобы система оглядывалась на родителя этого элемента, считывала у родителя услуга он или нет и проставляла этот признак для нового элемента.</p>
    <p>При создании нового элемента система проходит по многим модулям и выполняет многие обработчики событий, если они заданы разработчиком. Одно из таких событий это событие заполнения реквизитов нового элемента. Это событие возникает каждый раз при создании нового элемента(как программного, так и через форму), при копировании элемента, при вводе на основании. Событие это называется "обработкаЗаполнения" и находится оно в модуле объекта. События модуля объекта всегда выполняются на стороне сервера.</p>
    <p>У этого события есть 3 параметра: ДанныеЗаполнения, ТекстЗаполнения и СтандартнаяОбработка. Нас интересует 1й параметр. ДанныеЗаполнения это то чем система собирается заполнить текущий элемент. Этот параметр может быть заполнен разными значениями. Например, находясь в форме списка справочника Номенклатура мы можем зайти в меню Ещё и там выбрать "Настройка списка", откроется окно, где мы можем указать отбор по каким то полям в этом списке, применим и список отфильтруется в соотсветствии с нашим отбором. А дальше нажмём создать новый элемент справочника, и в параметр ДанныеЗаполнения помимо свойства с ключом "Родитель" добавятся дополнительные свойства структуры с ключами состоящие из тех полей, котрые мы выбрали для отбора. В нашем случае мы отборы не устанавливаем поэтому там будет структура с 1м свойством - "Родитель" -> НазваниеРодителя. Ключ "Родитель" это строка, а его значение это ссылка на элемент этого родителя в БД, а если это ссылка значит можно обратиться в БД к любому полю этого элемента. У этого элемента-группы есть поле Услуга, которую мы заранее задали для групп(свойство "Использование") и мы заранее туда проставили галочку, если это группа относится к услугам. Значит проверка <i>ДанныеЗаполнения.Родитель.Услуга</i> даст Истина(если пытаемся создать элемент в группе услуг), ну и от этого условия далее заполняем  поле Услуга у создаваемого элемента.</p>
    <p>Ещё нужно проверить ДанныеЗаполнения на то есть в нём какое то значение или нет. Структуры там может и не быть если мы в пользовательском режиме выберем группу самого вырхнего уровня, ведь у этой группы нет родителя и не укажем отбор по каким то полям, тогда и структуру незачем системе создавать в этот параметр, а значит этот параметр может иметь значение Неопределено, поэтому и проверяем. А может быть так, что мы выбрали группу верхнего уровня, поле родителя в структуре не будет, но будут другие поля по отбору. Получится, что структура есть в параметре и есть какие то свойства в этой структуре, но не будет свойтсва с родителем и тоже будет ошибка. Значит делаем все эти проверки:</p>
    <div class="code-style">
        <pre>
            --модуль объекта
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаЗаполнения<span class="vue-r">(</span>ДанныеЗаполнения<span class="vue-r">,</span> ТекстЗаполнения<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-g">//сначала мы вообще проверяем есть ли в параметре структура или нет</span>
                <span class="vue-r">Если</span> ДанныеЗаполнения <span class="vue-r">= Неопределено Тогда</span>
                    <span class="vue-r">Возврат;</span>
                <span class="vue-r">КонецЕсли;</span>

                <span class="vue-g">//далее надо проверить есть ли в структуре свойство с ключом "Родитель", 
                //2й параметр у метода Свойство() можно не указывать</span>
                <span class="vue-r">Если</span> ДанныеЗаполнения<span class="vue-r">.</span>Свойство<span class="vue-r">(</span><span class="vue-bl">"Родитель"</span><span class="vue-r">) тогда</span>
                    Услуга <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Родитель<span class="vue-r">.</span>Услуга<span class="vue-r">;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Одно замечание. Я чуть выше писал, что если для списка справочника установить в настройках отбор по каким то полям, то в параметр ДанныеЗаполнения эти поля попадают в структуру в виде ключей, а значения этих полей в виде значения для ключей. Так вот при создании нового элемента справочника можно установить автоматом заполнение этих полей у нового элемента, если для каждого поля в палитре свойств в свойстве Представление -> "Заполнять из данных заполнения" поставить галочку, но такое заполнение будет работать только если существуют подходящие свойства в сруктуре, а они могут туда попасть при отборе или ещё как то. Но у нас немного другой случай, мы не устанавливаем отборы для списка, а значит и свойств соответствующих не будет в структуре параметра.</p>
    <p>НО мы можем сделать и по другому немного. Мы всё таки установим галочку для реквизита Услуга в свойстве  Представление -> "Заполнять из данных заполнения" и теперь чтобы этот реквизит заполнялся, нужно чтобы в параметре ДанныеЗаполнения в структуре было такое свойство как "Услуга" -> Истина или "Услуга" -> Ложь. Но такое свойство в структуре может появиться если мы сделаем отбор, но можно и не делать отбор, просто добавим в структуру сами это свойство в коде. По окончанию отработки этой процедуры в структуре параметра ДанныеЗаполнения будет нужное нам свойство и система сама уже заполнит соответствующие реквизиты из этой структуры, при наличии установленной галочки свойства "Заполнять из данных заполнения" для реквизита Услуга. 3й параметр как раз и говорит системе, чтобы она сама заполняла, если параметру СтандартнаяОбработка задать флаг Ложь, то система уже ничего сама заполнять не будет и тут поможет код выше, в котором мы сами устанавливали в реквизит Услуга нужное нам значение:</p>
    <div class="code-style">
        <pre>
            --модуль объекта
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаЗаполнения<span class="vue-r">(</span>ДанныеЗаполнения<span class="vue-r">,</span> ТекстЗаполнения<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-g">//сначала мы вообще проверяем есть ли в параметре структура или нет</span>
                <span class="vue-r">Если</span> ДанныеЗаполнения <span class="vue-r">= Неопределено Тогда</span>
                    <span class="vue-r">Возврат;</span>
                <span class="vue-r">КонецЕсли;</span>

                <span class="vue-g">//далее надо проверить есть ли в структуре свойство с ключом "Родитель", 
                //2й параметр у метода Свойство() можно не указывать</span>
                <span class="vue-r">Если</span> ДанныеЗаполнения<span class="vue-r">.</span>Свойство<span class="vue-r">(</span><span class="vue-bl">"Родитель"</span><span class="vue-r">) тогда</span>
                    ДанныеЗаполнения<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"Услуга"</span><span class="vue-r">,</span> ДанныеЗаполнения<span class="vue-r">.</span>Родитель<span class="vue-r">.</span>Услуга<span class="vue-r">);
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Это 2 работающих способа заполнять реквизиты. Если нам нужен простой способ заполнить реквизиты, то нужно постараться, чтобы использовать родной способ заполнения, т.е. использовать параметр СтандартнаяОбработка. А если у нас сложный код заполнения реквизитов, то отключаем стандартнуую обрабатку и сами заполняем как нам надо.</p>

    <p class="title-size16"><b id="spravochnik9">Проверка заполнения реквизитов при записи в БД. Событие "ОбработкаПроверкиЗаполнения"</b></p>
    <p>Если что то вот это видео - https://www.youtube.com/watch?v=dkHZGoUvoxs&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=4.  Там примерно с 30й минуты.</p>
    <p>Событие "ОбработкаПроверкиЗаполнения" как я понимаю наступает перед записью элемента справочника в БД. Если что поинтересоваться в синтакс помошнике.</p>
    <p>Например, есть такой случай, при создании нового элемента товара реквизит ЕдиницыИзмерения заполнять нужно, а вот при создании нового элемента услуги этот реквизит заполнять не нужно. Рассмотрим стандартный механизм заполнения. В конфигураторе для этого реквизита в палитре свойств у свойства Представление -> "Проверка заполнения" выберем "Выдавать ошибку". И теперь если это поле будет пустым, то система не даст нам записать этот элемент, например, для элемента услуги, где нам не нужно это поле заполнять. Идём в модуль объекта и там посмотрим на событие "ОбработкаПроверкиЗаполнения", в котором мы сможем создать разные условия для заполнения полей. 1й параметр Отказ, по умолчанию в нём Ложь, если в него поставить Истина, то элемент в БД не запишется. 2й парамметр Проверяемые реквизиты это массив реквизитов, для которых в свойстве "Проверка заполнения" выбрано "Выдавать ошибку". Вот что получилось:</p>
    <div class="code-style">
        <pre>
            --модуль объекта
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроверкиЗаполнения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> ПроверяемыеРеквизиты<span class="vue-r">)</span>
                <span class="vue-r">Если</span> <span class="vue-r">НЕ</span> ЭтоГруппа <span class="vue-r">И</span> Услуга <span class="vue-r">Тогда</span>
                    Индекс <span class="vue-r">=</span> ПроверяемыеРеквизиты<span class="vue-r">.</span>Найти<span class="vue-r">(</span><span class="vue-bl">"ЕдИзм"</span><span class="vue-r">);</span>
                    ПроверяемыеРеквизиты<span class="vue-r">.</span>Удалить<span class="vue-r">(</span>Индекс<span class="vue-r">);</span>		
                <span class="vue-r">КонецЕсли;	
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>При создании элемента услуги, мы смотрим на поле Услуга и если это она, то просто удаляем из массива ПроверяемыеРеквизиты поле "ЕдИзм".  Мы как бы говорим системе, что да, это поле стоит на проверку, но сейчас его не надо проверять, потому что мы создаём услуги и это поле нам не нужно. А вот в других случаях, когда мы создаём элемент товара, то у нас эта проверка не выполнится и мы не будем удалять из массива это поле и система смотжет проверить это поле на заполненность.</p>
    <p>Мы тут использовали возвожности самой системы как и в прошлом примере. Мы просто подправили массив, который считывает система для проверки заполненности реквизитов. Тут такой же совет, использовать по возможности стандартные механизмы системы, слегка вмешиваясь в этот механизм подправляя данные. Подобные механизмы работают и с документами и другими объектами.</p>

    <p class="title-size16"><b id="spravochnik10">Почему на этапе разработки не надо ставить галочку свойству "Неотрицательное" при установке реквизиту типа данных Число.</b></p>
    <p>Если мы установили эту галочку, то в пользовательском режиме не будет проблем, мы не сможем ввести отрицательное число. А вот при программировании, если мы вдруг захотим заполнить этот реквизит и там попадёт отрицательное число, то система превратит его в 0 и будет трудно отловить ошибку. А если мы уберём галочку, то после программного заполнения цен, если в реквизит попало отрицательное число, то мы увидим у товара отрицательную цену, а значит и понять примерно можем где ловить ошибку.</p>
    <p>Когда уже отладка конфигурации произошла и начали пользоваться ей, то можно и поставить эти галочки.</p>

    <p class="title-size16"><b id="spravochnik11">Определяем пол сотрудника по его отчеству.</b></p>
    <p>Есть карточка сотрудника, в этой карточке заполняются поля именем, фамилией, отчеством, также из перечисления можно выбрать пол сотрудника. Нужно по отчеству определить пол и вставить в поле "Пол". Вот решение:</p>
    <div class="code-style">
        <pre>
            --модуль формы элемента справочника "Сотрудники"
             
            &НаКлиенте
            Процедура ОтчествоПриИзменении(Элемент)
                Если ПустаяСтрока(Объект.Отчество) Тогда
                    Возврат;
                КонецЕсли;
            
                Окончание = НРег(Прав(Элементы.Отчество.ТекстРедактирования, 3));
                Если Окончание = "ич" Тогда
                    Объект.Пол = ПредопределенноеЗначение("Перечисление.ПолСотрудника.Мужской");
                Иначе	
                    Объект.Пол = ПредопределенноеЗначение("Перечисление.ПолСотрудника.Женский");
                КонецЕсли; 	
            КонецПроцедуры
        </pre>
    </div>

    <p class="title-size16"><b id="spravochnik12">Устанавливаем картинку товара в форме элемента справочника "Номенклатура".</b></p>
    <p>Если нужно решение Камкова по установке картинке, то оно описано в форме элемента справочника Номенклатура в базе Камкова "Основные объекты".</p>
    <p><span class="vue-b">Ключевые слова используемые в статье.</span></p>
    <ul class="list">
        <li><i style="text-decoration: underline;">Модифицированность</i> - программное свойство формы для удаления или добавления признака изменения(звёздочка рядом с названием элемента справочника) формы.</li>
        <li><i style="text-decoration: underline;">События "ПередЗаписью" и "ПередЗаписьюНаСервере"</i> - рассказывается разница между этими событиями и какое нам нужно для установки картинки.</li>
        <li></li>
        <li></li>
    </ul>
    <p>Устанавливать картинки можно для разных целей, например, фотографии сотрудников, изображения товаров и т.д. Возникает самый первый вопрос, где хранить картинку? Сопособов её хранить есть несколько, одни из этих способов правильные другие не очень. Начнём от первого не совсем правильного до 4го правильного, но все эти способы имеют право на жизнь:</p>
    <ul class="list">
        <li>Первый способ хранить в файле. Просто указываем ссылку где-то в форме и по этой ссылке загружается картинка. Но этот способ не очень хороший. Потому что пользователи могут работать в разных операционных системах, с разных устройств. Вот например, мы открыли 1С:Предприятие по ссылке через интернет в обозревателе у себя на компьюторе или телефоне. У меня то на устройстве нет этой картинки, значит путь к картинке уже работать не будет. Это ещё не самый страшный способ, можно конечно хранить картинку и в файле, но могут возникнуть другие трудности, удалили файл, поменяли или ещё чего-то. Ну и картинка как-бы не связана никак с объектом конфигурации.</li>
        <li>Второй способ, более правильный и пример ниже будет по этому способу. Мы можем хранить картинку в реквизите справочника, ну не в самом конечно реквизите, а в БД будет храниться двоичный код на картинку, реквизит лишь будет получать эти данные из БД и через элемент формы отображать в форме. Здесь уже картинка становится частью элемента справочника и это хорошо. Из минусов это то, что картинка теперь как-бы всё время с элементом справочника, а вдруг нам нужно как-то передать или показать элемент справочника по быстрому кому-то или где-то, желательно без картинки, то тут уже никуда без неё. Описал как понял из объяснения Чистова.</li>
        <li>Третий способ более правильный чем второй. Сохранить картинки можно в отдельном справочнике или в регистре сведений. Тут тоже есть плюсы и минусы. Плюсы какие? Во-первых при обмене данными, когда из одной базы мы передаём товары в другую базу, то передача будет без картинок, что увеличивает скорость передчи. Без картинок, потому что картинки лежат в другой структуре(справочнике или регистре)</li>
        <li>Ну и последний способ, который очень часто применяется. Это когда картинки лежат в другой базе данных. Конечно, тут нарушается принцип связи элемента справочника с картинкой, но когда мы будем делать резервное копирование своей базы, то картинки тут будут отсутствовать и база будет намного быстрей копироваться.</li>
    </ul>
    <p>Пример будет по 2му способу. Почему по второму, просто Чистов хотел показать не только как хранить картинку, но и как работает передача данных формы от клиента к серверу и обратно. И как передаётся картинка.</p>
    <p>Итак, нам нужен реквизит в справочнике "Номенклатура", назовём его "ДанныеКартинки" и укажем тип "ХранилищеЗначения". Этот тип позволяет хранить двоичные данные. А как известно картинки хранятся в двоином коде в виде цифр и букв(каждая цифра или буква это двоичный код вида "00100111"). Кстати в этот реквизит можно загрузить вообще всё что угодно, потому что всё передаётся через двоичный код, а двоичный код преобразуется в строку и передаётся от сервера к клиенту и обратно.</p>
    <p>Создаём форму элемента справочника и в реквизитах раскроем основной реквизит "Объект". Там увидим наш реквизит "ДанныеКартинки", но в типах данных будет написано "ХранилищеЗначения(не доступен в данных формы)". Это говорит о том, что картинки не передаются с данными формы. Всё как в браузере, с сервера передаётся html, в самом html есть теги картинок с указанием ссылки на картинку. Браузер начинает парсить html и отображать на экране, как толкьо браузер увидет тег картинки с ссылкой, он отправит паралельно запрос на сервер на получение этой картинки. Это делается для того, чтобы пользователю быстро вывести письменную информацию на сайте, а картинку уже будут подгружаться после. Также и тут, пользователю нужно быстро показать форму с данными, а картинку он подгрузит либо сам по кнопке, либо система, но после того как форма придёт на клиента. Поэтому такая надпись и видна нам, что картинка одновременно с данными формы к нам не передаётся.</p>
    <p>Чтобы пользователю показать картинку создадим реквизит формы "АдресКартинки" с типом "Строка" и перетащим в элементы формы. В элементах формы создастя элемент "Поле" с видом "Поле ввода" и свяжется с созданным реквизитом "АдресКартинки" через свойство "ПутьКДанным". Но нам нужен вид не "Поле ввода", а "Поле картинки", поменяем вид в свойствах элемента формы. Вот этот элемент формы с видом "Поле картинки" это то же самое, что тег img в html:</p>
    <img src="../img/1С-1/2023-09-18_10-22-10.png" class="screen" alt="">
    <p>Внесём временно некоторые изменения в свойствах корневого объекта конфигурации. В палитре свойств на заклдаке "Совместимость" для свойств "Режим использования модальности" и "Режим использования синхронных вызовов" установим значения "Использовать", позже поясним, что мы сделали:</p>
    <img src="../img/1С-1/2023-09-18_10-29-32.png" class="screen-2" alt="">
    <p>Дальше создадим команду "ЗагрузитьКартинку", перенесём в элементы формы. Система сама создаст элемент формы "Кнопка" с видом "Обычная кнопка" и свяжет этот элемент с командой через свойство "ИмяКоманды".</p> 
    <img src="../img/1С-1/2023-09-18_21-24-38.png" class="screen" alt="">
    <p>Обработчик для команды создаём на клиенте. Так как метод ПоместитьФайл() уже видимо выпилили разработчики, поэтому использую метод НачатьПомещениеФайлаНаСервер(), он работает через оповещения. Этот метод доступен на клиенте, на сервере вроде нет его. <span class="vue-r">Делаю с этим методом самостоятельно, никто не показывает как с ним работать. И чистов и Камков показывают с методом ПоместитьФайл(), поэтому нет уверенности что делаю правильно, но работать будет</span>:</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="vue-r">(</span>Команда<span class="vue-r">)</span> 
                <span class="vue-g">//в оповещении первый параметр это имя процедуры, которую нужно вызвать при определённом событии
                //второй параметр это модуль, из которого нужно вызвать эту процедуру. Указав ЭтотОбъект, мы
                //говорим, что нужно вызвать процедуру из модуля данной формы</span>
                Оповещение  <span class="vue-r">=  Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ОбработатьЗавершение"</span><span class="vue-r">,</span> ЭтотОбъект<span class="vue-r">);</span>

                <span class="vue-g">//скорее всего этот метод внутри себя создаёт объект от класса ДиалогВыбораФайла
                //и через метод Показать() пользователю откроется окно выбора файла.
                //Выбираем в диалоговом окне картинку и дальше метод помещает картинку во временное хранилище
                //на сервере. Этот метод первым параметром принимает объект оповещения, по завершении
                //загрузки файла во временное хранилище, метод запускает процедуру связанную с этим оповещением.
                //Процедура называется "ОбработатьЗавершение", также в объект оповещения, в параметр "Описание" 
                //метод добавляет информацию о помещённом файле 
                //Последний параметр, если он указан, говорит о том, что мы связываем
	            //эту форму со временным хранилищем, удалится объект формы - исчезнет и хранилище</span>  
                НачатьПомещениеФайлаНаСервер<span class="vue-r">(</span>Оповещение<span class="vue-r">,,,,,</span> УникальныйИдентификатор<span class="vue-r">);
            КонецПроцедуры </span> 

            <span class="vue-r">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="vue-r">(</span>Описание<span class="vue-r">,</span> ДопПараметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//2й параметр "ДопПараметры" передаётся из описания оповещения, если мы там его задали

                //В параметре "Описание" хранится вся информация о помещённом файле.
                //В свойстве Адрес будет лежат адрес файла во временном хранилище,
                //но адрес не такой как путь до файла на компе, а адрес именно
                //до временного хранилища.
                //Если мы этот адрес присвоим в реквизит АдресКартинки, то тут же 
                //пользователь увидит картинку в элементе формы "АдресКартинки"
                //Система как и браузер увидев адрес тут же сделает запрос на его получение</span> 
                АдресКартинки <span class="vue-r">=</span> Описание<span class="vue-r">.</span>Адрес<span class="vue-r">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Итак, что выше мы написали? С помощью метода мы выбрали картинку и поместили в созданное временное хранилище на сервере. Метод передал в оповещение инфу о картинке и мы в процедуре оповещения вставили адрес картинки во временном хранилище в реквизит "АдресКартинки". Система как и браузер увидев адрес тут же запросила данные по нему и в результате отобразилась картинка в элементе формы. Если закрыть элемент справоника и опять открыть, то картинки не будет, потому что при открытии реквизит "АдресКартинки" будет пустой. Значит нам нужно как то сохранить данные картинки в базе.</p> 
    <p>При вставке картинки система даже не покажет признака изменения формы(звёздочка рядом с названием формы). Чтобы признак изменения появился, у команды в палитре свойств есть свойство "Изменяет сохраняемые данные" и установим галочку:</p>
    <img src="../img/1С-1/2023-09-19_10-11-12.png" class="screen-2" alt="">
    <p>Но нам нужно чтобы признак изменения формы появлялся только после того, как картинка будет помещена во временное хранилище, а не просто по нажатию на кнопку. Ведь картинка может и не поместиться в хранилище или пользватель отменит выбор картинки, а признак появится, если поставить галочку. Поэтому опишем появление признака программно в обработке оповещения.</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            //1
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="vue-r">(</span>Команда<span class="vue-r">)</span> 
                Оповещение  <span class="vue-r">=  Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ОбработатьЗавершение"</span><span class="vue-r">,</span> ЭтотОбъект<span class="vue-r">);</span>

                НачатьПомещениеФайлаНаСервер<span class="vue-r">(</span>Оповещение<span class="vue-r">);
            КонецПроцедуры </span> 

            //2
            <span class="vue-r">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="vue-r">(</span>Описание<span class="vue-r">,</span> ДопПараметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//добавим появление признака изменения данных формы(звёздочка рядом с названием формы)
                //Для этих целей у кнопки есть свойство "Изменяет сохраняемые данные",
                //но нам нужно не по нажатию кнопки показывать признак, а по добавлению
                //файла во временное хранилище, поэтому добавим признак программно
                //При отмене выбора картинки пользователем параметр Описание будет иметь
                //значение Неопределено, значит не нужно добавлять признак изменения</span>
                <span class="vue-r">Если НЕ</span> Описание <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    Модифицированность <span class="vue-r">=</span> Истина<span class="vue-r">;
                КонецЕсли;</span>

                АдресКартинки <span class="vue-r">=</span> Описание<span class="vue-r">.</span>Адрес<span class="vue-r">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Для чего мы беспокоимся о признаке изменения данных формы? А потому что мы картинку записывать в базу будем со всеми остальными данными формы, а не отдельно. Например, в курсе Камкова, мы сохраняли картинку тут же при нажатии кнопки "ЗагрузитьКартинку", но, как я понял, это не совсем правильно. Например, пользователю может не понравится картинка и он захочет другую поставить, а мы зря будем в фоне делать запись её в базу. Пусть лучше уже выберет 100% и сохранит её вместе со всеми данными в базу через кнопку "Записать" или "Записать и закрыть". Хотя как по мне обы способа имеют право быть.</p>
    <p>Короче трудно разобраться в событиях расширений формы(в данном случае расширение справочника) таких как "ПередЗаписью", "ПередЗаписьюНаСервере". Вот картинка как события срабатывают:</p>
    <img src="../img/1С-1/711482603b57870b07da914cedca25a9.jpg" class="screen" alt="">
    <p>Вот, например, событие "ПередЗаписью" у формы элемента справочника. При создании обработчика этого события вылетает окошко выбора директивы запуска процедур и выбора только 2: "Создать на клиенте" и "Создать на клиенте и процедуру на сервере". Как видно из картинки, то начинается это событие на клиенте. Как это происходит мне не совсем понятно. Если выбрать 2ю директиву, то будет такая запись процедур:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаСервереБезКонтекста
            Процедура</span> ПередЗаписьюНаСервере<span class="vue-r">()</span>
                Сообщить<span class="vue-r">(</span>"Я отработал на сервере"<span class="vue-r">);
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПередЗаписью<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> ПараметрыЗаписи<span class="vue-r">)</span>
                Сообщить<span class="vue-r">(</span>"Я отработал на клиенте"<span class="vue-r">)</span>;
                ПередЗаписьюНаСервере<span class="vue-r">();
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Открыв форму элемента справочника в пользовательском режиме, внесём какие-нибудь данные и нажмём кнопку "Записать", сработает событие "ПередЗаписью" на клиенте и вызовется сообщение, которое я написал и затем сработает это событие на сервере из модуля формы и появится 2е сообщение. Всё как по картинке выше с событиями. Но как записать картинку в базу не понятно с этим событием? Где вообще объект справочника с данными? Объект справочника конечно же записался в базу, но картинку же никто не записал. Мне нужно вмешаться в этот процесс, получить адрес картинки из временного хранилища и записать данные картинки в реквизит, но мне не доступен объект справочника. Конечно можно конвертировать данные формы в объект(метод РеквизитФормыВЗначение("Объект")) и так записать, но тогда получится двойная запись. Я запишу, потом система ещё раз сама запишет.</p>
    <p>Если посмотреть второе событие "ПередЗаписьюНаСервере", то там есть 2й параметр "ТекущийОбъект", это как раз и будет объект(элемент) справочника с типом "СправочникОбъект.Номенклатура", в который мы и добавляли картинку. То что нам и нужно. Теперь в обработчике этого события нам нужно из временного хранилаща по адресу получить значение(двоичные данные) картинки и поместить их в реквизит "ДанныеКартинки":</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            //1
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="vue-r">(</span>Команда<span class="vue-r">)</span> 
                Оповещение  <span class="vue-r">=  Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ОбработатьЗавершение"</span><span class="vue-r">,</span> ЭтотОбъект<span class="vue-r">);</span>

                НачатьПомещениеФайлаНаСервер<span class="vue-r">(</span>Оповещение<span class="vue-r">);
            КонецПроцедуры </span> 

            //2
            <span class="vue-r">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="vue-r">(</span>Описание<span class="vue-r">,</span> ДопПараметры<span class="vue-r">) Экспорт</span>
                <span class="vue-r">Если НЕ</span> Описание <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    Модифицированность <span class="vue-r">=</span> Истина<span class="vue-r">;
                КонецЕсли;</span>

                АдресКартинки <span class="vue-r">=</span> Описание<span class="vue-r">.</span>Адрес<span class="vue-r">;
            КонецПроцедуры</span>

            //3
            <span class="vue-r">&НаСервере
            Процедура</span> ПередЗаписьюНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> ТекущийОбъект<span class="vue-r">,</span> ПараметрыЗаписи<span class="vue-r">)</span>
                <span class="vue-g">//получаем двоичные данные картинки из временного хранилища</span>
                ДвоичныеДанные <span class="vue-r">=</span> ПолучитьИзВременногоХранилища<span class="vue-r">(</span>АдресКартинки<span class="vue-r">);</span>
                
                <span class="vue-g">//и запишем двоичные данные картинки в реквизит элемента справочника
                //"ДанныеКартинки"</span>
                ТекущийОбъект<span class="vue-r">.</span>ДанныеКартинки <span class="vue-r">= Новый</span> ХранилищеЗначения<span class="vue-r">(</span>ДвоичныеДанные<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вот этот алгоритм описан схематично:</p>
    <img src="../img/1С-1/2023-09-21_21-24-45.png" class="screen" alt="">
    <p>Ну и теперь нужно при открытии формы показать картинку из базы ранее записанную в неё, но вставить двоичный код в реквизит формы "АдресКартинки" нельзя, система такое не понимает, ей нужна опять ссылка на картинку. Но временного хранилища уже нет, ссылку оттуда не взять, но система умеет создать ссылку на то место где лежит значение картинки в базе. Сейчас у нас двоичные данные картинки лежат в базе в реквизите "ДанныеКартинки", вот на данные этого реквизита и сделаем ссылку:</p>
    <div class="code-style">
        <pre>
            --модуль формы справочника "Номенклатура"

            //1
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ЗагрузитьКартинку<span class="vue-r">(</span>Команда<span class="vue-r">)</span> 
                Оповещение  <span class="vue-r">=  Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ОбработатьЗавершение"</span><span class="vue-r">,</span> ЭтотОбъект<span class="vue-r">);</span>

                НачатьПомещениеФайлаНаСервер<span class="vue-r">(</span>Оповещение<span class="vue-r">);
            КонецПроцедуры </span> 

            //2
            <span class="vue-r">&НаКлиенте
            Процедура</span> ОбработатьЗавершение<span class="vue-r">(</span>Описание<span class="vue-r">,</span> ДопПараметры<span class="vue-r">) Экспорт</span>
                <span class="vue-r">Если НЕ</span> Описание <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    Модифицированность <span class="vue-r">=</span> Истина<span class="vue-r">;
                КонецЕсли;</span>

                АдресКартинки <span class="vue-r">=</span> Описание<span class="vue-r">.</span>Адрес<span class="vue-r">;
            КонецПроцедуры</span>

            //3
            <span class="vue-r">&НаСервере
            Процедура</span> ПередЗаписьюНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> ТекущийОбъект<span class="vue-r">,</span> ПараметрыЗаписи<span class="vue-r">)</span>
                <span class="vue-g">//Первый способ решения проблемы мой </span>     
                <span class="vue-r">Попытка</span>
                    <span class="vue-g">//получаем двоичные данные картинки из временного хранилища
                    //Если возникает ошибка получение их временного хранилища
                    //это может значит, что форма уже была закрыта и хранилище
                    //уничтожено и мы пытаемся повторно открыть форму
                    //в этом случае на не нужно получать никакие адреса,
                    //а просто завершить выполнение процедуры.</span>
                    ДвоичныеДанные<span class="vue-r"> =</span> ПолучитьИзВременногоХранилища<span class="vue-r">(</span>АдресКартинки<span class="vue-r">);</span> 
                <span class="vue-r">Исключение
                    Возврат;
                КонецПопытки;</span>
            
                <span class="vue-g">////Второй способ решения проблемы от Чистова
                //Если ЭтоАдресВременногоХранилища(АдресКартинки) Тогда
                //    ДвоичныеДанные = ПолучитьИзВременногоХранилища(АдресКартинки);
                //Иначе	
                //    Возврат;
                //КонецЕсли;</span>
                
                <span class="vue-g">//и запишем двоичные данные картинки в реквизит элемента справочника
                //"ДанныеКартинки"</span>
                ТекущийОбъект<span class="vue-r">.</span>ДанныеКартинки <span class="vue-r">= Новый</span> ХранилищеЗначения<span class="vue-r">(</span>ДвоичныеДанные<span class="vue-r">);
            КонецПроцедуры</span>

            //4
            <span class="vue-r">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-g">//теперь нужно при открытии формы элемента справочника показать 
                //пользователю картинку, которая сохранена в виде двочного кода
                //в реквизите "ДанныеКартинки". Просто так двоичный код нельзя вставить 
                //в реквизит формы "АдресКартинки", там нужен именно адрес(ссылка) на
                //на данные картинки. Для этого есть спец метод</span>
                АдресКартинки <span class="vue-r">=</span> ПолучитьНавигационнуюСсылку<span class="vue-r">(</span>Объект<span class="vue-r">.</span>Ссылка<span class="vue-r">,</span> <span class="vue-bl">"ДанныеКартинки"</span><span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вот алгоритм описания открытия формы и получения картинки из базы по ссылке:</p>
    <img src="../img/1С-1/2023-09-22_09-58-48.png" class="screen" alt="">
    <p>Ну и сделаем <b>удаление картинки</b>:</p>
    <div class="code-style">
        <pre>
            --модуль формы элемента справочника Номенклатура

            //удаление картинки
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> УдалитьКартинкуНаСервере<span class="vue-r">()</span>
                СправочникОбъект <span class="vue-r">=</span> РеквизитФормыВЗначение<span class="vue-r">(</span><span class="vue-bl">"Объект"</span><span class="vue-r">);</span>
                СправочникОбъект<span class="vue-r">.</span>ДанныеКартинки <span class="vue-r">=</span> <span class="vue-bl">""</span><span class="vue-r">;</span>
                СправочникОбъект<span class="vue-r">.</span>Записать<span class="vue-r">();</span> 
                ЗначениеВРеквизитФормы<span class="vue-r">(</span>СправочникОбъект<span class="vue-r">,</span> <span class="vue-bl">"Объект"</span><span class="vue-r">);</span>
                АдресКартинки <span class="vue-r">=</span> <span class="vue-bl">""</span><span class="vue-r">;	
            КонецПроцедуры


            &НаКлиенте
            Процедура</span> УдалитьКартинку<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                УдалитьКартинкуНаСервере<span class="vue-r">(); 
            КонецПроцедуры</span></span>
        </pre>
    </div>

















    <h3 class="header-style" id="document">Работа с документами</h3>

    <p class="title-size16"><b id="document-base">Что такое и для чего нужен документ</b></p>
    <p>Объект конфигурации Документ предназначен для описания информации о совершенных хозяйственных операциях или о событиях, произошедших в жизни организации вообще. Как правило, в работе любой фирмы используются такие документы, как приходные накладные, приказы о приеме на работу, платежные поручения, счета и т.д. Свойства и структура этих документов описываются в объектах конфигурации Документ, на основе которых платформа создает в базе данных таблицы для хранения информации из этих документов. </p>
    <p>Логика работы документов отличается от логики работы других объектов конфигурации. Документ обладает способностью <i style="text-decoration: underline;">проведения</i>. Факт проведения документа означает, что событие, которое он отражает, повлияло на состояние учета. </p>
    <p>До тех пор, пока документ не проведен, состояние учета неизменно, и документ не более чем черновик, заготовка. Как только документ будет проведен, изменения, вносимые документом в учет, вступят в силу и состояние учета будет изменено. </p>
    <p>Поскольку документ вносит изменения в состояние учета, он всегда «привязан» к конкретному моменту времени. Это позволяет отражать в базе данных фактическую последовательность событий.</p>
    <p>Следующим важным фактом, вытекающим из двух предыдущих, является то, что система «1С:Предприятие» имеет механизмы, позволяющие отслеживать правильность состояния учета. Предположим, что мы изменили один из проведенных ранее документов и снова провели его задним числом. В этом случае система «1С:Предприятие» способна отследить, повлияют ли внесенные нами изменения на последующие проведенные документы, и, если это так, система способна перепровести необходимые документы. Механизм этот называется "Последовательности".</p>
    <p>В процессе работы пользователь может самостоятельно создавать новые документы – приходные и расходные накладные, счета и т.п. </p>
    <p>В базе данных каждый документ представляет собой отдельную запись в основной таблице, хранящей информацию об этом виде документов.</p>
    <p>Каждый документ, как правило, содержит информацию, которая подробнее описывает этот документ. Например, каждый документ Приходная накладная может содержать информацию о поставщике товаров, складе, на который приходуется товар, и т.д. </p>
    <p>Набор такой информации является одинаковым для всех документов одного вида, и для описания такого набора используются реквизиты объекта конфигурации Документ, являющиеся подчиненными объектами конфигурации. Большинство реквизитов разработчик создает самостоятельно, однако у каждого объекта конфигурации Документ по умолчанию существуют стандартные реквизиты. Два наиболее важных из них – это Дата и Номер. Поскольку тип данных Дата содержит дату и время с точностью до секунды, этот реквизит и определяет в основном положение документа на оси времени.</p>
    <p>Кроме этого, каждый документ содержит, как правило, некоторый набор информации, которая одинакова по своей структуре, но различна по количеству и предназначена для разных документов. Так, например, каждый документ Приходная накладная может содержать список приходуемых товаров. </p>
    <p>Для описания подобной информации служат табличные части объекта конфигурации Документ. В этом случае в базе данных будут созданы дополнительные таблицы для хранения табличных частей, подчиненных конкретному документу (рис. 4.3).</p>

    <p class="title-size16"><b id="document-types">Типы данных у документа</b></p>
    <p>Наряду с примитивными типами данных, таких как Число, Строка, Дата, Булево могут существовать типы данных, определяемые только конкретной конфигурацией. То есть такие типы, которые не присутствуют в конфигурации постоянно, а появляются в результате того, что добавлены некоторые объекты конфигурации.</p>
    <p>Объекты конфигурации, которые могут образовывать новые типы данных, называются <i style="text-decoration: underline;">типообразующими</i>.</p>
    <p>Например, при создании документа "Приходная накладная" в нашей конфигурации сразу появятся несколько типов данных:</p>
    <ul class="list">
        <li>ДокументМенеджер.ПриходнаяНакладная,</li>
        <li>ДокументСсылка.ПриходнаяНакладная,</li>
        <li>ДокументОбъект.ПриходнаяНакладная,</li>
        <li>ДокументВыборка.ПриходнаяНакладная</li>
    </ul>
    <img src="../img/1С-1/2023-08-02_11-09-28.png" class="screen" alt="">

    <p class="title-size16"><b id="document-prop-1">Значение заполнения</b></p>
    <p>Предположим у нашего предприятия есть основной склад и все товары поступающие к нам обязательно приходуются сначала на этот основной склад. Есть справочник Склады, в нём есть предопрделённый элемент склада - Основной. Мы можем облегчить работу пользователю указав этот предопределённый элемент склада по умолчанию. Пользователь создаёт новый документ, а там в реквизите "Склад" уже установленно значение "Основной".</p>
    <p>Нам нужно открыть палитру свойств реквизита "Склад" и найти свойство "Значение заполнения". В качестве значения этого свойства выберем предопределенный элемент справочника Склады – Основной.</p>
    <p>Ещё пример. Есть реквизит в справочнике "Сотрудники" - Пол. Мы задаём этому реквизиту тип данных "ПеречислениеСсылка.ПолСотрудника", а на закладке "Представление" в свойстве "Значение заполнения" можно выбрать любой пол для отображения по умолчанию.</p>
    <p>Как я понял пока, в этом свойстве можно выбирать предопределённые данные справочника или значения из перечисления. Других значений для выбора пока не встречал.</p>

    <p class="title-size16"><b id="document1">Метод СоздатьДокумент() у менеджера документа и добавление товара из справочника в табличную часть документа</b></p>
    <p>Подразумевается, что уже создан вид документа "ПоступлениеТоваров", созданы реквизиты и табличная часть Товары и мы просто программно добавляем новый документ и вписываем в его табличную часть товар из справчоника. Всё это можно сделать не в обработке, а с помощью модуля приложения и процедуры в общих модулях. Чтобы сделать какую то обработку данных в системе 1С используются обработки, но можно обойтись и без них, но скорее только в учебных целях(но это не точно). Можно использовать в модуле приложения(он выполняется только на клиенте) обработчик события "ПриНачалеРаботыСистемы", который будет вызывать процедуру из общего модуля. Общий модуль сделаем доступным только на сервере, для этого поставим галочку "Сервер" и чтобы можно было вызвать процедуру из общего модуля от клиентского модуля приложения нужно ещё поставить галочку "Вызов сервера"(это обязательно) в свойствах общего модуля. Затем в процедуре общего модуля пишем логику с изменениями каких то данных в БД и при запуске системы срабатывает событие "при начале работы системы" и запускается обработчик в модуле приложения, который запускает процедуру из общего модуля на сервере и что то меняет на сервере. Вот такой есть способ сделать обработку данных. Ну правда придётся перезапускать 1С предприятие, чтобы выполнить обработку.</p>
    <div class="code-style">
        <pre>
            --модуль приложения
            <span class="vue-b">Процедура ПриНачалеРаботыСистемы()
                Серверный.НаСервере();
            КонецПроцедуры</span>

            --общий модуль Серверный
            <span class="vue-b">Процедура НаСервере() Экспорт
                НовыйДокумент = Документы.ПоступлениеТоваров.СоздатьДокумент();
                НовыйДокумент.Дата = ТекущаяДата();
                СтрокатабЧасти = НовыйДокумент.Товары.Добавить();
                СтрокатабЧасти.Товар = <span class="vue-r">&lt;Тут должна быть ссылка на товар справочника></span>;
                НовыйДокумент.Записать();
            КонецПроцедуры</span>
        </pre>
    </div>

    <p class="title-size16"><b id="document2a">В таб. части Товары документа "ПродажаТоваров" при выборе товара нужно подставить цену в поле Цена из реквизита справочника Номенклатура "ЦенаПродажи".</b></p>
    <p>Много описывать тут нечего. Вот сразу код:</p>
    <div class="code-style">
        <pre>
            --модуль формы
            <span class="vue-b"><span class="vue-r">&НаСервереБезКонтекста
            Функция</span> ТоварыНоменклатураПриИзмененииНаСервере<span class="vue-r">(</span>ИмяТовара<span class="vue-r">)</span>
                <span class="vue-g">//В ИмяТовара содержится ссылка на элемент справочника. Через ссылку можно получать значения полей объекта БД, 
                //на который указывает эта ссылка</span>
                <span class="vue-r">Возврат</span> СсылкаТовара<span class="vue-r">.</span>ЦенаТовара<span class="vue-r">;</span>
            <span class="vue-r">КонецФункции

            &НаКлиенте
            Процедура</span> ТоварыНоменклатураПриИзменении<span class="vue-r">(</span>Элемент<span class="vue-r">)</span> 
                ТекДанные <span class="vue-r">=</span> Элементы<span class="vue-r">.</span>Товары<span class="vue-r">.</span>ТекущиеДанные<span class="vue-r">;</span>
                ЦенаТовара <span class="vue-r">=</span> ТоварыНоменклатураПриИзмененииНаСервере<span class="vue-r">(</span>ТекДанные<span class="vue-r">.</span>Номенклатура<span class="vue-r">);</span>
                ТекДанные<span class="vue-r">.</span>Цена <span class="vue-r">=</span> ЦенаТовара<span class="vue-r">;</span> 

                <span class="vue-g">//далее тут можно вызвать процедуру пересчёта поля Сумма,
                //если у нас есть такая логика</span>
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document2b">Практика. В таб.части документа изменить поле Цена во всех строках при изменении реквизита Контрагент в шапке документа.</b></p>
    <p>ПРимер из курса Камкова - Основные объекты(видео 2.3). Для начала вот снимок формы документа:</p>
    <img src="../img/1С-1/2023-05-07_09-46-12.png" class="screen" alt="">
    <p>Мы выбрали Контрагента и заполнили таб. часть товарами, но потом решили сменить поле Контрагент на другво поставщика и у нас должны смениться цены для всех товаров взятые из регистра сведений "ЦеныПоставщиков". Первоначально цены заполняются при выборе товара.</p>
    <p>Но есть ещё одно дополнение, мы не будем писать основной алгоритм в модуле формы, а напишем его в модуле объекта документа "ПоступлениеТоваров". Почему так? Как объяснил Камков, это для того чтобы была возможность вызвать этот алгоритм не только из формы, но и из других мест. Например, мы где то в обработке загрузили товары из файла Эксель и у нас есть название поставщика, нам нужно загрузить эти товары в таб.часть этого документа в БД и заполнить шапку документа. Получить цены мы сможем вызвав алгоритм написанный в модуле документа и дальше посчитать сумму и всё это записать в БД. Как видно мы тут не смогли бы так сделать, если бы алгоритм был написан в модуле формы.</p>
    <p>Продолжим. Опишем обработчик на клиенте события "ПриИзменении" для поля Контрагент в форме и вызовем функцию на сервере. Так как логика у нас будет в модуле объекта, то нам надо как то получить объект текущего документа, чтобы вызвать ту логику. Для этого есть функция РеквизитФормыВЗначение("Объект"), в которую передаём основной реквизит формы Объект в виде строки. После того как цены заполнены мы переводим на сервере обратно документ объект в основной реквизит формы Объект и заполняем его данными для отображения новых данных в форме. Всё это делает процедура ЗначениеВРеквизитФормы().</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> КонтрагентПриИзмененииНаСервере<span class="vue-r">()</span>	  
                ДокументОбъект <span class="vue-r">=</span> РеквизитФормыВЗначение<span class="vue-r">(</span><span class="vue-bl">"Объект"</span><span class="vue-r">);</span>
                ДокументОбъект<span class="vue-r">.</span>ЗаполнитьЦеныТоваровПоПоставщику<span class="r">();</span>
                ЗначениеВРеквизитФормы<span class="vue-r">(</span>ДокументОбъект<span class="vue-r">,</span> <span class="vue-bl">"Объект"</span><span class="vue-r">);   
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> КонтрагентПриИзменении<span class="vue-r">(</span>Элемент<span class="vue-r">)</span> 
                КонтрагентПриИзмененииНаСервере<span class="vue-r">();
            КонецПроцедуры</span></span> 
        </pre>
    </div>
    <p>Вот сам код из модуля объекта. Первый код Камков показал, другой мой:</p>
    <div class="code-style">
        <pre>
            --код Камкова------------------------------------------------------------------------------------------------------------
            <span class="vue-b"><span class="vue-r">Процедура</span> ЗаполнитьЦеныТоваровПоПоставщику<span class="vue-r">() Экспорт</span>	
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"
                    |ВЫБРАТЬ
                    |	ПоступлениеТоваровТовары.Товар КАК Товар,
                    |	ПоступлениеТоваровТовары.СерияТовара КАК СерияТовара,
                    |	ПоступлениеТоваровТовары.Количество КАК Количество
                    |ПОМЕСТИТЬ ТаблицаДокумента
                    |ИЗ
                    |	Документ.ПоступлениеТоваров.Товары КАК ПоступлениеТоваровТовары
                    |ГДЕ
                    |	ПоступлениеТоваровТовары.Ссылка = &Ссылка
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ТаблицаДокумента.Товар КАК Товар,
                    |	ТаблицаДокумента.СерияТовара КАК СерияТовара,
                    |	ТаблицаДокумента.Количество КАК Количество,
                    |	ЦеныПоставщиковСрезПоследних.Цена КАК Цена,
                    |	ТаблицаДокумента.Количество * ЦеныПоставщиковСрезПоследних.Цена КАК Сумма
                    |ИЗ
                    |	ТаблицаДокумента КАК ТаблицаДокумента
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныПоставщиков.СрезПоследних(
                    |				&ДатаДокумента,
                    |				Контрагент = &Контрагент
                    |					И Номенклатура В
                    |						(ВЫБРАТЬ
                    |							ТаблицаДокумента.Товар КАК Товар
                    |						ИЗ
                    |							ТаблицаДокумента КАК ТаблицаДокумента)) КАК ЦеныПоставщиковСрезПоследних
                    |		ПО ТаблицаДокумента.Товар = ЦеныПоставщиковСрезПоследних.Номенклатура"</span><span class="vue-r">;</span>
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"ДатаДокумента"<span class="vue-r">,</span> Дата<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"Контрагент"<span class="vue-r">,</span> Контрагент<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"Ссылка"<span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                
                <span class="vue-g">//у табличной части документа Товары есть метод Загрузить(), передаём в этот метод 
                //таблицу значений и строки табличной части заполняются из этой таблицы</span>
                Товары<span class="vue-r">.</span>Загрузить<span class="vue-r">(</span>РезультатЗапроса<span class="vue-r">.</span>Выгрузить<span class="vue-r">());	
            КонецПроцедуры</span></span>


            --второй код------------------------------------------------------------------------------------------------------------------------
            <span class="vue-b"><span class="vue-r">Процедура</span> ЗаполнитьЦеныТоваровПоПоставщику2<span class="vue-r">() Экспорт</span>
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"
                    |ВЫБРАТЬ
                    |	ПоступлениеТоваровТовары.Товар КАК Товар
                    |ПОМЕСТИТЬ ТаблицаДокумента
                    |ИЗ
                    |	Документ.ПоступлениеТоваров.Товары КАК ПоступлениеТоваровТовары
                    |ГДЕ
                    |	ПоступлениеТоваровТовары.Ссылка = &Документ
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ТаблицаДокумента.Товар КАК Товар,
                    |	ЦеныПоставщиковСрезПоследних.Цена КАК Цена
                    |ИЗ
                    |	ТаблицаДокумента КАК ТаблицаДокумента
                    |	ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ЦеныПоставщиков.СрезПоследних(
                    |			,
                    |			Контрагент = &Контрагент
                    |			И Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ТаблицаДокумента.Товар КАК Товар
                    |					ИЗ
                    |						ТаблицаДокумента КАК ТаблицаДокумента)) КАК ЦеныПоставщиковСрезПоследних
                    |	ПО ТаблицаДокумента.Товар = ЦеныПоставщиковСрезПоследних.Номенклатура"</span><span class="vue-r">;</span>
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"Контрагент"<span class="vue-r">,</span> Контрагент<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"Документ"<span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span> 
                
                <span class="vue-g">//если не нашлось товаров и цен для указанного Контраегнта, то заполняем поля Цена и Сумма пустотой</span>
                <span class="vue-r">Если</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда
                    Для каждого</span> Строка <span class="vue-r">Из</span> Товары <span class="vue-r">Цик</span>л        
                        Строка<span class="vue-r">.</span>Цена <span class="vue-r">=</span> 0<span class="vue-r">;</span>
                        Строка<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> 0<span class="vue-r">;
                    КонецЦикла;
                Иначе</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span> 
                    <span class="vue-g">//для удобвства заполняю структуру данными из выборки. Ключ - Товар, значение - Цена</span>
                    Значения <span class="vue-r">= Новый</span> Структура<span class="vue-r">;
                    Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                        Значения<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>Выборка<span class="vue-r">.</span>Товар<span class="vue-r">,</span> Выборка<span class="vue-r">.</span>Цена<span class="vue-r">);       
                    КонецЦикла;</span>
                    
                    НайденноеЗначение <span class="vue-r">=</span> Неопределено<span class="vue-r">;
                    Для каждого</span> СтрокаТабЧасти <span class="vue-r">Из</span> Товары <span class="vue-r">Цикл
                        <span class="vue-g">//заполняем строки таб. части в полях Цена и Сумма, проверяя есть ли такой товар в структуре, если есть то подставляем цену</span>
                        <span class="vue-g">//если нету, то заполняем пустотой</span>
                        Если</span> Значения<span class="vue-r">.</span>Свойство<span class="vue-r">(</span>СтрокаТабЧасти<span class="vue-r">.</span>Товар<span class="vue-r">,</span> НайденноеЗначение<span class="vue-r">) Тогда</span>
                            //у нас могут быть пусты цены у товаров, поэтому возвращается null, проверяем и заменяем на 0
                            НайденноеЗначение <span class="vue-r">=</span> ?<span class="vue-r">(</span>ТипЗнч<span class="vue-r">(</span>НайденноеЗначение<span class="vue-r">) =</span> Тип<span class="vue-r">(</span>"Null"<span class="vue-r">),</span> 0<span class="vue-r">,</span> НайденноеЗначение<span class="vue-r">);</span>
                            СтрокаТабЧасти<span class="vue-r">.</span>Цена <span class="vue-r">=</span> НайденноеЗначение<span class="vue-r">;</span>
                            СтрокаТабЧасти<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> СтрокаТабЧасти<span class="vue-r">.</span>Количество <span class="vue-r">*</span> НайденноеЗначение<span class="vue-r">;
                        Иначе</span>
                            СтрокаТабЧасти<span class="vue-r">.</span>Цена <span class="vue-r">=</span> 0<span class="vue-r">;</span> 
                            СтрокаТабЧасти<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> 0<span class="vue-r">;
                        КонецЕсли;        
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вся разница в итоге толко в обработке результата запроса. У Камкова обработка заняла всего одну строку из-за метода Загрузить() у табличной части. Я не знал про этот метод, надо запомнить. После проверок моя обработка результат работает также как и этот метод. Ну зато потренировался.</p>

    <p class="title-size16"><b id="document3">Практика. Создание механизма бронирования товара при оперативном учёте. Делаем кнопку в форме документа(используем модуль объекта), в форме списка документа(используем модуль менеджера).</b></p>
    <p><span class="vue-b"><i>Первая часть задачи. Создать кнопку в форме документа</i></span></p>
    <p>Это пример из видеокурса Камкова, видео - https://www.youtube.com/watch?v=Hx23nbwHHhI&list=PLHWLo4jq87N6wg9Ghx2u_NqcqeR9poe1e&index=14, видео имеет номер 4.1</p>
    <p>Есть такой случай. Продавая товар покупателю может возникнуть какая то заминка с офофрмлением товара и чтобы за это время, пока идёт отладка заминки, другой продавец не продал этот товар, нужно забронировать этот товар для покупателя до проведения документа. У нас есть регистр с остатками товаров, есть документ "ПродажаТоваров". В документе нужно сделать кнопку "Забронировать", по нажатию на которую мы отнимаем количество товара из регистра с остатками товаров и добавляем этот товар и количество в новый регистр накопления "БронированиеТоваров" в режиме остатки. Здесь встречается тот случай, когда нужно писать в регистр не при проведении документа, а до проведения. Такой случай я уже описывал как писать в регистр не через обработчик "ОбработкаПроведения". Этот случай описан в статье в разделе про регистр сведений, статья про запись в регистр из обработчика "ПриЗаписи". <a href="#11aa16">Тут</a></p>
    <p>Код добавления в регистр  "БронированиеТоваров" мы будем писать в модуле объекта, потому что мы можем и программно забронировать товары не заходя в форму документа. Поэтому в форме мы по нажатию только вызываем код из модуля объекта. Напомню тут для напоминания, что если мы код пишем в модуле объекта, то у нас есть помощь платформы в виде свойства Движения, если же не в модуле объекта, то этого свойства нет и запись в регистр немного другая, как раз другая запись описана в статье, которую я упомянул в прошлом абзаце.</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ПродажаТоваров"
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> Забронировать<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ЗабронироватьНаСервере<span class="vue-r">();
            КонецПроцедуры

            &НаСервере
            Процедура</span> ЗабронироватьНаСервере<span class="vue-r">()</span>
                ДокументОбъект <span class="vue-r">=</span> РеквизитФормыВЗначение<span class="vue-r">(</span>"Объект"<span class="vue-r">);</span>
                ДокументОбъект<span class="vue-r">.</span>Забронировать<span class="vue-r">();</span>
                ЗначениеВРеквизитФормы<span class="vue-r">(</span>ДокументОбъект<span class="vue-r">,</span> "Объект"<span class="vue-r">);
            КонецПроцедуры</span></span>


            --модуль объекта документа "ПродажаТоваров"
            <span class="vue-b"><span class="vue-r">Процедура</span> Забронировать<span class="vue-r">() Экспорт</span> 
                <span class="vue-g">//может быть такое, что мы создали движения и хотим их добавить в БД, но при добавлении в БД
                //система также добавляет от себя в каждое движение поле Регстратор и пишет туда документ, который эти заиписи делает
                //но вдруг документ сам ещё не записан в БД, ведь нужна ссылка на документ, а она пуста, 
                //тогда система не найдёт его и будет исключение. Значит надо перед
                //записью в регистр БронированиеТоваров записать сам документ в БД</span>
                Записать<span class="vue-r">();</span>
                
                <span class="vue-g">//документ записан, теперь запишем и движения в регистр</span>
                <span class="vue-r">Для каждого</span> ТекСтрокаТовары <span class="vue-r">Из</span> Товары <span class="vue-r">Цикл</span>
                    Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                    Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Количество<span class="vue-r">;
                КонецЦикла;</span>
                Движения<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>Записать<span class="vue-r">();
            КонецПроцедуры</span></span>        
        </pre>
    </div>
    <p>Почему тут нет строки - Движения.БронированиеТоваров.Записывать = Истина, а есть строка Движения.БронированиеТоваров.Записать(); в конце процедуры? Потому что это не обработчик "ОбработкаПроведения", который по этому флагу сам записывает записи в регистр по окончанию процедуры.</p>
    <p>Далее, мы заминку починили и можем провести документ и нужно теперь при проведении удалить записи из регистра "БронированиеТоваров". Как показал Камков, то мы пишем в обработчик "ОбработкаПроведения" вот эти 2 строки:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Движения<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>
            Движения<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span></span>
        </pre>
    </div>
    <p>Но у меня возникает вопрос, а что если в регистр не только мы забронировали, а ещё какие то продавцы тоже туда добавили товары, то мы что? И их записи тоже удалим?Вопрос решён. Оказывается, что каждый документ создаёт свой набор записей и записывает его в регистр и когда мы находясь в контексте текущего документа очищаем, то очищается только набор записей созданный этим документом ранее. Если в регистре есть другие наборы от других документов, то они не трогаются.</p>
    <p>Следующий шаг это сделать так, чтобы закрыть возможность бронировать товары, если документ уже проведён. Для этого в процедуре Забронировать в контексте объекта документа есть свойство Проведен, делаем проверку и выполняем бронирование если это свойтсво Ложь.</p>
    <p><span class="vue-b"><i>Вторая часть задачи. Создать кнопку в форме списка документа</i></span></p>
    <p>Нужно сделать так, чтобы пользователю не требовалось открывать форму документа и там нажимать "Забронировать", а эта кнопка была бы в панели команд формы списка документа. Мы выбираем в списке документ или документы и по нажатию на кнопку товары внутри этих документов бронировались.</p>
    <p>Как я понимаю есть как минимум 2 способа добавить кнопку в форму списка документа. Превый это через подобъект Команды этого документа и через форму списка документа. Мы будем делать 2м способом. Добавим команду в форме и вынесем её в командную панель формы, также повесим обработчик на эту команду и будем также вызывать внешний код для бронирования. Нам нужно как то определить, какие документы выбраны в списке. У элемента Список как и у таб. части есть похожее свойство, которое возвращает текущие выделенные строки. У списка это свойство <b>ВыделенныеСтроки</b>, это свойство возвращает массив со ссылками выделенных документов, всё то же самое как у кнопки созданной через подобъект Команды, там платформа сама нам предоставляет обработчик "ОбработкаКоманды" и там также 1м параметром массив.</p>
    <p>Маленькое отступление! Бывает у нас есть своя форма списка и мы вносим в неё изменения, но они не видны в пользовательской части. Причина может быть в том, что форма не назначена основной, делается это на вкладке Формы.</p>
    <p>Итак, по нажатию к нам приходит массив со ссылками, в цикле можно перебрать эти ссылки и для каждой получить объект типа ДокументОбъект и вызвать уже ранее написанную процедуру Забронировать в модуле объекта. Но такой способ затратный, потому что при получении объекта типа ДокументОбъект из БД считываются все данные каждого объекта, собираются свойства и методы для этого объекта и так в цикле для каждого объекта. А нам не нужны все эти данные, свойства и методы, кроме одного метода. И нужно найти более подходящий способ без собирания объекта. ЗАМЕТКА! Подумал тут и видится мне не совсем бесполезным способом получать объект и вызывать у него метод Забронировать(). Многие данные, которые объект собирает нам понадобятся. Когда мы будем вызывать метод Забронировать() то в нём нам будут нужны почти все данные объекта - Дата, Проведен, Ссылка, таб. часть Товары, да и плюс будет свойство Движения, а значит нам платформа поможет немного. И пока как мне видится не нужно будет делать запросы к БД, у нас все данные уже есть. Так что когда научусь замерять быстродействие методов, нужно будет сравнить, что быстрее. Но есть НО. Мы собираем объект документа в цикле, а сбор это запросы к БД. Значит у нас будут запросы к БД в цикле, а это плохо. Хотя и ниже в коде от Камкома мы тоже делаем запросы в цикле.</p>
    <p>Выходом может стать написания метода Забронировать() не в модуле объекта, а в модуле менеджера документа вида "ПоступлениеТоваров". Модуль менеджера ещё выбрали, потому что он не связан с каким то одним документом, в нём содержаться свойства и методы для управления всеми документами одного вида. Можно было бы и написать в Общем модуле и всё работало бы, но этот метод не тянет на общий и связан вполне с конкретным видом документа.</p>
    <p>В модуле менеджера теперь не будет свойства Движения и платформа нам уже не поможет с записью в регистр и тут вот как раз и понадобится способ писать в регистр, про который я выше писал и ссылку на статью оставил.</p>
    <p>Итак вот код который написал Камков:</p>
    <div class="code-style">
        <pre>
            --модуль формы списка документа ПродажаТоваров
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> Забронировать<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ЗабронироватьНаСервере<span class="vue-r">();</span>
            <span class="vue-r">КонецПроцедуры</span>

            <span class="vue-r">&НаСервере
            Процедура</span> ЗабронироватьНаСервере<span class="vue-r">()</span>
                <span class="vue-r">Для каждого</span> СсылкаНаДокумент <span class="vue-r">Из</span> Элементы<span class="vue-r">.</span>Список<span class="vue-r">.</span>ВыделенныеСтроки <span class="vue-r">Цикл</span>
                    <span class="vue-g">//ДокументОбъект = СсылкаНаДокумент.ПолучитьОбъект();
                    //ДокументОбъект.Забронировать();</span>

                    Документы<span class="vue-r">.</span>ПродажаТоваров<span class="vue-r">.</span>Забронировать<span class="vue-r">(</span>СсылкаНаДокумент<span class="vue-r">);</span>	
                <span class="vue-r">КонецЦикла;
            КонецПроцедуры</span></span>


            --модуль менеджера документа ПродажаТоваров
            <span class="vue-b"><span class="vue-r">Процедура</span> Забронировать<span class="vue-r">(</span>ДокументСсылка<span class="vue-r">)  Экспорт</span>
                Запрос <span class="vue-r">=</span> Новый Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"Ссылка"<span class="vue-r">,</span> ДокументСсылка<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span><span class="vue-bl">"
                    |ВЫБРАТЬ
                    |	ПродажаТоваров.Дата КАК Дата,
                    |	ПродажаТоваров.Склад КАК Склад,
                    |	ПродажаТоваров.Проведен КАК Проведен
                    |ИЗ
                    |	Документ.ПродажаТоваров КАК ПродажаТоваров
                    |ГДЕ
                    |	ПродажаТоваров.Ссылка = &Ссылка"</span><span class="vue-r">;</span>
                
                ДанныеИзШапкиДокумента <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">().</span>Выбрать<span class="vue-r">();</span>
                ДанныеИзШапкиДокумента<span class="vue-r">.</span>Следующий<span class="vue-r">();</span> 
                
                <span class="vue-r">Если</span> ДанныеИзШапкиДокумента<span class="vue-r">.</span>Проведен <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат;</span>
                <span class="vue-r">КонецЕсли;</span>
                
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"
                    |ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	ПродажаТоваровТовары.Количество КАК Количество
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка"</span><span class="vue-r">;</span>
                
                Выборка <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">().</span>Выбрать<span class="vue-r">();</span>

                НаборЗаписей <span class="vue-r">=</span> РегистрыНакопления<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>СоздатьНаборЗаписей<span class="vue-r">();</span> 
                НаборЗаписей<span class="vue-r">.</span>Отбор<span class="vue-r">.</span>Регистратор<span class="vue-r">.</span>Установить<span class="vue-r">(</span>ДокументСсылка<span class="vue-r">);</span>
	
                <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">()</span> <span class="vue-r">Цикл</span>
                    Движение <span class="vue-r">=</span> НаборЗаписей<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                    Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> ДанныеИзШапкиДокумента<span class="vue-r">.</span>Дата<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> ДанныеИзШапкиДокумента<span class="vue-r">.</span>Склад<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;
                КонецЦикла;</span>

                НаборЗаписей<span class="vue-r">.</span>Записать<span class="vue-r">();
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Не знаю почему, но Камков написал код так, что у него в цикле выполяется как минимум по 2 запроса. Мы из формы документа вызываем метод Забронировать() в цикле, а в этом методе мы делаем 2 запроса к БД.Ниже я опишу свой метод Забронировать, который я не вызываю в цикле, а сразу передаю в него весь массив ссылок и уже в методе делаю всего 1 запрос, куда также передаю параметром массив ссылок и мне вернётся ответ по всем документам нас интересующих. Для удобства ответ выгружу в таблицу значений и её буду использовать.</p>
    <p>Сделал замер производительности кода Камкова и своего, если я всё правильно понял по времени, то выполнение кода Камкова заняло 35,43598, мой занял 3,395823, как видно разница в 10 раз.Могу предположить, что если бы мы использовали тот способ, где мы получаем в цикле на каждую ссылку объект документа, то там тоже было бы не быстро, потому что в цикле запросы по получению данных и сбор методов для объекта.</p>
    <p>В наборе записей когда мы добавляем новую запись, то Период заполняется обязательно(если это периодический регистр).</p>
    <p>Когда мы заполняли регистр накопления "БронированиеТоваров" в подтексте документа в модуле объекта, то там, я так понял, в запись(движение) автоматом записывалось такое поле как Регистратор и это поле заполнялось ссылкой на документ в подтексет которого и выполнился этот модуль. Но мы находимся в модуле менеджер документов и тут автоматом это поле не заполняется, его нужно заполнить нам самим. Есть 2 способа записать Регистратор. Можно просто написать <b>Движение.Регистратор = ДокументСсылка</b>, а есть 2й способ, который встречается более чаще, пишем перед циклом такую строку <b>НаборЗаписей.Отбор.Регистратор.Установить(ДокументСсылка);</b>.</p>
    <p>Мой код:</p>
    <div class="code-style">
        <pre>
            --модуль формы списка документа ПродажаТоваров
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> Забронировать<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ЗабронироватьНаСервере<span class="vue-r">();
            КонецПроцедуры

            &НаСервере
            Процедура</span> ЗабронироватьНаСервере<span class="vue-r">()</span> 
                <span class="vue-g">//1й способ
                //Для каждого СсылкаНаДокумент Из Элементы.Список.ВыделенныеСтроки Цикл
                //	Документы.ПродажаТоваров.Забронировать(СсылкаНаДокумент);	
                //КонецЦикла; 
                
                //2й способ
                //Для каждого СсылкаНаДокумент Из Элементы.Список.ВыделенныеСтроки Цикл
                //    ДокументОбъект = СсылкаНаДокумент.ПолучитьОбъект();
                //    ДокументОбъект.Забронировать();
                //КонецЦикла;


                //мой способ
                //инструкция Элементы.Список.ВыделенныеСтроки возвращает массив ссылок</span>
                Документы<span class="vue-r">.</span>ПродажаТоваров<span class="vue-r">.</span>Забронировать2<span class="vue-r">(</span>Элементы<span class="vue-r">.</span>Список<span class="vue-r">.</span>ВыделенныеСтроки<span class="vue-r">);
            КонецПроцедуры</span></span>



            --модуль менеджера документа ПродажаТоваров
            <span class="vue-b"><span class="vue-r">Процедура</span> Забронировать2<span class="vue-r">(</span>МассивСсылок<span class="vue-r">) Экспорт</span>
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Ссылка КАК Ссылка,
                    |	ПродажаТоваровТовары.Ссылка.Дата КАК Дата,
                    |	ПродажаТоваровТовары.Ссылка.Склад КАК Склад,
                    |	ПродажаТоваровТовары.Ссылка.Проведен КАК Проведен,
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	ПродажаТоваровТовары.Количество КАК Количество
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка В(&Ссылка)"</span><span class="vue-r">;</span>
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span>"Ссылка"<span class="vue-r">,</span> МассивСсылок<span class="vue-r">);</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                Таблица <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выгрузить<span class="vue-r">();</span>
                
                <span class="vue-r">Для каждого</span> Элемент <span class="vue-r">Из</span> МассивСсылок <span class="vue-r">Цикл</span>
                    НаборЗаписей <span class="vue-r">=</span> РегистрыНакопления<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>СоздатьНаборЗаписей<span class="vue-r">();</span>
                    НаборЗаписей<span class="vue-r">.</span>Отбор<span class="vue-r">.</span>Регистратор<span class="vue-r">.</span>Установить<span class="vue-r">(</span>Элемент<span class="vue-r">);</span>
                    
                    <span class="vue-r">Для каждого</span> СтрокаТаблицы <span class="vue-r">Из</span> Таблица <span class="vue-r">Цикл</span>
                        <span class="vue-r">Если</span> Элемент <span class="vue-r">=</span> СтрокаТаблицы<span class="vue-r">.</span>Ссылка <span class="vue-r">И НЕ</span> СтрокаТаблицы<span class="vue-r">.</span>Проведен <span class="vue-r">Тогда</span>
                            Движение <span class="vue-r">=</span> НаборЗаписей<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                            Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                            Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> СтрокаТаблицы<span class="vue-r">.</span>Дата<span class="vue-r">;</span>
                            Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> СтрокаТаблицы<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                            Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> СтрокаТаблицы<span class="vue-r">.</span>Склад<span class="vue-r">;</span>
                            Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> СтрокаТаблицы<span class="vue-r">.</span>Количество<span class="vue-r">;
                        КонецЕсли;
                    КонецЦикла;</span>
                    НаборЗаписей<span class="vue-r">.</span>Записать<span class="vue-r">();
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document4">Практика. Показываем остаток выделенного товара в табличной части документа "ПродажаТоварв". Событие у таб. части с типом ТаблицаФормы - "ПриАктивизацииСтроки". Продолжение к предыдущему примеру</b></p>
    <p>Эту статью можно отнести к предыдущей статье про добавление товаров в регистр "БронированиеТоваров" как продолжение логики. Мы в документе перед тем как нажать на кнопку "Забронировать" можем в таб. части посмотреть остаток этих товаров на складе.</p>
    <p>Стоит задача отобразить в реквизите формы "Остаток товара" с видом "Поле надписи", ниже табличной части, остаток выделенного товара в таб. части документа "ПродажаТоваров". Для табличной части Товары(тип ТаблицаФормы) есть событие "ПриАктивизацииСтроки", это когда мы кликаем по строке и она выделается, срабатывает это событие. Далее вешаем на это событие в модуле формы документа обработчики:</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ПродажаТоваров"
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки<span class="vue-r">(</span>Элемент<span class="vue-r">)</span>
                СсылкаНаТовар <span class="vue-r">=</span> Элементы<span class="vue-r">.</span>Товары<span class="vue-r">.</span>ТекущиеДанные<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                ТоварыПриАктивизацииСтрокиНаСервере<span class="vue-r">(</span>СсылкаНаТовар<span class="vue-r">);
            КонецПроцедуры</span>

            <span class="vue-r">&НаСервере
            Процедура</span> ТоварыПриАктивизацииСтрокиНаСервере<span class="vue-r">(</span>СсылкаНаТовар<span class="vue-r">)</span>
                <span class="vue-g">//объектная модель запроса 
                //так как этот регистр имеет 2 измерения, то их и указываем</span>
                Отбор <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span>"Номенклатура<span class="vue-r">,</span> Склад"<span class="vue-r">,</span> СсылкаНаТовар<span class="vue-r">,</span> Объект<span class="vue-r">.</span>Склад<span class="vue-r">);</span>

                <span class="vue-g">//в переменную ТаблицаОстатков вернётся ТаблицаЗначений</span>
                ТаблицаОстатков <span class="vue-r">=</span> РегистрыНакопления<span class="vue-r">.</span>ОстаткиНоменклатуры<span class="vue-r">.</span>Остатки<span class="vue-r">(,</span> Отбор<span class="vue-r">);</span> 

                <span class="vue-g">//чтобы получить ресурс Количество нужно вызвать метод Итог у таблицы
                //мы можем получить Количество и не через Итог, а сразу получить значение поля, выбрав строку таблицы и поле в этой строке
                //ОстатокТовара = ТаблицаОстатков.[0].Количество;
                //почему используем Итог(), потомо что у нас может не быть остатков, а значит строк
                //не будет в таблице и обращение к строке вызовет ошибку, а метод Итог() не вызовет ошибки</span>
                ОстатокТовара <span class="vue-r">=</span> ТаблицаОстатков<span class="vue-r">.</span>Итог<span class="vue-r">(</span>"Количество"<span class="vue-r">);</span>
                


                <span class="vue-g">//табличная модель запроса
                //Запрос = Новый Запрос;
                //Запрос.Текст = 
                //	"ВЫБРАТЬ
                //	|	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК КоличествоОстаток
                //	|ИЗ
                //	|	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки
                //	|ГДЕ
                //	|	ОстаткиНоменклатурыОстатки.Номенклатура = &Номенклатура";
                //
                //Запрос.УстановитьПараметр("Номенклатура", СсылкаНаТовар);
                //РезультатЗапроса = Запрос.Выполнить();
                //ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
                //ВыборкаДетальныеЗаписи.Следующий();
                //ОстатокТовара = ВыборкаДетальныеЗаписи.КоличествоОстаток;</span>
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Заходим, проверяем работу и всё работает, но нас поджидает ошибка при попытке создать новый документ ПродажаТоваров. Когда мы создадим документ, нам откроется форма документа, где мы будем заполнять поля и событие "ПриАктивизацииСтроки" сразу срабатывает, это событие пытается спозиционироваться на строку в табличной части, но у нас ещё не заполнена табличная часть и потому нет пока строки, на которую это событие указывает, а потому в процедуре строка <b>СсылкаНаТовар = Элементы.Товары.ТекущиеДанные.Товар;</b> вызовет ошибку, в Элементы.Товары.ТекущиеДанные будет лежать Неопределено и попытка прочитать у Неопределено поле Товар вызовет ошибку. Перепишем процедуру на клиенте:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки(Элемент)
                <span class="vue-g">//1й способ мой через Попытка ... Исключение</span>
                <span class="vue-r">Попытка</span>
                    СсылкаНаТовар <span class="vue-r">=</span> Элементы<span class="vue-r">.</span>Товары<span class="vue-r">.</span>ТекущиеДанные<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                Исключение
                    Возврат;
                КонецПопытки;</span>
                ТоварыПриАктивизацииСтрокиНаСервере<span class="vue-r">(</span>СсылкаНаТовар<span class="vue-r">);</span>
                
                <span class="vue-g">//2 способ Камкова через условие
                //ТекущиеДанные = Элементы.Товары.ТекущиеДанные.Товар;
                //Если ТекущиеДанные &lt;> Неопределено Тогда
                //  ТоварыПриАктивизацииСтрокиНаСервере(ТекущиеДанные.Товар);
                //КонецЕсли;</span>
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Если же нам по какой то причине нужно получать остатки не актуальные, а на дату документа, то в метод Остатки первым аргументом передаём дату документа или момент времени документа. Можно момент времени передать 2мя способами - 1) у основного реквизита Объект нет такого свойства, зато есть в таблице документа в БД, чтобы его получить обратимся через ссылку - <b>Объект.Ссылка.МоментВремени</b>, 2) и можно создать момент времени самому и передать в него параметры - <b>Новый МоментВремени(Объект.Дата, Объект.Ссылка)</b>.</p>
    <p>Важно не забывать, что при добавления товара, платформа сама спозиционирует выделение на новой созданной строке и опять же сработает это событие. Остатки не покажутся, потому что в миг срабатывания события товар ещё не был выбран, поэтому можно сделать вызов процедуры ТоварыПриАктивизацииСтрокиНаСервере() где нибудь в обработчике ТоварПриИзменении(), когда срабатывает событие "ПриИзменении" при выборе товара.</p>
    <p>Ещё может быть ошибка. При создании нового документа, а затем сразу при создании нового товара событие "ПриАктивизацииСтроки" сработает и Элементы.Товары.ТекущиеДанные.Товар вернёт пустую ссылку. При передаче на сервер пустой ссылки И передаче в параметр момента времени(ТаблицаОстатков = РегистрыНакопления.ОстаткиНоменклатуры.Остатки(Объект.Ссылка.МоментВремени, Отбор);) попытка получить данные по этой пустой ссылке приведёт к тому, что будет бесконечный цикл. Как показывает отладчик, если передать в Остатки момент времени, то при пустой ссылке снова срабатывает событие "ПриАктивизацииСтроки" и так по кругу, а если не передавать момент времени, то всё норм. Можно решить проблему по разному, можно как я ниже показано, а можно как Камков сделал. Он перед запросом проверял на пустоту ссылку и если она пустая мы моменту времени присваиваем Неопределено, это то же самое что и не передавали этот момоент времени, а если не пустая, то передаём момент времени. Механизм Попытка ... Исключение пустую ссылку не отлавливает как ошибку, поэтому проверяем в попытке значение на пустую ссылку и если она пустая, то возбуждаем исключение:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки(Элемент)
                <span class="vue-g">//1й способ мой через Попытка ... Исключение</span>
                <span class="vue-r">Попытка</span>
                    СсылкаНаТовар <span class="vue-r">=</span> Элементы<span class="vue-r">.</span>Товары<span class="vue-r">.</span>ТекущиеДанные<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                    <span class="vue-r">Если</span> СсылкаНаТовар<span class="vue-r">.</span>Пустая<span class="vue-r">() Тогда</span>
                        ВызватьИсключение<span class="vue-r">(</span>" "<span class="vue-r">);
                    КонецЕсли;
                Исключение
                    Возврат;
                КонецПопытки;</span>
                ТоварыПриАктивизацииСтрокиНаСервере<span class="vue-r">(</span>СсылкаНаТовар<span class="vue-r">);</span>
                
                <span class="vue-g">//2 способ Камкова через условие
                //ТекущиеДанные = Элементы.Товары.ТекущиеДанные.Товар;
                //Если ТекущиеДанные &lt;> Неопределено Тогда
                //  ТоварыПриАктивизацииСтрокиНаСервере(ТекущиеДанные.Товар);
                //КонецЕсли;</span>
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Потому что если пустая ссылка пойдёт дальше, то там может случится бесконечный вызов при моменте времени.</p>

    <p class="title-size16"><b id="document5">Практика. Создание механизма бронирования товара. Другой способ записи в регистр, выносим Движения в документ и прям напрямую пишем. Создаём отдельно документ "БронированиеТоваров"</b></p>
    <p>Создадим документ "БронированиеТоваров", реквизиты свои добавлять не будем, запретим ему проведение. При запрете проведения в форме исчезнуть кнопки проведения. На закладке Движения отметим, что движения будут по регистру накопления "БронированиеТоваров". Создаём форму документа и из основного реквизита Объект выносим в элементы набор записей: Объект - Движения - БронированиеТоваров  -> Форма. Теперь у нас в документе отображается набор записей принадлежащий этому документу из регистра "БронированиеТоваров". Прям в него пишем товары и жмём Записать. Нужно отметить, что в пользовательской части появится кнопка Добавить, которая добавляет новую запись в регистр.</p> 
    <p>Удалить запись из регистра можно из этого же документа, выделив строку и в меню Ещё выбрать Удалить. Или можно обработать пометку на удаление. Например пользователь пометил документ на удаление и мы обработаем эту пометку там же в обработчике "ПередЗаписью", потому что при пометке происходит перезапись документа. Можно удалить запись или сделать не активной.</p>
    <p>Обычно документ пишет в регистры через обработчик "ОбработкаПроведения", но в этом примере, документ не использует этот обработчик, платформа сама пишет в регистр после записи самого документа в БД. Если нам нужно что то подправить в запись набора, то можно воспользоваться обработчиком "ПередЗаписью", что мы дальше и сделаем. Например, облегчим заполнение движения пользователю, убрав поле Период. Для этого в форме в окне Элементы уберём это поле. Но это поле обязательно к заполнению и мы его будем заполнять в обработчике "ПередЗаписью" в модуле объекта. Поле Период скорее всего будет соответствовать дате документа, поэтому и заполним его датой.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ПередЗаписью<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> РежимЗаписи<span class="vue-r">,</span> РежимПроведения<span class="vue-r">)</span>
                <span class="vue-r">Для каждого</span> Движение <span class="vue-r">Из</span> Движения<span class="vue-r">.</span>БронированиеТоваров <span class="vue-r">Цикл</span>
                    Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;
                КонецЦикла;</span>
                
                <span class="vue-r">Если НЕ</span> ПометкаУдаления <span class="vue-r">=</span> Ссылка<span class="vue-r">.</span>ПометкаУдаления <span class="vue-r">Тогда</span>
                    Движения<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>Прочитать<span class="vue-r">();</span>
                    <span class="vue-r">Для каждого</span> Движение <span class="vue-r">Из</span> Движения<span class="vue-r">.</span>БронированиеТоваров <span class="vue-r">Цикл</span>
                        Движение<span class="vue-r">.</span>Активность <span class="vue-r">= НЕ</span> ПометкаУдаления<span class="vue-r">;</span>
                    <span class="vue-r">КонецЦикла;</span> 
                    Движения<span class="vue-r">.</span>БронированиеТоваров<span class="vue-r">.</span>Записать<span class="vue-r">();</span>
                <span class="vue-r">КонецЕсли;</span>
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document6">Практика. Контроль остатков и расчёт себестоимости по курсу Камкова. Есть пару объяснений про оперативное проведение. Блокировка таблицы.</b></p>
    <p>Продолжаем с теми же документами из видео Камкова. Видео 4.2. У нас есть документ "ПродажаТоваров", регистры накопления - "ОстаткиНоменклатуры", "Продажа", "Задолженности".</p>
    <p>Итак, в какой миг мы должны проверять остатки на складах? Сопобов написать код в разных местах много и он будет работать, но самым правильным способом является проверка при проведении документа. Код соответсенно пишется в модуле объетка документа в обработчике "ОбработкаПроведения". В этом обработчике перед движениями сделаем запрос в БД о том, достаочно ли у нас на складе товаров из таб. части документа "ПродажаТоваров", в контексте которого и находится этот обработчик. В запросе будем запрашивать НомерСтроки товара в таб.части, Количество(которое мы хотим продать), Номенклатуру, КоличествоОстаток и Сумму для вычисления себестоимости. НомерСтроки нужен для того, чтобы указать пользователю, на какой строке какого товара уже на складе не хватает.</p>
    <p>Камков Номер строки, Количество и Номенклатуру выбирает во временную таблицу из табличной части документа "ПродажаТоваров". Я же хочу попробовать то же самое выбрать из обычного регистра накопления "ОстаткиТоваров". В регистре или в таб. части документа пользователь может ввести несколько одинаковых товаров и нам в запросе нужно товары сгруппировать и просуммировать колличество, а вот как быть с полем НомерСтроки? Если мы это поле поместим вместе с товаром в группировку, то сгруппировать товары не получится, потому что все номера строк разные, а если применить к этому полю агрегатную функцию, то можно что то получить. Но какую функцию к ней применить? Предположим у нас есть 2 одинаковых товара, один на 1й строке, второй на 4й. Нам номера строк нужны для того, чтобы указать пользователю на какой строке у него недостающий товар. Если в результате проверок окажется, что этого товара не хватает на складе, то в принципе без разницы какой номер строки указать пользователю - 1й или 4й, давайте будем указывать нименьшую строку у одинаковых товаров, поэтому и применим функцию МИНИМУМ() к полю НомерСтроки.</p>
    <p>Далее во втором запросе пакета мы должны выбрать количество остаток и сумму остаток из виртуальной таблицы Остатки и номенклатуру, номер строки, количество из временной таблицы, соединяя эти 2 таблицы левым соединеним. Слева будет временная таблица, потому что в ней будут только те товары, которые есть в таб. части документа, а в виртуальной таблице Остатки будут все товары всех таб частей документов. Поначалу я в виртуальную таблицу встатвлял встроенный запрос, который возвращал номенклатуру из временной таблицы и выбиралась только та номенклатура, которая соответствует товарам из временной таблицы, но потом понял, что соединяя 2 таблицы - временную и виртуальную, из виртуальной сами выберутся только те товары, которые есть во временной таблице, потому что временная таблица слева. Хотя Камков использовал встроенный запрос. Как быстрее работает не знаю. Я тоже буду делать также.</p>
    <p>Также нам предстоит сравнивать количество продаваемых товаров с остатком товаров, но остатков может не быть на складе, значит вирт. таблица вернёт в этом поле NULL, сравнение с NULL недопустипо, поэтому сразу переводим NULL в 0 в запросе. Для поля СуммаОстаток точно также.</p>
    <p>ЗАМЕТКА! По базе Камкова я заметил, что он ещё дополнительно во временную таблицу отбирал только товары отсеивая услуги. Зачем вообще писать услуги в регистр ОстаткиНоменклатуры? Как услуги могут хранится на складе, чтобы у нихещё остатки подсчитывать? Мне вот это не понятно. А хотя он отсеивал услуги из табличной части документа. Но вроде в предыдущих видео мы услуги убрали отдельно в другую табличну часть. Видимо база уже немного другая. Но я не буду тут заморачиваться с услугами, она у меня в базе отдельно в другой таблице лежит, поэтому и в запросе её отсеивать не буду. Хотя нужно хорошо разобраться с этим вопросом.</p>
    <p>И ещё одна заметка! Я посмотрел в учебнике Хрусталёвой "Пособие ...", там тоже она выбирает во временную таблицу из табличной части документа продажи. Значит и я переделаю, почему не используют таблицу обычного регистра накопления ОстаткиТоваров нужно ещё узнать.</p>
    <p>Также мы устанавливаем в парамтерах Дату документа, на которую нужно получить остатки товаров. У меня такой вопрос. Зачем устанавливать дату, при проведении нам же нужны самые последние данные об остатках товара на складе? Но я так понимаю, что это нужно для того, чтобы перепроводить документа ранее уже проведённые. Иначе получится так, мы не устанавливаем дату и проводим документ, получаем последние данные об остатках и всё хорошо, проходит время и мы решаем что то в конфигурации изменить и нужно после изменений перепровести документы уже вчерашние, позавчерашине и т.д. И если не будет указана дата в параметрах, то все документы будут получать самые последние данные об остаках и во многих случится ошибка(которую мы возбуждаем в "обработкеПроведения" при контроле остатков), потому как на сегодня уже не будет тех товаров, которые были вчера, позавчера.</p>
    <p>Едем дальше. Мы получили от запроса какие то данные. Теперь в цикле нужно сделать сравнение количеств. Если продаваемого товара больше чем на складе, то выдаём сообщение.</p>
    <p>Отступление!!!Почему то пытался пользователю передать сообщение через класс СообщениеПользователю, но выдаёт ошибку, что "Значение не является значением объектного типа (Текст)". Фиг знает, что это значит, не нашёл решения. Используем обычный метод глобального контекста Сообщить(). Ошибку вроде нашёл, я использовал переменную Сообщение для того, чтобы поместить туда объект конструктора СообщениеПолюзователю, а эта переменная то ли занята кем то, то ли перебивается, фиг знает, короче переименовал её и вроде норм.</p>
    <p>Продолжаем. Если же количество меньше, то делаем запись в регистр ОстаткиНоменклатуры. Замечу, что мы сразу сгруппировали товары в запросе из таб. части документа, поэтому в регистр пишем уже сгруппированные, что уменьшает размер таблицы. Вот обработчик:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоваров"
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> Режим<span class="vue-r">)</span> 
                Движения<span class="vue-r">.</span>ОстаткиНоменклатуры<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>

                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	ПродажаТоваровТовары.Товар КАК Номенклатура,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВременнаяТаблица
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Документ
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВременнаяТаблица.Номенклатура КАК Номенклатура,
                    |	ВременнаяТаблица.НомерСтроки КАК НомерСтроки,
                    |	ВременнаяТаблица.Количество КАК Количество,
                    |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток
                    |ИЗ
                    |	ВременнаяТаблица КАК ВременнаяТаблица
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(
                    |				&Дата,
                    |				Склад = &Склад
                    |					И Номенклатура В
                    |						(ВЫБРАТЬ
                    |							ВременнаяТаблица.Номенклатура КАК Номенклатура
                    |						ИЗ
                    |							ВременнаяТаблица КАК ВременнаяТаблица)) КАК ОстаткиНоменклатурыОстатки
                    |		ПО (ОстаткиНоменклатурыОстатки.Номенклатура = ВременнаяТаблица.Номенклатура)"</span><span class="vue-r">;</span>

                <span class="vue-r">Если</span> Режим <span class="vue-r">=</span> РежимПроведенияДокумента<span class="vue-r">.</span>Неоперативный <span class="vue-r">Тогда</span>
                    Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Дата"</span><span class="vue-r">,</span> МоментВремени<span class="vue-r">());</span>
                <span class="vue-r">Иначе</span>
                    Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Дата"</span><span class="vue-r">,</span> <span class="vue-r">Неопределено;</span>	
                <span class="vue-r">КонецЕсли;</span>    
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Документ"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">,</span> Склад<span class="vue-r">);</span>
                
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                
                <span class="vue-g">//перебираем результат запроса и если есть товары, которых не хватает на складе, 
                //то они пропустяться, а те что есть, запишутся в регистр</span>
                <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                    <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>Количество <span class="vue-r">></span> Выборка<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">Тогда</span>
                        МоёСообщение <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                        МоёСообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не хватает товара "</span> 
                                            <span class="vue-r">+</span> Выборка<span class="vue-r">.</span>Номенклатура 
                                            <span class="vue-r">+</span> <span class="vue-bl">" в количестве "</span> 
                                            <span class="vue-r">+</span> <span class="vue-r">(</span>Выборка<span class="vue-r">.</span>Количество <span class="vue-r">-</span> Выборка<span class="vue-r">.</span>КоличествоОстаток<span class="vue-r">)</span> 
                                            <span class="vue-r">+</span> <span class="vue-bl">" в строке с номером "</span> 
                                            <span class="vue-r">+</span> Выборка<span class="vue-r">.</span>НомерСтроки<span class="vue-r">;</span>
                        МоёСообщение<span class="vue-r">.</span>Поле <span class="vue-r">=</span> <span class="vue-bl">"Товары["</span> <span class="vue-r">+ (</span>Выборка<span class="vue-r">.</span>НомерСтроки <span class="vue-r">-</span> 1<span class="vue-r">)</span> <span class="vue-r">+</span> <span class="vue-bl">"].Количество"</span><span class="vue-r">;</span> 
                        МоёСообщение<span class="vue-r">.</span>УстановитьДанные<span class="vue-r">(</span>ЭтотОбъект<span class="vue-r">);</span>
                        МоёСообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span>

                        <span class="vue-g">//если тут указать Отказ равно Истина, то ни один товар не проведётся, потому что при первом же
                        //отрицательном количестве сработает Отказ и документ не будет проводится
                        //А если убрать это присвоение, то проведутся только те товары, которые есть на складе
                        //вот и выбираем что нам нужно.</span>
                        Отказ <span class="vue-r">=</span> Истина;
                    <span class="vue-r">Иначе</span> 

                        <span class="vue-g">// регистр ОстаткиНоменклатуры Расход</span>
                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиНоменклатуры<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
            
                        <span class="vue-g">//тут мы расчитываем себестоимость товара и умножаем его на количество, которое хотим продать</span>
                        Движение<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>СуммаОстаток <span class="vue-r">/</span> Выборка<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">*</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;	</span>
                    <span class="vue-r">КонецЕсли;</span>	
                <span class="vue-r">КонецЦикла;</span>	
            КонецПроцедуры</span>
        </pre>
    </div>
    <p><span class="vue-r">Заметка!</span> Нужно подправить одну мелочь. Мы в параметрах для запроса установили Дату как МоментВремени(), это метод объекта документа. Этот метод передаёт дату в запрос не просто как дата и время, но и позиция документа в очерёдности. Теперь если мы когда то провели документ, то при перепроведении его не возникнет проблем, документ запросом получит остатки товара на то время, когда проводился документ(в этом помогает метод МоментВремени()). Но если мы провели документ сегодня и товара хватало и потом позже, например, через час попытаемся его перепровести и товара уже не хватает, то документ не проведётся, потому что срабатывает оперативное проведение и в течении суток, время автоматом подгоняется под текущее. Т.е. если мы провели документ сегодня в 12.05.2023 12:00:00 и товара хватало на это время, то при попытке перепровести через час время подгонится так 12.05.2023 13:00:00 и на час дня уже нет товара, то документ не проведётся из-за нехватки товара. Мы бы хотели чтобы он перепроводился в течении суток без проблем, пусть время само подгоняется, но не вызывало бы ошибки. Ведь мы проводим один и тот же документ и значит он должен списывать один раз тот товар, который мы продаём, а сейчас получается, что при перепроводке одного и того же документа мы списываем из регистра каждый раз при каждой перепроводке, а так не нужно. Решить можно и программно и настройкой в конфигурации. В конфе откроем документ и его вкладку Движения, там вверху 3е поле "Удаление движений", в нём надо выбрать "Удалять автоматически". Пргораммное же решение в том, что в обработчик выше надо добавить 2 строки в начале процедуры:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Движения<span class="vue-r">.</span>ОстаткиНоменклатуры<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>
            Движения<span class="vue-r">.</span>ОстаткиНоменклатуры<span class="vue-r">.</span>Записать<span class="vue-r">();</span></span>
        </pre>
    </div>
    <p>Т.е. мы перед записью в регистр очищаем все записи сделанные этим документом и изменения записываем в БД. Что в итоге. Получается мы создали один документ и теперь можно хоть до упада перепроводить его сегодня, без разницы, он будет только один раз списывать товары. Ещё раз напомню, это касается документов, которые мы пытаемся перепроводить на текущий день, потому что оперативное проведение подрубается и меняет время под текущее.</p>
    <p><span class="vue-r">Ещё одно замечание!</span> Если у нас в настройках разрешено проведение документов оперативно, то на текущий день последний оперативно проводимый документ на оси времени смещается на самую границу этой оси, т.е. становится самым последним по времени. Например, мы за сегодня провели несколько документов, без разницы в какое время мы их провели, любой из них который мы проведём ещё раз станец последним. И тут есть одна штука,  в обработчике который выше, мы передаём параметр Дата со значением МоментВремени(). Так вот нет смысла указывать дату для оперативно проведённого документа, потому то дата будет показывать вот прям последнюю текущую секунду, без указания даты виртуальная таблица ОстаткиНоменклатуры.Остатки автоматом нам даст данные на это же время. Ведь известно, если не указать в параметрах дату, то вернутся самые последние данные. Так в чём тогда прикол, не передавать дату? Ну передал её или не передал какая разница, всё равно вернутся самые последние данные, но разница есть в производительности. Системе проще вернуть последние данные без указания от нас даты. Поэтому в обработчике выше сделаем проверку на оперативный режим.</p>
    <p><span class="vue-b">Про блокировку таблицы</span></p>
    <p>В обработчике "ОбработкаПроведения" мы ещё не сделали функционал блокирования таблицы БД, допишем его. Создаётся объект от класса БлокировкаДанных, который может блокировать одну или несколько таблиц в БД. Вызываем метод Добавить() у этого объекта и передаём ему имя таблицы, которую надо заблокировать. Этот метод вернёт тип ЭлементБлокировки, у которого есть свойство Режим. Для этого свойства нужно указать каой режим мы будем использовать. Для указания режима используем системеное перечисление РежимБлокировкиДанных с 2мя значениями - Исключительны и Разделяемый. Эти 2 режима нам говорят о том, как мы хотим заблокировать таблицу. Исключительный блокирует и чтение и запись данных. Нам нужно, чтобы другие пользователи не могли ни прочитать, ни записать данные, пока мы проводим документ, а Разделяемый запрещает писать в регистр, но читать можно. Ну и далее вызываем метод Заблокировать().</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Блокировка <span class="vue-r">= Новый</span> БлокировкаДанных<span class="vue-r">;</span>
            ЭлементБлокировки <span class="vue-r">=</span> Блокировка<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"РегистрНакопления.ОстаткиНоменклатуры"</span><span class="vue-r">);</span>
            ЭлементБлокировки<span class="vue-r">.</span>Режим <span class="vue-r">=</span> РежимБлокировкиДанных<span class="vue-r">.</span>Исключительный<span class="vue-r">;</span>
            Блокировка<span class="vue-r">.</span>Заблокировать<span class="vue-r">();</span></span>
        </pre>
    </div>
    <p>Но у механизма блокирования, который мы описали есть недостатки. Мы блокируем полностью всю таблицу и, например, мы продаём яблоки, а другой пользователь в это же время пытается продать груши, но он не сможет, хотя вроде мы продаём разные продукты, потому что заблокирована вся общая таблица с остатками продуктов. Чтобы исправить механизм нужно блокировать не всю таблицу, а только те записи с продуктами в регистре, остатки которых мы запрашиваем. Для этого перед методом Заблокировать() мы выгрузим из табличной части колонку, в которой указаны ссылки на товар. У меня эта колонка называется "Товар". Метод Выгрузить() у табличной части возвращает ТаблицуЗначений. Но нам мало только указать товары, ещё нужно указать и склад, а для этого мы в таблицу значений добавим новую колонку "Склад". И заполним значения этой колонки с помощью метода ЗаполнитьЗначения().</p>
    <p>Теперь у нас есть таблица значений, в которой у нас есть пара: Номенклатура, Склад, по соответствующим измерениям мы будем блокировать записи в регистре. Далее нужно указать эту таблицу элементу блокировки. И сказать какие поля из таблицы значений соответствуют измерениям, 1й параметр измерение, 2й имя колонки из таблицы. </p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Блокировка <span class="vue-r">= Новый</span> БлокировкаДанных<span class="vue-r">;</span>

            ЭлементБлокировки <span class="vue-r">=</span> Блокировка<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"РегистрНакопления.ОстаткиНоменклатуры"</span><span class="vue-r">);</span>
            ЭлементБлокировки<span class="vue-r">.</span>Режим <span class="vue-r">=</span> РежимБлокировкиДанных<span class="vue-r">.</span>Исключительный<span class="vue-r">;</span>

            <span class="vue-g">//создаём таблицу значений пучём выгрузки из таб. части</span>
            ДанныеБлокировки <span class="vue-r">=</span> Товары<span class="vue-r">.</span>Выгрузить<span class="vue-r">(,</span> <span class="vue-bl">"Товар"</span><span class="vue-r">);</span>
            ДанныеБлокировки<span class="vue-r">.</span>Колонки<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">);</span>
            ДанныеБлокировки<span class="vue-r">.</span>ЗаполнитьЗначения<span class="vue-r">(</span>Склад<span class="vue-r">,</span> <span class="vue-bl">"Склад"</span><span class="vue-r">);</span> 
            
            <span class="vue-g">//задаём для элемента блокировки откуда ему брать данные для блокирования записей
            //в измерения Номенклатура и Склад подставляются значения из колонок Товары и Склад
            //и по этим значениям блокируются записи. Например, товар "Груши", склад "Основной"
            //значит нужно найти в регистре запись в измерениях Номенклатура и Склад которого есть "Груши" и "Основной"
            //и заблокировать её </span>
            ЭлементБлокировки<span class="vue-r">.</span>ИсточникДанных <span class="vue-r">=</span> ДанныеБлокировки<span class="vue-r">;</span>
            ЭлементБлокировки<span class="vue-r">.</span>ИспользоватьИзИсточникаДанных<span class="vue-r">(</span><span class="vue-bl">"Номенклатура"</span><span class="vue-r">,</span> <span class="vue-bl">"Товар"</span><span class="vue-r">);</span>
            ЭлементБлокировки<span class="vue-r">.</span>ИспользоватьИзИсточникаДанных<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">,</span> <span class="vue-bl">"Склад"</span><span class="vue-r">);</span>

            Блокировка<span class="vue-r">.</span>Заблокировать<span class="vue-r">();</span></span>
        </pre>
    </div>
    <p><span class="vue-r">Змечание!</span> В файловом варианте организации БД несмотря на то, что мы описали, всё равно заблокируется вся таблица целиков. Отдельные записи мы можем заблокировать только при наличии сервера.</p>
    <p><span class="vue-b">Проблема образования отрицательного остатка при изменении количества товара в документе "ПоступлениеТоваров" и проведении его задним числом.</span></p>
    <p>Мы вроде бы уже сделали контроль остатков при проведении документа "ПродажаТоваров", но бывает, что пользователи изменяют задним числом и документы "ПоступлениеТоваров". И если мы изменим количество и проведём документ "ПоступлениеТоваров", то наш контроль остатков не отработает как надо и мы можем увидеть отрицательный остаток в отчёте.</p>

    <p class="title-size16"><b id="document7">Контроль остатков(количества и суммы) по курсу Камкова в документе "ПоступлениеТоваров". Объект "Последовательности".</b></p>
    <p>Решаем проблему остатка количеств а и суммы товаров с другой стороны. Мы решили задачу по остаткам при проведении документа "ПродажаТоваров", но пользователь может изменить количествоили сумму товаров в документе "ПоступлениеТоваров" и провести. Если потом посмотреть в отчёте остатки, то можно увидеть отрицаетльные остатки, потому что этот механизм никак не проверяется. Вот и будем его делать. Кстати пользователь может уменьшить не только количество, но и сумму и потом в остатках если с количеством может быть всё в порядке, то сумма может быть в минусе. Поэтому нужно править и то и то.</p>
    <p>Как решить такую проблему? Можно запретить проводить задним числом этот вид документа, но это врятли остановит пользователя, обычно находят как это сделать. А если пользователь изменит цену поступившего товара, а в документах "ПродажаТоваров" мы уже расчитали по другой цене и провели ранее? Ведь если изменить цену, то нужно и перепроводить все документы "ПродажаТоваров". Решением с ценой так и будет перепроводка всех документов "ПродажаТоваров". НО перепроводить все документы продажи может быть долго. Поэтому надо сделать механизм, который будет отслеживать у какого товара при поступлении мы изменили цену и перепровести продажные документы начиная с того, где встретился этот товар, т.е. не все документы, а начиная с какого то и до конца на оси  времени. Такой механизм уже есть в системе. Называется этот механизм "Последовательности", находится внутри объекта конфигурации Документы.</p>
    <p>Создадим новый объект Последовательности и назовём его "Товарная". Есть важная закладка Использование. В окне "Входящие документы" этой закладки мы отмечаем те документы, которые нужно перепроводить, если сбивается последовательность. Выбираем Документ.ПродажаТоваров. Сбитие последовательности в нашем случае это изменение цены задним число в "ПоступлениеТоваров". А что влияет на границы этой последовательности? Ниже окошко с названием - "Движения, влияющие на последовательность". В этом окошке нужно отметить регистр накопления ОстаткиНоменклатуры, который влияет на границы последовательности. Тут же выберем и регистр накопления "БронированиеТоваров", он тоже влияет, хотя как он влияет пока не совсем понятно. В принципе всё, мы указали какие документы перепроводить и что влияет на их перепровождение. Сохраняем, проверяем.</p>
    <img src="../img/1С-1/2023-05-20_17-47-11.png" class="screen" alt="">
    <p>Как теперь увидеть её работу? Последовательность в интерфейсе отображаться не будет, хотя мы её и добавили в подсистему Прочее. В БД последовательность хранит данные в 2х таблицах. Покажем эти 2 таблицы с польледовательностью и её границами на начальной странице. Чтобы показать что то на начальной странице нужна форма, а формы у объекта последовательности нет, значит обратимся к общим формам. Идём в общие формы и добавляем новую форму с типом Произвольная форма, назовём её "ФормаПоследовательности" и жмём Готово. Появится пустая форма, командную панель можно скрыть убрав галочку в свойствах у свойства Автозаполнение.</p>
    <p>Теперь нужно как то показать список какой то таблицы из базы. Создаём реквизит формы и даём ему тип "Динамический список", так как таблицы 2, значит и будем выводить 2 списка. Первый реквизит назовём "ТаблицаПоследовательности". Чтоб будем выводить в него? Как мы помним есть закладка Объект со свойством Основная таблица и если посмотреть список таблиц в нём, то не найдём там таблицы с последовательностью. Поэтому нам остаётся написать произвольный запрос поставив галочку выше в одноимённом свойстве. Появится ссылка Открыть, жмём на неё, откроется редактор составления запроса для динамического списка. В редакторе жмём на Конструктор запроса и в нём мы видим объект Последовательности, в котором 2 таблицы: Товарная и Товарная.Границы. Сначала выбираем таблицу Товарная и все её поля, а это Регистратор и Период и жмём принять. Перетаскиваем на форму этот список. Теперь создаём 2й реквизит с именем "ТаблицаГраницыПоследовательности" с типом Динамический список. Также пишем произвольный запрос, выбирая в запросе таблицу Товарная.Граница со всеми её полями, поля там с такими же названиями, но это совершенно другая таблица, принимаем и также перетаскиваем на форму.</p>
    <p>Теперь идём в настройки начальной страницы и отображаем там ФормуПоследовательности. В пользовательской части видим 2 этих списка, пока они пусты, но есть проблемы свысотой, потому что приходится прокручивать. Идём в форму и в Элементах выделяем эти реквизиты и укажем в свойствах высоту, например, 7. Можно было бы конечно создать для каждой таблицы по одной формы, тогда они сами бы высоту приняли, но у нас пусть будет в одной форме.</p>
    <p>Чтобы в таблице последовательности что то появилось, нужно провести все документы поступления и продажи. После проведения обновляем и там появятся все документы продажи товаров, как мы и указали в конфигураторе. После обновления в таблице граница последовательности увидим самый последний проведённый документ продажи. Теперь если изменить сумму в любом документе поступления у товара, то при обновлении таблицы границы последовательности, мы увидим в её списке этот проведённый документ поступления в качестве границы. Т.е нам система теперь показывает, что если проводить все документы, то начинать нужно вот с этого документа поступления товаров. И теперь если зайти в системную обработку ПроведениеДокументов, то там есть закладка "Восстановление последовательностей", она становится доступной, когда мы создали последовательность и перепровели первый раз документы. в окне указана последовательность, которую мы создали в конфе, выше есть кнопка "Восстановить", по нажатию на которую документы перепроведутся начиная с документа поступления, в котором мы изменили цену и после проведения в качестве границы опять установится самый последний документ продажи.</p>
    <p>Как я понял, на начальной странице нет смысла отображать эти 2 таблицы последовательности, они не несут никакой информации. Просто если где то изменили цену в поступлении, то открываем системную обработку по проведению документов и там проводим их в закладке "Восстановление последовательностей". И ещё, мы вроде бы посмотрели этот механизм, который перепроводит документы при изменении цены, а как быть с изменением количества? Или количество не трогают? Или этот механизм работает и для изменения количества? Чёт сомневаюсь. Ведь если изменить количество где то в постеплении товаров задним число, то при перепроведении где то там продажный документ не запишет в регистр продаваемый товар, потому что уже не хватает его на складе, а товар как бы уже продан по факту, но в отчёт уже не попадёт. Я так понимаю пользователи не меняю количество задним числом, цену меняют, а количество нет. Пока не понятно. Узнаю, распишу.</p>

    <p class="title-size16"><b id="document8">"Дополнительные свойства" документа</b></p>
    <p>Пишу это из телеграмма одного программиста 1с.</p>
    <p>У некоторых объектов конфигурации есть полезная структура «Дополнительные свойства», которая позволяет хранить значения, связанные с объектом, но не изменяющие объект. В синтаксис-помощнике приводится пример использования этой структуры в подписке на событие. Но в своей задаче я воспользовался данной структурой, чтобы обойти определенные проверки при записи документа. Требовалось при создании документа «Поступления товаров и услуг» не выполнять заполнение собственных реквизитов, если документ создается автоматически специальной обработкой.</p>
    <p>Про «Дополнительные свойства» узнал из вопросов на собеседовании, как ответ на вопрос «как передать значение из события документа «ПередЗаписью» в «ПриЗаписи».</p>
    <div class="code-style">
        <pre>
            Процедура СоздадтьДокументы()
                //...
                НовыйДокумент = Документы.ПоступлениеТоваров.СоздатьДокумент();
                //...
                НовыйДокумент.ДополнительныеСвойства.Вставить("ПропуститьПроверки", Истина);
                НовыйДокумент.Записать();
                //...
            КонецПроцедуры
        </pre>
    </div>

    <p class="title-size16"><b id="document9">Продажа товара и списание себестоимости методом ФИФО и ЛИФО</b></p>
    <p>Видео Камкова 4.2, начиная с 01:52:10</p>
    <p>У вычисления себестоимости по средней есть небольшие косяки связанные с остатками маленьких хвостиков, например, -0,01 может остаться в отчёте. Всё из за того, что могут быть не целые числа и округления этих чисел могут нарушить остаток и не выйти в ноль. Это так, маленькое отступление.</p>
    <p>Иногда специалисты учётные просят применять другую систему вычисления себестоимости товара при продаже. Сейчас мы высчитываем среднюю и по ней списываем. Но есть способы ФИФО(First In First Out - первый вошел, первый вышел) и ЛИФО(Last In First Out - последний вошел, первый вышел). ФИФО это когда мы продаём товары по той цене, по которой товар пришёл на склад самый первый и потом в порядке их прибытия также и продаём. ЛИФО это когда наоборот мы первый товар продаём по цене последнего прибывшего соответствующего товара на склад и в порядке от конца до начала продаём.</p>
    <p>Разберёмся с ФИФО. Введём в регистр накопления ОстаткиНоменклатуры новое измерение Партия. Такой учёт принято называть <i>партионным</i>. Тип данных измерения Пария будет ДокументСсылка.ПоступлениеТоваров. Это значит нам нужно открыть модуль объекта документа ПоступлениеТоваров и в обработчике "ОбработкаПроведения" дописать в движение данного регистра новое поле Партия и присвоить ему текущий документ поступления:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><b>Движение<span class="vue-r">.</span>Партия <span class="vue-r">=</span> Ссылка<span class="vue-r">;</span></b></span>
        </pre>
    </div>
    <p>Т.е. мы в этом поле Партия указываем какой документ зафиксировал приходование пачки товара(партию).</p>
    <p><span class="vue-r">Кстати заметка для себя! Раньше часто не хватало поле Регистратор в виртуальной таблице Остатки, вот одно  из решений, мы добавили поле Партия и теперь при перепроведении всех документов поступления товаров это поле заполнится этим документом и для каждого прихода товаров будет свой документ поступления. Чем не поле Регистратор.</span></p>
    <p>Итак перепроведём все документы "ПоступленияТоваров". Поле Партия заполнится этим документом. Если раньше виртуальная таблица Остатки группировала товары и не было понятно когда какой товар поступал, то с введением нового поля Партия появятся одинаковые товары но в разрезе разных документов вида поступления. Видны партии поступления товаров в какой то период.</p>
    <p>Далее нужно как то переписать запрос в обработчике "ОбработкаПроведения". Предыдущий запрос описан выше в статье про контроль остатков и списание себестоимости по средней. Что нужно изменить в этом запросе? Добавим выборку поля Партия и седлаем итоги по номенклатуре:</p>
    <div class="code-style">
        <pre>
            Запрос.Текст = 
                "ВЫБРАТЬ
                |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                |	ПродажаТоваровТовары.Товар КАК Номенклатура,
                |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество
                |ПОМЕСТИТЬ ВременнаяТаблица
                |ИЗ
                |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                |ГДЕ
                |	ПродажаТоваровТовары.Ссылка = &Документ
                |
                |СГРУППИРОВАТЬ ПО
                |	ПродажаТоваровТовары.Товар
                |;
                |
                |////////////////////////////////////////////////////////////////////////////////
                |ВЫБРАТЬ
                |	ВременнаяТаблица.Номенклатура КАК Номенклатура,
                |	ВременнаяТаблица.НомерСтроки КАК НомерСтроки,
                |	ВременнаяТаблица.Количество КАК Количество,
                |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                |	ЕСТЬNULL(ОстаткиНоменклатурыОстатки.СуммаОстаток, 0) КАК СуммаОстаток,
                |	ОстаткиНоменклатурыОстатки.Партия КАК Партия    <span class="vue-g"><b>//добавили вот эту строку</b></span>
                |ИЗ
                |	ВременнаяТаблица КАК ВременнаяТаблица
                |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиНоменклатуры.Остатки(
                |				&Дата,
                |				Склад = &Склад
                |					И Номенклатура В
                |						(ВЫБРАТЬ
                |							ВременнаяТаблица.Номенклатура КАК Номенклатура
                |						ИЗ
                |							ВременнаяТаблица КАК ВременнаяТаблица)) КАК ОстаткиНоменклатурыОстатки
                |		ПО (ОстаткиНоменклатурыОстатки.Номенклатура = ВременнаяТаблица.Номенклатура)
                |
                |УПОРЯДОЧИТЬ ПО
                |	ОстаткиНоменклатурыОстатки.Партия.МоментВремени
                |ИТОГИ           <span class="vue-g"><b>//и добавили итоги по номенклатуре</b></span>
                |	МАКСИМУМ(НомерСтроки),
                |	МАКСИМУМ(Количество),
                |	СУММА(КоличествоОстаток)
                |ПО
                |	Номенклатура";
        </pre>
    </div>
    <p>Если провести первый документ продажи, то запрос вернёт такой ответ:</p>
    <img src="../img/1С-1/2023-05-23_17-26-22.png" class="screen" alt="">
    <p>Из этой таблицы нам нужны строки только итоговые, поэтому в метод Выбрать() нужно передать занчение системеного перечисления ОбходРезультатаЗапроса.ПоГруппировкам. Пока остановился на этом месте. время 02:20:00</p>

    <p class="title-size16"><b id="document10">Способ, как не добавляя реквизит "СуммаДокумента" в форму документа, видеть это поле с подсчётами в форме списка документа</b></p>
    <p>Описывать детально не буду, просто мне понравился сам подход, как такое можно делать и не только с суммой, но и с любым полем, если не нужно добавлять это поле в таблицу в БД.</p>
    <p>Суть в следующем. Создаём свою форму списка документа, потом в этой форме для его основного реквизита "Список" настраиваем прозвольный запрос, который нам будет выводить данные в список. В этом запросе нам надо как то добавить дополнительное поле "СуммаДокумента". Делаем запрос с выборкой из таб. части документа все ссылки и сумму(этому полю дадим псевдоним "СуммаДокумента"), затем группируем записи и помещаем во временную таблицу, потом в основном запросе через левое соединение присоединяем эту временную таблицу по полю Ссылка. А можно не через временную таблицу, а через вложенный запрос, вложенный запрос также вернёт таблицу с группированными товарами, присоединяем эту таблицу к основной таблице документа. Всё, осталось в редакторе формы вынести поле "СуммаДокумента" влево в элементы формы.</p>
    <p>Это трудозатратно для системы, но зато мы не добавляем лишнее поле в таблицу в БД. Что выгоднее пока не знаю.</p>
    <p>Запрос с временной таблицей:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ПоступлениеТоваровТовары</span><span class="vue-r">.</span>Ссылка <span class="vue-r">КАК</span> Ссылка<span class="vue-r">,</span>
                <span class="vue-r">СУММА(</span><span class="vue-g">ПоступлениеТоваровТовары</span><span class="vue-r">.</span>Сумма<span class="vue-r">) КАК</span> СуммаДокумента
            <span class="vue-r">ПОМЕСТИТЬ</span> <span class="vue-g">ВТ</span>
            <span class="vue-r">ИЗ</span>
                Документ<span class="vue-r">.</span>ПоступлениеТоваров<span class="vue-r">.</span>Товары <span class="vue-r">КАК</span> <span class="vue-g">ПоступлениеТоваровТовары</span>

            <span class="vue-r">СГРУППИРОВАТЬ ПО</span>
                <span class="vue-g">ПоступлениеТоваровТовары</span><span class="vue-r">.</span>Ссылка
            <span class="vue-r">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Ссылка <span class="vue-r">КАК</span> Ссылка<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>ПометкаУдаления <span class="vue-r">КАК</span> ПометкаУдаления<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Номер <span class="vue-r">КАК</span> Номер<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Дата <span class="vue-r">КАК</span> Дата<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Проведен <span class="vue-r">КАК</span> Проведен<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Контрагент <span class="vue-r">КАК</span> Контрагент<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>ДоговорКонтрагента <span class="vue-r">КАК</span> ДоговорКонтрагента<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Товары<span class="vue-r">.(</span>
                    Ссылка <span class="vue-r">КАК</span> Ссылка<span class="vue-r">,</span>
                    НомерСтроки <span class="vue-r">КАК</span> НомерСтроки<span class="vue-r">,</span>
                    Номенклатура <span class="vue-r">КАК</span> Номенклатура<span class="vue-r">,</span>
                    Цена <span class="vue-r">КАК</span> Цена<span class="vue-r">,</span>
                    Количество <span class="vue-r">КАК</span> Количество<span class="vue-r">,</span>
                    Сумма <span class="vue-r">КАК</span> Сумма
                <span class="vue-r">) КАК</span> Товары<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>МоментВремени <span class="vue-r">КАК</span> МоментВремени<span class="vue-r">,</span>
                <span class="vue-g">ВТ</span><span class="vue-r">.</span>СуммаДокумента <span class="vue-r">КАК</span> СуммаДокумента
            <span class="vue-r">ИЗ</span>
                Документ<span class="vue-r">.</span>ПоступлениеТоваров <span class="vue-r">КАК</span> <span class="vue-g">ДокументПоступлениеТоваров</span>
                    <span class="vue-r">ЛЕВОЕ СОЕДИНЕНИЕ</span> ВТ <span class="vue-r">КАК</span> <span class="vue-g">ВТ</span>
                    <span class="vue-r">ПО</span> <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Ссылка <span class="vue-r">=</span> <span class="vue-g">ВТ</span><span class="vue-r">.</span>Ссылка</span>
        </pre>
    </div>
    <p>Запрос с вложенной таблицей:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Ссылка <span class="vue-r">КАК</span> Ссылка<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>ПометкаУдаления <span class="vue-r">КАК</span> ПометкаУдаления<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Номер <span class="vue-r">КАК</span> Номер<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Дата <span class="vue-r">КАК</span> Дата<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Проведен <span class="vue-r">КАК</span> Проведен<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Контрагент <span class="vue-r">КАК</span> Контрагент<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>ДоговорКонтрагента <span class="vue-r">КАК</span> ДоговорКонтрагента<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Товары<span class="vue-r">.(</span>
                    Ссылка <span class="vue-r">КАК</span> Ссылка<span class="vue-r">,</span>
                    НомерСтроки <span class="vue-r">КАК</span> НомерСтроки<span class="vue-r">,</span>
                    Номенклатура <span class="vue-r">КАК</span> Номенклатура<span class="vue-r">,</span>
                    Цена <span class="vue-r">КАК</span> Цена<span class="vue-r">,</span>
                    Количество <span class="vue-r">КАК</span> Количество<span class="vue-r">,</span>
                    Сумма <span class="vue-r">КАК</span> Сумма
                <span class="vue-r">) КАК</span> Товары<span class="vue-r">,</span>
                <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>МоментВремени <span class="vue-r">КАК</span> МоментВремени<span class="vue-r">,</span>
                <span class="vue-g">ВЗ</span><span class="vue-r">.</span>СуммаДокумента <span class="vue-r">КАК</span> СуммаДокумента
            <span class="vue-r">ИЗ</span>
                Документ<span class="vue-r">.</span>ПоступлениеТоваров <span class="vue-r">КАК</span> <span class="vue-g">ДокументПоступлениеТоваров</span>
                    <span class="vue-r">ЛЕВОЕ СОЕДИНЕНИЕ</span> (
                        <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                            <span class="vue-g">ПоступлениеТоваровТовары</span><span class="vue-r">.</span>Ссылка <span class="vue-r">КАК</span> Ссылка<span class="vue-r">,</span>
                            <span class="vue-r">СУММА(</span><span class="vue-g">ПоступлениеТоваровТовары</span><span class="vue-r">.</span>Сумма<span class="vue-r">) КАК</span> СуммаДокумента
                        <span class="vue-r">ИЗ</span>
                            Документ<span class="vue-r">.</span>ПоступлениеТоваров<span class="vue-r">.</span>Товары <span class="vue-r">КАК</span> <span class="vue-g">ПоступлениеТоваровТовары</span>
                        ) <span class="vue-r">КАК</span> <span class="vue-g">ВЗ</span>
                    <span class="vue-r">ПО</span> <span class="vue-g">ДокументПоступлениеТоваров</span><span class="vue-r">.</span>Ссылка <span class="vue-r">=</span> <span class="vue-g">ВЗ</span><span class="vue-r">.</span>Ссылка</span>
        </pre>
    </div>

    <p class="title-size16"><b id="document11">При выборе товара в таб. части документа открывается форма выбора справочника. Нужно чтобы в этой форме было доп. поле с остатками товаров.</b></p>
    <p>Пример похож на предыдущий, потому что придётся также использовать произвольный запрос к динамическому списку.</p>
    <p>Когда мы в таб. части документа выбираем товар, то открывается форма выбора справочника Номенклатура, если мы хотим что то добавить своё в эту форму, значит нам надо создать свою форму выбора у этого справочника. Создаём, у этой формы основным реквизитом яаляется динамический список "Список", также как и в предыдущем примере настраиваем произвольный запрос на вкладке "Объект" в палитре свойств. В запросе можно на выбор использовать либо временную таблицу, либо вложенную. Я буду писать с временной таблицей. В запросе нам нужно к основной таблице справочника Номенклатура присоединить временную таблицу с остатками товаров. Вот такой запрос получился:</p>
    <p>Мы не будем создавать реквизит "ОстаткиТоваров" для этой формы, мы добавим поле в динамический список в запросе, всё как в прошлом примере. Если сравнить, то наше поле "ОстатокТоваров" это виртуальное поле, которое мы на лету создаём и заполняем.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ОстаткиТоваровОстатки</span><span class="vue-r">.</span>Номенклатура <span class="vue-r">КАК</span> Номенклатура<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиТоваровОстатки</span><span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">КАК</span> ОстатокТовара
            <span class="vue-r">ПОМЕСТИТЬ</span> <span class="vue-g">ВТ</span>
            <span class="vue-r">ИЗ</span>
                РегистрНакопления<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Остатки <span class="vue-r">КАК</span> <span class="vue-g">ОстаткиТоваровОстатки</span>
            <span class="vue-r">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Ссылка <span class="vue-r">КАК</span> Ссылка<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>ПометкаУдаления <span class="vue-r">КАК</span> ПометкаУдаления<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Родитель <span class="vue-r">КАК</span> Родитель<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>ЭтоГруппа <span class="vue-r">КАК</span> ЭтоГруппа<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Код <span class="vue-r">КАК</span> Код<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Наименование <span class="vue-r">КАК</span> Наименование<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>СтавкаНДС <span class="vue-r">КАК</span> СтавкаНДС<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Весовой <span class="vue-r">КАК</span> Весовой<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Качество <span class="vue-r">КАК</span> Качество<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>ПроисхождениеНоменклатуры <span class="vue-r">КАК</span> ПроисхождениеНоменклатуры<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Услуга <span class="vue-r">КАК</span> Услуга<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>ЕдИзм <span class="vue-r">КАК</span> ЕдИзм<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>ЦенаТовара <span class="vue-r">КАК</span> ЦенаТовара<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Предопределенный <span class="vue-r">КАК</span> Предопределенный<span class="vue-r">,</span>
                <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>ИмяПредопределенныхДанных <span class="vue-r">КАК</span> ИмяПредопределенныхДанных<span class="vue-r">,</span>
                <span class="vue-g">ВТ<span class="vue-r"></span>.</span>ОстатокТовара <span class="vue-r">КАК</span> ОстатокТовара
            <span class="vue-r">ИЗ</span>
                Справочник<span class="vue-r">.</span>Номенклатура <span class="vue-r">КАК</span> <span class="vue-g">СправочникНоменклатура</span>
                    <span class="vue-r">ЛЕВОЕ СОЕДИНЕНИЕ</span> <span class="vue-g">ВТ</span> <span class="vue-r">КАК</span> <span class="vue-g">ВТ</span>
                    <span class="vue-r">ПО</span> <span class="vue-g">ВТ</span><span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> <span class="vue-g">СправочникНоменклатура</span><span class="vue-r">.</span>Ссылка</span>
        </pre>
    </div>

    <p class="title-size16"><b id="document12">Дополнение к предыдущей записи про форму выбора. Нужно передать параметр в форму выбора справочника в запрос для динамического списка. Свойство <b>"Связи параметров выбора"</b>, свойство <b>"Параметры"</b> у формы.</b></p>
    <p>Обстановка та же что и в предыдущей записи. Мы в произвольном запросе соединяли с основной таблицей Номенклатура таблицу остатков, в эту таблицу остатков мы можем передать параметр &ДатаДокумента. Как это сделать? Идём в документ и далее к реквизиту Товар таб. части Товары. Для этого реквизита в палитре свойств найдём знакомое нам свойство "Связи параметров выбора". Откроем его и в окне слева выберем доступный нам реквизит Дата, перенесём его вправо и в колонке Имя зададим имя какой нам хочется, назовём его МояДата.</p>
    <p>Когда мы нажимаем на кнопку "Показать все" в подсказке у реквизита Товар, то система программно открывает форму выбора справочника, видимо она считывает значение свойства "Связи параметров выбора", формирует параметр из того, что мы указали и даёт сигнал на сервер с командой создать такую форму и передать ей вот эти параметры. Параметры попадают в свойство "Параметры" для создаваемой формы выбора. Теперь идём в форму выбора справочника Номенклатура и у ней есть событие "ПриСозданииНаСервере". Это событие сработает когда форма собирается на сервере. В обработчике этого события мы можем поймать этот переданный параметр. У формы есть свойство Параметры, куда помещаются все переданные ей параметры, получим оттуда наш параметр:</p>
    <div class="code-style">
        <pre>
            --модуль формы выбора справочника Номенклатура
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                Дата <span class="vue-r">=</span> Параметры<span class="vue-r">.</span>МояДата<span class="vue-r">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>В свойстве формы Параметры есть свои стандартные параметры и те, которые передаём мы. Но мы можем и не передать параметр, тогда будет ошибка при попытке его получения, сделаем проверку:</p>
    <div class="code-style">
        <pre>
            --модуль формы выбора справочника Номенклатура
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-r">Если</span> Параметры<span class="vue-r">.</span>Свойство<span class="vue-r">(</span><span class="vue-bl">"МояДата"</span><span class="vue-r">) =</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-g">//установим дату никакую</span>
                    Дата <span class="vue-r">=</span> <span class="vue-or">'00010101'</span><span class="vue-r">;</span>
                <span class="vue-r">Иначе</span>
                    Дата <span class="vue-r">=</span> Параметры<span class="vue-r">.</span>МояДата<span class="vue-r">;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Итак, параметр мы поймали, теперь его надо передать как то в динамический список "Список". У динамического списка тоже есть свойство Параметры, у этого свойства есть метод УстановитьЗначениеПраметра():</p>
    <div class="code-style">
        <pre>
            --модуль формы выбора справочника Номенклатура
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-r">Если</span> Параметры<span class="vue-r">.</span>Свойство<span class="vue-r">(</span><span class="vue-bl">"МояДата"</span><span class="vue-r">) =</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-g">//установим дату никакую</span>
                    Дата <span class="vue-r">=</span> <span class="vue-or">'00010101'</span><span class="vue-r">;</span>
                <span class="vue-r">Иначе</span>
                    Дата <span class="vue-r">=</span> Параметры<span class="vue-r">.</span>МояДата<span class="vue-r">;
                КонецЕсли;</span>

                Список<span class="vue-r">.</span>Параметры<span class="vue-r">.</span>УстановитьЗначениеПраметра<span class="vue-r">(</span><span class="vue-bl">"ДатаДокумента"</span><span class="vue-r">,</span> Дата<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Ещё одно замечание от себя. Если передать параметр с датой документа, то мы получим остатки до того, как повлияет этот документ на остатки. Если вдруг надо получить остатки уже после влияния этого документа, то к дате нужно прибавить секунду.</p>

    <p class="title-size16"><b id="document13">(Курс Чистова - 8.2) Контроль остатков и расчёт себестоимости по средней в документе "ПродажаТоваров"</b></p>
    <p>Вот такой способ у Чистова:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоваров"
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> РежимПроведения<span class="vue-r">)</span> 
                <span class="vue-g">//во 2м пакете запроса указана функция ЕСТЬNULL(). Если мы продадим товар, который ещё не поступал на склад
                //то в остатках будет значение NULL, вот мы и меняем это значение на 0, чтобы не было ошибок</span> 
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                <span class="vue-g">//не оптимизированный запрос. Почему нет, читать нижу в статье про многоскладской учёт
                Запрос.Текст= 
                    "ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.КоличествоОстаток) КАК КоличествоОбщ,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.СебестоимостьОстаток) КАК СебестоимостьОбщ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки КАК ОстаткиТоваровОстатки
                    |		ПО (ПродажаТоваровТовары.Номенклатура = ОстаткиТоваровОстатки.Номенклатура)
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура";</span>

                <span class="vue-g">//оптимизированный запрос</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span>
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК КоличествоПродажи
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Номенклатура КАК Номенклатура,
                    |   ПРЕДСТАВЛЕНИЕ(ВТ.Номенклатура) КАК НоменклатураП,
                    |	ВТ.НомерСтроки КАК НомерСтроки,
                    |	ВТ.КоличествоПродажи КАК Количество,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОбщ,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьОбщ
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ВТ.Номенклатура
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура"</span><span class="vue-r">;</span>
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"ДатаДокумента"</span><span class="vue-r">,</span> МоментВремени<span class="vue-r">());</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">,</span> Склад<span class="vue-r">);</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                
                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">(); </span>

                    Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                    
                    <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                        <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>Количество <span class="vue-r">></span> Выборка<span class="vue-r">.</span>КоличествоОбщ <span class="vue-r">Тогда</span>
                            СообщениеП <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не хватает товара "</span> 
                                                <span class="vue-r">+</span> Выборка<span class="vue-r">.</span>НоменклатураП 
                                                <span class="vue-r">+</span> <span class="vue-bl">" в количестве "</span> 
                                                <span class="vue-r">+</span> <span class="vue-r">(</span>Выборка<span class="vue-r">.</span>Количество <span class="vue-r">-</span> Выборка<span class="vue-r">.</span>КоличествоОбщ<span class="vue-r">)</span> 
                                                <span class="vue-r">+</span> <span class="vue-bl">" в строке с номером "</span> 
                                                <span class="vue-r">+</span> Выборка<span class="vue-r">.</span>НомерСтроки<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Поле <span class="vue-r">=</span> <span class="vue-bl">"Товары["</span> <span class="vue-r">+</span> <span class="vue-r">(</span>Выборка<span class="vue-r">.</span>НомерСтроки <span class="vue-r">-</span> 1<span class="vue-r">)</span> <span class="vue-r">+</span> <span class="vue-bl">"].Количество"</span><span class="vue-r">;</span> 
                            СообщениеП<span class="vue-r">.</span>УстановитьДанные<span class="vue-r">(</span>ЭтотОбъект<span class="vue-r">);</span>
                            СообщениеП<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span>

                            Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                            <span class="vue-g">//Почему пропускаем круг цикла, а не прерываем цикл полностью? Ведь уже есть товар, которого не хватает,
                            //и транзакция записи не пройдёт. А для того, чтобы вывести пользователю все товары,
                            //которых не хватает.</span>
                            <span class="vue-r">Продолжить;
                        КонецЕсли;</span>

                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;</span>                       
                        <span class="vue-g">//вот такая формула нахождения себестоимости из-за проблем округления может оставить копейки в остатках	
                        //Движение.Себестоимость = (Выборка.СебестоимостьОбщ / Выборка.КоличествоОбщ) * Выборка.Количество;	
                        //а вот такая формула будет без остатков копеек, так обещает Чистов</span>
                        Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество <span class="vue-r">/</span> Выборка<span class="vue-r">.</span>КоличествоОбщ <span class="vue-r">*</span> Выборка<span class="vue-r">.</span>СебестоимостьОбщ<span class="vue-r">;
                    КонецЦикла;
                КонецЕсли; 
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Замечу, что такое проведение обеспечивает учёт только общий по всем складам.</p>

    <p class="title-size16"><b id="document14">Как вести многоскладской учёт?</b></p>
    <p>Видео, с которого это пишу - https://www.youtube.com/watch?v=bqZwpeTZ5Ug&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=12</p>
    <p>В этом видео человек показывает решение задачи Чистова, как вести многоскладской учёт, когда в продажном документе мы указываем склад не из шапки документа, а из поля Склад табличной части документа, то есть склад выбирается для каждого товара - https://www.youtube.com/watch?v=e62fUxSCV7k</p>
    <p>Как вести учёт с наличием одного склада мы вроде бы разобрались. Подсчитываем количество и себестоимость по средней и не паримся. Но когда появляется ещё один склад или несколько, то возникают проблемы с подсчётом себестоимости по средней. Например, у нас есть 2 склада: Склад1 и Склад2. На Склад1 поступил товар Ложки в количестве 1 шт. за 100 руб. Позже на Склад2 поступил такой же товар Ложки 1 шт. за 200 руб. Наступил миг продажи и нам нужно продать одну ложку. Как нам подсчитать себестоимость списываемой ложки? Можно было бы считать себестоимость учитывая склады, но тогда у нас на каждом складе была бы своя себестоимость на один и тот же товар. Такое бывает на автономных складах(например, в разных городах склады), но мы хотели бы, чтобы на всех складах себестоимость была одинаковой на одинаковый товар. Получится если мы спишем ложку из первого склада по средней по 150 руб. за ложку, то остаток себестоимости на первом складе составит -50 руб., а количество будет по нулям, тут всё нормально с количеством. Дальше если мы продадим последнюю ложку со второго склада, то средняя также будет 150 руб., потому что подсчёт 200 - 50 = 150, и при продаже на втором складе остаток будет 50 руб. Всё, ложек нет, но остаток себестоимости на 1м складе -50, на втором 50, ерунда полная. Да, на всех складах остаток в итоге выйдет в 0, но если мы посмотрим остаток на первом складе, там не будет 0 и на 2м тоже.</p>
    <p>Для чего нам вообще нужно знание себестоимости товара? Первое это для расчёта валовой прибыли, второе для отчёта остатков, где мы хотели бы видеть на какую сумму осталось товара на складах.</p>
    <p>Для чего мы вообще описываем как вести многоскладской учёт? Для того, чтобы понимать как сделать отчёт с понятным отображением остатков количества и себестоимости товаров на складах. И сделать так, чтобы себестоимость на всех складах для одинакого товара была одна, посчитанная по средней или методами ФИФО или ЛИФО.</p>
    <p>Как же сделать такой отчёт?</p> 
    <p>Как я понимаю из видео, то для решения такой задачи нужно 2 регистра накопления. Один регистр мы возмём "ОстаткиНоменклатуры", эта будет таблица с общими остатками количества и себестоимости, а второй нужно создать. В чём смысл этих 2х регистров? В первом регистре у нас будут измерения Номенклатура, может быть Контрагент, а ресурсы - Количество и Себестоимость, Количество будем использовать как общее количество одного товара на всех складах. При продаже мы в первый регистр записываем себестоимость продаваемых товаров со всех складов, т.е. у нас не будет вообще привязки к складам, как будто мы продаём из одного склада. В документе продажи мы конечно же будем указывать склад, но записывать склад в первый регистр не будем.</p>
    <p>А вот второй регистр у нас будет иметь 2 измерения - Номенклатура и Склад, а ресурс один это Количество. Создадим такой регистр и назовём "ОстаткиПоСкладам". Во втором мы уже при проведении документа будем учитывать товар с какого склада продаём, тут нам не нужен ресурс Себестоимость, потому как мы выяснили выше, будут проблемы с его вычислением. Получается Себестоимость и общее количество мы вычисляем в первом регистре(хотя общее количество мы можем получить и из второго регистра, ну пусть будет в первом), а количество по складам во втором регистре, далее в СКД нам нужно будет соединить эти 2 виртуальные таблицы остатков и присоединить вычисляемое поле Себестоимость. Это вычисляемое поле будем отображать в отчёте, в отличии от поля Себестоимость в первой таблице. Вычисляемое поле будем вычислять на основе полей из 2х соединенных таблиц остатков.</p>
    <p>Прежде чем такой отчёт сделать в СКД, покажу как это выглядит в виде запроса в консоле запросов:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ОстаткиПоСкладамОстатки</span><span class="vue-r">.</span>Номенклатура <span class="vue-r">КАК</span> Номенклатура<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиПоСкладамОстатки</span><span class="vue-r">.</span>Склад <span class="vue-r">КАК</span> Склад<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиПоСкладамОстатки</span><span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">КАК</span> КоличествоОстаток<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиТоваровОстатки</span><span class="vue-r">.</span>СебестоимостьОстаток <span class="vue-r">КАК</span> СебестоимостьОбщ<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиТоваровОстатки</span><span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">КАК</span> КоличествоОбщ<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиПоСкладамОстатки</span><span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">/</span> ОстаткиТоваровОстатки<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">*</span> <span class="vue-g">ОстаткиТоваровОстатки</span><span class="vue-r">.</span>СебестоимостьОстаток <span class="vue-r">КАК</span> Себестоимость
            <span class="vue-r">ИЗ</span>
                РегистрНакопления<span class="vue-r">.</span>ОстаткиПоСкладам<span class="vue-r">.</span>Остатки <span class="vue-r">КАК</span> <span class="vue-g">ОстаткиПоСкладамОстатки</span>
                    <span class="vue-r">ЛЕВОЕ СОЕДИНЕНИЕ</span> РегистрНакопления<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Остатки <span class="vue-r">КАК</span> <span class="vue-g">ОстаткиТоваровОстатки</span>
                    <span class="vue-r">ПО</span> <span class="vue-g">ОстаткиПоСкладамОстатки</span><span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> <span class="vue-g">ОстаткиТоваровОстатки</span><span class="vue-r">.</span>Номенклатура</span>
        </pre>
    </div>
    <img src="../img/1С-1/2023-06-09_09-51-31.png" class="screen" alt="">
    <p>Как видно из таблицы у нас есть количество(КоличествоОстаток) товаров по складам из таблицы "ОстаткиПоСкладам" и есть общее количество(КоличествоОбщ) каждого товара по всем складам(без привязки к складу), а также есть общая себестоимость(СебестоимостьОбщ) товаров также без привязки к складам. Добавляем вычмсляемое поле Себестоимость и расчитываем его по формуле, которую дал Чистов(говорит, что она не имеет таких косяков с остатками копеек):</p>
    <p><i>ОстаткиПоСкладамОстатки.КоличествоОстаток / ОстаткиТоваровОстатки.Количество.Общ * ОстаткиТоваровОстатки.СебестоимостьОбщ</i></p>
    <p>Вместо старой формулы, которая с косяками(ну эти косяки убтраются если что, на канале ТЕХПОДДЕРЖКА вроде рассказывал как их убрать):</p>
    <p><i>ОстаткиТоваровОстатки.СебестоимостьОбщ / ОстаткиТоваровОстатки.Количество.Общ * ОстаткиПоСкладамОстатки.КоличествоОстаток</i></p>
    <p>К этой таблице можно для интереса добавить ещё одно вычисляемое поле Себестоимость_1_ед, которая будет показывать себестоимость 1 единицы товара. Расчитать её можно разделив общую себестоимость на общее количество.</p>
    <p>Теперь можно убрать из запроса получение полей с общей себестоимостью и общим количеством и получим вот такую таблицу, где по складам мы видим себестоимость и количество и всё правильно подсчитывается:</p>
    <img src="../img/1С-1/2023-06-09_10-46-01.png" class="screen" alt="">
    <p>Далее начну описывать по шагам как создать такой отчёт в СКД на основе этих 2х виртуальных таблиц.</p>
    <p>Начнём с набора данных для отчёта, их будет 2 набора из запроса. В первом наборе данных запрашиваем поля из виртуальной таблицы "ОстаткиПоСкладам.Остатки", потом создаём ещё один набор данных и запрашиваем поля из виртуальной таблицы "ОстаткиНоменклатуры.Остатки". Соединение в СКД таблиц всегда только левое. Если мы создали больше одного набора данных, то появляется вкладка "Связи наборов данных". На ней нажимаю на плюс мы создаём связь 2х таблиц. Слева у нас будт таблица со складами, поэтому в поле "Источник связи" указывам первый набор данных, а в поле "Приемник связи" будет таблица с общими остатками. Далее в поле "Выражение источник" и в поле "Выражение приемник" указываем поля, по которым мы будем связывать эти 2 таблицы. Это поле Номенклатура. В поле "Параметр" указываем Период, потому что нам важно, чтобы даты формирования записей в 2х таблицах совпадали(пока не особо понял это решение с датой).</p>
    <p>Далее нужно добавить вычисляемое поле Себестоимость, поэтому идём во вкладку "Вычисляемые поля". В поле "Путь к данным" укажем имя нашего вычисляемого поля - Себестоимость. В поле "Выражение" нужно написать формулу, по которой мы вычисляем поле Себестоимость. Формула там будет та, что я указал выше первой от Чистова. Чтобы в вычисляемом поле не получить большую дробную часть, тут же на поледнем поле "Оформление" можно настроить формат числа. В списке окна оформления выбираем функцию Формат и там для числа задаём длина 15, точность 2. Всё, теперь число будет обрезаться до 2 цифр в дробной части.</p>
    <p>У нас в формуле присутствует деление, в 1С при делении на 0 будет ошибка, поэтому стоит подстраховаться. Если общего товара не будет на складе(делим же на общее количество вот и проверяем это число), то в записи будет NULL. Я тут подумал и пока не понимаю как вообще в общем количестве может быть 0 или Null. Если в общем количестве будет Null, то скорее всего товара нет на складе, а значит такой записи с товаром вообще не будет в таблице. Поэтому оставлю без проверок эту формулу, может что то встретися допишу.</p>
    <p>Ну всё дальше уже понятно, выбираем ресурсы на вкладке ресуров и в настройках выводим как нам надо.</p>
    <p>А как быть при проведении продажного документа, как нам проверять есть ли продаваемый товар на указываемом складе? Ведь до этого мы всё время продавали товар проверяя его общее количество со всех складов. Теперь же когда у нас есть многоскладской учёт, то мы указываем склад в документе, с которого пытаемся продать товар, надо как-то в обработку проведения добавить и проверку на остатки на указанном складе.</p>
    <p>Напишем пока такой запрос, он повторяет не оптимизированный запрос из предыдущей статьи, только добавляется 2я виртуальная таблица с остатками по складу:</p>
    <div class="code-style">
        <pre>
            Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
            Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                <span class="vue-bl">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	МИНИМУМ(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.КоличествоОстаток) КАК КоличествоОбщ,
                    |	МИНИМУМ(ОстаткиТоваровОстатки.СебестоимостьОстаток) КАК СебестоимостьОбщ,
                    |	МИНИМУМ(ОстаткиПоСкладамОстатки.КоличествоОстаток) КАК КоличествоОстатокНаСкладе
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки КАК ОстаткиТоваровОстатки
                    |		ПО (ПродажаТоваровТовары.Номенклатура = ОстаткиТоваровОстатки.Номенклатура)
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки КАК ОстаткиПоСкладамОстатки
                    |		ПО (ПродажаТоваровТовары.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура)
                    |			И (ПродажаТоваровТовары.Ссылка.Склад = ОстаткиПоСкладамОстатки.Склад)
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура"</span><span class="vue-r">;</span>
        </pre>
    </div>
    <p><i>Оптимизация запроса</i></p>
    <p>Как объяснил Чистов, что вот так как написан запрос выше не очень оптимально, потому что у нас в табличной части документа могут повторяться товары, мы к этой таблице присоединяем 2 виртуальные таблицы остатков, которые сама система уже сгруппировывает. И присоединив к таб. части эти 2 сгруппированные вирт. таблицы они опять повторяют записи, потому что в таб. части могут быть повторения товаров и только потом в конце запроса мы группируем всю соединённую таблицу. Чтобы так не было можно взять отдельно получить товары из таб. части, сгруппировать её, поместить во временную таблицу и уже потом к ней присоединять остатки. Плюсом, как по мне, являетс ещё то, что не нужно применять агрегатные функции ко всем полям виртуальных таблиц как в примере выше.</p> 
    <p>Также очень важным замечанием является то, что виртуальные таблицы сначала выбирают все товары, потом начинается сравнение, что нам нужны товары только такие как из таб. части и отбрасываются опять куча ненужных товаров. Делается двойная работа. Нужно сразу в параметрах вирт. таблиц указать какие товары надо выбрать для этих таблиц. Вот какой должен быть запрос:</p>
    <div class="code-style">
        <pre>
            Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
            Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                <span class="vue-bl">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК КоличествоПродажи
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Номенклатура
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Номенклатура КАК Номенклатура,
                    |	ВТ.НомерСтроки КАК НомерСтроки,
                    |	ВТ.КоличествоПродажи КАК Количество,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОбщ,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьОбщ,
                    |	ЕСТЬNULL(ОстаткиПоСкладамОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокНаСкладе
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ВТ.Номенклатура
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки(
                    |				&ДатаДокумента,
                    |				Склад = &Склад
                    |				И Номенклатура В
                    |					(ВЫБРАТЬ
                    |						ВТ.Номенклатура
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиПоСкладамОстатки
                    |		ПО ВТ.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура"</span><span class="vue-r">;</span>
        </pre>
    </div>
    <p>В итоге получим такой код в обработке проведения:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоваров"
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> РежимПроведения<span class="vue-r">)</span> 
                <span class="vue-g">//во 2м пакете запроса указана функция ЕСТЬNULL(). Если мы продадим товар, который ещё не поступал на склад
                //то в остатках будет значение NULL, вот мы и меняем это значение на 0, чтобы не было ошибок</span> 
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                        |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                        |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                        |	СУММА(ПродажаТоваровТовары.Количество) КАК КоличествоПродажи
                        |ПОМЕСТИТЬ ВТ
                        |ИЗ
                        |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                        |ГДЕ
                        |	ПродажаТоваровТовары.Ссылка = &Ссылка
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ПродажаТоваровТовары.Номенклатура
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ВТ.Номенклатура КАК Номенклатура,
                        |	ВТ.НомерСтроки КАК НомерСтроки,
                        |	ВТ.КоличествоПродажи КАК Количество,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОбщ,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьОбщ,
                        |	ЕСТЬNULL(ОстаткиПоСкладамОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокНаСкладе
                        |ИЗ
                        |	ВТ КАК ВТ
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                        |				&ДатаДокумента,
                        |				Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки(
                        |				&ДатаДокумента,
                        |				Склад = &Склад
                        |				И Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиПоСкладамОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура"</span><span class="vue-r">;</span>
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">,</span> Склад<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"ДатаДокумента"</span><span class="vue-r">,</span> МоментВремени<span class="vue-r">());</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                
                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">(); </span>

                    Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                    Движения<span class="vue-r">.</span>ОстаткиПоСкладам<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                    
                    <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                        <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>Количество <span class="vue-r">></span> Выборка<span class="vue-r">.</span>КоличествоОстатокНаСкладе <span class="vue-r">Тогда</span>
                            СообщениеП <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Текст <span class="vue-r">=</span> "Не хватает товара " 
                                                <span class="vue-r">+</span> Выборка<span class="vue-r">.</span>Номенклатура 
                                                <span class="vue-r">+</span> " в количестве " 
                                                <span class="vue-r">+</span> <span class="vue-r">(</span>Выборка<span class="vue-r">.</span>Количество <span class="vue-r">-</span> Выборка<span class="vue-r">.</span>КоличествоОстатокНаСкладе<span class="vue-r">)</span> 
                                                <span class="vue-r">+</span> " в строке с номером " 
                                                <span class="vue-r">+</span> Выборка<span class="vue-r">.</span>НомерСтроки<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Поле <span class="vue-r">=</span> "Товары[" <span class="vue-r">+</span> <span class="vue-r">(</span>Выборка<span class="vue-r">.</span>НомерСтроки <span class="vue-r">-</span> 1<span class="vue-r">)</span> <span class="vue-r">+</span> "].Количество"<span class="vue-r">;</span> 
                            СообщениеП<span class="vue-r">.</span>УстановитьДанные<span class="vue-r">(</span>ЭтотОбъект<span class="vue-r">);</span>
                            СообщениеП<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span>

                            Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                            <span class="vue-g">//Почему пропускаем круг цикла, а не прерываем цикл полностью? Ведь уже есть товар, которого не хватает,
                            //уже всё равно не пройдёт транзакция записи. А для того, чтобы вывести пользователю все товары,
                            //которых не хватает. Моё предположение, до конца не уверен.</span>
                            <span class="vue-r">Продолжить;
                        КонецЕсли;</span>

                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                        <span class="vue-g">//вот такая формула нахождения себестоимости из-за проблем округления может оставить копейки в остатках	
                        //Движение.Себестоимость = (Выборка.СебестоимостьОбщ / Выборка.КоличествоОбщ) * Выборка.Количество;	
                        //а вот такая формула будет без остатков копеек, так обещает Чистов</span>
                        Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество <span class="vue-r">/</span> Выборка<span class="vue-r">.</span>КоличествоОбщ <span class="vue-r">*</span> Выборка<span class="vue-r">.</span>СебестоимостьОбщ<span class="vue-r">;</span>


                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиПоСкладам<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;
                    КонецЦикла;
                КонецЕсли; 
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document15">Партионный учёт, продажа товара и списание себестоимости методом ФИФО и ЛИФО</b></p>
    <p>Курс Чистова, видео - https://www.youtube.com/watch?v=I70c87BCWS8&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=13</p>
    <p>Смысл такого учёта в том, что мы списываем товар по пришедшим партиям. ФИФО это списание от начала и до конца. Добавляем в регистр остатков с себестоимостью поле Партия и записываем в это поле ссылку на документ, который эту партию оприходовал. Получаем запросом нужные товары из этого регистра и упорядычиваем по возрастанию поле Партия.Дата, затем начинаем списывать от начала до конца то количество товара, котрое хотим продать. Когда мы заходим внутрь партии, то там себестоимость вычисляется по средней. И в каждой партии будет своя себестоимость, если у одного и того же товара разная себестоимость при поступлении.</p>
    <p>ЛИФО запрещён в России с какого то года, но используется где то в управленческом учёте, пока не понимаю о чём речь.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> РежимПроведения<span class="vue-r">)</span> 
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                        |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                        |	СУММА(ПродажаТоваровТовары.НомерСтроки) КАК НомерСтроки,
                        |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество
                        |ПОМЕСТИТЬ ВТ
                        |ИЗ
                        |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                        |ГДЕ
                        |	ПродажаТоваровТовары.Ссылка = &Ссылка
                        |
                        |СГРУППИРОВАТЬ ПО
                        |	ПродажаТоваровТовары.Номенклатура
                        |;
                        |
                        |////////////////////////////////////////////////////////////////////////////////
                        |ВЫБРАТЬ
                        |	ВТ.Номенклатура КАК Номенклатура,
                        |	ВТ.НомерСтроки КАК НомерСтроки,
                        |	ВТ.Количество КАК Количество,
                        |   ОстаткиТоваровОстатки.Партия КАК Партия,
                        |   ОстаткиТоваровОстатки.Партия.Склад КАК Склад,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоПартии,
                        |	ЕСТЬNULL(ОстаткиТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьПартии,
                        |	ЕСТЬNULL(ОстаткиПоСкладамОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокНаСкладе
                        |ИЗ
                        |	ВТ КАК ВТ
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                        |				&ДатаДокумента,
                        |				Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиТоваровОстатки.Номенклатура
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиПоСкладам.Остатки(
                        |				&ДатаДокумента,
                        |				Склад = &Склад
                        |				И Номенклатура В
                        |					(ВЫБРАТЬ
                        |						ВТ.Номенклатура
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиПоСкладамОстатки
                        |		ПО ВТ.Номенклатура = ОстаткиПоСкладамОстатки.Номенклатура
                        |
                        |УПОРЯДОЧИТЬ ПО Партия.Дата ВОЗР
                        |
                        |ИТОГИ МИНИМУМ(Количество), МИНИМУМ(КоличествоОстатокНаСкладе)
                        |ПО ВТ.Номенклатура"</span><span class="vue-r">;</span>
                
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">,</span> Склад<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"ДатаДокумента"</span><span class="vue-r">,</span> МоментВремени<span class="vue-r">());</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>


                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span> 
                    <span class="vue-g">//выбираем в выборку толко записи верхнего уровня с итогами</span>
                    ВыборкаИтогов <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">(</span>ОбходРезультатаЗапроса<span class="vue-r">.</span>ПоГруппировкам<span class="vue-r">);</span> 

                    Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                    Движения<span class="vue-r">.</span>ОстаткиПоСкладам<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                    
                    <span class="vue-r">Пока</span> ВыборкаИтогов<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                        <span class="vue-r">Если</span> ВыборкаИтогов<span class="vue-r">.</span>Количество <span class="vue-r">></span> ВыборкаИтогов<span class="vue-r">.</span>КоличествоОстатокНаСкладе <span class="vue-r">Тогда</span>
                            СообщениеП <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не хватает товара "</span> <span class="vue-r">+</span> ВыборкаИтогов<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span>

                            Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;
                            Продолжить;
                        КонецЕсли;</span>  
                        
                        <span class="vue-g">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество <span class="vue-r">=</span> ВыборкаИтогов<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                        
                        <span class="vue-g">//из текущей записи верхнего уровня с итогами выбираем его детальные записи</span>
                        ВыборкаДетальных <span class="vue-r">=</span> ВыборкаИтогов<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                        <span class="vue-r">Пока</span> ВыборкаДетальных<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span> 
                            <span class="vue-g">//если есть что списывать, то идём внутрь. Если у нас партии упорядочены по возрастанию, 
                            //то вот здесь и начинается списание и вычисление себестоимости по методу ФИФО </span>
                            <span class="vue-r">Если</span> СписываемоеКоличество <span class="vue-r">></span> 0 <span class="vue-r">И</span> ВыборкаДетальных<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад <span class="vue-r">Тогда</span>
                                Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                                Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                                Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                                Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                                Движение<span class="vue-r">.</span>Партия <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>Партия<span class="vue-r">;</span>
                            
                                <span class="vue-r">Если</span> СписываемоеКоличество <span class="vue-r">&lt;=</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоПартии <span class="vue-r">Тогда</span>
                                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> СписываемоеКоличество<span class="vue-r">;</span>
                                    Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> СписываемоеКоличество <span class="vue-r">/</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоПартии <span class="vue-r">*</span> ВыборкаДетальных<span class="vue-r">.</span>СебестоимостьПартии<span class="vue-r">;</span>
                                    СписываемоеКоличество <span class="vue-r">=</span> СписываемоеКоличество <span class="vue-r">-</span> СписываемоеКоличество<span class="vue-r">;</span>
                                <span class="vue-r">Иначе</span>
                                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоПартии<span class="vue-r">;</span>
                                    Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>СебестоимостьПартии<span class="vue-r">;</span>
                                    СписываемоеКоличество <span class="vue-r">=</span> СписываемоеКоличество <span class="vue-r">-</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоПартии<span class="vue-r">;
                                КонецЕсли;

                            КонецЕсли;
                        КонецЦикла;</span> 
                        
                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиПоСкладам<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> ВыборкаИтогов<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ВыборкаИтогов<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                    КонецЦикла;
                КонецЕсли;   
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document16">(Курс Чистова 8.2)Последовательности, что такое и для чего нужны.</b></p>
    <p>Видео - https://www.youtube.com/watch?v=RLedCEoiA2s&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=14</p>
    <p>В принципе смысл тот же самый, что и в курсе Камкова, там я уже примерно описал, что такое поледовательности и как этот объект работает.</p>
    <p>Тема не особо понятна как это применяется на практике. Нужно будет поискать более развёрнутый ответ в инете. Хотя если несколько раз пересмотреть видео, то можно понять работу последовательности.</p>

    <p class="title-size16"><b id="document18">Как свернуть(сгруппировать) одинаковые товары табличной части при записи их в регистр</b></p>
    <p>Пользователь может ввести несколько раз один и тот же товар в табличной части и не заметит. Чтобы не раздувать БД регистра нужно сгруппировать одинаковые товары перед записью их в регистр. Есть несколько способов это сделать.</p>
    <p><i>Первый</i>. В обработке проведения в замом начале насильно записываем данные документа в БД, затем делаем запрос в этим данным документа, получаем все товары табличной части, в запросе группируем и записываем в регистр.</p>
    <p><i>Второй</i>. Можем выгрузить табличную часть в таблицу значений и у таблицы значений есть метод Свернуть(), почитать про него можно тут же в шпоре в типах данных про ТЗ. Затем из таблицы получаем строки и записываем товары в регистр. Пример:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> РежимПроведения<span class="vue-r">)</span>
                Движения<span class="vue-r">.</span>ОстаткиСкоропортящихсяТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>

                ТЗ <span class="vue-r">=</span> Товары<span class="vue-r">.</span>Выгрузить<span class="vue-r">();</span>
                <span class="vue-g">//в первом параметре указвыем колонки для свёртывания, во втором 
                //параметре колонки для суммирования. Колонки которые мы не указали
                //не войдут в новую свёрнутую таблицу.</span>
                ТЗ<span class="vue-r">.</span>Свернуть<span class="vue-r">(</span><span class="vue-bl">"Товар, СрокГодности"</span><span class="vue-r">,</span> <span class="vue-bl">"Количество, Сумма"</span><span class="vue-r">);</span>

                <span class="vue-r">Для каждого</span> ТекСтрока <span class="vue-r">Из</span> ТЗ <span class="vue-r">Цикл</span>
                    Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиСкоропортящихсяТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                    Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Товар <span class="vue-r">=</span> ТекСтрока<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Партия <span class="vue-r">=</span> Ссылка<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>СрокГодности <span class="vue-r">=</span> ТекСтрока<span class="vue-r">.</span>СрокГодности<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ТекСтрока<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> ТекСтрока<span class="vue-r">.</span>Сумма<span class="vue-r">;
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p><i>Третий</i>. Этот способ я сам выдумывал, он описан где то в конфигурации "Управление кухней" от канал ТЕХПОДДЕРЖКА. В этом способе я средствами языка 1С сам группирую строки табличной части, но смысла в нём тогда нет, потому что то же самое делает метод Свернуть() у ТЗ.</p>
    <p><span class="vue-r">Кстати нужно будет ещё проверить как быстрее будет сворачивать строки, через 1й или 2й способы.</span></p>

    <p class="title-size16"><b id="document19">Как для реквизита шапки/таб.части документа добавить кнопку выбора и открыть окно с результатом, который мы выберем из БД</b></p>
    <p>Описание такого примера можно найти в разделе 1С - Разные заметки 1С - События формы - НачалоВыбора</p>

    <p class="title-size16"><b id="document20">Опишу тут другой способ бронировать товары</b></p>
    <p>Напомню, что если нужно в отсортированном списке партий поднять одну конкретную запись в верх списка, то это описано в статье: "Записетки по запросам" - Первая статья.</p>
    <p>Опишу тут решения из 2х задач, номер 8 и 9. В 8 задаче заказчик не может взять меньше заказанного и при отказе от заказа просто удаляем документ бронирования. А 9 задаче нужно сделать, чтобы заказчик мог взять любое количество товара(больше или меньше заказанного). Также нужно сделать возможность, чтобы заказчик мог бронировать несколько раз один и тот же товар и списывать эти товары из брони в порядке их бронирования(это партии).</p>
    <p><i style="text-decoration: underline;">Это решение задачи из книги - Чистов П.А. - Сборник задач по разработке на платформе 1С.Предприятие - 2020,  под номером 8.</i></p>
    <p>Заказчик не может взять меньше заказанного и при отказа от своей брони, документ с бронёй просто удаляется и регистр очищается.</p>
    <p>К нам приходит покупатель или звонит и заказывает товар, но говорит, что заберёт позже. Нам нужно забронировать товар для этого покупателя. В системе создаём документ "БронированиеТоваров", документы "ПоступлениеТоваров" и "ПродажаТоваров" есть само собой. Нам понадобится 2 регистра накопления в режиме Остатки - "ОстаткиТоваров" и "ТоварыВБроне".</p>
    <p>В документе "БронированиеТоваров" будет 2 доп. реквизита - "Контрагент" и "Телефон". И тот и другой будут ссылаться на справочники "Контрагенты" и "Телефоны". Справочник "Телефоны" сделаем подчинёным справочнику "Контрагенты". В форме документа "БронированиеТоваров" настроим связь между этими реквизитами через "Связи параметров выбора".</p>
    <p>В запросе мы кроме остатков товаров на сладе("ОстаткиТоваров.Остатки") используем и таблицу остатков забронированных товаров("ТоварыВБроне.Остатки"), чтобы узнать остатки не только физические на складе, но и сколько до нас уже забронировали этот товар, ведь его тоже нужно учитывать. Узнав все остатки мы сравниваем их с количеством, которое хотим забронировать.</p>
    <p>В статье про бронирование товара у Камкова, я видимо не правильно понял и писал, что нужно при бронировании из регистра "ОстаткиТоваров" списывать товар и в регистр бронирования записывать, так вот с регистра "ОстаткиТоваров" не надо ничего списывать, а просто записываем в регистр "ТоварыВБроне". Потом в обработке проведения документа "ПродажаТоваров" мы смотрим остатки в "ОстаткиТоваров.Остатки" и смотрим остатки в "ТоварыВБроне.Остатки" и вычитаем из физических остатков на складе те, что забронированные просто математическим действием и получаем свободный остаток товаров, как видим ничего из регистра остатков со склада не надо списывать.</p>
    <p>На счёт того нужно ли блокировать таблицу "РегистрНакопления.ОстаткиТоваров" при бронировании товара пока не ясно. Как видится мне то нужно. В решении блокирования не было, но если подумать, то блокирование нужно, потому что пока мы проводим документ бронирования и смотрим в эту таблицу и в начале кода остаток есть, то до конца кода уже его может и не быть, а мы забронируем как-будто он есть.</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "БронированиеТоваров"
            <span class="vue-b">Процедура ОбработкаПроведения(Отказ, РежимПроведения)
                Движения.ТоварыВБроне.Записывать = Истина;

                <span class="vue-g">//блокировка записей в таблице ОстаткиТоваров</span>
                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить(<span class="vue-bl">"РегистрНакопления.ОстаткиТоваров"</span>);
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
                ДанныеБлокировки = Товары.Выгрузить(, <span class="vue-bl">"Товар"</span>);
                ЭлементБлокировки.ИсточникДанных = ДанныеБлокировки;
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="vue-bl">"Товар"</span>, <span class="vue-bl">"Товар"</span>); 
                Блокировка.Заблокировать();

                Запрос = Новый Запрос;
                Запрос.Текст = 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	БронированиеТоваровТовары.Товар КАК Товар,
                    |	СУММА(БронированиеТоваровТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.БронированиеТоваров.Товары КАК БронированиеТоваровТовары
                    |ГДЕ
                    |	БронированиеТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	БронированиеТоваровТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокВБроне
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Товар = ОстаткиТоваровОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ТоварыВБронеОстатки
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки.Товар"</span>;
                    
                Запрос.УстановитьПараметр(<span class="vue-bl">"ДатаДокумента"</span>, Неопределено);
                Запрос.УстановитьПараметр(<span class="vue-bl">"Ссылка"</span>, Ссылка);
                РезультатЗапроса = Запрос.Выполнить(); 

                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                    
                    Пока Выборка.Следующий() Цикл
                        ОстатокТовараСУчётомЗабронированных = Выборка.КоличествоОстаток - Выборка.КоличествоОстатокВБроне;
                        Если Выборка.Количество > ОстатокТовараСУчётомЗабронированных Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="vue-bl">"Не хватает товара "</span> + Выборка.ТоварП + <span class="vue-bl">" в количестве "</span> + (Выборка.Количество - ОстатокТовараСУчётомЗабронированных);
                            СообщениеП.Сообщить();

                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;

                        Движение = Движения.ТоварыВБроне.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
                        Движение.Период = Дата;
                        Движение.Товар = Выборка.Товар;
                        Движение.Контрагент = Контрагент;
                        Движение.Количество = Выборка.Количество;             
                    КонецЦикла
                КонецЕсли;
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Далее покупатель пришёл за товаром. Для отпуска ему товара мы используем документ "ПродажаТоваров", в обработчике которого мы в запросе используем также 3 таблицы, только из таблицы "ТоварыВБроне.Остатки" мы будем 2 раза получать данные и получается соединено будет 4 таблицы. Из одной и той же таблицы "ТоварыВБроне.Остатки" мы хотим получить данные бронированных товаров чужих покупателей и товары только с нашим покупателем.</p> <p>Всё, дальше мы количество из документа "ПродажаТоваров" сравниваем с физическими остатками минус остатки в броне других покупателей и записываем в регистр "ОстаткиТоваров" расход количества товаров из документа, а в регистр "ТоварыВБроне" записываем расход количества товаров покупателя из остатков в броне, т.е. мы из резерва списываем всё что там было. Почему так, ведь можно было просто записать и туда и туда остаток из брони данного покупателя, но покупатель когда прийдёт за товаром, то он может заказть больше или меньше своей брони, а больше или меньше будет лежать только в количестве документа. Поэтому и получается, что в регистр "ОстаткиТоваров" мы пишем только то, что реально заказчик купит(количество из документа), а из регистра "ТоварыВБроне" нам нужно списать столько сколько там и лежит.</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПродажаТоаров"
            <span class="vue-b">Процедура ОбработкаПроведения(Отказ, РежимПроведения) 
                Движения.ОстаткиТоваров.Записывать = Истина;
                Движения.ТоварыВБроне.Записывать = Истина;


                <span class="vue-g">//блокировка записей в таблице ОстаткиТоваров</span>
                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить(<span class="vue-bl">"РегистрНакопления.ОстаткиТоваров"</span>);
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
                ДанныеБлокировки = Товары.Выгрузить(, <span class="vue-bl">"Товар"</span>);
                ЭлементБлокировки.ИсточникДанных = ДанныеБлокировки;
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="vue-bl">"Товар"</span>, <span class="vue-bl">"Товар"</span>); 
                Блокировка.Заблокировать();


                Запрос = Новый Запрос;
                Запрос.Текст = 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	СУММА(ПродажаТоваровТовары.Сумма) КАК Сумма
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,
                    |	ВТ.Сумма КАК Сумма,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеДругихКонтрагентов,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки1.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеНашегоКонтрагента
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар
                    |					ИЗ
                    |						ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Товар = ОстаткиТоваровОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				НЕ Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар
                    |						ИЗ
                    |							ВТ)) КАК ТоварыВБронеОстатки
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар КАК Товар
                    |						ИЗ
                    |							ВТ КАК ВТ)) КАК ТоварыВБронеОстатки1
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки1.Товар"</span>;
                                                            
                Запрос.УстановитьПараметр(<span class="vue-bl">"Ссылка"</span>, Ссылка);
                Запрос.УстановитьПараметр(<span class="vue-bl">"ДатаДокумента"</span>, Неопределено);
                Запрос.УстановитьПараметр(<span class="vue-bl">"Контрагент"</span>, Контрагент);
                РезультатЗапроса = Запрос.Выполнить();
                
                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                    
                    Пока Выборка.Следующий() Цикл
                        СвободныйОстатокТовара = Выборка.КоличествоОстаток - Выборка.КоличествоОстатокВБронеДругихКонтрагентов;
                        Если Выборка.Количество > СвободныйОстатокТовара Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="vue-bl">"Не хватает товара "</span> + Выборка.ТоварП + <span class="vue-bl">" на складе "</span> + Склад + <span class="vue-bl">" в количество "</span>
                                                + (Выборка.Количество - СвободныйОстатокТовара);
                            СообщениеП.Сообщить();
                            
                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;

                        Движение = Движения.ОстаткиТоваров.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Товар = Выборка.Товар;
                        Движение.Количество = Выборка.Количество;

                        Движение = Движения.ТоварыВБроне.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Товар = Выборка.Товар;
                        Движение.Контрагент = Контрагент; 
                        Движение.Количество = Выборка.КоличествоОстатокВБронеНашегоКонтрагента;
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Если заказчик отказывается от брони, то просто удаляем документ "БронированиеТоваров" для этого покупателя, все записи в регистре автоматом удалятся. На всякий случай нужно поставить "Удалять автоматически" в закладке Движения этого документа.</p>
    <p><i style="text-decoration: underline;">Это решение задачи из книги - Чистов П.А. - Сборник задач по разработке на платформе 1С.Предприятие - 2020,  под номером 9.</i></p>
    <p>Теперь нужно исправить то место, когда заказчик может взять меньше забронированного и если у заказчика несколько броней одного и того же товара, то нужно списывать из брони в порядке бронирования по дате. Короче говоря нужно вести партионное списание. Также если заказчик забрал часть товара из брони, а от части отказался, то нужно ввести документ "СнятиеБрони".</p>
    <p>Итак писать код обработчика проведения документа "БронированиеТоваров" не буду, там все 2 строки изменения. Нужно в регистр "ТоварыВБроне" добавить измерение Партия, затем в обработчике нужно записывать в этот регистр в поле Партия ссылку на текущий документ бронирования и в запросе также получать это поле Партия.</p>
    <p>А вот код обработчика проведения документа "ПродажаТоваров" нужно описать, потому что там больше изменений:</p>
    <div class="code-style">
        <pre>           
            <span class="vue-b">Процедура ОбработкаПроведения(Отказ, РежимПроведения) 
                Движения.ОстаткиТоваров.Записывать = Истина;
                Движения.ТоварыВБроне.Записывать = Истина;


                <span class="vue-g">//блокировка записей в таблице ОстаткиТоваров</span>
                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить(<span class="vue-bl">"РегистрНакопления.ОстаткиТоваров"</span>);
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный;
                ДанныеБлокировки = Товары.Выгрузить(, <span class="vue-bl">"Товар"</span>);
                ЭлементБлокировки.ИсточникДанных = ДанныеБлокировки;
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="vue-bl">"Товар"</span>, <span class="vue-bl">"Товар"</span>); 
                Блокировка.Заблокировать();


                Запрос = Новый Запрос;
                Запрос.Текст = 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Товар КАК Товар,
                    |	СУММА(ПродажаТоваровТовары.Количество) КАК Количество,
                    |	СУММА(ПродажаТоваровТовары.Сумма) КАК Сумма
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	ПродажаТоваровТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,  
                    |	ВТ.Сумма КАК Сумма,
                    |	ЕСТЬNULL(ОстаткиТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеДругихКонтрагентов,
                    |	ТоварыВБронеОстатки1.Партия КАК Партия,
                    |	ЕСТЬNULL(ТоварыВБронеОстатки1.КоличествоОстаток, 0) КАК КоличествоОстатокВБронеНашегоКонтрагента
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваров.Остатки(
                    |				&ДатаДокумента,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар
                    |					ИЗ
                    |						ВТ)) КАК ОстаткиТоваровОстатки
                    |		ПО ВТ.Товар = ОстаткиТоваровОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				НЕ Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар
                    |						ИЗ
                    |							ВТ)) КАК ТоварыВБронеОстатки
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки.Товар
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыВБроне.Остатки(
                    |				&ДатаДокумента,
                    |				Контрагент = &Контрагент
                    |					И Товар В
                    |						(ВЫБРАТЬ
                    |							ВТ.Товар КАК Товар
                    |						ИЗ
                    |							ВТ КАК ВТ)) КАК ТоварыВБронеОстатки1
                    |		ПО ВТ.Товар = ТоварыВБронеОстатки1.Товар 
                    |УПОРЯДОЧИТЬ ПО
                    |	ТоварыВБронеОстатки1.Партия  
                    |ИТОГИ
                    |	МИНИМУМ(Количество),
                    |	МИНИМУМ(КоличествоОстаток),
                    |	МИНИМУМ(КоличествоОстатокВБронеДругихКонтрагентов),
                    |	МИНИМУМ(Сумма),
                    |	СУММА(КоличествоОстатокВБронеНашегоКонтрагента)
                    |ПО
                    |	Товар"</span>;
                                                            
                Запрос.УстановитьПараметр(<span class="vue-bl">"Ссылка"</span>, Ссылка);
                Запрос.УстановитьПараметр(<span class="vue-bl">"ДатаДокумента"</span>, Неопределено);
                Запрос.УстановитьПараметр(<span class="vue-bl">"Контрагент"</span>, Контрагент);
                РезультатЗапроса = Запрос.Выполнить();

                Если НЕ РезультатЗапроса.Пустой() Тогда
                    ВыборкаГруппировки = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
                    
                    Пока ВыборкаГруппировки.Следующий() Цикл
                        СвободныйОстатокТовара = ВыборкаГруппировки.КоличествоОстаток - ВыборкаГруппировки.КоличествоОстатокВБронеДругихКонтрагентов;
                        Если ВыборкаГруппировки.Количество > СвободныйОстатокТовара Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="vue-bl">"Не хватает товара "</span> + ВыборкаГруппировки.ТоварП + <span class="vue-bl">" на складе "</span> + Склад + <span class="vue-bl">" в количество "</span>
                                                + (ВыборкаГруппировки.Количество - СвободныйОстатокТовара);
                            СообщениеП.Сообщить();
                            
                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;
                        
                        <span class="vue-g">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество = ВыборкаГруппировки.Количество;
                        ВыборкаДетальныхИзГруппы = ВыборкаГруппировки.Выбрать();			
                        Пока ВыборкаДетальныхИзГруппы.Следующий() Цикл 
                            Если СписываемоеКоличество > 0 Тогда
                                Движение = Движения.ТоварыВБроне.Добавить();
                                Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                                Движение.Период = Дата;
                                Движение.Товар = ВыборкаДетальныхИзГруппы.Товар;
                                Движение.Контрагент = Контрагент; 
                                Движение.Партия = ВыборкаДетальныхИзГруппы.Партия;	            
                                Если СписываемоеКоличество &LT;= ВыборкаДетальныхИзГруппы.КоличествоОстатокВБронеНашегоКонтрагента Тогда
                                    Движение.Количество = СписываемоеКоличество;
                                    СписываемоеКоличество = СписываемоеКоличество - СписываемоеКоличество;
                                Иначе
                                    Движение.Количество = ВыборкаДетальныхИзГруппы.КоличествоОстатокВБронеНашегоКонтрагента;
                                    СписываемоеКоличество = СписываемоеКоличество - ВыборкаДетальныхИзГруппы.КоличествоОстатокВБронеНашегоКонтрагента;
                                КонецЕсли;
                            Иначе
                                Прервать;
                            КонецЕсли;	
                        КонецЦикла;


                        Движение = Движения.ОстаткиТоваров.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Товар = ВыборкаГруппировки.Товар;
                        Движение.Количество = ВыборкаГруппировки.Количество;	
                    КонецЦикла;
                КонецЕсли;  
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Теперь у нас покупатель может взять меньше из резерва, а остальное из брони можно списать документом "СнятиеБрони". Документ "СнятиеБрони" имеет 2 доп. реквизита - "Покупатель" и "ДокументБронирования". Документ "СнятиеБрони" может списать с указанного документа бронирования или если не указать никаких ссылок на документ бронирования, то списываются все брони для указанного покупателя. Вот обработчик проведения документа "СнятиеБрони":</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Процедура ОбработкаПроведения(Отказ, РежимПроведения)
                Если ЗначениеЗаполнено(ДокументБронирования) Тогда
                    НаборЗаписей = РегистрыНакопления.ТоварыВБроне.СоздатьНаборЗаписей();
                    НаборЗаписей.Отбор.Регистратор.Установить(ДокументБронирования);
                    НаборЗаписей.Очистить();
                    НаборЗаписей.Записать();
                Иначе
                    Запрос = Новый Запрос;
                    Запрос.Текст = 
                        <span class="vue-bl">"ВЫБРАТЬ
                        |	ТоварыВБроне.Регистратор КАК Регистратор
                        |ИЗ
                        |	РегистрНакопления.ТоварыВБроне КАК ТоварыВБроне
                        |ГДЕ
                        |	ТоварыВБроне.Контрагент = &Контрагент"</span>;
                    
                    Запрос.УстановитьПараметр(<span class="vue-bl">"Контрагент"</span>, Контрагент);
                    РезультатЗапроса = Запрос.Выполнить();
                    Выборка = РезультатЗапроса.Выбрать();
                    
                    Пока Выборка.Следующий() Цикл
                        НаборЗаписей = РегистрыНакопления.ТоварыВБроне.СоздатьНаборЗаписей();
                        НаборЗаписей.Отбор.Регистратор.Установить(Выборка.Регистратор);
                        НаборЗаписей.Очистить();
                        НаборЗаписей.Записать();	
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span>
        </pre>
    </div>

    <p class="title-size16"><b id="document21">(Курс Чистова 8.3) Контроль остатков и расчёт себестоимости по средней.</b></p>
    <p>Тут опишу последнее видение Чистова о том как правильно писать код для обработки проведения документа продажи товаров. Это минимальный шаблон кода. Описание кода находится в комментариях:</p>
    <div class="code-style">
        <pre>
            --модуль объекта, процедура "ОбработкаПроведения" документа "РасходнаяНакладная"

            <span class="vue-g">//тут Чистов делает проверку остатков товара немного другим способом
            //мы сразу записываем в регистр товары, которые хотим продать, блокируем регистр,
            //затем делаем запрос в регистр и получаем остатки наших товаров,
            //у которых есть остаток в минусе. Если есть такие товары с минусом
            //то мы отказываемся от транзакции записи, т.е. записи из регистра
            //система сама удалит и также удалит записи документа из БД
            //Как утверждает Чистов, то такой способ проверки остатков
            //более быстродейственнее, из-за того, что мы сначала всё записали
            //и только потом проверили есть ли отрицательные остатки. 
            //В другом способе, он описан в курсе 8.2, мы сначала сразу начинаем
            //проверять остатки и только потом записываем.</span>
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> Режим<span class="vue-r">)</span>
                Движения<span class="vue-r">.</span>Взаиморасчеты<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span> 
                Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span> 

                <span class="vue-g">//регистр Взаиморасчеты Приход</span>
                Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>Взаиморасчеты<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Контрагент <span class="vue-r">=</span> Контрагент<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> СуммаИтого<span class="vue-r">;</span>
                
                <span class="vue-g">////Это первый способ как получить и свернуть одинаковые товары
                ////В первом параметре указываем колонки для свёртывания, во втором 
                ////параметре колонки для суммирования. Колонки которые мы не указали
                ////не войдут в новую свёрнутую таблицу.
                //ТЗ = Товары.Выгрузить();
                //ТЗ.Свернуть("Товар", "Количество"); 


                //Это второй способ получить и свернуть товары, через запрос 
                //Что быстрее работает, через запрос или через ТЗ не известно
                //Нужно будет проверить
                //В этом запросе мы поместим результат во временную таблицу
                //и сразу получим из неё данные. Временная таблица нужна будет
                //в запросе ниже, для отбора товаров из таблицы остатков 
                //Чтобы временная таблица сохранилась в памяти, нужно создать объект
                //менеджера временных таблиц и он сам всё сделает
                //Использование временных таблиц будет оправдано, если нам
                //она будет нужна несколько раз. Если же используем один раз,
                //то во вложенном запросе ниже можно и сразу получить товары из документа,
                //потому что для временной таблицы нужно построить в базе саму эту таблицу,
                //а это затраты ресурсов. В этой процедуре мы используем раза 2 обращение
                //к временной таблице в рваных запросах 
                //Кстати!!! Вот так можно посмотреть что лежит во временной таблице
                //Запрос.МенеджерВременныхТаблиц.Таблицы[0].ПолучитьДанные().Выгрузить();</span>
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>МенеджерВременныхТаблиц <span class="vue-r">=</span> Новый МенеджерВременныхТаблиц<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"
                    |ВЫБРАТЬ
                    |	РасходнаяНакладнаяТовары.Товар КАК Товар,
                    |	СУММА(РасходнаяНакладнаяТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.РасходнаяНакладная.Товары КАК РасходнаяНакладнаяТовары
                    |ГДЕ
                    |	РасходнаяНакладнаяТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	РасходнаяНакладнаяТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество
                    |ИЗ
                    |	ВТ КАК ВТ"</span><span class="vue-r">;</span>

                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>

                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                    <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span> 
                        <span class="vue-g">// регистр ОстаткиТоваров Приход</span>
                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Товар <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">; 
                    КонецЦикла;
                КонецЕсли;</span> 
                
                <span class="vue-g">//вот так выглядит блокировка записей регистра с остатками именно
                //тех товаров, которые му тут пытаемся получить. Как я понял
                //вся таблица регистра не блокируется. Заблокируются те записи,
                //у которых в измерениях Товар и Склад будет то же что и у набора
                //записей выше. Например, если мы продаём Ложки со склада Основной,
                //то в регистре заблокируются все записи приходные и расходные
                //где есть Товар Ложки со Склад - Основной 
                //Теперь никто не сможет прочитать остатки по нашим товарам до конца транзакции
                //Это инструкция это ещё не сама блокировка, а указание, что нужно заблокировать
                //блокировка наступит в миг когда произойдёт запись движений в регистр
                //Эта строка с блокировкой также запретит разделение итогов
                //Что такое разделение итогов можно посмотреть в шпоре
                //И ещё одно замечание. Эта строка блокировки работает, когда
                //движения для текущего документа уже записаны. Они записаны и мы можем
                //заблокировать этот набор записей</span>
                Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>БлокироватьДляИзменения <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                
                <span class="vue-g">//Когда мы указываем вот так записать, то происходит запись наборов записей во
                //все регистры подчинённые данному документу. И запись произойдёт только
                //если для этих наборов установлен флаг Записывать в Истина
                //Например, для такой строки - Движения.ОстаткиТоваров.Записать() флаг можно в истину не ставить </span>      
                Движения<span class="vue-r">.</span>Записать<span class="vue-r">();</span>
                
                <span class="vue-g">//выше мы записали сразу в регистр количество товаров, которые хотим продать
                //и теперь в запросе получаем из него остатки, которые ушли в минус
                //если такие есть, то документ не проводим
                //Этот запрос мы не инициализируем как новый объект, а продолжаем использовать
                //старый, созданный выше, меняем только текст запроса. Выше в запросе мы помещали
                //результат во временную таблицу и сейчас у нас в памяти висит эта временная таблица,
                //благодаря менеджеру временных таблиц,
                //а значит мы можем к ней обратиться в новом тексте запроса.</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ	
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Товар) КАК ТоварП,
                    |	ОстаткиТоваровОстатки.КоличествоОстаток КАК КоличествоОстаток
                    |ИЗ
                    |	РегистрНакопления.ОстаткиТоваров.Остатки(
                    |			&МоментВремени,
                    |			Склад = &Склад И 
                    |			Товар В
                    |				(ВЫБРАТЬ
                    |					ВТ.Товар КАК Товар
                    |				ИЗ
                    |					ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки 
                    |ГДЕ
                    |	ОстаткиТоваровОстатки.КоличествоОстаток &lt; 0"</span><span class="vue-r">;</span>
                
                <span class="vue-g">//это то же самое, что прибавить 1 секунду к дате, чтобы данные текущего документа
                //уже учитывались при расчёте остатков
                //если задать просто МоментВремени(), то вернутся остатки до влияния текущего
                //документа на них</span> 
                Граница <span class="vue-r">= Новый</span> Граница<span class="vue-r">(</span>МоментВремени<span class="vue-r">(),</span> ВидГраницы<span class="vue-r">.</span>Включая<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"МоментВремени"</span><span class="vue-r">,</span> Граница<span class="vue-r">);</span>	
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">,</span> Склад<span class="vue-r">);</span>
                <span class="vue-g">//в условии виртуальной таблицы Остатки выше мы отбираем те товары
                //которые есть в табличной части документа -> Товары В (Вложенный запрос)
                //Но можно сделать и без вложенного запроса -> Товары В (&МассивТоваров)
                //нам нужен массив товаров для параметра. Мы можем получить такой массив вот так:
                //Запрос.УстановитьПараметр("МассивТоваров", Товары.ВыгрузитьКолонку("Товар"));	</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                
                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                
                    <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                        СообщениеП <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                        СообщениеП<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не хватает товара "</span> <span class="vue-r">+</span> Выборка.ТоварП <span class="vue-r">+</span> <span class="vue-bl">" в количестве "</span> <span class="vue-r">+ (-</span>Выборка<span class="vue-r">.</span>КоличествоОстаток<span class="vue-r">);</span>
                        СообщениеП<span class="vue-r">.</span>Сообщить<span class="vue-r">();
                    КонецЦикла;</span>
                    Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;
                КонецЕсли;</span>

                <span class="vue-r">Если</span> Отказ <span class="vue-r">Тогда
                    Возврат;
                КонецЕсли;</span> 

                <span class="vue-g">//Объясняю!!! У Чистова при оперативном проведении(на текущую дату) документа
                //всё хорошо, но стоит только перепровести документ, как система ставит новую
                //дату документа, точнее время и происходит попытка новой записи движений в регистре
                //потому что дата другая, отличается от той что раньше была записана, а значит
                //предыдущий набор записей в регистре не удаляется. Получается, что при оперативном
                //перепроведении всё время пишутся новые наборы записей и товары уменьшаются.
                //По этой причине нам нужно определить, режим проведения оперативный? Если да
                //то запишем пустой набор записей в регистр для данного документа, таким образом
                //удалятся старые движения
                //У себя я такой проблемы не заметил, у меня при оперативном перепроведении 
                //движения перезаписываются системой сами, может разработчики исправили.
                //Поэтом закоментирую пока у себя эту проверку, посмотрим как это скажется
            
                //Если Режим = РежимПроведенияДокумента.Оперативный Тогда
                //	Движения.ОстаткиСебестоимостиТоваров.Записать();		
                //КонецЕсли;
                                        


                //следующий пакет запроса. Здесь мы уже получаем данные из ВТ и 
                //вирт. таб. ОстаткиСебестоимостиТоваров.Остатки, чтобы была
                //возможность заполнить расходные движения регистра ОстаткиСебестоимостиТоваров, 
                //а именно нужны данные для вычисления себестоимости по средней
                //в запросе мы к временной таблице присоединяем таблицу остатков
                //поэтому в таблице остатков может не быть каких то записей и система
                //там проставит NULL. В данном случае не надо всем числовым полям таблице с остатками, ставить
                //проверку ЕСТЬNULL(), хватит одному полю, которое мы будем проверять в цикле,
                //потому что функция ЕСТЬNULL() довольно медленная и не нужно всем подряд полям её ставить
                //Вот мы в цикле выбрали проверку поля КоличествоОстаток на равенство 0, всё этого поля нам хватит  
                //БЛОКИРОВКА. Заблокировать набор записей в регистре  ОстаткиСебестоимостиТоваров для текущего документа
                //уже не получится так как было выше одной строкой, потому что у нас нет записей для этого документа в регистре
                //мы запрашиваем записи из регистра чужих документов. Поэтому придётся самим описать блокировку.</span>

                Блокировка <span class="vue-r">= Новый</span> БлокировкаДанных<span class="vue-r">;</span>
                ЭлементБлокировки <span class="vue-r">=</span> Блокировка<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"РегистрНакопления.ОстаткиСебестоимостиТоваров"<span class="vue-r"></span>);</span>
                ЭлементБлокировки<span class="vue-r">.</span>Режим <span class="vue-r">=</span> РежимБлокировкиДанных<span class="vue-r">.</span>Исключительный<span class="vue-r">;</span> 
                <span class="vue-g">//дальше нужно указать источник данных, по данным которого будем ставить блокировку
                //У нас есть измерение Товар, нам нужно знать по каким товарам заблокировать записи
                //Товары у нас хранятся в табличной части Товары</span>
                ЭлементБлокировки<span class="vue-r">.</span>ИсточникДанных <span class="vue-r">=</span> Товары<span class="vue-r">;</span>
                <span class="vue-g">//Дальше в методе первый параметр это измерение регистра по которому будем делать отбор, указываем "Товар"
                //второй параметр это поле табличной части Товары, данные этого поля это значение для отбора
                //Например, выбрать запись где измерение Товар = "Ложка", Товар = "Вилка"    
                //В результате мы установим блокировку на записи в регистре с товарами равными товарам из табличной части</span>
                ЭлементБлокировки<span class="vue-r">.</span>ИспользоватьИзИсточникаДанных<span class="vue-r">(</span><span class="vue-bl">"Товар"</span><span class="vue-r">,</span> <span class="vue-bl">"Товар"</span><span class="vue-r">);</span>
                Блокировка<span class="vue-r">.</span>Заблокировать<span class="vue-r">();</span>    

                <span class="vue-g">//если мы документ перепроводим, то у нас есть старые записи для этого документа
                //и способ выше их не заблокирует, поэтому тут можно применить строку с блокировкой.
                //Этот момент не понял. Ну если мы перепроводим, то у нас способ выше заблокирует
                //записи с товарами из табличной части, старые записи будут содержать такие же товары
                //значит должны заблокироваться, а если мы изменили товары в табличной части, то
                //зачем нам тогда блокировать старые? Короче пока не понятно. Понятно то, что
                //кроме блокировки старых записей ещё будет отключено разделение итогов.
                //А разделение итогов нужно отключать если проводятся документы продажи товаров </span>
                Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>БлокироватьДляИзменения <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>Записать<span class="vue-r">();</span>	

                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество,
                    |	ЕСТЬNULL(ОстаткиСебестоимостиТоваров.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ОстаткиСебестоимостиТоваров.СебестоимостьОстаток КАК СебестоимостьОстаток
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиСебестоимостиТоваров.Остатки(
                    |				&МоментВремени,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиСебестоимостиТоваров
                    |		ПО ВТ.Товар = ОстаткиСебестоимостиТоваров.Товар"</span><span class="vue-r">;</span>
                
                <span class="vue-g">//если документ будет перепроводится, то нам нужны остатки до влияния
                //этого документа на остатки, поэтому и параметр МоментВремени()</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"МоментВремени"</span><span class="vue-r">,</span> МоментВремени<span class="vue-r">());</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>

                
                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                
                    <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span> 
                        <span class="vue-g">//так как деление на 0 это ошибка, поэтому проверяем это поле
                        //Если это поле будет равно 0, значит записей в регистре нет для данного товара
                        //значит останавливаем проведение документа</span>
                        <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">=</span> 0 <span class="vue-r">Тогда</span>
                            <span class="vue-g">//Почему такое сообщение, что есть расхождения?
                            //Выше есть запрос к остаткам товаров на складе и если мы дошли до
                            //этого кода, то остатки на складе были, ну а если мы зашли в эту проверку
                            //то остаков себестоимости по этому товару нет. Значит получилось
                            //так, что есть расхождения в остатках в этих двух регистрах</span>
                            Сообщить<span class="vue-r">(</span><span class="vue-bl">"Остаток себестоимости не совпадает с остатками на складе"</span><span class="vue-r">);</span>
                            Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;
                            Возврат;	
                        КонецЕсли;</span>

                        <span class="vue-g">// регистр ОстаткиСебестоимостиТоваров Приход</span>
                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Товар <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;</span>

                        <span class="vue-g">//вот такая формула нахождения себестоимости из-за проблем округления может оставить копейки в остатках	
                        //Движение.Себестоимость = (Выборка.СебестоимостьОбщ / Выборка.КоличествоОбщ) * Выборка.Количество;
                
                        //а вот такая формула будет без остатков копеек, так обещает Чистов</span>
                        Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество <span class="vue-r">/</span> Выборка<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">*</span> Выборка<span class="vue-r">.</span>СебестоимостьОстаток<span class="vue-r">;	
                    КонецЦикла;
                КонецЕсли;</span>
            
                <span class="vue-g">//если выше буду очищать набор записей для этого регистра, то
                //запись снимает флаг Записывать в ложь, поэтому внизу мы 
                //разместили эту инструкцию, чтобы флаг снова стал Истина и 
                //новый движения записались в регистр</span>
                Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;   
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document22">(Курс Чистова 8.3) Партионный учёт, продажа товара и списание себестоимости методом <b>ФИФО</b>.</b></p>
    <div class="code-style">
        <pre>
            --модуль объекта, процедура "ОбработкаПроведения" документа "РасходнаяНакладная"

            <span class="vue-g">//тут Чистов делает проверку остатков товара немного другим способом
            //мы сразу записываем в регистр товары, которые хотим продать, блокируем регистр,
            //затем делаем запрос в регистр и получаем остатки наших товаров,
            //у которых есть остаток в минусе. Если есть такие товары с минусом
            //то мы отказываемся от транзакции записи, т.е. записи из регистра
            //система сама удалит и также удалит записи документа из БД
            //Как утверждает Чистов, то такой способ проверки остатков
            //более быстродейственнее, из-за того, что мы сначала всё записали
            //и только потом проверили есть ли отрицательные остатки. 
            //В другом способе, он описан в курсе 8.2, мы сначала сразу начинаем
            //проверять остатки и только потом записываем.</span>
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> Режим<span class="vue-r">)</span>
                Движения<span class="vue-r">.</span>Взаиморасчеты<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span> 
                Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span> 

                <span class="vue-g">//регистр Взаиморасчеты Приход</span>
                Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>Взаиморасчеты<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Контрагент <span class="vue-r">=</span> Контрагент<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> СуммаИтого<span class="vue-r">;</span>
                
                <span class="vue-g">////Это первый способ как получить и свернуть одинаковые товары
                ////В первом параметре указываем колонки для свёртывания, во втором 
                ////параметре колонки для суммирования. Колонки которые мы не указали
                ////не войдут в новую свёрнутую таблицу.
                //ТЗ = Товары.Выгрузить();
                //ТЗ.Свернуть("Товар", "Количество"); 


                //Это второй способ получить и свернуть товары, через запрос 
                //Что быстрее работает, через запрос или через ТЗ не известно
                //Нужно будет проверить
                //В этом запросе мы поместим результат во временную таблицу
                //и сразу получим из неё данные. Временная таблица нужна будет
                //в запросе ниже, для отбора товаров из таблицы остатков 
                //Чтобы временная таблица сохранилась в памяти, нужно создать объект
                //менеджера временных таблиц и он сам всё сделает
                //Использование временных таблиц будет оправдано, если нам
                //она будет нужна несколько раз. Если же используем один раз,
                //то во вложенном запросе ниже можно и сразу получить товары из документа,
                //потому что для временной таблицы нужно построить в базе саму эту таблицу,
                //а это затраты ресурсов. В этой процедуре мы используем раза 2 обращение
                //к временной таблице в рваных запросах 
                //Кстати!!! Вот так можно посмотреть что лежит во временной таблице
                //Запрос.МенеджерВременныхТаблиц.Таблицы[0].ПолучитьДанные().Выгрузить();</span>
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>МенеджерВременныхТаблиц <span class="vue-r">=</span> Новый МенеджерВременныхТаблиц<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"
                    |ВЫБРАТЬ
                    |	РасходнаяНакладнаяТовары.Товар КАК Товар,
                    |	СУММА(РасходнаяНакладнаяТовары.Количество) КАК Количество
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.РасходнаяНакладная.Товары КАК РасходнаяНакладнаяТовары
                    |ГДЕ
                    |	РасходнаяНакладнаяТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	РасходнаяНакладнаяТовары.Товар
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество
                    |ИЗ
                    |	ВТ КАК ВТ"</span><span class="vue-r">;</span>

                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>

                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                    <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span> 
                        <span class="vue-g">// регистр ОстаткиТоваров Приход</span>
                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Товар <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">; 
                    КонецЦикла;
                КонецЕсли;</span> 
                
                <span class="vue-g">//вот так выглядит блокировка набора записей регистра с остатками именно
                //тех товаров, которые мы тут пытаемся получить. Как я понял
                //вся таблица регистра не блокируется. Заблокируются те записи,
                //у которых в измерениях Товар и Склад будет то же что и у набора
                //записей, который мы записали выше. Например, если мы продаём Ложки со склада Основной,
                //то в регистре заблокируются все записи приходные и расходные
                //где есть Товар Ложки со Складом - Основной 
                //Теперь никто не сможет прочитать остатки по нашим товарам до конца транзакции
                //Эта инструкция ещё не сама блокировка, а указание, что нужно будет заблокировать.
                //Блокировка наступит в миг когда произойдёт запись движений в регистр.
                //Эта инструкция также запретит разделение итогов, таким образом документ
                //приходования товаров не сможет записать такие же товары в итоги, будет ждать в очереди
                //Что такое разделение итогов можно посмотреть в шпоре по  словам "ключевые итоги".
                //Эта инструкция блокировки работает, когда
                //набор записей уже записан в регистр. Они записаны и мы можем
                //заблокировать все записи по измерениям из этого набора записей.
                //Если нужно блокировать записи, а набор записей ещё не записан в регистр, 
                //то нужно использовать класс "БлокировкаДанных"</span>
                Движения<span class="vue-r">.</span>ОстаткиТоваров<span class="vue-r">.</span>БлокироватьДляИзменения <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                
                <span class="vue-g">//Когда мы указываем вот так записать, то происходит запись наборов записей во
                //все регистры подчинённые данному документу. И запись произойдёт только
                //если для этих наборов установлен флаг Записывать в Истина
                //Например, для такой строки - Движения.ОстаткиТоваров.Записать() флаг можно в истину не ставить </span>      
                Движения<span class="vue-r">.</span>Записать<span class="vue-r">();</span>
                
                <span class="vue-g">//выше мы записали сразу в регистр количество товаров, которые хотим продать
                //и теперь в запросе получаем из него остатки, которые ушли в минус
                //если такие есть, то документ не проводим
                //Этот запрос мы не инициализируем как новый объект, а продолжаем использовать
                //старый, созданный выше, меняем только текст запроса. Выше в запросе мы помещали
                //результат во временную таблицу и сейчас у нас в памяти висит эта временная таблица,
                //благодаря менеджеру временных таблиц,
                //а значит мы можем к ней обратиться в новом тексте запроса.</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ	
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Товар) КАК ТоварП,
                    |	ОстаткиТоваровОстатки.КоличествоОстаток КАК КоличествоОстаток
                    |ИЗ
                    |	РегистрНакопления.ОстаткиТоваров.Остатки(
                    |			&МоментВремени,
                    |			Склад = &Склад И 
                    |			Товар В
                    |				(ВЫБРАТЬ
                    |					ВТ.Товар КАК Товар
                    |				ИЗ
                    |					ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки 
                    |ГДЕ
                    |	ОстаткиТоваровОстатки.КоличествоОстаток &lt; 0"</span><span class="vue-r">;</span>
                
                <span class="vue-g">//это то же самое, что прибавить 1 секунду к дате, чтобы данные текущего документа
                //уже учитывались при расчёте остатков
                //если задать просто МоментВремени(), то вернутся остатки до влияния текущего
                //документа на них</span> 
                Граница <span class="vue-r">= Новый</span> Граница<span class="vue-r">(</span>МоментВремени<span class="vue-r">(),</span> ВидГраницы<span class="vue-r">.</span>Включая<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"МоментВремени"</span><span class="vue-r">,</span> Граница<span class="vue-r">);</span>	
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Склад"</span><span class="vue-r">,</span> Склад<span class="vue-r">);</span>
                <span class="vue-g">//в условии виртуальной таблицы Остатки выше мы отбираем те товары
                //которые есть в табличной части документа -> Товары В (Вложенный запрос)
                //Но можно сделать и без вложенного запроса -> Товары В (&МассивТоваров)
                //нам нужен массив товаров для параметра. Мы можем получить такой массив вот так:
                //Запрос.УстановитьПараметр("МассивТоваров", Товары.ВыгрузитьКолонку("Товар"));	</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                
                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                
                    <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                        СообщениеП <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                        СообщениеП<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не хватает товара "</span> <span class="vue-r">+</span> Выборка.ТоварП <span class="vue-r">+</span> <span class="vue-bl">" в количестве "</span> <span class="vue-r">+ (-</span>Выборка<span class="vue-r">.</span>КоличествоОстаток<span class="vue-r">);</span>
                        СообщениеП<span class="vue-r">.</span>Сообщить<span class="vue-r">();
                    КонецЦикла;</span>
                    Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;
                КонецЕсли;</span>

                <span class="vue-r">Если</span> Отказ <span class="vue-r">Тогда
                    Возврат;
                КонецЕсли;</span> 

                <span class="vue-g">//Объясняю!!! У Чистова при оперативном проведении(на текущую дату) документа
                //всё хорошо, но стоит только перепровести документ, как система ставит новую
                //дату документа, точнее время и происходит попытка новой записи движений в регистре
                //потому что дата другая, отличается от той что раньше была записана, а значит
                //предыдущий набор записей в регистре не удаляется. Получается, что при оперативном
                //перепроведении всё время пишутся новые наборы записей и товары уменьшаются.
                //По этой причине нам нужно определить, режим проведения оперативный? Если да
                //то запишем пустой набор записей в регистр для данного документа, таким образом
                //удалятся старые движения
                //У себя я такой проблемы не заметил, у меня при оперативном перепроведении 
                //движения перезаписываются системой сами, может разработчики исправили.
                //Поэтом закоментирую пока у себя эту проверку, посмотрим как это скажется
            
                //Если Режим = РежимПроведенияДокумента.Оперативный Тогда
                //	Движения.ОстаткиСебестоимостиТоваров.Записать();		
                //КонецЕсли;
                                        


                //следующий пакет запроса. Здесь мы уже получаем данные из ВТ и 
                //вирт. таб. ОстаткиСебестоимостиТоваров.Остатки, чтобы была
                //возможность заполнить расходные движения регистра ОстаткиСебестоимостиТоваров, 
                //а именно нужны данные для вычисления себестоимости по средней
                //в запросе мы к временной таблице присоединяем таблицу остатков
                //поэтому в таблице остатков может не быть каких то записей и система
                //там проставит NULL. В данном случае не надо всем числовым полям таблице с остатками, ставить
                //проверку ЕСТЬNULL(), хватит одному полю, которое мы будем проверять в цикле,
                //потому что функция ЕСТЬNULL() довольно медленная и не нужно всем подряд полям её ставить
                //Вот мы в цикле выбрали проверку поля КоличествоОстаток на равенство 0, всё этого поля нам хватит  
                //БЛОКИРОВКА. Заблокировать набор записей в регистре  ОстаткиСебестоимостиТоваров для текущего документа
                //уже не получится так как было выше одной строкой, потому что у нас нет записей для этого документа в регистре
                //мы запрашиваем записи из регистра чужих документов. Поэтому придётся самим описать блокировку.</span>

                Блокировка <span class="vue-r">= Новый</span> БлокировкаДанных<span class="vue-r">;</span>
                ЭлементБлокировки <span class="vue-r">=</span> Блокировка<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"РегистрНакопления.ОстаткиСебестоимостиТоваров"<span class="vue-r"></span>);</span>
                ЭлементБлокировки<span class="vue-r">.</span>Режим <span class="vue-r">=</span> РежимБлокировкиДанных<span class="vue-r">.</span>Исключительный<span class="vue-r">;</span> 
                <span class="vue-g">//дальше нужно указать источник данных, по данным которого будем ставить блокировку
                //У нас есть измерение Товар, нам нужно знать по каким товарам заблокировать записи
                //Товары у нас хранятся в табличной части Товары</span>
                ЭлементБлокировки<span class="vue-r">.</span>ИсточникДанных <span class="vue-r">=</span> Товары<span class="vue-r">;</span>
                <span class="vue-g">//Дальше в методе первый параметр это измерение регистра по которому будем делать отбор, указываем "Товар"
                //второй параметр это поле табличной части Товары, данные этого поля это значение для отбора
                //Например, выбрать запись где измерение Товар = "Ложка", Товар = "Вилка"    
                //В результате мы установим блокировку на записи в регистре с товарами равными товарам из табличной части</span>
                ЭлементБлокировки<span class="vue-r">.</span>ИспользоватьИзИсточникаДанных<span class="vue-r">(</span><span class="vue-bl">"Товар"</span><span class="vue-r">,</span> <span class="vue-bl">"Товар"</span><span class="vue-r">);</span>
                Блокировка<span class="vue-r">.</span>Заблокировать<span class="vue-r">();</span>    

                <span class="vue-g">//если мы документ перепроводим, то у нас есть старые записи для этого документа
                //и способ выше их не заблокирует, поэтому тут можно применить строку с блокировкой.
                //Этот момент не понял. Ну если мы перепроводим, то у нас способ выше заблокирует
                //записи с товарами из табличной части, старые записи будут содержать такие же товары
                //значит должны заблокироваться, а если мы изменили товары в табличной части, то
                //зачем нам тогда блокировать старые? Короче пока не понятно. Понятно то, что
                //кроме блокировки старых записей ещё будет отключено разделение итогов.
                //А разделение итогов нужно отключать если проводятся документы продажи товаров </span>
                Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>БлокироватьДляИзменения <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>Записать<span class="vue-r">();</span>	

                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                        |	ВТ.Товар КАК Товар,
                        |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                        |	ВТ.Количество КАК Количество,
                        |	ОстаткиСебестоимостиТоваров.Партия КАК Партия,
                        |	ЕСТЬNULL(ОстаткиСебестоимостиТоваров.КоличествоОстаток, 0) КАК КоличествоОстаток,
                        |	ОстаткиСебестоимостиТоваров.СебестоимостьОстаток КАК СебестоимостьОстаток
                        |ИЗ
                        |	ВТ КАК ВТ
                        |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиСебестоимостиТоваров.Остатки(
                        |				&МоментВремени,
                        |				Товар В
                        |					(ВЫБРАТЬ
                        |						ВТ.Товар КАК Товар
                        |					ИЗ
                        |						ВТ КАК ВТ)) КАК ОстаткиСебестоимостиТоваров
                        |		ПО ВТ.Товар = ОстаткиСебестоимостиТоваров.Товар
                        |
                        |УПОРЯДОЧИТЬ ПО
                        |	ОстаткиСебестоимостиТоваров.Партия.МоментВремени,
                        |	ОстаткиСебестоимостиТоваров.Товар.Наименование
                        |ИТОГИ
                        |	МИНИМУМ(Количество),
                        |	СУММА(КоличествоОстаток)
                        |ПО
                        |	Товар"</span><span class="vue-r">;</span>
                
                <span class="vue-g">//если документ будет перепроводится, то нам нужны остатки до влияния
                //этого документа на остатки, поэтому и параметр МоментВремени()</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"МоментВремени"</span><span class="vue-r">,</span> МоментВремени<span class="vue-r">());</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>

                
                <span class="vue-r">Если НЕ</span> РезультатЗапроса<span class="vue-r">.</span>Пустой<span class="vue-r">() Тогда</span>
                    ВыборкаИтогов <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">(</span>ОбходРезультатаЗапроса<span class="vue-r">.</span>ПоГруппировкам<span class="vue-r">);</span>
        
                    <span class="vue-r">Пока</span> ВыборкаИтогов<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл </span>
                        <span class="vue-g">//так как деление на 0 это ошибка, поэтому проверяем это поле
                        //Если это поле будет равно 0, значит записей в регистре нет для данного товара
                        //значит останавливаем проведение документа</span>
                        <span class="vue-r">Если</span> Выборка<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">=</span> 0 <span class="vue-r">Тогда</span>
                            <span class="vue-g">//Почему такое сообщение, что есть расхождения?
                            //Выше есть запрос к остаткам товаров на складе и если мы дошли до
                            //этого кода, то остатки на складе были, ну а если мы зашли в эту проверку
                            //то остаков себестоимости по этому товару нет. Значит получилось
                            //так, что есть расхождения в остатках в этих двух регистрах</span>
                            Сообщить<span class="vue-r">(</span><span class="vue-bl">"Остаток себестоимости не совпадает с остатками на складе"</span><span class="vue-r">);</span>
                            Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;
                            Возврат;	
                        КонецЕсли;</span>
            
                        <span class="vue-r">Если</span> ВыборкаИтогов<span class="vue-r">.</span>Количество <span class="vue-r">></span> ВыборкаИтогов<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">Тогда</span>
                            СообщениеП <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не хватает товара "</span> <span class="vue-r">+</span> ВыборкаИтогов<span class="vue-r">.</span>ТоварП<span class="vue-r">;</span>
                            СообщениеП<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span>
            
                            Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;
                            Продолжить;
                        КонецЕсли;</span>
            
                        <span class="vue-g">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество <span class="vue-r">=</span> ВыборкаИтогов<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                        
                        <span class="vue-g">//из текущей записи верхнего уровня с итогами выбираем его детальные записи</span>
                        ВыборкаДетальных <span class="vue-r">=</span> ВыборкаИтогов<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                        <span class="vue-r">Пока</span> ВыборкаДетальных<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span> 
                            <span class="vue-g">//если есть что списывать, то идём внутрь. Если у нас партии упорядочены по возрастанию, 
                            //то вот здесь и начинается списание и вычисление себестоимости по методу ФИФО </span>
                            <span class="vue-r">Если</span> СписываемоеКоличество <span class="vue-r">></span> 0 <span class="vue-r">Тогда</span>
                                <span class="vue-g">// регистр ОстаткиСебестоимостиТоваров Приход</span>
                                Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                                Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                                Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                                Движение<span class="vue-r">.</span>Товар <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                                Движение<span class="vue-r">.</span>Партия <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>Партия<span class="vue-r">;</span>
                            
                                <span class="vue-r">Если</span> СписываемоеКоличество <span class="vue-r">&lt;=</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">Тогда</span>
                                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> СписываемоеКоличество<span class="vue-r">;</span>
                                    Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> СписываемоеКоличество <span class="vue-r">/</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоОстаток <span class="vue-r">*</span> ВыборкаДетальных<span class="vue-r">.</span>СебестоимостьОстаток<span class="vue-r">;</span>
                                    СписываемоеКоличество <span class="vue-r">=</span> СписываемоеКоличество <span class="vue-r">-</span> СписываемоеКоличество<span class="vue-r">;
                                Иначе</span>
                                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоОстаток<span class="vue-r">;</span>
                                    Движение<span class="vue-r">.</span>Себестоимость <span class="vue-r">=</span> ВыборкаДетальных<span class="vue-r">.</span>СебестоимостьОстаток<span class="vue-r">;</span>
                                    СписываемоеКоличество <span class="vue-r">=</span> СписываемоеКоличество <span class="vue-r">-</span> ВыборкаДетальных<span class="vue-r">.</span>КоличествоОстаток<span class="vue-r">;
                                КонецЕсли;
            
                            КонецЕсли;
                        КонецЦикла; 	
                    КонецЦикла;
                КонецЕсли;</span></span>
            
                <span class="vue-g">//если выше буду очищать набор записей для этого регистра, то
                //запись снимает флаг Записывать в ложь, поэтому внизу мы 
                //разместили эту инструкцию, чтобы флаг снова стал Истина и 
                //новый движения записались в регистр</span>
                Движения<span class="vue-r">.</span>ОстаткиСебестоимостиТоваров<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;   
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="document23">(Курс Чистова 8.3)Как правильно построить отчёт о продажах товара</b></p>
    <p>Мы могли бы построить отчёт на данных табличных частей документа, откуда мы бы брали Сумму(Выручка) проданного товара и на регистре накопления "ОстаткиСебестоимостиТоваров" в режиме "Остатки", из виртуальной таблицы "ОстаткиСебестоимостиТоваров.Обороты" которого брали бы данные поля "СебестоимостьРасход", но у этого способа есть минусы.</p> 
    <p>Во-первых, обращение к табличным частям документа это долго. Но это ещё не самое страшное. Пострашнее это обращение к регистру накопления, а точнее к его виртуальной таблице "Обороты". Этот регистр работает в режиме "Остатки", а мы получаем поле "СебестоимостьРасход" из виртуальной таблицы ОстаткиСебестоимостиТоваров.Обороты. Как говорит Чистов это плохо, потому что для получения такого поля регистр снова бегает по регистру движений "ОстаткиСебестоимостиТоваров" и заного подсчитывает данные для этого поля. Потому что у регистра накопления движений в режиме "Остатки" нету итоговой таблицы для хранения подсчитанных оборотовых данных, а для хранения остатков такая итоговая таблица есть. А вот в режиме "Обороты" итоговая таблица есть для оборотов, которая заранее уже содержит промежуточные итоги. Но переделывать регистр накопления работающий в режиме остатков в режим оборотов будет неправильно. Поэтому выходом тут будет построение нового регистра накопления в режиме "Оборотов". Хотя такой описанный способ получения данных для анализа может подойти где-нибудь в типовой конфигурации, когда не нужно создавать никаких новых объектов конфигурации, а можно только использовать то что имеется.</p>
    <p>В третьих, кто сказал, что в поле "СебестоимостьРасход" виртуальной таблицы оборотов всегда будет лежать именно себестоимость проданных товаров? Тут у меня есть вопросы. Чистов говорит, что могут быть разные случаи: пожар, украли, вернули и т.д.,  и из-за этого в этом поле может быть разные данные, не обязательно себестоимость проданных товаров. Тогда мне не понятны следующие точки его рассказа:</p>
    <ul class="list">
        <li>Ну вот украли, сгорел, вернули товар. И что теперь у товара пропала из-за этого себестоимость? Ну допустим украли товар, мы его наверно каким то документом списываем, но при списании мы же указываем себестоимость украденного товара. Аааа, кажется я понял, в этом поле всегда будет себестоимость товара лежать, разница в том, себестоимость какого товара? Проданного, сгоревшего, который украли, вернули и т.д. Мы то строим отчёт только по проданным товарам, а у нас в регистре могут лежать в поле "Себестоимость" себестоимость товаров, например, сгоревших и мы эти сгоревшие посчитаем, как-будто проданные. Вот про эту причину и говорил Чистов, по которой мы не можем составить правильный отчёт по продажам по данному регистру. Пока понятно, другие вопросы отпали сами.</li>
    </ul>
    <p>Итак, как выглядел бы запрос к данным по тому способу, который мы описали выше. Мы хотим построить отчёт о продаже товаров, чтобы в нём были поля с контаргентами, товарами, количеством проданных, себестоимостью проданных, выручкой, прибылью. У нас на миг создания такого отчёта есть только документы продажи и регистр накопления "ОстаткиСебестоимостиТоваров" в режиме "остатки", регистр кстати не имеет измерения Контрагенты. Из имеющихся данных можно слепить такой запрос:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">РасходнаяНакладнаяТовары</span><span class="vue-r">.</span>Товар <span class="vue-r">КАК</span> Товар<span class="vue-r">,</span>
                <span class="vue-g">РасходнаяНакладнаяТовары</span><span class="vue-r">.</span>Ссылка<span class="vue-r">.</span>Контрагент <span class="vue-r">КАК</span> Контрагент<span class="vue-r">,</span>
                <span class="vue-or">СУММА</span><span class="vue-r">(</span><span class="vue-g">РасходнаяНакладнаяТовары</span><span class="vue-r">.</span>Сумма<span class="vue-r">)</span> <span class="vue-r">КАК</span> Выручка
            <span class="vue-r">ПОМЕСТИТЬ</span> Продажи
            <span class="vue-r">ИЗ</span>
                Документ<span class="vue-r">.</span>РасходнаяНакладная<span class="vue-r">.</span>Товары <span class="vue-r">КАК</span> <span class="vue-g">РасходнаяНакладнаяТовары</span>

            <span class="vue-r">СГРУППИРОВАТЬ ПО</span>
                <span class="vue-g">РасходнаяНакладнаяТовары</span><span class="vue-r">.</span>Товар<span class="vue-r">,</span>
                <span class="vue-g">РасходнаяНакладнаяТовары</span><span class="vue-r">.</span>Ссылка<span class="vue-r">.</span>Контрагент
            <span class="vue-r">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ОстаткиСебестоимостиТоваровОбороты</span><span class="vue-r">.</span>Товар <span class="vue-r">КАК</span> Товар<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиСебестоимостиТоваровОбороты</span><span class="vue-r">.</span>Регистратор<span class="vue-r">.</span>Контрагент <span class="vue-r">КАК</span> РегистраторКонтрагент<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиСебестоимостиТоваровОбороты</span><span class="vue-r">.</span>КоличествоРасход <span class="vue-r">КАК</span> КоличествоРасход<span class="vue-r">,</span>
                <span class="vue-g">ОстаткиСебестоимостиТоваровОбороты</span><span class="vue-r">.</span>СебестоимостьРасход <span class="vue-r">КАК</span> СебестоимостьРасход
            <span class="vue-r">ПОМЕСТИТЬ</span> СебестоимостьПродаж
            <span class="vue-r">ИЗ</span>
                РегистрНакопления<span class="vue-r">.</span>ОстаткиСебестоиомстиТоваров<span class="vue-r">.</span>Обороты<span class="vue-r">(, ,</span> Регистратор<span class="vue-r">, ) КАК</span> <span class="vue-g">ОстаткиСебестоимостиТоваровОбороты</span>
            <span class="vue-r">;</span>

            ////////////////////////////////////////////////////////////////////////////////
            <span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">Продажи</span><span class="vue-r">.</span>Товар <span class="vue-r">КАК</span> Товар<span class="vue-r">,</span>
                <span class="vue-g">Продажи</span><span class="vue-r">.</span>Контрагент <span class="vue-r">КАК</span> Контрагент<span class="vue-r">,</span>
                <span class="vue-g">СебестоимостьПродаж</span><span class="vue-r">.</span>КоличествоРасход <span class="vue-r">КАК</span> КоличествоРасход<span class="vue-r">,</span>
                <span class="vue-g">СебестоимостьПродаж</span><span class="vue-r">.</span>СебестоимостьРасход <span class="vue-r">КАК</span> СебестоимостьРасход<span class="vue-r">,</span>
                <span class="vue-g">Продажи</span><span class="vue-r">.</span>Выручка <span class="vue-r">КАК</span> Выручка
            <span class="vue-r">ИЗ</span>
                Продажи <span class="vue-r">КАК</span> <span class="vue-g">Продажи</span>
                    <span class="vue-r">ЛЕВОЕ СОЕДИНЕНИЕ</span> СебестоимостьПродаж <span class="vue-r">КАК</span> <span class="vue-g">СебестоимостьПродаж</span>
                    <span class="vue-r">ПО</span> Продажи<span class="vue-r">.</span>Товар <span class="vue-r">=</span> СебестоимостьПродаж<span class="vue-r">.</span>Товар
                        <span class="vue-r">И</span> Продажи<span class="vue-r">.</span>Контрагент <span class="vue-r">=</span> СебестоимостьПродаж<span class="vue-r">.</span>РегистраторКонтрагент</span>
        </pre>
    </div>
    <p>Мы можем облегчить описанный выше способ получения данных. Можно исключить табличные части документа и использовать только регистр "ОстаткиСебестоимостиТоваров". Нам станет не доступно поле выручки для отчёта, поэтому мы добавим не измерение, а доп. реквизит "СуммаПродажи" в этот регистр. Документ будет писать в этот реквизит сумму товара(выручку). Чисто технически можно в запросе получить этот реквизит и расчитать поле Прибыль, но как говорит Чистов это полный бред.</p>
    <p>Но как и было сказано, такой способ нам не подходит. Правильней сделать другой регистр для сбора данных чисто о продажах. В регистр продаж мы не будем записывать товары, с которыми случилось что-то другое кроме продажи.</p>
    <p>Создадим регистр накопления "Продажи" в режиме оборотов. У него будет 2 измерения - Контрагенты и Номенклатура, 3 ресурса - Себестоимость, Количество, Выручка. Делать движения в этом регистре будет ТОЛЬКО документ продажи товаров, документы списывающие сгоревшие, украденные или другие товары в регистр "Продажи" писать не будут, чтобы у нас был регистр по сбору только проданных товаров. В этом и отличие его от регистра ОстаткиСебестоимостиТоваров. </p>
    <div class="code-style">
        <pre> 
            --модуль объекта, процедура "ОбработкаПроведения"

            <span class="vue-b">Процедура ОбработкаПроведения(Отказ, Режим)
                Движения.Взаиморасчеты.Записывать = Истина; 
                Движения.ОстаткиТоваров.Записывать = Истина; 

                <span class="vue-g">//регистр Взаиморасчеты Приход</span>
                Движение = Движения.Взаиморасчеты.Добавить(); 
                Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
                Движение.Период = Дата;
                Движение.Контрагент = Контрагент;
                Движение.Сумма = СуммаИтого;
                
                <span class="vue-g">////Это первый способ как получить и свернуть одинаковые товары
                ////В первом параметре указываем колонки для свёртывания, во втором 
                ////параметре колонки для суммирования. Колонки которые мы не указали
                ////не войдут в новую свёрнутую таблицу.
                //ТЗ = Товары.Выгрузить();
                //ТЗ.Свернуть("Товар", "Количество");</span>


                <span class="vue-g">//Это второй способ получить и свернуть товары, через запрос 
                //Что быстрее работает, через запрос или через ТЗ не известно
                //Нужно будет проверить
                //В этом запросе мы поместим результат во временную таблицу
                //и сразу получим из неё данные. Временная таблица нужна будет
                //в запросе ниже, для отбора товаров из таблицы остатков 
                //Чтобы временная таблица сохранилась в памяти, нужно создать объект
                //менеджера временных таблиц и он сам всё сделает
                //Использование временных таблиц будет оправдано, если нам
                //она будет нужна несколько раз. Если же используем один раз,
                //то во вложенном запросе ниже можно и сразу получить товары из документа,
                //потому что для временной таблицы нужно построить в базе саму эту таблицу,
                //а это затраты ресурсов. В этой процедуре мы используем раза 2 обращение
                //к временной таблице в рваных запросах 
                //Кстати!!! Вот так можно посмотреть что лежит во временной таблице
                //Запрос.МенеджерВременныхТаблиц.Таблицы[0].ПолучитьДанные().Выгрузить();</span>
                Запрос = Новый Запрос;
                Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
                Запрос.Текст = 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	РасходнаяНакладнаяТовары.Товар КАК Товар,
                    |	СУММА(РасходнаяНакладнаяТовары.Количество) КАК Количество,
                    |	СУММА(РасходнаяНакладнаяТовары.Сумма) КАК Выручка
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.РасходнаяНакладная.Товары КАК РасходнаяНакладнаяТовары
                    |ГДЕ
                    |	РасходнаяНакладнаяТовары.Ссылка = &Ссылка
                    |
                    |СГРУППИРОВАТЬ ПО
                    |	РасходнаяНакладнаяТовары.Товар,
                    |	РасходнаяНакладнаяТовары.Ссылка.Контрагент
                    |;
                    |
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ВТ.Количество КАК Количество
                    |ИЗ
                    |	ВТ КАК ВТ"</span>;

                Запрос.УстановитьПараметр(<span class="vue-bl">"Ссылка"</span>, Ссылка);
                РезультатЗапроса = Запрос.Выполнить();

                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                    Пока Выборка.Следующий() Цикл 
                        <span class="vue-g">// регистр ОстаткиТоваров Приход</span>
                        Движение = Движения.ОстаткиТоваров.Добавить();
                        Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                        Движение.Период = Дата;
                        Движение.Склад = Склад;
                        Движение.Товар = Выборка.Товар;
                        Движение.Количество = Выборка.Количество; 
                    КонецЦикла;
                КонецЕсли; 
                
                <span class="vue-g">//вот так выглядит блокировка набора записей регистра с остатками именно
                //тех товаров, которые мы тут пытаемся получить. Как я понял
                //вся таблица регистра не блокируется. Заблокируются те записи,
                //у которых в измерениях Товар и Склад будет то же что и у набора
                //записей, который мы записали выше. Например, если мы продаём Ложки со склада Основной,
                //то в регистре заблокируются все записи приходные и расходные
                //где есть Товар Ложки со Складом - Основной 
                //Теперь никто не сможет прочитать остатки по нашим товарам до конца транзакции
                //Эта инструкция ещё не сама блокировка, а указание, что нужно будет заблокировать.
                //Блокировка наступит в миг когда произойдёт запись движений в регистр.
                //Эта инструкция также запретит разделение итогов, таким образом документ
                //приходования товаров не сможет записать такие же товары в итоги, будет ждать в очереди
                //Что такое разделение итогов можно посмотреть в шпоре по  словам "ключевые итоги".
                //Эта инструкция блокировки работает, когда
                //набор записей уже записан в регистр. Они записаны и мы можем
                //заблокировать все записи по измерениям из этого набора записей</span>
                Движения.ОстаткиТоваров.БлокироватьДляИзменения = Истина;
                
                <span class="vue-g">//Когда мы указываем вот так записать, то происходит запись наборов записей во
                //все регистры подчинённые данному документу. И запись произойдёт только
                //если для этих наборов установлен флаг Записывать в Истина
                //Например, для такой строки - Движения.ОстаткиТоваров.Записать() флаг можно в истину не ставить </span>      
                Движения.Записать();
                
                <span class="vue-g">//выше мы записали сразу в регистр количество товаров, которые хотим продать
                //и теперь в запросе получаем из него остатки, которые ушли в минус
                //если такие есть, то документ не проводим
                //Этот запрос мы не инициализируем как новый объект, а продолжаем использовать
                //старый, созданный выше, меняем только текст запроса. Выше в запросе мы помещали
                //результат во временную таблицу и сейчас у нас в памяти висит эта временная таблица,
                //благодаря менеджеру временных таблиц,
                //а значит мы можем к ней обратиться в новом тексте запроса.</span>
                Запрос.Текст = 
                    <span class="vue-bl">"ВЫБРАТЬ	
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Товар) КАК ТоварП,
                    |	ПРЕДСТАВЛЕНИЕ(ОстаткиТоваровОстатки.Склад) КАК СкладП,
                    |	ОстаткиТоваровОстатки.КоличествоОстаток КАК КоличествоОстаток
                    |ИЗ
                    |	РегистрНакопления.ОстаткиТоваров.Остатки(
                    |			&МоментВремени,
                    |			Склад = &Склад И 
                    |			Товар В
                    |				(ВЫБРАТЬ
                    |					ВТ.Товар КАК Товар
                    |				ИЗ
                    |					ВТ КАК ВТ)) КАК ОстаткиТоваровОстатки 
                    |ГДЕ
                    |	ОстаткиТоваровОстатки.КоличествоОстаток &lt; 0"</span>;
                
                <span class="vue-g">//это то же самое, что прибавить 1 секунду к дате, чтобы данные текущего документа
                //уже учитывались при расчёте остатков
                //если задать просто МоментВремени(), то вернутся остатки до влияния текущего
                //документа на них </span>
                Граница = Новый Граница(МоментВремени(), ВидГраницы.Включая);
                Запрос.УстановитьПараметр(<span class="vue-bl">"МоментВремени"</span>, Граница);	
                Запрос.УстановитьПараметр(<span class="vue-bl">"Склад"</span>, Склад);
                <span class="vue-g">//в условии виртуальной таблицы Остатки выше мы отбираем те товары
                //которые есть в табличной части документа -> Товары В (Вложенный запрос)
                //Но можно сделать и без вложенного запроса -> Товары В (&МассивТоваров)
                //нам нужен массив товаров для параметра. Мы можем получить такой массив вот так:
                //Запрос.УстановитьПараметр("МассивТоваров", Товары.ВыгрузитьКолонку("Товар"));	</span>
                РезультатЗапроса = Запрос.Выполнить();
                
                Если НЕ РезультатЗапроса.Пустой() Тогда
                    Выборка = РезультатЗапроса.Выбрать();
                
                    Пока Выборка.Следующий() Цикл
                        СообщениеП = Новый СообщениеПользователю;
                        СообщениеП.Текст = <span class="vue-bl">"Не хватает товара "</span> + Выборка.ТоварП + <span class="vue-bl">" в количестве "</span> + (-Выборка.КоличествоОстаток) + <span class="vue-bl">" на складе """</span> + Выборка.СкладП + <span class="vue-bl">""""</span>;
                        СообщениеП.Сообщить();
                    КонецЦикла;
                    Отказ = Истина;
                КонецЕсли;

                Если Отказ Тогда
                    Возврат;
                КонецЕсли; 

                <span class="vue-g">//Объясняю!!! У Чистова при оперативном проведении(на текущую дату) документа
                //всё хорошо, но стоит только перепровести документ, как система ставит новую
                //дату документа, точнее время и происходит попытка новой записи движений в регистре
                //потому что дата другая, отличается от той что раньше была записана, а значит
                //предыдущий набор записей в регистре не удаляется. Получается, что при оперативном
                //перепроведении всё время пишутся новые наборы записей и товары уменьшаются.
                //По этой причине нам нужно определить, режим проведения оперативный? Если да
                //то запишем пустой набор записей в регистр для данного документа, таким образом
                //удалятся старые движения
                //У себя я такой проблемы не заметил, у меня при оперативном перепроведении 
                //движения перезаписываются системой сами, может разработчики исправили.
                //Поэтом закоментирую пока у себя эту проверку, посмотрим как это скажется</span>
            
                <span class="vue-g">//Если Режим = РежимПроведенияДокумента.Оперативный Тогда
                //	Движения.ОстаткиСебестоимостиТоваров.Записать();		
                //КонецЕсли;</span>
                                        


                <span class="vue-g">//следующий пакет запроса. Здесь мы уже получаем данные из ВТ и 
                //вирт. таб. ОстаткиСебестоимостиТоваров.Остатки, чтобы была
                //возможность заполнить расходные движения регистра ОстаткиСебестоимостиТоваров, 
                //а именно нужны данные для вычисления себестоимости по средней
                //в запросе мы к временной таблице присоединяем таблицу остатков
                //поэтому в таблице остатков может не быть каких то записей и система
                //там проставит NULL. В данном случае не надо всем числовым полям таблице с остатками, ставить
                //проверку ЕСТЬNULL(), хватит одному полю, которое мы будем проверять в цикле,
                //потому что функция ЕСТЬNULL() довольно медленная и не нужно всем подряд полям её ставить
                //Вот мы в цикле выбрали проверку поля КоличествоОстаток на равенство 0, всё этого поля нам хватит  
                //БЛОКИРОВКА. Заблокировать набор записей в регистре  ОстаткиСебестоимостиТоваров для текущего документа
                //уже не получится так как было выше одной строкой, потому что у нас нет записей для этого документа в регистре
                //мы запрашиваем записи из регистра чужих документов. Поэтому придётся самим описать блокировку.</span>

                Блокировка = Новый БлокировкаДанных;
                ЭлементБлокировки = Блокировка.Добавить("РегистрНакопления.ОстаткиСебестоимостиТоваров");
                ЭлементБлокировки.Режим = РежимБлокировкиДанных.Исключительный; 
                <span class="vue-g">//дальше нужно указать источник данных, по данным которого будем ставить блокировку
                //У нас есть измерение Товар, нам нужно знать по каким товарам заблокировать записи
                //Товары у нас хранятся в табличной части Товары</span>
                ЭлементБлокировки.ИсточникДанных = Товары;
                <span class="vue-g">//Дальше в методе первый параметр это измерение регистра по которому будем делать отбор, указываем "Товар"
                //второй параметр это поле табличной части Товары, данные этого поля это значение для отбора
                //Например, выбрать запись где измерение Товар = "Ложка", Товар = "Вилка"    
                //В результате мы установим блокировку на записи в регистре с товарами равными товарам из табличной части</span>
                ЭлементБлокировки.ИспользоватьИзИсточникаДанных(<span class="vue-bl">"Товар"</span>, <span class="vue-bl">"Товар"</span>);
                Блокировка.Заблокировать();    

                <span class="vue-g">//если мы документ перепроводим, то у нас есть старые записи для этого документа
                //и способ выше их не заблокирует, поэтому тут можно применить строку с блокировкой.
                //Этот момент не понял. Ну если мы перепроводим, то у нас способ выше заблокирует
                //записи с товарами из табличной части, старые записи будут содержать такие же товары
                //значит должны заблокироваться, а если мы изменили товары в табличной части, то
                //зачем нам тогда блокировать старые? Короче пока не понятно. Понятно то, что
                //кроме блокировки старых записей ещё будет отключено разделение итогов.
                //А разделение итогов нужно отключать если проводятся документы продажи товаров</span> 
                Движения.ОстаткиСебестоимостиТоваров.БлокироватьДляИзменения = Истина;
                Движения.ОстаткиСебестоимостиТоваров.Записать();	

                Запрос.Текст = 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	ВТ.Товар КАК Товар,
                    |	ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП,
                    |	ВТ.Количество КАК Количество,
                    |	ВТ.Выручка КАК Выручка,
                    |	ОстаткиСебестоимостиТоваров.Партия КАК Партия,
                    |	ЕСТЬNULL(ОстаткиСебестоимостиТоваров.КоличествоОстаток, 0) КАК КоличествоОстаток,
                    |	ОстаткиСебестоимостиТоваров.СебестоимостьОстаток КАК СебестоимостьОстаток
                    |ИЗ
                    |	ВТ КАК ВТ
                    |		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиСебестоимостиТоваров.Остатки(
                    |				&МоментВремени,
                    |				Товар В
                    |					(ВЫБРАТЬ
                    |						ВТ.Товар КАК Товар
                    |					ИЗ
                    |						ВТ КАК ВТ)) КАК ОстаткиСебестоимостиТоваров
                    |		ПО ВТ.Товар = ОстаткиСебестоимостиТоваров.Товар
                    |
                    |УПОРЯДОЧИТЬ ПО
                    |	ОстаткиСебестоимостиТоваров.Партия.МоментВремени,
                    |	ОстаткиСебестоимостиТоваров.Товар.Наименование
                    |ИТОГИ
                    |	МИНИМУМ(Количество),
                    |	СУММА(КоличествоОстаток),
                    |	МИНИМУМ(Выручка)
                    |ПО
                    |	Товар"</span>;
                
                <span class="vue-g">//если документ будет перепроводится, то нам нужны остатки до влияния
                //этого документа на остатки, поэтому и параметр МоментВремени()</span>
                Запрос.УстановитьПараметр(<span class="vue-bl">"МоментВремени"</span>, МоментВремени());
                РезультатЗапроса = Запрос.Выполнить();

                
                Если НЕ РезультатЗапроса.Пустой() Тогда
                    ВыборкаИтогов = РезультатЗапроса.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
                
                    Пока ВыборкаИтогов.Следующий() Цикл 
                        <span class="vue-g">//так как деление на 0 это ошибка, поэтому проверяем это поле
                        //Если это поле будет равно 0, значит записей в регистре нет для данного товара
                        //значит останавливаем проведение документа</span>
                        Если ВыборкаИтогов.КоличествоОстаток = 0 Тогда
                            <span class="vue-g">//Почему такое сообщение, что есть расхождения?
                            //Выше есть запрос к остаткам товаров на складе и если мы дошли до
                            //этого кода, то остатки на складе были, ну а если мы зашли в эту проверку
                            //то остаков себестоимости по этому товару нет. Значит получилось
                            //так, что есть расхождения в остатках в этих двух регистрах</span>
                            Сообщить(<span class="vue-bl">"Остаток себестоимости не совпадает с остатками на складе"</span>);
                            Отказ = Истина;
                            Возврат;	
                        КонецЕсли;

                        Если ВыборкаИтогов.Количество > ВыборкаИтогов.КоличествоОстаток Тогда
                            СообщениеП = Новый СообщениеПользователю;
                            СообщениеП.Текст = <span class="vue-bl">"Не хватает товара "</span> + ВыборкаИтогов.ТоварП;
                            СообщениеП.Сообщить();

                            Отказ = Истина;
                            Продолжить;
                        КонецЕсли;

                        <span class="vue-g">//в эту переменную помещается количество товара, которое мы хотим продать</span>
                        СписываемоеКоличество = ВыборкаИтогов.Количество;
                        
                        <span class="vue-g">//из текущей записи верхнего уровня с итогами выбираем его детальные записи</span>
                        ВыборкаДетальных = ВыборкаИтогов.Выбрать();
                        <span class="vue-g">//переменная для накопления себестоимостей товаров продаваемых по партиям, 
                        //чтобы потом эту общую себестоимость записать в регистр "Продажи"</span>
                        НакоплениеСебестоимости = 0;
                        Пока ВыборкаДетальных.Следующий() Цикл 
                            <span class="vue-g">//если есть что списывать, то идём внутрь. Если у нас партии упорядочены по возрастанию, 
                            //то вот здесь и начинается списание и вычисление себестоимости по методу ФИФО</span> 
                            Если СписываемоеКоличество > 0 Тогда
                                <span class="vue-g">// регистр ОстаткиСебестоимостиТоваров Приход</span>
                                Движение = Движения.ОстаткиСебестоимостиТоваров.Добавить();
                                Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
                                Движение.Период = Дата;
                                Движение.Товар = ВыборкаДетальных.Товар;
                                Движение.Партия = ВыборкаДетальных.Партия;
                            
                                Если СписываемоеКоличество &lt;= ВыборкаДетальных.КоличествоОстаток Тогда
                                    ВычислениеСебест = СписываемоеКоличество / ВыборкаДетальных.КоличествоОстаток * ВыборкаДетальных.СебестоимостьОстаток;
                                    Движение.Количество = СписываемоеКоличество;
                                    Движение.Себестоимость = ВычислениеСебест;
                                    НакоплениеСебестоимости = НакоплениеСебестоимости + ВычислениеСебест;
                                    СписываемоеКоличество = СписываемоеКоличество - СписываемоеКоличество;
                                Иначе
                                    Движение.Количество = ВыборкаДетальных.КоличествоОстаток;
                                    Движение.Себестоимость = ВыборкаДетальных.СебестоимостьОстаток;
                                    НакоплениеСебестоимости = НакоплениеСебестоимости + ВыборкаДетальных.СебестоимостьОстаток;
                                    СписываемоеКоличество = СписываемоеКоличество - ВыборкаДетальных.КоличествоОстаток; 
                                КонецЕсли;

                            КонецЕсли;
                        КонецЦикла;
                        
                        <spa class="vue-r">Вот это место где мы наполняем регистр Продажи, также расчитываем для него себестоимость</spa>
                        <span class="vue-g">//блокировок на эту таблицу ставить не нужно</span>
                        Движение = Движения.Продажи.Добавить();;
                        Движение.Период = Дата;
                        Движение.Товар = ВыборкаИтогов.Товар; 	
                        Движение.Контрагент = Контрагент; 	
                        Движение.Количество = ВыборкаИтогов.Количество; 	
                        Движение.Выручка = ВыборкаИтогов.Выручка; 
                        Движение.Себестоимость = НакоплениеСебестоимости; 	
                    КонецЦикла;
                КонецЕсли;
            
                <span class="vue-g">//если выше буду очищать набор записей для этого регистра, то
                //запись снимает флаг Записывать в ложь, поэтому внизу мы 
                //разместили эту инструкцию, чтобы флаг снова стал Истина и 
                //новый движения записались в регистр</span>
                Движения.ОстаткиСебестоимостиТоваров.Записывать = Истина;   
                Движения.Продажи.Записывать = Истина;   
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Теперь можно построить отчёт на основе регистра Продажи. В этом регистре теперь есть все нужные нам поля, не нужно соединять несколько таблиц, не нужно обращаться к медленным таблицам документов, не нужно обращаться за данными к медленной витруальной таблице ОстаткиТоваров.Обороты, потому что регистр накопления работает  в режиме "остатки". Мы используем одну вирт. таблицу Продажи.Обороты в режиме работы регистра "обороты", ну и останется только создать одно вычисляемое поле Прибыль и всё, отчёт готов. Это быстрее и производительнее. И не забываем, что теперь есть итоговая таблица, в которой будут сразу подсчитываться итоги по оборотам и при обращении к виртуальной таблице Продажи.Обороты у нас уже намного быстрей будут возвращаться данные, потому что будет задействована итоговая таблица, в которой уже заранее будет что то подсчитано.</p>

    <p class="title-size16"><b id="document24">(Курс Чистова 8.3) Бронирование товаров.</b></p>
    <p>Делаю по этому видео - https://www.youtube.com/watch?v=r5ZNzST8Mzc&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=39.   ДЗ №5</p>
    <p>Вот задание по созданию бронирования товаров.</p>
    <img src="../img/1С-1/2023-09-23_16-11-22.png" class="screen" alt="">
    <p>Это пока ещё не полной механизм бронироания товаров, а начало его. Со временем будем его дополнять.</p>
    <p>У нас уже имеется регистр накопления "ОстаткиТоваров" и можно было бы в него добавить ещё один ресурс "ВБроне", многие так и делают, но это считается не правильным. Остаки товаров предназначены для подсчёта только остатков товаров на складе, вот и пусть так и остаётся, а вот для бронирования лучше создать отдельный регистр "ТоварыВБроне". Как говорит Чистов, чтобы составлять легко отчёты, нужно хранить показатели разных областей каждый в своём регистре. Для анализа продаж создаём регистр продаж, для анализа остатка на складе создаём регистр остатков товаров, для анализа остатков в броне создаём регистр брони и т.д. И тогда не придётся строить сложные отчёты на одном громоздком регистре или на соединении нескольких таблиц. Если можно этого избежать, то лучше избегать. Так и сделаем.</p>
    <img src="../img/1С-1/2023-09-24_20-22-17.png" class="screen-2" alt="">
    <p>Ещё Чистов рассказывал, что одно из главных назначений регистра это отдалиться от документов и отчётами не завязываться на документы, потому что документы через время могут меняться, а регистр будет хранить стабильно показатель от разных документов. Пусть они там меняются, главное чтобы писали в регистр изменение показателя и всё.</p>
    <p>Документ, который будет писать в наш регистр это "СчетНаОплату". Для документа запретим оперативное проведение, это нам не нужно. В документе также добавим реквизит с типом дата для указания - до какого числа будем бронировать. Вот так выглядит обработка проведения документа:</p>
    <div class="code-style">
        <pre>
            --модуль объекта "ОбработкаПроведения" документа "СчетНаОплату"

            <span class="vue-b">Процедура ОбработкаПроведения(Отказ, РежимПроведения)
                ТЗ = Товары.Выгрузить();
                ТЗ.Свернуть("Товар", "Количество");

                Движения.ТоварыВБроне.Записывать = Истина;
                Для Каждого ТекСтрокаТЗ Из ТЗ Цикл
                    <span class="vue-g">// регистр ТоварыВБроне Приход</span>
                    Движение = Движения.ТоварыВБроне.Добавить();
                    Движение.ВидДвижения = ВидДвиженияНакопления.Приход;
                    Движение.Период = Дата;
                    Движение.Склад = Склад;
                    Движение.Контрагент = Контрагент;
                    Движение.ДатаОкончанияБрони = КонецДня(ДоКакогоЧислаБронировать);
                    Движение.Товар = ТекСтрокаТЗ.Товар;
                    Движение.Количество = ТекСтрокаТЗ.Количество; 
                КонецЦикла; 
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Как видим механизм бронирования пока простой по сравнению с теми, что описаны раньше от Камкова или от Чистова из курса 8.2. Но надеюсь со временем допишем его до конца.</p>

    <p class="title-size16"><b id="document25">(Курс Чистова 8.3) Ввод на основании.</b></p>
    <p>Взято из видео курса под названием СпецКурс 016.</p>
    <p>Событие "ОбработкаЗаполнения" срабатывает каждый раз когда создаётся новый документ или справочник и т.д.</p>
    <p>У нас есть 2 документа: "СчетНаОплату" и "РасходнаяНакладная". Первый документ предоставляет счёт покупателю и после того как он его оплатил мы проводим второй документ отгружая ему товар. Эти документы по своему составу похожи и можно облегчить работу пользователю и не заставлять после счёта заного вбивать все данные в документ "РасходнаяНакладная". Мы можем создавая новый документ продажи товаров перенести данные из счёта. Для этого есть механизм "Ввод на основании".</p>
    <p>В 1С есть конструктор этого механизма, но для начала вручную посмотрим как это работает. В конструкторе документа "РасходнаяНакладная" есть вкладка "Ввод на основании". В правом верхнем углу есть картика карандаша, жмём на неё. В открывшемся окошке выбираем объект, из которого мы будем создавать новый документ "РасходнаяНакладная". Как видим в объектах есть не только документы, но и другие обхекты(справочники и т.д.). Например, на основании справочника "Сотрудники" можно создать документ о приёме на работу и в этот документ перенесутся все нужные данные из карточки сотрудника. Но можно и наоборот, на основе документа создать карточку сотрудника.</p>
    <p>Итак, укажем документом основанием "СчетНаОплату". Это повлияло на интерфейс форм этого документа. Там появилась группа кнопок "Ввод на основании", в которой есть одна команда "Расходная накладная". Эта команда является параметризуемой, т.е. в процедуру "ОбработкаКоманды" передаётся параметр со ссылкой на документ "СчетНаОплату", который выбран в списке или из которого мы и вызываем данную команду.</p>
    <p>Далее, у нас есть команда у счёта, которая создаёт новый документ "РасходнаяНакладная", но документ будет создаваться пустой. Нужно как то заполнять его. Для этого есть событие в модуле объекта "ОбработкаЗаполнения". Откроем модуль у документа "РасходнаяНакладная" и откроем шаблон обработчика этого события. Событие срабатывает на сервере в миг создания нового документа, как я понял. У обработчика события есть 3 параметра: "ДанныеЗаполнения", "ТекстЗаполнения" и "СтандартнаяОбработка".</p>
    <ul class="list">
        <li>"СтандартнаяОбработка" - этот параметр позволяет отменить стандартное поведение обработчика.</li>
        <li>"ТекстЗаполнения" - сюда попадает строка номера документа</li>
        <li>"ДанныеЗаполнения" - самый интересный параметр, который нам и нужен. В нём будет ссылка на тот объект, который является основанием, т.е. ссылка на документ "СчетНаОплату". Внимание! Ссылка в нём будет, если мы вводим на основании и от одного объекта, потому что есть и другие разновидности вызова этого события и там в этом параметре может быть уже другой тип данных. Например, массив, в котором будут ссылки на разные объекты основания и исходя из этого мы будем заполнять по другому. Поэтому нужно всегда проверять, что лежит в этом параметре. А может и структура быть(о ней позже опишу).</li>
    </ul>
    <p>Параметры понятны, теперь нужно заполнить реквизиты нового документа "РасходнаяНакладная" реквизитами документа основания "СчетНаОплату". Как будем получать данные документа "СчетНаОплату" из базы? Объектным или табличным способом? Вот статья в каких случаях что использовать - https://its.1c.ru/db/metod8dev/content/2717/hdoc.  Как я понял, да и Чистов так делает, мы можем использовать объектный способ получения данных через ссылку, потому что при получении какого то поля мы из базы выбирается весь объект данных вместе с табличной частью. Этот объект кешируется и мы можем уже получать из закешированного объекта другие поля. Если бы нам нужно было бы одно или 2 поля, то тогда скорее подойдёт запрос табличным способом, а так нам нужно обратиться к нескольким полям, можно сказать почти весь объект нам и нужен.</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "РасходнаяНакладная"

            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаЗаполнения<span class="vue-r">(</span>ДанныеЗаполнения<span class="vue-r">,</span> ТекстЗаполнения<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                Контрагент <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Контрагент<span class="vue-r">;</span>
                Договор <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Договор<span class="vue-r">;</span>
                Склад <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Склад<span class="vue-r">;</span>
                
                <span class="vue-g">//чтобы выгрузить из одной табличной части в другую
                //можно использовать промежуточную таблицу значений
                //другово более удобного способа не знаю</span>
                ТЗ <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Товары<span class="vue-r">.</span>Выгрузить<span class="vue-r">();</span>
                Товары<span class="vue-r">.</span>Загрузить<span class="vue-r">(</span>ТЗ<span class="vue-r">); 

                <span class="vue-g">////или вот другой способ через цикл
                //Для каждого СтрокаТабЧасти Из ДанныеЗаполнения.Товары Цикл
                //	НоваяСтрока = Товары.Добавить();
                //	ЗаполнитьЗначенияСвойств(НоваяСтрока,СтрокаТабЧасти);
                //КонецЦикла;</span>
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Если сделать это через конструктор, то он нам создаст такой код:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаЗаполнения<span class="vue-r">(</span>ДанныеЗаполнения<span class="vue-r">,</span> ТекстЗаполнения<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-r">Если</span> ТипЗнч<span class="vue-r">(</span>ДанныеЗаполнения<span class="vue-r">) =</span> Тип<span class="vue-r">(</span>"ДокументСсылка.СчётНаОплату"<span class="vue-r">) Тогда</span>
                    <span class="vue-g">// Заполнение шапки</span>
                    Договор <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Договор<span class="vue-r">;</span>
                    Контрагент <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Контрагент<span class="vue-r">;</span>
                    Склад <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Склад<span class="vue-r">;</span>
                    <span class="vue-r">Для Каждого</span> ТекСтрокаТовары <span class="vue-r">Из</span> ДанныеЗаполнения<span class="vue-r">.</span>Товары <span class="vue-r">Цикл</span>
                        НоваяСтрока <span class="vue-r">=</span> Товары<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        НоваяСтрока<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                        НоваяСтрока<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Сумма<span class="vue-r">;</span>
                        НоваяСтрока<span class="vue-r">.</span>Товар <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                        НоваяСтрока<span class="vue-r">.</span>ЦенаПродажи <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>ЦенаПродажи<span class="vue-r">;
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Вот схема действий от нажатия по кнопке "РасходнаяНакладная" в группе "Ввод на основании" до открытия нового документа "РасходнаяНакладная":</p>
    <img src="../img/1С-1/2023-09-25_21-20-32.png" class="screen" alt="">

    <p><b id="document25-1">Давайте сделаем теперь всё то же самое, только сами, без помощи системы</b>. "Ввод на основании вручную", "Передача параметров в форму". "Открытие формы"</p>
    <p>Имеется ввиду, что сделаем тот же ввод на основании документа "СчетНаОплату", по которому будем создавать и заполнять документ "РасходнаяНакладная".</p>
    <p>Мы делаем этот пример только для показа передачи параметров в создающуюся форму документа.</p>
    <p>Зайдём в форму документа "СчетНаОплату" и создадим команду "ВводНаОснованииВручную", перенесём её в элементы формы. На клиенте создаём обработчик для команды. Вспоминаем, что делает система при вводе на основании. Она создаёт новый документ указанного вида и открываем его основную форму документа. Значит мы можем использовать метод ОткрытьФорму() по имени. Этот метод, как я понимаю, может создать новый объект документа и сконструировать по параметрам для него форму, а затем отправить на клиента для отображения.</p>
    <p>При написании этого метода система помогает при выборе формы. Мы можем открыть форму объекта, которая на данный миг является основной, выбрав "ФормаОбъекта":</p>
    <img src="../img/1С-1/2023-09-28_09-19-40.png" class="screen" alt=""> 
    <p>Или выбрать "Форма" и тогда мы можем выбрать любую форму, которые созданы для объекта документа. Может у нас заранее несколько форм для объекта созданы, но основная только одна. Вот пункт "Форма" позволяет выбрать одну из этих заранее созданных:</p>
    <img src="../img/1С-1/2023-09-28_09-20-09.png" class="screen" alt="">
    <p>Далее 2м аргументом нужно передать какие то параметры для формы. Параметры собираются в структуру и эта структура передаётся. Что нам нужно передать? Опять вспоминаем, что система передаёт на сервер в параметр "ДанныеЗаполнения" в обработку заполнения, при стандартном вводе на основании? Система передаёт ссылку на объект текущего документа "СчетНаОплату". Значит нужно передать ссылку на текущий объект. В расширениях формы для документа есть свои параметры формы с разными ключами, нам нужен такой ключ как "Основание", вот для этого ключа и надо указать ссылку:</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "СчетНаОплату"

            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ВводНаОснованииВручную<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ПраметрыФормы <span class="vue-r">= Новый</span> Структура<span class="vue-r">;</span>
                ПраметрыФормы<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"Основание"</span><span class="vue-r">,</span> Объект<span class="vue-r">.</span>Ссылка<span class="vue-r">);</span>                                                                 	

                ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Документ.РасходнаяНакладная.Форма.ФормаДокумента"</span><span class="vue-r">,</span> ПраметрыФормы<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>У документа "РасходнаяНакладная", который мы собираемся создавать на основании, в его модуле объекта оставим код в обработке заполнения тот же.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаЗаполнения<span class="vue-r">(</span>ДанныеЗаполнения<span class="vue-r">,</span> ТекстЗаполнения<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-r">Если</span> ТипЗнч<span class="vue-r">(</span>ДанныеЗаполнения<span class="vue-r">) =</span> Тип<span class="vue-r">(</span>"ДокументСсылка.СчётНаОплату"<span class="vue-r">) Тогда</span>
                    <span class="vue-g">// Заполнение шапки</span>
                    Договор <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Договор<span class="vue-r">;</span>
                    Контрагент <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Контрагент<span class="vue-r">;</span>
                    Склад <span class="vue-r">=</span> ДанныеЗаполнения<span class="vue-r">.</span>Склад<span class="vue-r">;</span>
                    <span class="vue-r">Для Каждого</span> ТекСтрокаТовары <span class="vue-r">Из</span> ДанныеЗаполнения<span class="vue-r">.</span>Товары <span class="vue-r">Цикл</span>
                        НоваяСтрока <span class="vue-r">=</span> Товары<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        НоваяСтрока<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                        НоваяСтрока<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Сумма<span class="vue-r">;</span>
                        НоваяСтрока<span class="vue-r">.</span>Товар <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                        НоваяСтрока<span class="vue-r">.</span>ЦенаПродажи <span class="vue-r">=</span> ТекСтрокаТовары<span class="vue-r">.</span>ЦенаПродажи<span class="vue-r">;
                    КонецЦикла;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Запустим систему и в форме документа "СчетНаОплату" нажмём кнопку "ВводНаОснованииВручную". У нас всё отработает хорошо, откроется заполненная форма документа "РасходнаяНакладная". Вот накидал схему, как я понимаю, описанных действий:</p>

    <p><b id="document25-2">Дальше про свойство "Заполнять из данных заполнения"</b>. Это свойство также связанно с событием "ОбработкаЗаполнения". В определённых случаях с помощью этого свойства в событие передаётся параметр в виде структуры с данными. Когда это происходит? Уже где то описывал один пример с этим свойством и как оно работает. Опишу тут ещё раз, но наш пример.</p>
    <p>В пользовательской части открываем форму списка документа "РасходнаяНакладная" и видим список документов. В подменю "Еще" есть такой пункт как "Настроить список", это возможность сделать со списком документов что-то. Например, сделать отбор по списку. Допустим, оставим в списке документы с контрагентом ЗАО "Бурёнка", для этого в отборе выберем контрагент и равно ЗАО "Бурёнка", завершаем настройку и тут же система отсортирует список и оставит указанные документы. И вот после этого действия, если мы создадим новый документ, то сработает событие "ОбработкаЗаполнения" и в первый параметр "ДанныеЗаполнения" попадёт структура с ключом "Контрагент" и значением "ЗАО "Бурёнка"".</p>
    <p>Когда откроется форма нового документа то поля будут пусты, если конечно в обработке "ОбработкаЗаполнения" ничего никуда не присваивается. Но если в конфигураторе установить свойство "Заполнять из данных заполнения" поставив галочку, потм опять настроить список с отбором, то при создании нового документа в поля с контрагентом попадёт сразу значение "ЗАО "Бурёнка"" из структуры. Система это сделает сама, не нужно описывать это в обработчике.</p>
    <p>Для чего это нужно? Как объясняет Чистов это нужно, когда пользователь ищет конкретные документы и устанавливает отборы и вдруг ничего не нашёл, то он может создать новый документ и система заполнит все реквизиты по отбору. Для меня пока трудно представить такой случай, когда что то ищешь, не находишь и давай создавать новый документ с недостающими реквизитами. Примеры такого не приходят в голову, как это может быть в жизни.</p>
    <p>Важное замечание! Система сама добавляет в реквизиты из структуры, а значит это срабатывает стандартная обработка, если в 3й параметр поставить флаг Ложь, то система перестанет это делать.</p>
    <p>Ещё пользователь может отобрать из списка с помощью строки поиска:</p>
    <img src="../img/1С-1/2023-09-26_10-19-37.png" class="screen" alt="">
    <p>Но в этом случае в параметр "ДанныеЗаполнения" ничего не попадает. Также есть расширенный поиск в меню с картинкой лупы, там мы как для отбора выбираем где искать и что искать, после применения сверху рядом со списком появится обозначение отбора. Но в этом случае также ничего не передаётся в параметр "ДанныеЗаполнения". Передаются только при настройке списка.</p>



















    <h2 class="header-style" id="work-forms">Работа с формами</h2>
    <h3 class="header-style2" id="work-forms-total">В общем о классе ФормаКлиенскогоПриложения</h3>
    <p>Подробнее про создание формы на сервере можно посмотреть в этом видео - https://www.youtube.com/watch?v=yVz6N1y3eSk&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=55  начиная с 19 минуты.</p>
    <p>На сегодня, как я понял, уже нет такого типа данных как "Управляемая форма", вместо такого названия есть "Форма клиентского приложения".</p>
    <p>В модуле формы любую процедуру можно назначить в качестве обработчика для события.</p>
    <p>Если посмотреть на эту картинку, то мы увидим такое явление как "Данные сеанса", вот в эти данные и входит такое понятие как "Данные формы":</p>
    <img src="../img/1С-1/2023-08-19_10-40-12.png" class="screen" alt="">
    <p>"Данные формы" мы получаем из конвертации объекта данных из базы. Затем данные формы вместе с формой летят на клиента и там отображаются через элементы формы. Конвертация происходит потому, что объект данных просто так нельзя передать по HTTP, его нужно перевести в вид json или xml, но ещё до того как перевести в json нужно переделать данные объекта данных в другой вид. Ну например, мы на клиенте открываем карточку сотрудника, в этой карточке есть реквизиты с данными, эти данные лежат в базе. Мы посылаем сигнал на сервер, сервер получает из базы объект данных конкретного сорудника в виде объекта. В объекте есть поле "Пол", в котором значение в виде ссылки на значение перечисления. Просто так это не передать, поэтому сервер создаёт тип данных "Структура" и записывает в неё 2 свойства:</p>
    <div class="code-style">
        <pre>
            Структура.Вставить("ID", "24:kj342po3j4s98df3l342l4k3j"); - тут ссылка
            Структура.Вставить("Представление", "Мужской"); - тут строка для отображения в реквизите
        </pre>
    </div>
    <p>И вот таким образом данные объекта сотрудника переделываются в данные формы. Затем вся форма с описанием оформления и данными запаковывется в json или xml и передаётся на клиент.</p>
    <p>После передачи формы на клиента, она теперь существует одновременно и на стороне клиента и на стороне сервера. Это нужно для того, чтобы с клиента обратится на сервер к данным формы, которые не прилетели на клиента, мы их не передавали на клиента и нам нужна какая то информация из этих данных. Т.е. обращаемся именно к уже сконвертированным данным формы на сервере. Для этого и сохраняется объект формы на сервере паралельно с объектом формы на клиенте. На данный миг пока понял так.</p>
    <p>"Данные сеансов" всё время синхронизируются с клиентом.</p>
    <p>На этой картинке показано как работает механизм создания формы и отправки его на клиента:</p>
    <img src="../img/1С-1/2023-08-19_10-48-11.png" class="screen" alt="">



    <p class="title-size16"><b id="work-forms-client-server">Подробно о директивах НаКлиенте, НаСервере, НаСервереБезКонтекста</b></p>
    <p>В этом видео Чистов раасказывает о этих директивах подробно - https://www.youtube.com/watch?v=SVMgXFwm_dg&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=52.  СпецКурс. 006, начиная с 46 минуты 35 сек.</p>
    <p>В этом же видео с 01:10:00 - объясняет зачем нужна директива НаСервере, если есть такая хорошая директива НаСервереБезКонтекста. Вот пример, который Чистов привёл, для показа того, для чего нужна директива НаСервере:</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "СчетНаОплату"
            <span class="vue-b"><span class="vue-g">//мы хотим по нажатию на кнопку "ДатьСкидку" умножить все цены товаров табличной части
            //на 0.9(это мы с цены скидываем 10%)
            //можно было бы и на клиенте это всё сделать, но представим
            //что мы работаем с планшета и у нас в табличной части пару сотен товаров,
            //сразу все товары не подгрузятся на клиента и если мы попытаемся на клиенте перемножать
            //то каждый раз будут подгружаться товары и перемножаться, котороче будет много обращений
            //на сервер, а это плохо. Поэтому план такой, чтобы всё сделать один раз на сервере и когда
            //сервер всё обработает, то он автоматом вернёт все данные формы и форма обновится на клиенте
            //с новыми данными</span>
            <span class="vue-r">&НаКлиенте
            Процедура</span> ДатьСкидку<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ДатьСкидкуНаСервере<span class="vue-r">();
            КонецПроцедуры

            &НаСервере
            Процедура</span> ДатьСкидкуНаСервере<span class="vue-r">()</span> 
                <span class="vue-g">//на сервере работаем не с элементами формы, а с данными формы, которые лежат в реквизитах формы
                //в данном случае обращаемся к основному реквизиту формы Объект
                //Важное наблюдение. На сервере вызывается эта процедура, данные переменожаются, меняются и 
                //возвращаются на клиента, но эти данные не записывались на сервере в БД
                //запись происходит только по кнопке "Записать", тогда данные формы летят на сервер, там конвертируются в 
                //объект базы данных и уже этот объект записывается в базу</span>
                <span class="vue-r">Для каждого</span> Стр <span class="vue-r">Из</span> Объект<span class="vue-r">.</span>Товары <span class="vue-r">Цикл</span>
                    Стр<span class="vue-r">.</span>ПродажнаяЦена <span class="vue-r">=</span> Стр<span class="vue-r">.</span>ПродажнаяЦена <span class="vue-r">*</span> 0.9<span class="vue-r">;</span> 

                    <span class="vue-g">//цену изменили, теперь и сумму нужно пересчитать
                    //НО вот так считать сумму можно если вычисление суммы не сложное
                    //если вычисление суммы сложное, то нужна отдельная процедура
                    //по её вычислению. Такую процедуру размещают сразу в 2х модулях
                    //и на клиенте и на сервере, для этого есть такая директива как
                    //НаКлиентеНаСервереБезКонтекста. С такой директивой эта процедура
                    //будет доступна и на клиенте и на сервере</span>
                    Стр<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> Стр<span class="vue-r">.</span>ПродажнаяЦена <span class="vue-r">*</span> Стр<span class="vue-r">.</span>Количество<span class="vue-r">;
                    <span class="vue-g">//РасчитатьСумму(Стр);</span>
                КонецЦикла;	
            КонецПроцедуры</span>
        
            <span class="vue-r">&НаКлиентеНаСервереБезКонтекста
            Процедура</span> РасчитатьСумму<span class="vue-r">(Стр)</span>
                ... 
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>



    <p class="title-size16"><b id="work-forms-context">Контекст модуля формы</b></p>
    <p>Каждый модуль связан с остальной частью конфигурации. Эта связь называется <b>контекстом модуля</b>. Контекст модуля определяет набор доступных во время выполнения модуля объектов, переменных, процедур и функций. Контекст модуля формы образуется:</p>
    <ul class="list">
        <li>локальным контекстом самого модуля формы</li>
        <li>реквизитами этой формы</li>
        <li>свойствами и методами объекта УправляемаяФорма встроенного языка</li>
        <li>свойствами и методами расширения формы, определяемого типом того объекта, данные которого содержатся в основном реквизите формы</li>
        <li>глобальным контекстом, в том числе неглобальными общими модулями и экспортируемыми функциями и процедурами глобальных общих модулей</li>
        <li>экспортируемыми переменными, процедурами и функциями модуля управляемого приложения.</li>
    </ul>
    <p>Рассмотрим подробнее, что собой представляет каждая из перечисленных составляющих.</p>
    <p><b>1. Локальный контекст модуля формы.</b></p>
    <p>Локальный контекст модуля формы – это переменные, процедуры и функции, объявленные в этом модуле. Например, внутри модуля формы можно непосредственно обращаться по имени к процедуре ПолучитьСумму(), объявленной в этом же модуле:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура Команда1()
                <span class="vue-b">ПолучитьСумму()</span>;
            КонецПроцедуры

            &НаСервереБезКонтекста
            Процедура <span class="vue-b">ПолучитьСумму()</span>
                …
            КонецПроцедуры
        </pre>
    </div>
    <p>Или внутри модуля формы можно непосредственно обращаться по имени к переменной СлужебнаяПеременная, объявленной в этом модуле:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Перем <span class="vue-b">СлужебнаяПеременная</span>;

            &НаКлиенте
            Процедура Команда1()
                <span class="vue-b">СлужебнаяПеременная</span> = 3;
            КонецПроцедуры
        </pre>
    </div>
    <p><b>2. Реквизиты формы, которой «принадлежит» модуль.</b></p>
    <p>Например, если у формы существует реквизит СлужебныйРеквизит, то к нему можно непосредственно обращаться по имени в модуле формы:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура Команда1()
                <span class="vue-b">СлужебныйРеквизит</span> = 3;
            КонецПроцедуры
        </pre>
    </div>
    <p><b>3. Свойства и методы объекта класса ФормаКлиенскогоПриложения.</b></p>
    <p>Свойства и методы объекта встроенного языка ФормаКлиенскогоПриложения описаны в синтакс-помощнике:  Интерфейс(управляемый) > ФормаКлиенскогоПриложения. К ним можно обращаться непосредственно по имени. Например, можно задать заголовок формы, а можно закрыть форму:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура Команда1()
                <span class="vue-b">Заголовок</span> = "Новый заголовок формы";
            КонецПроцедуры

            &НаКлиенте
            Процедура Команда2()
                <span class="vue-b">Закрыть()</span>;
            КонецПроцедуры
        </pre>
    </div>
    <p><b>4. Свойства и методы расширения формы, определяемого типом того объекта, данные которого содержатся в основном реквизите формы.</b></p>
    <p>Один из реквизитов формы может быть основным, в списке реквизитов он выделяется жирным.</p>
    <img src="../img/1С-1/2023-08-03_10-05-31.png" class="screen" alt="">
    <p>Как правило, основной реквизит формы содержит данные того объекта, который отображается в форме. Например, если это форма справочника, то основной реквизит будет содержать данные объекта СправочникОбъект.&lt;Имя справочника>. А если это форма документа, то основной реквизит формы будет содержать данные объекта ДокументОбъект.&lt;Имя документа></p>
    <p>Тут следует пояснить, почему в списке реквизитов тип основного реквизита указан в скобках: (ДокументОбъект.ПриходнаяНакладная. Дело в том, что это «ненастоящий» тип реквизита формы. Настоящий тип в данном случае будет ДанныеФормыСтруктура. Но ДанныеФормыСтруктура – это универсальный тип, который может содержать данные различных прикладных объектов. Поэтому, чтобы в редакторе формы можно было «ориентироваться», данные какого же именно прикладного объекта отображает эта форма, в колонке Тип редактора показывается не тип реквизита формы (ДанныеФормыСтруктура), а тип того объекта, данные которого содержатся в этом реквизите. И этот «ненастоящий» тип показывается в скобках.</p>
    <p>От типа объекта, данные которого содержатся в основном реквизите формы, зависят некоторые особенности в поведении формы. Например, если основной реквизит формы будет содержать данные документа, то при закрытии такой формы система будет запрашивать подтверждение записи и проведения этого документа. Если же основной реквизит формы будет содержать данные справочника, то подобного запроса подтверждения при закрытии формы возникать не будет. В зависимости от того, какой тип имеет объект, данные которого содержатся в основном реквизите, к контексту программного объекта ФормаКлиенскогоПриложения добавляется контекст соответствующего расширения.</p>
    <p>Например, если основной реквизит – СправочникОбъект.&lt;имя>, то в модуле формы становятся доступны свойства, методы объекта встроенного языка Расширение управляемой формы для справочника (синтакс-помощник – Интерфейс (управляемый) > Форма клиентского приложения > Расширение
    справочника). А если основной реквизит – ДинамическийСписок, то в модуле формы становятся доступны свойства, методы объекта встроенного языка Расширение управляемой формы для динамического списка (синтакс-помощник – Интерфейс (управляемый) > Форма клиентского приложения > Расширение динамического списка).</p>
    <p>Проще говоря в зависимости от объекта основного реквизита модуль формы расширяется дополнительными методами и свойствами.</p>
    <p>Таким образом, в модуле формы, где основной реквизит содержит данные документа, можно обратиться к свойству расширения управляемой формы для документа <i style="text-decoration:underline;">АвтоВремя</i>:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура Команда1()
                АвтоВремя = <span class="vue-b">РежимАвтоВремя.Первым</span>;
            КонецПроцедуры
        </pre>
    </div>
    <p>Или записать документ с помощью метода расширения управляемой формы для документа Записать():</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура Команда1()
                <span class="vue-b">Записать(РежимЗаписиДокумента.Проведение)</span>;
            КонецПроцедуры
        </pre>
    </div>
    <p><b>5. Глобальный контекст, в том числе неглобальные общие модули и экспортируемые функции и процедуры глобальных общих модулей.</b></p>
    <p>В модуле формы можно:</p>
    <div class="code-style">
        <pre>
            //получить системную дату
            &НаКлиенте
            Процедура Команда1()
                МояДата = <span class="vue-b">ТекущаяДата()</span>;
            КонецПроцедуры

            //или получить историю работы пользователя
            &НаКлиенте
            Процедура Команда1()
                История = <span class="vue-b">ИсторияРаботыПользователя.Получить()</span>;
            КонецПроцедуры
        </pre>
    </div>
    <p>Если в глобальном общем модуле (например, ОбменДанными) определена экспортная процедура ПолучитьПрефиксНомера(), то в модуле формы можно обращаться к ней по имени.</p>
    <div class="code-style">
        <pre>
            //заметим, что обращение идёт без указания имени общего модуля
            &НаКлиенте
            Процедура Команда1(Префикс)
                Префикс = <span class="vue-b"><b>ПолучитьПрефиксНомера()</b>;</span>
            КонецПроцедуры 
        </pre>
    </div>
    <p>Если такой общий модуль – неглобальный (например, РаботаСДокументами), то при обращении к процедуре ее имя нужно указывать через точку от имени модуля.</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура КоличествоПриИзменении(Элемент)
                <span class="vue-b"><b>РаботаСДокументами.РассчитатьСумму(СтрокаТабличнойЧасти);</b></span>
            КонецПроцедуры
        </pre>
    </div>
    <p>Второй способ предпочтительнее, так как неглобальные общие модули компилируются по мере обращения к ним, а не при запуске системы, как глобальные. Естественно, при этом нужно обеспечивать согласованность того, как описана процедура в модуле формы (&НаКлиенте, &НаСервере и т.д.), и того, какие флажки проставлены у общего модуля (клиент (управляемое приложение), сервер и т.д.).</p>
    <p><b>6. Экспортируемые переменные, процедуры и функции модуля управляемого приложения.</b></p>
    <p>Если в модуле приложения определена экспортная процедура ТестовоеСообщение(), то в модуле формы можно обращаться к ней по имени.</p> 
    <div class="code-style">
        <pre>
            --модуль приложения
            Процедура <span class="vue-b">ТестовоеСообщение()</span> Экспорт
                Сообщить("Тестовое сообщение");
            КонецПроцедуры

            --модуль формы
            &НаКлиенте
            Процедура Команда1()
                <span class="vue-b">ТестовоеСообщение()</span>;
            КонецПроцедуры  
        </pre>
    </div>
    <p>По описанию модуль управляемого приложения предоставляет доступ к своим процедурам и функциям также как и глобальный общий модуль. В чём разница пока не знаю. экспортировать переменную можно так:</p>
    <div class="code-style">
        <pre>
            Перем МояПеременная Экспорт;
        </pre>
    </div>



    <p class="title-size16"><b id="work-forms-events">События формы и её элементов</b></p>
    <p><b id="work-forms-events-1">"ПриСозданииНаСервере", "ПриОткрытии", свойство формы "Параметры", "Ключевой параметр"</b></p>
    <p>Объясняет что такое ключевые параметры в этом видео - https://www.youtube.com/watch?v=WBGTR_ZjPBs&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=34.  СпецКурс 016.  с 35 минуты.</p>
    <p>Это событие наступает ещё до конструирования формы на стороне сервера. Процесс конвертации прикладного объекта в данные формы уже произошёл. В модуле формы доступен контекст всей формы, а значит в этом событии будет такое свойство как "Параметры". "Параметры" как и данные формы тоже имеет тип "ДанныеФормыСтруктура". Многие вещи в построении формы зависят от того, что есть в параметрах.</p>
    <p>Вот параметры на миг создания документа "РасходнаяНакладная". Я заранее в пользовательской части сделал отбор в форме списка этого вида документа и в параметрах мы видим свойство "ЗначениеЗаполнения". Это структура и в ней в ключе и значении то, что я отобрал.</p>
    <img src="../img/1С-1/2023-09-26_13-06-13.png" class="screen" alt="">
    <p>Как только событие "ПриСозданииНаСервере" отработает, то свойство "Параметры" сильно обрезается и на клиента приходят только "ключевые параметры". Это можно увидеть в событии формы "ПриОткрытии":</p>
    <img src="../img/1С-1/2023-09-26_13-28-55.png" class="screen" alt="">
    <p>Свойство "Ключ" пустое, потому что форма новая, если открыть существующую форму, то в ключе будет ссылка на объект. Что такое ключ? Когда форма конструируется на сервере, то система на основе одного или нескольких параметров определяет уникальность формы. Ссылка является уникальным распознователем каждого объекта, вот и ключ принимает это значение. На уникальность формы влияет не один ключевой параметр, а несколько. На картинке показаны 3 ключевых параметра, они от системы. Но к ним можно и свои добавить. В редакторе формы мы можем сделать свои ключевые параметры. Для этого рядом с реквизитами и командами есть вкладка "Параметры". Созданным нами ключеыой параметр будет жить, пока жива форма.</p>
    <p>Те 3 параметра, что система сама нам предоставила являются предопределёнными.</p>
    <p>Вот примерно такую схему нарисовал:</p>
    <img src="../img/1С-1/2023-09-26_13-32-35.png" class="screen" alt="">
    <p>Как пользоваться ключом показано в следующей статье "Программно открываем формы".</p>
    
    

    <p class="title-size16"><b id="work-forms-prog-open-form">Программно открываем формы</b></p>
    <p>Для того, чтобы открыть форму какого то объекта конфигурации используется метод глобального контекста ОткрытьФорму(&lt;ИмяФормы>, &lt;Параметры>, &lt;Владелец>, &lt;Уникальность>, &lt;Окно>, &lt;НавигационнаяСсылка>, &lt;ОписаниеОповещенияОЗакрытии>, &lt;РежимОткрытияОкна>). Обязательный параметр только 1й. В тренировочной форме обработки создадим кнопку и в обработчике этой кнопки напишем глобальный метод открытия формы, при нажатии на кнопку в польз. режиме откроется указанная форма указанного объекта конфигурации. При поставке первой кавычки, когда начинаяю писать имя формы, нам будут вылетать подсказки, по подсказкам мы можем указать путь до нужной формы:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//открыть форму элемента справочника "Номенклатура"</span>
            --ФормаОбъекта откроет именно ту форму элемента справочника, которая является основной. 
            --Если же форм элемента несколько и мы хотим открыть не основную, то нужно указать полный путь к этой форме. 
            --Метод открывает форму НОВОГО элемента, т.е. по сути запустили создание нового элемента справочника.
            <span class="vue-b">ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Справочник.Номенклатура.ФормаОбъекта"</span><span class="vue-r">);</span></span>

            --А вот чтобы открыть форму уже ранее созданного элемента, 
            --пригодится 2й аргумент. 2й аргумент это структура. 
            --"Ключ" это имя ключа свойства структуры, а значение это ссылка
            --на существующий элемент. Имя "Ключ" для ключа свойства структуры тут не случайно 
            --и тип значения этого свойства должен быть СправочникСсылка.&lt;ИмяСправочника>
            --(если мы для справочника делаем), т.е. там должна 
            --быть ссылка. Какие ещё параметры формы мы можем использовать для открытия 
            --форм помимо "Ключ". Про это можно посмотреть в синтакс-помошнике:
            --Интерфейс(управляемый) -> Форма клиентского приложения -> 
            --Расширение справочника -> Параметры формы. Это параметры формы 
            --для справочника. Далее нам нужно получить ссылку. Чтобы получить 
            --ссылку, нужна функция выполняющаяся на сервере. 
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ОткрытьФормуНоменклатуры<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                СсылкаНаНоменклатуру <span class="vue-r">=</span> ПолучитьНоменклатуруПоКоду<span class="vue-r">(</span><span class="vue-bl">"000000004"</span><span class="vue-r">);</span>
                ПараметрыФормы <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"Ключ"</span>, СсылкаНаНоменклатуру<span class="vue-r">);</span>
                ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Справочник.Номенклатура.ФормаОбъекта"</span>, ПараметрыФормы<span class="vue-r">);
            КонецПроцедуры </span>   

            <span class="vue-r">&НаСервере
            Функция</span> ПолучитьНоменклатуруПоКоду<span class="vue-r">(</span>Код<span class="vue-r">)</span>
                <span class="vue-r">Возврат</span> Справочники<span class="vue-r">.</span>Номенклатура<span class="vue-r">.</span>НайтиПоКоду<span class="vue-r">(</span>Код<span class="vue-r">);
            КонецФункции</span></span>


            --Кроме "Ключ" можно передать имя параметра "ЗначениеКопирования" и 
            --тогда при открытии формы с таким параметром формы, у нас откроется 
            --копия элемента справочника указанного в ссылке. 
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ОткрытьФормуНоменклатуры<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                СсылкаНаНоменклатуру <span class="vue-r">=</span> ПолучитьНоменклатуруПоКоду<span class="vue-r">(</span><span class="vue-bl">"000000004"</span><span class="vue-r">);</span>
                ПараметрыФормы <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"ЗначениеКопирования"</span>, СсылкаНаНоменклатуру<span class="vue-r">);</span>
                ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Справочник.Номенклатура.ФормаОбъекта"</span>, ПараметрыФормы<span class="vue-r">);
            КонецПроцедуры </span>   

            <span class="vue-r">&НаСервере
            Функция</span> ПолучитьНоменклатуруПоКоду<span class="vue-r">(</span>Код<span class="vue-r">)</span>
                <span class="vue-r">Возврат</span> Справочники<span class="vue-r">.</span>Номенклатура<span class="vue-r">.</span>НайтиПоКоду<span class="vue-r">(</span>Код<span class="vue-r">);
            КонецФункции</span></span> 


            <span class="vue-g">//открыть форму списка справочника "Номенклатура"</span>
            --Просто открываем форму списка.
            <span class="vue-b">ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Справочник.Номенклатура.ФормаСписка"</span><span class="vue-r">);</span></span>

            --Ещё давайте посмотрим как открыть форму списка с отбором. 
            --Например, в справочнике Номенклатура есть реквизит 
            --"ВидНоменклатуры"(Товар или Услуги) и мы хотим открыть форму 
            --списка с отбором по "ВидНоменклатуры -> Товар". Для этого будем
            --использовать опять 2й параметр - параметр формы. Нам нужно понять
            --как правильно описать структуру отбора. На этот раз нам нужно 
            --расширение динамического списка в том же разделе где и расширение
            --справочника. В расширении есть параметры формы и в ней есть параметр 
            --"Отбор". Создаём структуру Отбор. Ключом будет имя поля("ВидНоменклатуры"),
            --а значением ссылка на элемент перечисления. Затем надо создать ещё 
            --структуру уже ПараметрыФормы. Куда ключом указываем слово "Отбор", 
            --а значением структуру выше созданную. Да вот так всё мудрённо.
            --Функция ПердопределенноеЗначение() возвращает ссылку на предопределенный 
            --элемент из предопределенных данных, прикладных перечислений и точек 
            --маршрута бизнес-процессов, а также значения системных перечислений.
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ОткрытьФормуСпискаСОтбором<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                Отбор <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"ВидНоменклатуры"</span>, ПредопределенноеЗначение<span class="vue-r">(</span><span class="vue-bl">"Перечисление.ВидыНоменклатуры.Товар"</span><span class="vue-r">));</span>
                ПараметрыФормы <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"Отбор"</span>, Отбор<span class="vue-r">);</span>
                ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Справочник.Номенклатура.ФормаСписка"</span>, ПараметрыФормы<span class="vue-r">);
            КонецПроцедуры </span>

            <span class="vue-g">//открыть форму выбора справочника "Номенклатура"</span>
            <span class="vue-b">ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Справочник.Номенклатура.ФормаВыбора"</span><span class="vue-r">);</span></span>

            <span class="vue-g">//открыть форму справочника "Номенклатура" с именем "ФормаЭлементаУправляемая"</span>
            <span class="vue-b">ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Справочник.Номенклатура.ФормаЭлементаУправляемая"</span><span class="vue-r">);</span></span>


            <span class="vue-g">//пример открытия формы документа с заполнением некоторых полей</span>
            <span class="vue-b">ЗначениеПолей <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"Дата, ДатаОкончания"</span>, ДатаНачало, ДатаКонец<span class="vue-r">);</span>
            ПараметрыФормы <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"ЗначенияЗаполнения"</span>, ЗначениеПолей<span class="vue-r">);</span>
            ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"Документ.Запись.ФормаОбъекта"</span><span class="vue-r">);</span></span>
        </pre>
    </div>
    <p>Вот ещё один из способов открыть форму:</p>
    <div class="code-style">
        <pre>
            П = Новый Структура("Ключ", Поставщик);
            Форма = ПолучитьФорму("Справочник.Контрагенты.ФормаОбъекта", П);
            Форма.Открыть();
        </pre>
    </div>
    <p><span class="vue-r">Вот пример открытия формы</span> - <a href="#document25-1">тут</a></p>



    <p class="title-size16"><b id="work-forms-prog-param-form">Передача параметров в форму</b></p>
    <p>Вот пример передачи параметров в форму для открытия формы - <a href="#document25-1">тут</a></p>
    <p>Ещё примеры передачи параметров в статье выше - <a href="#work-forms-prog-open-form">тут</a></p>
    
    



    <p class="title-size16"><b id="work-forms-prog-form">Форма как программный объект</b></p>
    <p>Помимо того что форма внутри своего модуля предоставляет доступ к различным частям конфигурации, она также доступна из других частей конфигурации как программный объект.</p>
    <p>При этом помимо стандартных свойств и методов объекта встроенного языка ФормаКлиенскогоПриложения у нее могут существовать и другие свойства и методы, определенные разработчиком.</p>
    <p>Например, если в модуле формы ФормаДокумента документа ПриходнаяНакладная описана экспортируемая процедура ПроверочнаяПроцедура(), то может быть использован следующий вызов этой процедуры:</p>
    <div class="code-style">
        <pre>
            --модуль формы
            <span class="vue-b">&НаКлиенте
            Процедура ПроверочнаяПроцедура() Экспорт
                Сообщить(<span class="vue-bl">"Я из модуля формы"</span>);
            КонецПроцедуры</span>

            --модуль приложения
            <span class="vue-b">Процедура ПриНачалеРаботыСистемы()
                Форма = ПолучитьФорму(<span class="vue-bl">"Документ.ПриходнаяНакладная.Форма.ФормаДокумента"</span>);
                Форма.ПроверочнаяПроцедура();
            КонецПроцедцры</span>    

            <span class="vue-g">//при запуске системы мы увидим сообщение - "Я из модуля формы"</span>
        </pre>
    </div>











    <h2 class="header-style" id="table-part">Работа с табличной частью формы</h2>

    <h3 class="header-style2" id="table-part1">Работа с табличной частью документа в форме. Подвал, итоги.</h3>
    <p>Есть табличная часть в документе "ПоступлениеТоваров". Чтобы в этой табличной части снизу отобразать строку с итогами по сумме, то выбираем в форме табличную часть и открываем её свойства. На вкладке "Использование" есть такое свойство как "Подвал", включаем его. Появится пока пустая строка закрашенная так же как и шапка таблицы. Строка подвал делится на столько же колонок, сколько их в шапке. Например, если в шапке колонки - Товар, Количество, Цена и Сумма, то и в подвале будет 4 колонки. Для каждой колонки мы можем что то показать в подвале. Для колонки Товар выберем палитру свойств и в свойстве "ТекстПодвала" напишем ИТОГО. Для колонок Цена и Количество ничего не указываем.</p>
    <p>Дальше мы хотим, чтобы в колонке Сумма в подвале подсчитывалась автоматом сумма всех товаров. Для этого выделяем колонку Сумма и в палитре свойств есть свойство "ПутьКДаннымПодвала" вкладки "Основные". У этого свойства жмём на кнопку выбора и откроется окошко "Выбор реквизита". Видим 2 объекта формы: 1)Основной реквизит формы Объект, 2)Объект коллекция элементов формы Элементы. Нам нужен основной реквизит Объект, раскрываем его и проходим до табличной части Товары, раскрываем его и под буквой Е внизу есть такое вычисление как ИтогСумма, выбираем его. Всё, теперь в подвале в колонке Сумма будут суммироваться все суммы денег товаров.</p>


    <h3 class="header-style2" id="table-part2">Как заблокировать некоторые колонки в табличной части.</h3>
    <p>Как то не мог найти, как заблокировать колонку табличной части для изменений. Пытался через Элементы найти колонки в табличной части, заблокировать их при открытии формы, но не получалось. Оказалось просто нужно выбрать поле табличной части и в палитре свойств поставить галочку "Только просмотр".</p>

    <h3 class="header-style2" id="table-part3">Размещаем в ком. панели таб. части кнопку "Подбор" и по ней открываем форму выбора справочника Номенклатура. Из формы выбора выбираем товар и он добавляется в таб. часть</h3>
    <p>Опишу здесь просто для тренировки программирования. Но такое встречается на практике, когда размещают кнопку Подбор в табличной части формы документа и по ней из формы выбирают товары и эти товары попадают в табличную часть сразу скопом. Вот такую форму видел на ютубе, но как её делать, пока не знаю:</p>
    <img src="../img/1С-1/2023-07-19_09-48-06.png" class="screen" alt="">
    <p>Как видно, форма разделена на 3 части, как такое сделать я пока не знаю, но давай сделаем простенький способ. Тут опишу как по кнопке Подбор открыть просто форму выбора Справочника Номенклатура, там выбрать товар и вставить этот товар в созданную строку табличной части.</p>
    <p>Чтобы добавить новую строку с товаром в табличную часть можно использовать 2 способа. Первый это через добавление строки табличной части через основной реквизит формы Объект, а второй через Элементы формы. Второй способ больше по коду, сам его сочинял. Всё ради тренировки.</p>
    <p><span class="vue-d-b">При первом способе</span>, чтобы добавить товар нужна кнопка и обработчик этой кнопки, а также событие "ОбработкаВыбора" у табличной части.</p>
    <div class="code-style">
        <pre>
            --модуль формы
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> Подбор<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                <span class="vue-g">//тут важно указать владельца(табличная часть Товары) открываемой формы, иначе событие
                //"ОбработкаВыбора" у табличной части не сработает</span>
                ОткрытьФорму<span class="vue-r">(</span>"Справочник.Номенклатура.ФормаВыбора"<span class="vue-r">,,</span>Элементы<span class="vue-r">.</span>Товары<span class="vue-r">);
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ТоварыОбработкаВыбора<span class="vue-r">(</span>Элемент<span class="vue-r">,</span> ВыбранноеЗначение<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-g">//этим способом проще добавлять товар, потому что метод Добавить() возвращает добавленную строку</span>
                СтрокаТабЧасти <span class="vue-r">=</span> Объект<span class="vue-r">.</span>Товары<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                СтрокаТабЧасти<span class="vue-r">.</span>Товар <span class="vue-r">=</span> ВыбранноеЗначение<span class="vue-r">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p><span class="vue-d-b">При втором способе</span> будем использовать таблицу из окна Элементов формы. Там нет у таблицы метода Добавить(), но есть метод ДобавитьСтроку(). Проблема в том, что этот метод не возвращает добавляему строку, а значит просто так в строку не добавить товар в колонку Товар. При добавлении строки в табличную часть таким способом происходит её добавление в таб. часть и сразу система ставит на ней фокус, а значит можно использовать событие "ПриАктивизацииСтроки". Дальше просто отлавливаем эту строку и вставляем в неё выбранный товар из другого обработчика. А чтобы из другого обработчика получить товар используем промежуточную переменную. Для этого добавим глобальную перепенную, глобальная в подтексте формы конечно же. Если просто объявить переменную через ключевое слово Перем, то ничего не сработает, как я вычитал тут - https://its.1c.ru/db/v8std/content/639/hdoc, если все обработчики и события выполняются на клиенте, то глобальную переменную тоже нужно объявлять на клиенте, чтобы с её помощью передавать промежуточные результаты между процедурами и функциями.</p>
    <div class="code-style">
        <pre>
            --модуль формы
            
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Перем</span> НаименованиеТовара<span class="vue-r">;</span>

            <span class="vue-r">&НаКлиенте
            Процедура</span> Подбор<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                <span class="vue-g">//тут важно указать владельца(табличная часть Товары) открываемой формы, иначе событие
                //"ОбработкаВыбора" у табличной части не сработает</span>
                ОткрытьФорму<span class="vue-r">(</span>"Справочник.Номенклатура.ФормаВыбора"<span class="vue-r">,,</span>Элементы<span class="vue-r">.</span>Товары<span class="vue-r">);
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ТоварыОбработкаВыбора<span class="vue-r">(</span>Элемент<span class="vue-r">,</span> ВыбранноеЗначение<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                НаименованиеТовара <span class="vue-r">=</span> ВыбранноеЗначение<span class="vue-r">;</span>
                Элементы<span class="vue-r">.</span>Товары<span class="vue-r">.</span>ДобавитьСтроку<span class="vue-r">();
            КонецПроцедуры</span>

            <span class="vue-r">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки<span class="vue-r">(</span>Элемент)
                ТекДанные <span class="vue-r">=</span> Элемент<span class="vue-r">.</span>ТекущиеДанные<span class="vue-r">;</span>
                <span class="vue-g">//первая проверка, на случай когда мы создаём новый документ, 
                //то система автоматом ставит на на строку табличной части фокус
                //а строки нет, значит занчение будет Неопределено
                //вторая проверка, когда мы открываем существующий документ и в таб. части есть товары</span>
                <span class="vue-r">Если</span> ТекДанные <span class="vue-r">= Неопределено</span> <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат;</span>
                <span class="vue-r">ИначеЕсли</span> ЗначениеЗаполнено<span class="vue-r">(</span>ТекДанные<span class="vue-r">.</span>Товар<span class="vue-r">) Тогда</span>
                    <span class="vue-r">Возврат;</span>
                <span class="vue-r">Иначе</span>
                    ТекДанные<span class="vue-r">.</span>Товар <span class="vue-r">=</span> НаименованиеТовара<span class="vue-r">;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <h3 class="header-style2" id="table-part4">Свойство "Проверка заполнения" для табличной части</h3>
    <p>В свойствах для табличной части есть свойство "Проверка заполнения" на вкладке Представление. Если выбрать значение "Выдавать ошибку", то это значит, что нельзя будет сохранить документ или элемент справочника не заполнив его табличную часть. Будет проверяться табличная часть в целом и по каждой колонке.</p>













    <h2 class="header-style" id="">Работа с кнопками для поля ввода</h2>

    <p class="title-size16"><b id="work-buttons1">Основы</b>.</p>
    <p>Когда мы создаём реквизит формы, то он по умолчанию создаётся с видом "Поле ввода". Это наверно самый распространнёный вид поля. Для этого поля предусмотренны расширения из разных кнопок. Эти кнопки можно подключить в палитре свойств для этого поля, но только после того как это поле перенесём в окно элементов формы. В палитре свойств эти кнопки находятся на закладке "Использование".</p>
    <img src="../img/1С-1/2023-07-07_09-17-31.png" alt="">
    <p>Чтобы подключить одну из кнопок нужно в списке напротив кнопки выбрать значение Да. Также для каждой из кнопок предусмотренны события, которые находятся на вкладке "События".</p>
    <p>Как я узнал, на данный миг событие "Начало выбора из списка" не работает. По идеи оно должно срабатывать по нажатию на кнопку "КнопкаВыпадающегоСписка", но не работает. Раньше, как говорят, была другая кнопка - "Кнопка списка выбора", вот для неё работало это событие.</p>
    <p>В зависимости от того какой тип данных мы назначим полю ввода, то такие кнопки и подключатся к ней и у кнопок будут свои заранее написанные действия. Например, указывая тип Дата, появится кнопка выбора даты и по нажатию на неё сработает событие "НачалоВыбора" и откроется по умолчанию календарь. Стандартное поведение можно отключить указав аргументу "СтандартнаяОбработка" значение Ложь.</p>
    <p>Начну по неменогу описывать кнопки и их события. Начну с "КнопкаВыбора" и её событий "НачалоВыбора" и "ОбработкаВыбора".</p>

    <p class="title-size16"><b id="work-buttons2">Кнопка выбора</b>.</p>















    <h2 class="header-style" id="reg-copy-0">Отдельно об регистре накопления</h2>

    <p class="title-size16"><b id="reg-theory">Теория</b>.</p>
    <p>Регистр накопления предназначен для описания структуры накопления данных. На основе объекта конфигурации <i style="text-decoration:underline">Регистр накопления</i> платформа создает в базе данных таблицы, в которых будут накапливаться данные, поставляемые различными объектами базы данных. Эти данные будут храниться в таблицах в виде отдельных записей, каждая из которых имеет одинаковую заданную в конфигураторе структуру:</p>
    <img src="../img/1С-1/2022-11-10_16-50-07.png" class="screen" alt="">
    <p>На основании таблицы движений регистра накопления система рассчитывает таблицу итогов регистра, которая хранит в базе данных итоги на момент времени последнего движения (актуальные итоги).</p>
    <p>Отличительной особенностью регистра накопления является то, что он не предназначен для интерактивного редактирования пользователем.</p> 
    <p>Разработчик может при необходимости предоставить пользователю возможность редактировать регистр накопления. Но предназначение регистра накопления заключается в том, чтобы его изменение(модификация) производилось на основе алгоритмов работы других объектов базы данных, а не в результате непосредственных действий пользователя.</p>
    <p>Основным назначением регистра накопления является накопление числовой информации в разрезе нескольких <i style="text-decoration:underline">измерений</i>, которые описываются разработчиком в соответствующем объекте конфигурации Регистр накопления и являются подчиненными объектами конфигурации.</p>
    <p>Виды числовой информации, накапливаемой регистром накопления, называются <i style="text-decoration:underline">ресурсами</i>, также являются подчиненными объектами и описываются в конфигураторе.</p>
    <p>Например, регистр накопления может накапливать информацию о количестве и сумме товаров на складах. В этом случае он будет иметь измерения Товар и Склад и ресурсы Количество и Сумма.</p>
    <p>Изменение состояния регистра накопления происходит, как правило, при проведении документа и заключается в том, что в регистр добавляется некоторое количество записей. Каждая запись содержит значения измерений, значения приращений ресурсов, ссылку на документ, который вызвал эти изменения (регистратор), и «направление» приращения (приход или расход). Такой набор записей называется <i style="text-decoration:underline">движениями</i> регистра накопления. Каждому движению регистра накопления всегда должен соответствовать <i style="text-decoration:underline">регистратор</i> – объект информационной базы (как правило, документ), который произвёл эти движения. </p>
    <img src="../img/1С-1/2023-08-04_08-02-12.png" class="screen" alt="">
    <p>Кроме этого, регистр накопления может хранить дополнительную информацию, описывающую каждое движение. Набор такой дополнительной информации задаётся разработчиком при помощи <i style="text-decoration:underline">реквизитов</i> объекта конфигурации Регистр накопления.</p>
    <p>Когда мы создадим какой нибудь регистр накопления, дадим ему имя, заполним измерения и ресурсы и попытаемся запустить пользовательский режим, то система выдаст предупреждение, что не указан регистратор для этого регистра. Это сообщение еще раз подтверждает тот факт, что назначение регистра накопления в том, чтобы накапливать данные, поставляемые различными документами.</p>
    <p>Уникальность записей регистра обеспечивается полем Регистратор и Номер строки.</p>
    <p>Поэтому нужно сформировать движения по регистру накопления документами. <i style="text-decoration:underline">Движения документа</i> – это записи в регистрах, которые создаются в процессе проведения документа и отражают изменения, производимые документом.</p>
    <p>Движения формируются в обработчике события ОбработкаПроведения модуля объекта.</p>
    <div class="code-style">
        <pre>
            --модуль объекта
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> Режим<span class="vue-r">)</span>
                Движения<span class="vue-r">.</span>ОстаткиМатериалов<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                <span class="vue-r">Для Каждого</span> ТекСтрокаМатериалы <span class="vue-r">Из</span> Материалы <span class="vue-r">Цикл</span>
                    //создаём записи в регистре ОтстаткиМатериалов
                    Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиМатериалов<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                    Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                    <span class="vue-g">//поле Период обязательно должно быть заполнено</span>
                    Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Материал <span class="vue-r">=</span> ТекСтрокаМатериалы<span class="vue-r">.</span>Материал<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ТекСтрокаМатериалы.Количество<span class="vue-r">;
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Объект встроенного языка ДокументОбъект.ПриходнаяНакладная имеет свойство Движения, возвращающее объект КоллекцияДвижений, который содержит коллекцию набора записей регистров, по которым этот документ может делать движения. К конкретному набору записей этой коллекции можно обратиться, указав через точку имя регистра, которому принадлежит этот набор записей. Например, Движения.ОстаткиМатериалов. В результате мы получим набор записей принадлежащий именно текущему документу, этот набор может быть пустой, а может уже заполненный раньше.</p>
    <p>Затем через точку можно использовать различные методы набора записей регистра, например, Движения.ОстаткиМатериалов.Добавить(). Метод Добавить() добавляет новую запись в набор записей.</p>
    <p>В первой строке процедуры мы устанавливаем свойство Записывать набора записей регистра в значение Истина. То есть в явном виде указываем, что после завершения обработки проведения платформа должна будет записать этот набор записей в базу данных. Т.е. когда исполнение кода подойдёт до конца обработчика, то система видя этот флаг сама запишет набор записей в регистр.</p>
    <p>Свойство Движения, то что система сама запишет данные в регистр, то что система сама добавит поле Регистратор и запишет в него текущий документ - это всё помошники именно в контексте ДокументОбъект(в модуле объекта). Если мы будем писать в регистр из других мест, то таких помошников там не будет и нужно будет самому всё это писать и указывать.</p>
    <p>Система по умолчанию также добавляет команду открытия регистра накопления в командную панель раздела, но делает её невидимой. Чтобы её сдклать видимой в разделе, нужно перейти в командный интерфейс подсистемы и там включить её видимость.</p>

    <p class="title-size16"><b id="reg-copy-0.1">Команда перехода к движениям в форме документа</b>.</p>
    <p>Для примера возьмём регистр накопления "Остатки материалов".</p>
    <p>При реальной работе записей в регистре накпления "Остатки материалов" будет много, и будет трудно понять, какие записи относятся к определенному документу. </p>
    <p>Поэтому наряду с общим списком регистра хотелось бы иметь возможность вызывать из формы документа список регистра, в котором показаны движения, произведённые только этим документом.</p>
    <p>Для этого нужно в конфигураторе открыть форму документа и перейти во вкладку "Командный интерфейс" окна элементов формы. В разделе Панель навигации раскроем группу Перейти и увидим команду для открытия списка регистра накопления "Остатки материалов". Эта команда была автоматически помещена в панель навигации формы документа, так как он является регистратором, то есть создаёт движения в нашем регистре. </p>
    <img src="../img/1С-1/2023-08-04_09-32-49.png" class="screen" alt="">
    <p>Нужно установить свойство Видимость для регистра. У команды "Остатки материалов" рядом в скобках указано (Объект.Ссылка) это параметр для запроса в таблицу регистра накопления "Остатки материалов" в БД. Объект это основной реквизит формы, т.е. это почти объект данных документа "Приходная накладная", а Ссылка это идентификатор этого объекта данных в БД. И этот параметр говорит как бы, что хочу получить из регистра "Остатки материалов" записи, где поле Регистратор = Объект.Ссылка. Вот так мы переходя по команде "Остатки материалов" получаем список записей для текущего документа.</p>
    <p>Если это команда не добавляется автоматически в форму документа, то можно самому её туда добавить. Для этого нужно в конфигураторе в форме документа перейти в редактор команд во вкладку Команды - Глобальные команды, в окошко параметризуемых команд и там выбрать:</p>
    <img src="../img/1С-1/2023-08-04_09-48-15.png" class="screen" alt="">
    <p>Теперь если посмотреть в пользовательском режиме в форме документа, то появилась гиперссылка в панели навиации на список записей регистра для текущего документа:</p>
    <img src="../img/1С-1/2023-08-04_09-51-43.png" class="screen" alt="">
    <p>Если ни одной команды нет в панели навигации, то она не будет отображаться.</p>

    <p class="title-size16"><b id="reg-copy-1">Основная таблица регистра накопления в БД</b>.</p>
    <p>У этой таблицы есть такие стандартные реквизиты как ВидДвижения, Активность и др. ВидДвижения для каждой записи содержит слово Приход или Расход. Активность говорит системе о том, будет ли запись, у которой Активность стоит ДА учавствовать в построении виртуальных таблиц этого регистра. Иногда проще поставить записи значение НЕТ в поле Активность  чем её удалять.</p>

    <p class="title-size16"><b id="reg-copy-2">Виртуальная таблица регистра накопления Остатки</b>.</p>
    <p>Эта таблица не содержит уже левых полей, в полях только измерения и ресурсы. Ресурсы подсчитываются и вычисляется остаток заданного ресурса(количество, сумма и т.д.). Вирт. таб. <span class="vue-b">Остатки имеет всего 2 параметра: Период и Условие</span>.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ВЫБРАТЬ
                *
            ИЗ
                РегистрНакопления.ОстаткиНоменклатуры.Остатки(
                    &Период,
                    Номенклатура = &Товар
                    //Номенклатура В ИЕРАРХИИ(&Номенклатура)
                )
            </span>
        </pre>
    </div>

    <p class="title-size16"><b id="reg-copy-3">Виртуальная таблица регистра накопления Обороты</b>.</p>
    <p>Вирт. таблица Обороты подсчитывает ресурс в возрастающем направлении. Обычно считают деньги потраченные на закупку товаров или заработанные с продажи. Обороты отбираются за какой-то отрезок времени, т.е. нужно начало даты и конец даты. <span class="vue-b">Обороты имеет 4 параметра: начало периода, конец периода, периодичность и условие</span>. Периодичность задаёт отезки, на которые будут биться обороты, например, Месяц, тогда появится дополнительное поле Период, в котором будут по месяцам разбиты обороты ресурса. Условие как и у всех таблиц такое же. Все эти параметры необязательны.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ВЫБРАТЬ
            	*
            ИЗ
                РегистрНакопления.Продажи.Обороты(
                    &НачалоПериода,
                    &КонецПериода,
                    Месяц,
                    Номенклатура = &Товар
                )
            </span>
        </pre>
    </div>
    <p>Если параметр Периодичность задать Авто, то тогда периодичность оборотов будет зависить от полей отбора. Там есть такие поля как ПериодГод, ПериодДекада, ПериодДень и т.д. Виртуальные таблицы не нужно группировать, там уже предусмотрено системой такое поведение. Например если мы хотим получить только поле КоличествоОборот, то указываем в отборе только это поле и система сама сгруппирует и просуммирует записи этого поля и выдастся одна колонка с одной записью - какое то число.</p>

    <p class="title-size16"><b id="reg-copy-4">Виртуальная таблица регистра накопления ОстаткиИОбороты</b>.</p>
    <p>Хочу отметить, что тут КоличествоОборот отличается от КоличествоОборот в вирт. таблице Оборот. Потому что в этой таблице КоличествоОборот подсчитывает оборот оставшегося количества товаров, тогда как в таблице Оборот подсчитывается количество проданных, поступивших и т.д. товаров.</p>
    <p>Эта таблица имеет уже 5 параметров: НачалоПериода, КонецПериода, Периодичность, Метод дополнения периодов, Условие. Не буду описывать все параметры, можно посмотреть это в справочнике. Эту таблицу используют когда нужны остатки на начало и конец периода и обороты за этот период.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ВЫБРАТЬ
            	*
            ИЗ
                РегистрНакопления.ОстаткиНоменклатуры.ОстаткиИОбороты(
                    &НачалоПериода,
                    &КонецПериода,
                    Месяц,
                    Движения,
                    Номенклатура = &Товар
                )
            </span>
        </pre>
    </div>

    <p class="title-size16"><b id="reg-copy-5">Выборка из виртуальной таблицы Остатки объектным и табличным способом</b>.</p>
    <p>Этот обработчик выполняется при наступлении события "ПриАктивизацииСтроки". Это когда мы в табличной части в форме выделяем строку. В форме под таб. частью есть реквизит "ОстатокТовара" с видом "Поле надписи", куда мы и записываем результат запроса. Мы выделяем строку с товаром, а в поле "ОстатокТовара" выводится остаток этого товара.</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ПродажаТоваров"
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ТоварыПриАктивизацииСтроки<span class="vue-r">(</span>Элемент<span class="vue-r">)</span>
                СсылкаНаТовар <span class="vue-r">=</span> Элементы<span class="vue-r">.</span>Товары<span class="vue-r">.</span>ТекущиеДанные<span class="vue-r">.</span>Товар<span class="vue-r">;</span>
                ТоварыПриАктивизацииСтрокиНаСервере<span class="vue-r">(</span>СсылкаНаТовар<span class="vue-r">);
            КонецПроцедуры</span>

            <span class="vue-r">&НаСервере
            Процедура</span> ТоварыПриАктивизацииСтрокиНаСервере<span class="vue-r">(</span>СсылкаНаТовар<span class="vue-r">)</span>
                <span class="vue-g">//объектная модель запроса 
                //так как этот регистр имеет 2 измерения, то их и указываем</span>
                Отбор <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span>"Номенклатура<span class="vue-r">,</span> Склад"<span class="vue-r">,</span> СсылкаНаТовар<span class="vue-r">,</span> Объект<span class="vue-r">.</span>Склад<span class="vue-r">);</span>

                <span class="vue-g">//в переменную ТаблицаОстатков вернётся ТаблицаЗначений</span>
                ТаблицаОстатков <span class="vue-r">=</span> РегистрыНакопления<span class="vue-r">.</span>ОстаткиНоменклатуры<span class="vue-r">.</span>Остатки<span class="vue-r">(,</span> Отбор<span class="vue-r">);</span> 

                <span class="vue-g">//чтобы получить ресурс Количество нужно вызвать метод Итог у таблицы
                //мы можем получить Количество и не через Итог, а сразу получить значение поля, выбрав строку таблицы и поле в этой строке
                //ОстатокТовара = ТаблицаОстатков.[0].Количество;
                //почему используем Итог(), потомо что у нас может не быть остатков, а значит строк
                //не будет в таблице и обращение к строке вызовет ошибку, а метод Итог() не вызовет ошибки</span>
                ОстатокТовара <span class="vue-r">=</span> ТаблицаОстатков<span class="vue-r">.</span>Итог<span class="vue-r">(</span>"Количество"<span class="vue-r">);</span>
                


                <span class="vue-g">//табличная модель запроса
                //Запрос = Новый Запрос;
                //Запрос.Текст = 
                //	"ВЫБРАТЬ
                //	|	ОстаткиНоменклатурыОстатки.КоличествоОстаток КАК КоличествоОстаток
                //	|ИЗ
                //	|	РегистрНакопления.ОстаткиНоменклатуры.Остатки КАК ОстаткиНоменклатурыОстатки
                //	|ГДЕ
                //	|	ОстаткиНоменклатурыОстатки.Номенклатура = &Номенклатура";
                //
                //Запрос.УстановитьПараметр("Номенклатура", СсылкаНаТовар);
                //РезультатЗапроса = Запрос.Выполнить();
                //ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
                //ВыборкаДетальныеЗаписи.Следующий();
                //ОстатокТовара = ВыборкаДетальныеЗаписи.КоличествоОстаток;</span>
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="reg-copy-6">Для чего поле "Активность" в таблице регистра накопления а БД</b>.</p>
    <p>Мы можем в документе сформировать движения и их выключить, тем самым делать какое то планирование. Т.е. документ проведён, но хотим, чтобы движения не нашли отражение в учёте. Например, мы подготовили документ заранее, провели его, но заказчик за товаром ещё не приехал, мы выключаем его, указав полю Активность Ложь. Движения есть, но на остатках это никак не влияет. Приехал заказчик, забрал товар, кладовщик нажал на галочку "Забрали", движения включились, на остатки оборотов они повлияли. Это первый практический смысл.</p>
    <p>Второй смысл. Удалить что либо быстро за большой период мы не можем, это повлечёт к существенным трудозатратам, а вот выключить большое количество движений можно довольно быстро.</p>
    <p>Пока не совсем понятно как это на практике работает.</p>

    <p class="title-size16"><b id="reg-copy-7">Как не записывать одинаковые товары в регистр при проведении</b>.</p>
    <p>Мой способ скорее всего не понадобится, потому что обычно в этом обработчике делают запрос в БД не только для группировки, но и для получения всех необходиммых данных, а потому скорее всего будет испольховаться именно запрос. Но как пример группировки товаров в табличной части может когда нибудь пригодится.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения(Отказ, Режим)
                <span class="vue-g">//Сделаем проверку на наличие строк в табличной части.
                //Если строк нет, то и документ проводить не надо и стоит вообще остановить код.
                //Отказ это параметр в котором лежит булево значение Ложь и если мы в него установим Истина по какому то условию, то документ не будет
                //проведён, но код продолжит выполнение, чтобы и код остановить, чтобы не тратить ресурсы на исполнение, напишем слово Возврат</span>
                <span class="vue-r">Если</span> Материалы<span class="vue-r">.</span>Количество<span class="vue-r">() =</span> 0 <span class="vue-r">Тогда</span>
                    Отказ <span class="vue-r">=</span> Истина<span class="vue-r">;
                    Возврат;
                КонецЕсли;</span>


                <span class="vue-g">//Бывает что вносится в документ поступления товаров несколько строк одного и того же товара и при проведении в регистр также вносится один и тот же товар
                //в нескольких записях. Такой подход быстро затормозит БД. Нужно один и тот же товар подсчитать и занести его одной строкой. Есть способ, который предложил
                //человек из курса Техподдержка. Этот способ через запрос в БД к таблице(табличной части документа). В запросе группируем одинаковый товар подсчитывая его количество
                //и сумму цен товара, потом запрос возвращает уже сгруппированные данные и записывает эти данные в регистр.
                //Я написал свой способ без запроса. Сразу на месте получаем строки табличной части и подсчитываем сумму и количество одинакового товара и записываем в регистр.
                //Будет ли мой способ работать нормально в дальнейшем пока не знаю, оставлю его и буду проверять на деле. И какой способ работает быстрее тоже пока не знаю.
                
                //мой способ</span>
                СтруктураДляПродукта <span class="vue-r">= Новый</span> Структура<span class="vue-r">;</span>
                МассивНаименованийПродуктов <span class="vue-r">= Новый</span> Массив<span class="vue-r">;</span>
                
                <span class="vue-r">Для каждого ТекСтрокаПродукты <span class="vue-r">Из</span> Продукты <span class="vue-r">Цикл</span>
                    СтруктураДляПродукта<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>"Продукт"<span class="vue-r">,</span> ТекСтрокаПродукты<span class="vue-r">.</span>Продукт<span class="vue-r">);</span>
                    СтруктураДляПродукта<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>"Количество"<span class="vue-r">,</span> ТекСтрокаПродукты<span class="vue-r">.</span>Количество<span class="vue-r">);</span>
                    СтруктураДляПродукта<span class="vue-r">.</span>Вставить<span class="vue-r">(</span>"СуммаЦенПродукта"<span class="vue-r">,</span> ТекСтрокаПродукты<span class="vue-r">.</span>Количество <span class="vue-r">*</span> ТекСтрокаПродукты.Цена<span class="vue-r">);</span>
                    
                    <span class="vue-r">Если</span> МассивНаименованийПродуктов<span class="vue-r">.</span>Найти<span class="vue-r">(</span>СтруктураДляПродукта<span class="vue-r">.</span>Продукт<span class="vue-r">) =</span> Неопределено <span class="vue-r">Тогда</span>
                        
                        <span class="vue-r">Для каждого</span> ТекСтрокаПродукты2 <span class="vue-r">Из</span> Продукты <span class="vue-r">Цикл</span>
                            <span class="vue-r">Если</span> ТекСтрокаПродукты<span class="vue-r">.</span>НомерСтроки <span class="vue-r">=</span> ТекСтрокаПродукты2<span class="vue-r">.</span>НомерСтроки <span class="vue-r">Тогда</span>
                                Продолжить;	
                            КонецЕсли;</span>
                            <span class="vue-r">Если</span> ТекСтрокаПродукты<span class="vue-r">.</span>Продукт <span class="vue-r">=</span> ТекСтрокаПродукты2<span class="vue-r">.</span>Продукт <span class="vue-r">Тогда</span>
                                СтруктураДляПродукта<span class="vue-r">.</span>Количество <span class="vue-r">=</span> СтруктураДляПродукта<span class="vue-r">.</span>Количество <span class="vue-r">+</span> ТекСтрокаПродукты2<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                                СтруктураДляПродукта<span class="vue-r">.</span>СуммаЦенПродукта <span class="vue-r">=</span> СтруктураДляПродукта<span class="vue-r">.</span>СуммаЦенПродукта <span class="vue-r">+ (</span>ТекСтрокаПродукты2<span class="vue-r">.</span>Количество <span class="vue-r">*</span> ТекСтрокаПродукты2<span class="vue-r">.</span>Цена<span class="vue-r">);
                            КонецЕсли;
                        КонецЦикла;</span>
                    
                    
                        МассивНаименованийПродуктов<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>СтруктураДляПродукта<span class="vue-r">.</span>Продукт<span class="vue-r">);</span>
                        
                        Движения<span class="vue-r">.</span>ОстаткиПродуктов<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>	
                        Движение             <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиПродуктов<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Приход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период      <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Продукт     <span class="vue-r">=</span> СтруктураДляПродукта<span class="vue-r">.</span>Продукт<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество  <span class="vue-r">=</span> СтруктураДляПродукта<span class="vue-r">.</span>Количество<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Сумма       <span class="vue-r">=</span> СтруктураДляПродукта<span class="vue-r">.</span>СуммаЦенПродукта<span class="vue-r">;	
                    КонецЕсли;
                КонецЦикла;</span>

                
                <span class="vue-g">//второй способ через запрос
                //Запрос = Новый Запрос;
                //Запрос.Текст = 
                //    "ВЫБРАТЬ
                //    |	Материалы.Материал КАК Материал,
                //    |	СУММА(Материалы.Количество) КАК Количество,
                //    |	СУММА(Материалы.Количество * Материалы.Цена) КАК ОбщаяСумма
                //    |ИЗ
                //    |	Документ.ПриходнаяНакладная.Материалы КАК Материалы
                //    |ГДЕ
                //    |	Материалы.Ссылка = &Ссылка
                //    |
                //    |СГРУППИРОВАТЬ ПО
                //    |	Материалы.Материал";
                //
                //Запрос.УстановитьПараметр("Ссылка", Ссылка);
                //
                //РезультатЗапроса = Запрос.Выполнить();
                //
                //ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();

                //далее тут движения заполнить из выборки</span>

            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>

    <p class="title-size16"><b id="reg-copy-8">Регистр "Взаиморасчеты" и отчёт по нему</b>.</p>
    <p>Пишу из курса Чистова 8.2. Видео https://www.youtube.com/watch?v=_l3Z5Ek6XCc&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=18, с 00:27:10</p>
    <p>Регистр "Взаиморасчеты" это запись долгов наших и перед нами. Нужно сделать отчёт с 3мя колонками - Контрагент, НашДолг, ДолгКонтрагента.</p>
    <p>Добавим новый регистр "Взаиморасчеты" в режиме остатки, ресурс будет один - Сумма. Положительный ресурс это нам должны, отрицательный это мы должны. Измерением будет Контрагент. Документы, которые будут писать в этот регистр это документы поступления и продажи товаров, но это не все документы. Ещё будут документы "оплачивающие" эти долги, мы же в регистре должны же сводить в ноль и наши долги и перед нами.</p>
    <p>В обработке проведения документа "ПоступлениеТоваров" запишем данные в регистр. У нас нет реквизита "СуммаДокумента", поэтому мы можем вычислить итог у табличной части документа. Я бы наверно добавил такой рекизит в документ, как говорил Гилёв, пусть такой реквизит будет избыточным, но в итоге от него больше положительного. Где то Чисто уже показывал как в форме списка документа на лету создать виртуальное поле "СуммаДокумента" и показывать это поле с вычисленным значением при открытии этого списка, но это затратно по ресурсам компьютера. Проще добавить такой реквизит и затем в списке не надо на лету его создавать и тут в обработке не надо итог выислять. Но чисто в опытных целях оставлю так как Чистов делает.</p>
    <p>У нас сумма документа может быть в иностранной валюте, потому что так расчитываемся с контрагентом. Нам же нужно для отчета рубли, значит сделаем проверку и переведём в рубли если это нужно. Будем смотреть на поле "Валюта", если оно заполнено, то произведём пересчёт в рубли:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "ПоступлениеТоваров"

            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> Режим<span class="vue-r">)</span>
                Движения<span class="vue-r">.</span>Взаиморасчеты<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>

                СуммаДокумента <span class="vue-r">=</span> Товары<span class="vue-r">.</span>Итог<span class="vue-r">(</span><span class="vue-bl">"Сумма"</span><span class="vue-r">);</span>

                <span class="vue-r">Если НЕ</span> Валюта<span class="vue-r">.</span>Пустая<span class="vue-r">() Тогда</span>
                    <span class="vue-g">//тут код по переводу в рубли. Для этого можно сделать процедуру
                    //в общем модуле, которая получает регистр сведений с указанной валютой
                    //и производим пересчёт в рубли</span>
                <span class="vue-r">КонецЕсли;</span>

                Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>Взаиморасчеты<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Контрагент <span class="vue-r">=</span> Контрагент<span class="vue-r">;</span>
                Движение<span class="vue-r">.</span>Сумма <span class="vue-r">=</span> СуммаДокумента<span class="vue-r">;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Точно такой же код добавим в обработку проведения документа "ПродажаТоаров", только вид движения изменим на приход. Далее нужно сделать отчёт, который будет показывать остатки долга наши и контрагента.</p>
    <p><b>Отступление. Тут немного о пользовательских полях в отчёте</b></p>
    <p>Создаём отчёт "СостояниеВзаиморасчетов", выбираем запрос в наборе данных и что же нам выбрать в запросе, чтобы было 3 колонки описанные выше? Давайте выберем таблицу РегистрНакопления.Взаиморасчеты.Остатки. В ней всего 2 поля, это Контрагент и СуммаОстаток, в поле СуммаОстаток у нас и приходы и расходы, а нам нужно чтобы приходы были отдельно в своей колонке "ДолгКонтрагента", а расходы в своей "НашДолг". Можно выбрать и эту таблицу, тогда мы получим отчет с 2мя колонками - "Контрагент" и "Сумма долга контрагента" и у пользователя в пользовательском режиме будет возможность самому добавить свои пользовательские поля, назвать их как он хочет и вывести в них через условие приходные и расходные значения. Такой вариант конечно лучше пользователю не предоставлять, потому что это дополнительная нагрузка на него, но в целях обучения помотрим как вообще пользователь может создавать такие поля сам.</p>
    <p>Создадим простенький отчет в СКД по таблице остатков с 2мя полями. Зайдём в пользовательский режим, откроем "Ещё" -> "Изменить вариант". Откроется окно похожее на окно вкладки "Настройка" в СКД, в этом окне находим вкладку "Пользовательские поля" и жмём "Добавить" -> "Новое поле выбор", откроется ещё окно "Редактирование пользоватеьского поля", в заголовке пишем имя поля - НашДолг, а ниже добавляем отбор. Отбор это условие для поля. В колонке Отбор по кнопке выбора откроется ещё одно окно для написания условия отбора, условие будет таким: слева указываем сумму долга, по середине указываем сравнение - Меньше, справа указываем 0. Условие звучит так - "Выбрать все долги меньше нуля", жмём ОК и выходим из окна отбора, теперь в колонке Значение нужно указать то, что будет показанно в этом пользовательском поле по заанному условию, а там мы будем показывать сам долг, поэтому в окне выбора выбираем "Поле компоновки данных", а далее сумму долга. Всё тоже самое проделываем и со вторым пользовательским полем "ДолгКонтрагента", только там условие отбора больше нуля.Вот так выглядит настройка пользовательских полей. Но мы не будем так делать, мы сразу в запросе выберем поля с соответстующими значениями.</p>
    <p><span class="vue-b">Раз тут начал про пользовательские поля, то приведу ещё один пример с их применением, с другим отчётом.</span> Предположим мы создали в СКД и вывели отчёт с 3мя полями:</p>
    <img src="../img/1С-1/2023-09-13_13-10-23.png" class="screen-2" alt="">
    <p>Пользователь захотел ещё одно поле, например, с прибылью. Выбираем у отчёта из подменю "Ещё" пункт "Изменить вариант", находим вкладку "Пользовательские поля" и жмём "Добавить" -> "Новое поле выражение...". Откроется окошко вида:</p>
    <img src="../img/1С-1/2023-09-13_13-16-34.png" class="screen-2" alt="">
    <p>В верхнем поле пишем название поля - Прибыль, в среднем выражение для этого поля: Выручка - Себестоимость и нижнем поле пишем выражение для итоговой строки таблицы: СУММА(Выручка) - Сумма(Себестоимость).</p> 
    <img src="../img/1С-1/2023-09-13_13-25-22.png" class="screen-2" alt="">
    <p>После переходим на закладку "Поля" и слева из группы "Пользовательские поля" перетащим поле "Прибыль" вправо, чтобы система отобразила новое поле в отчёте:</p>
    <img src="../img/1С-1/2023-09-13_13-21-03.png" class="screen" alt="">
    <p>В результате получаем:</p>
    <img src="../img/1С-1/2023-09-13_13-26-44.png" class="screen-2" alt="">
    <p><b>Продолжаем дальше тему</b></p>
    <p>В запросе мы берём ту же таблицу с 2мя полями, только для поля "СуммаОстаток" мы применим условие ВЫБОР КОГДА из языка запросов. Вот так будет выглядеть запрос:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ВзаиморасчетыОстатки</span><span class="vue-r">.</span>Контрагент <span class="vue-r">КАК</span> Контрагент<span class="vue-r">,</span>
                <span class="vue-r">ВЫБОР
                    КОГДА</span> <span class="vue-g">ВзаиморасчетыОстатки</span><span class="vue-r">.</span>СуммаОстаток <span class="vue-r">&lt;</span> 0
                        <span class="vue-r">ТОГДА</span> ВзаиморасчетыОстатки<span class="vue-r">.</span>СуммаОстаток
                <span class="vue-r">КОНЕЦ КАК</span> НашДолг<span class="vue-r">,</span>
                <span class="vue-r">ВЫБОР
                    КОГДА</span> <span class="vue-g">ВзаиморасчетыОстатки</span><span class="vue-r">.</span>СуммаОстаток <span class="vue-r">></span> 0
                        <span class="vue-r">ТОГДА</span> ВзаиморасчетыОстатки<span class="vue-r">.</span>СуммаОстаток
                <span class="vue-r">КОНЕЦ КАК</span> ДолгКонтрагента
            <span class="vue-r">ИЗ</span>
                РегистрНакопления<span class="vue-r">.</span>Взаиморасчеты<span class="vue-r">.</span>Остатки <span class="vue-r">КАК</span> <span class="vue-g">ВзаиморасчетыОстатки</span></span>
        </pre>
    </div>
    <p>По этому запросу составляем в СКД несложный отчёт и результат будет таким:</p>
    <img src="../img/1С-1/2023-06-19_15-44-57.png" class="screen" alt="">
    <p>Теперь усложним отчёт, нужно показать контрагентов с географической привязкой. Поставщики из Москвы в одной группе, поставщики из Самары в другой группе. Для этого используются Планы видов характеристик.</p>

    <p class="title-size16"><b id="reg-copy-9">Отличие оборотного регистра накопления от остаточного</b>.</p>
    <p>Всё это взято из видео Чистова - https://www.youtube.com/watch?v=t0DfNs8JK6s&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=44.  СпецКурс 014</p>
    <p>Здесь постараюсь описать отличия регистра накопления в режиме "остатки" от регистра накопления в режиме "обороты".</p>
    <p><b>В режиме "остатки"</b></p>
    <p>В этом режиме регистр имеет 3 виртуальные таблицы: Обороты, Остатки и ОборотыИОстатки. Дополнительно будет создана таблица с итогами, которая будет хранить остатки по ресурсам. По умолчанию в итогах хранятся подсчитанные остатки на начало каждого месяца. Как я понял эту дату можно сместить на любое число месяца. Сделать это можно в пользовательском режиме в стандартной обработке "Управление итогами".</p>
    <p>Итоговой таблицы для виртуальной таблицы с оборотами нет у регистра в этом режиме. Поэтому если мы в запросе обращаемся к каким то ресурсным полям из этой виртуальной таблицы, то при подсчёте ресурса система начнёт подсчёт с самого начала движений до указанной даты(или до конца если дата не указана) по настоящей таблице регистра. Т.е. это будет занимать какое то время. А вот для виртуальной таблицы "Остатки" есть итоговая таблица и получение данных из неё будет намного быстрее.</p>
    <p>Поэтому если нужно частое обращение к полям виртуальной таблицы с оборотами, то стоит рассмотреть создание другого регистра, но уже в режиме обротов. Чтобы запросы выполнялись быстрее.</p>
    <p>Для регистра с режимом "остатки" остатки хранятся в итоговой таблице на начало и конец месяца.</p>
    <p><b>В режиме "обороты". Свойство "Использование в итогах", "Агрегаты"</b></p>
    <p>В этом режиме есть только одна виртуальная таблица - "Обороты". Для этой таблицы теперь есть итоговая таблица с промежуточными подсчитанными ресурсами.</p>
    <p>Когда мы создали такой регистр в режиме оборотов, то при добавлении измерения в его свойствах есть такое свойство как "Использовать в итогах".</p> 
    <img src="../img/1С-1/2023-09-16_18-30-44.png" class="screen" alt="">
    <p>О чём это свойство? Допустим мы продали несколько товаров разным контрагентам и итоговая таблица для оборотного регистра выглядит так, кстати в отличии от итоговой таблицы остатков, здесь итоговая таблица содержит подсчёты за месяц, а остатки на начало месяца или на конец:</p>
    <img src="../img/1С-1/2023-09-16_10-42-22.png" class="screen" alt="">
    <p>Для каждого измерения(Товар и Контрагент) стоит галочка у этого свойства, это значит что нужно отображать и учитывать данные измерения в итоговой таблице. Но если мы уберём например галочку у измерения Контрагент, то таблица схлопнется по товарам и поле Контрагент не будет отображаться, таблица станет такой:</p>
    <img src="../img/1С-1/2023-09-16_10-50-04.png" class="screen" alt="">
    <p>Таким образом у нас уменьшится таблица итогов, что скажется хорошо на объёме занимаемой информации. Но тогда, когда мы захотим в отчёте получить данные и по контрагенту в том числе, то системе придётся пробежать по всем движениям регистра и пересчитать все ресурсы для поля Контрагент. Вот если мы будет получать ресурсы по товару, система возмёт из итоговой таблицы подсчитанные данные за прошлый месяц и добьёт подсчёт до нужно числа по движениям регистра, а если добавить в запрос ещё и контрагента, то итоговая таблица не поможет и придётся считать по всем движениям заново.</p>
    <p>Так что трогая эту галочку нужно хорошо понимать как будут использоваться измерения в регистре, будут по ним запросы или нет. По умолчанию галочка стоит, разработчики как бы намекают, что так лучше.</p>
    <p><i style="text-decoration: underline;">Агрегаты</i></p>
    <p>В окне редактора регистра накопления в режиме обороты на закладке "Данные" внизу есть кнопка "Агрегаты". Агрегаты позволяют самому построить итоговую таблицу и указать за какой период будут накапливаться ресурсы и какие измерения мне нужны. Вот на этой картинке с помощью механизма агрегатов создано 2 итоговые таблицы:</p>
    <img src="../img/1С-1/2023-09-17_08-41-45.png" class="screen" alt="">
    <p>В первой итоговой таблице будет одно измерение "Контрагент" и все ресурсы. В поле "Периодичность" установили значение "Непериодический", это значит, что ресурсы для этого измерения будут накапливаться за всё время. Мы можем получить ресурс для контрагента из этой таблицы для указания скидки этому контрагенту. Нам не нужна информация на сколько купил этот контрагент за недулю или за месяц или за год, нам нужно знать сколько он купил за всё время.</p>
    <p>Во второй итоговой таблице будут накапливаться ресурсы для товара за квартал.</p>
    <p>Вообще как говрит Чистов нужно сделать в начале использования нашей конфигурации 4 таблицы, которые будут отражает все возможные способыведения статистики по этим измерениям, вот так:</p>
    <img src="../img/1С-1/2023-09-17_08-54-51.png" class="screen" alt="">
    <p>Система сама по собранной статистике решит будут ли накапливаться ресурсы по этим таблицам и когда. Остальное нужно смотреть по видео. Тема не простая. Агрегаты нужно использовать при больших нагрузках на оборотные показатели. До конца Тему не понял.</p>

    <p class="title-size16"><b id="reg-copy-10">Отличие оборотного регистра накопления от остаточного в выборе измерений</b>.</p>
    <p>Регистры накопления могут быть регистрами остатков и регистрами оборотов.</p>
    <p>При создании оборотного регистра накопления нет особой сложности в определении того, какие именно данные должны являться измерениями регистра – мы можем назначить в качестве его измерений любые нужные нам данные</p>
    <p>Совсем иная ситуация в случае регистра накопления, поддерживающего накопление остатков. Для него выбор измерений должен выполняться исходя из того, что движения регистра могут быть осуществлены в две стороны: приход и расход. Таким образом, в качестве измерений нужно выбирать те данные, по которым движения точно будут осуществляться как в одну, так и в другую сторону.</p>
    <p>Например, если ведётся учет материалов в разрезах номенклатуры и склада, очевидно, что и номенклатура, и склад могут быть измерениями, поскольку как приход, так и расход материалов всегда будут осуществляться с указанием конкретной номенклатуры и конкретного склада. Если же в этой ситуации появляется желание отразить учет материалов еще и в разрезе поставщика, то здесь уже нужно исходить из конкретной схемы учета, принятой на предприятии.</p>
    <p>Скорее всего, при поступлении материалов поставщик будет указан, а вот при расходовании материалов с большой долей вероятности поставщик указываться не будет. В большинстве случаев это совершенно лишняя информация. Значит, поставщика следует добавить не как измерение, а как реквизит регистра накопления.</p>
    <p>Если же при расходе материалов поставщик будет указываться наверняка, имеет смысл добавить поставщика в измерения регистра.</p>
    <p>Иными словами, по каждому из измерений регистра накопления остатков ресурсы обязательно должны изменяться в обе стороны: приход и расход. Не должно существовать таких измерений, по которым осуществляется только приход или только расход.</p>
    <p><span class="vue-r">Нарушение этого принципа построения регистров накопления будет вести к непроизводительному использованию ресурсов системы и как следствие к замедлению работы и падению производительности.</span></p>
    <p>Для реквизитов же регистра этот принцип не важен. По реквизитам регистра ресурсы могут только приходоваться или только расходоваться. </p>

    <p class="title-size16"><b id="reg-copy-11">Свойство "Разрешить разделение итогов" регистра накопления на вклвдке "Прочее"</b>.</p>
    <p>Допустим 2 пользователя одновременно пытаются провести документ "ПриходнаяНакладная" и записать в БД покупку товара Ложка. В базе существует таблица итогов, которая сразу подсчитывает количество товаров. При проведении документа товар записывается в эту таблицу и подсчитывается количество. При проведении записи блокируются, в которые пишет документ. Первый пользователь проводит документ и запись заблокировалась, но при проведении документа вторым пользователем, система увидит, что запись с таким товаром заблокирована, она просто допишет рядом такой же товар с количеством. Такое возможно при установленной галочке "Разрешить разделение итогов", по умолчанию она стоит.</p>
    <p>Таких записей с одинаковым товаром может собраться не мало в таблице итогов, если много пользователей одновременно пишут один и тот же товар, но потом система сама улучшит эту таблицу и уберёт повторы, а количество подсчитает.</p>
    <p>Так что если убрать эту галочку, то пользователи будут стоять в транзакционной очереди на запись. Включить или выключить разделение итогов можно и в пользовательском режиме в стандартной обработке "Управление итогами".</p>
    <p>Но если в обработке проведения "РасходнойНакладной" мы использовали строку кода <b>Движения.ОстаткиТоваров.БлокироватьДляИзменения = Истина;</b>, то эта строка запрещает разделение итогов.</p>

    <p class="title-size16"><b id="reg-copy-12">Итоговая таблица остатков и оборотов</b>.</p>
    <p>Вот в этом видео в начале Чистов рассказывает подробно про итоговую таблицу остатков - https://www.youtube.com/watch?v=r_XX10f5nQ0&list=PLkdnTy1CsgR1phYcN8Ts1HD2AugrAVgRd&index=50.  СпецКурс 007</p>
    <p>Вот тут тоже статья про итоговые таблицы остатков и оборотов - https://ausevich.ru/ekspert/chto-takoe-itogi-registrov-nakopleniya/</p>


















    <h2 class="header-style">Отдельно об регистре сведений</h2>

    <p class="title-size16"><b id="reg-info-theory">Теория</b></p>

    <p class="title-size16"><b id="reg-info-example">Примеры использования регистра сведений</b></p>
    <p>Примеры использования этого регистра:</p>
    <ul class="list">
        <li>Для хранения истории цен на товары</li>
        <li>Можно хранить состояния заказа: выполнен, заторможен, в работе и т.д. И последнее значение будет актуальное состояние заказа</li>
        <li>Можно хранить цвета покраски машины, и последнее значение будет цвет, в который сейчас покрашена машина</li>
        <li>Хранение сведений о сотрудниках</li>
    </ul>
    <p>Мне казалось, что для хранения, например, цвета машин или состояния заказов может подойти и объект Перечисление. Выбрали в поле нужное значние, записали в базу и потом получили это значение, но есть один минус, мы не можем записать новое значение, ведь у пользователя нет возможности задать новое значение в перечисление, он может пользоваться только тем, что там заранее задал разработчик. А вот в регистр сведений можно добавлять новые цвета машин и состояния заказов.</p>

    <p class="title-size16"><b id="reg-info-1">Что такое регистр сведений. Галочка "Основной отбор по периоду" и "Основной отбор"</b>.</p>
    <p>Объект конфигурации Регистр cведений предназначен для описания структуры хранения данных в разрезе нескольких измерений. На основе объекта конфигурации Регистр сведений платформа создает в базе данных таблицу, в которой может храниться произвольная информация, «привязанная» к набору измерений.</p>
    <img src="../img/1С-1/2022-12-06_08-23-15.png" class="screen" alt="">
    <p>Принципиальное отличие регистра сведений от регистра накопления заключается в том, что каждое движение регистра сведений устанавливает новое значение ресурса, в то время как движение регистра накопления изменяет существующее значение ресурса. По этой причине регистр сведений может хранить любые данные (а не только числовые, как регистр накопления).</p>
    <p>Следующей важной особенностью регистра сведений является его способность (при необходимости) хранить данные с привязкой ко времени. Благодаря этому регистр сведений может хранить не только актуальные значения данных, но и историю их изменения во времени. Регистр сведений, использующий привязку ко времени, называют <i style="text-decoration:underline">периодическим регистром сведений</i>.</p>
    <p>Периодичность регистра сведений можно определить одним из следующих значений:</p>
    <ul class="list">
        <li>в пределах секунды;(в на какую дату и время создали цену, такая дата с временем и будет стоять, не сбрасываясь никуда)</li>
        <li>в пределах дня;(вводим дату и время и она сбрасывается на начало заданного дня)</li>
        <li>в пределах месяца;(сбрасывается на начало заданного месяца)</li>
        <li>в пределах квартала;(сбрасывается на начало квартала заданной даты, например добавил цену 04.03.2022, а сбросится до 01.01.2022)</li>
        <li>в пределах года;(ну тут будет сбрасываться всё на 1 января)</li>
        <li>в пределах регистратора (если установлен режим записи Подчинение регистратору).</li>
    </ul>
    <p>Периодический регистр сведений всегда содержит служебное поле Период, добавляемое системой автоматически. Оно имеет тип Дата и служит для указания факта принадлежности записи к какому-либо периоду. При записи данных в регистр платформа всегда приводит значение этого поля к началу того периода, в который он попадает. Например, если в регистр сведений с периодичностью в пределах месяца записать данные, в которых период указан как 08.04.2022, то регистр сохранит эти данные со значением периода, равным 01.04.2022.</p>
    <p>Как и для других регистров, система контролирует уникальность записей для регистра сведений. Однако если для прочих регистров уникальным идентификатором записи является регистратор и номер строки, то для регистра сведений применяется другой принцип формирования ключевого значения.</p>
    <p><i style="text-decoration:underline">Ключом записи</i>, однозначно идентифицирующим запись, является в данном случае совокупность значений измерений регистра и периода (в случае, если регистр сведений периодический). Например, для периодического регистра сведений с измерением Товар и ресурсом Цена ключом записи будет набор значений полей Период и Товар. Регистр сведений не может содержать несколько записей с одинаковыми ключами.</p>
    <p>Если продолжать сравнение с регистром накопления, то можно сказать, что регистр сведений предоставляет больше свободы в редактировании хранимых данных. Наряду с возможностью использования в режиме подчинения регистратору (когда записи регистра сведений «привязаны» к документу-регистратору) регистр сведений может применяться и в независимом режиме, в котором пользователю предоставляется полная свобода интерактивной работы с данными регистра. Регистр сведений, не использующий подчинение регистратору, называют <i style="text-decoration:underline">независимым регистром сведений</i>.</p>

    <p class="title-size16"><b id="reg-info-2">Что такое измерение и ресурс</b></p>
    <p>Я взял этот кусочек объяснения из книги Радченко. Он мне показался самым лучшим объяснением. Как пример, будет прикладное решение - Дневник. Мы документом записываем в каждый день недели расписание и оценки и проводим его по регистру сведений Оценки. В этом регистре сведений Предмет(Урок) это измерение, а Оценка - ресурс.</p>
    <p>Попробуем сформулировать: зачем мы создавали регистр Оценки? Чтобы, например, узнать оценки по математике. Теперь слово "оценки" замените на "ресурс", а слово "математика" замените на "измерение". И вам всё сразу станет понятно.</p>
    <img src="../img/1С-1/2023-05-02_20-49-39.png" alt="">
    <p><i style="text-decoration:underline">Измерения</i> это уточняющая информация, которую вы передадите регистру, когда будете его о чём-то спрашивать. А <i style="text-decoration:underline">ресурсы</i> это то, что регистр вам ответит. То, что выхотите узнать в результате своего вопроса.</p> 
    <p>Вы хотите знать оценки, поэтому создали ресурс Оценка. Если бы кроме этого выхотели знать продолжительность ответов на вопрос учителя, вы бы создали ещё один реквизит "ПродолжительностьОтвета". И тогда ваш вопрос звучал бы так: "Какие оценки и сколько времени я потратил на ответы по математике?"</p>
    <p>Вы хотите знать оценки по каждому предмету. Поэтому вы создали измерение Предмет. Если бы вы хотели кроме этого знать, за устный ответ получена оценка или за письменную работу, вы бы создали ещё одно измерение "ВидОтвета". И тогда ваш вопрос звучал бы так: "Какие оценки у меня за устные ответы по математике?"</p>

    <p class="title-size16"><b id="reg-info-3">Рассмотрим переодический регистр сведений</b>.</p>
    <p>Предположим наше предприятие оказывает услуги. У нас имеется справочник Номенклатура, в котором описаны товары и услуги. У наших услуг должны быть цены. Казалось бы логично разместить цены как реквизит "Цена" у каждой услуги в справочнике, однако стоимость услуг имеет особенность меняться со временем. И может сложиться такая ситуация, когда нам потребуется внести изменения или уточнения в один из ранее проведенных документов Оказание услуги. В этом случае мы не сможем получить правильную стоимость услуги, поскольку в реквизите "Цена" справочника будет храниться последнее введенное значение. Что это значит? Приведу пример. Вот завели мы в спрвочнике Номенклатура реквизит Цена и указали стоимость для услуги Диагностика - 5000 руб. Затем мы создали документ Оказание услуги и начали заполнять его. Указали в документе сотрудника(Иванов), который выполнял диагностику, указали цену из справочника - 5000, провели документ. Проходит время, у нас на предприятии поменялась цена на диагностику и теперь услуга стоит 6000 руб. Мы идём в справочник "Номенклатура" и меняем в реквизите "Цена" на услугу Диагностика стоимость с 5000 на 6000. Опять проходит время и мы вдруг понимаем, что когда то мы проводили документ, где Иванов оказал услугу Диагностика, а на самом деле услугу как оказалось выполнил Петров и мы идём в документ и меняем Иванова на Петрова. Нам снова нужно провести документ, но при заполнении документа автоматически возьмётся последняя цена из справочника - 6000 руб. Но нам так нельзя, нам нужна та старая цена в 5000 руб., а её уже не существует ни в каких БД и хранилищах. Вот для этих случаев цены и заполняются в периодических регистрах сведений, которые могут хранить цены на одну и ту же услугу во времени.</p>
    <p>Также предприятие вдруг захочет видеть зависимость прибыли от изменения стоимость услуг, то тогда спрвочники опять же не помогут, а помогут регистры сведений, которые позволяют анализировать изменение стоимости услуг во времени. И тогда просто необходимо будет иметь возможность анализировать изменение стоимости услуг во времени.</p>

    <p class="title-size16"><b id="reg-info-4">Добавление переодического регистра сведений. Свойство "Ведущее". Свойство "Основной отбор по периоду" и "Основной отбор"</b>.</p>
    <p>Приступим к созданию периодического регистра сведений, который будет хранить развернутые во времени розничные цены материалов и стоимости услуг, оказываемых нашим предприятием.</p>
    <p>Добавим в конфигураторе новый регистр сведений с именем Цены, установим преодичность - В пределах секунды. Такую периодичность мы выбрали для того, чтобы иметь возможность отслеживать цены несколько раз в течение дня. Если же так часто не предполагается изменять цены, то можно выбрать в пределах дня.</p>
    <p>Обратим внимание на свойство Режим записи. По умолчанию оно имеет значение – Независимый, то есть мы создаем независимый регистр сведений и сможем в дальнейшем вводить в него данные без использования регистратора, вручную.</p>
    <p>Далее перейдём на закладку Данные и создадим измерение Номенклатура с типом СправочникСсылка.Номенклатура. В свойствах этого измерения укажем, что оно будет Ведущим, поставив галочку. Свойство <b>Ведущее</b> имеет смысл использовать лишь тогда, когда измерение имеет тип ссылки на объект базы данных. Установка свойства Ведущее будет говорить о том, что запись регистра сведений представляет интерес, пока существует тот объект, ссылка на который выбрана в качестве значения этого измерения в этой записи. При удалении объекта все записи регистра сведений по этому объекту тоже будут автоматически удалены. Проще говоря, если мы из справочника удалим услугу или товар, то и в регистре удалятся записи связанные с этой услугой и товаром, конечно если такая связь существует с помощью свойства Ведущий.</p>
    <p>А если свойство "Ведущий" не установить, то при попытке удаления объекта из справочника, например, товара, ссылка на который есть в регистре, нам не удастья удалить этот товар из справочника, пока мы не почистим записи в регистре.</p>
    <p>Также в результате того, что это измерение регистра мы сделали ведущим, в форме элемента справочника Номенклатура, в панели навигации в группе Перейти появится ссылка. По ней возможен переход к записям этого регистра, которые содержат в измерении Номенклатура ссылку на этот элемент справочника.</p>
    <p>Затем создадим ресурс Цена, тип Число, длина 15, точность 2, неотрицательное.</p>
    <p>Если зайти в пользовательский режим, то увидим команду вызова регистра сведений Цены в тех разделах, куда мы их поместили. В отличии от регистра накопления система по умолчанию не прячет этот регистр от глаз пользователя, потому что он независимый и может пользователем напрямую заполняться.</p>
    <p>В консрукторе объекта регистра сведений ниже полей "Периодичность" и "Режим записей" есть галочка <b>"Основной отбор по периоду"</b>, она установлена по умолчанию. Этот пункт говорит о том, что поле "Период" будет индексироваться, а значит и поиск по этому полю регистра будет быстрее, но и запись будет происходить дольше в базу.</p>
    <p>Также при создании измерения, для каждого из них можно убрать или поставить галочку <b>"Основной отбор"</b>. Это тоже самое, что и для периода, измерения будут индексироваться. По умолчанию галочка стоит. Как более подробнее узнаю про индексацию допишу.</p>

    <p class="title-size16"><b id="reg-info-5">Создание записей в регистре сведений</b>.</p>
    <p>В пользовательском режиме выберем наш регистр сведений и надмём команду Создать. Какой укажем период? Если у нас уже есть проведённые раньше документы по оказанию услуг, то надо задать дату задним числом,т.е. чтобы она была меньше(раньше) или равна дате документа.</p>
    <img src="../img/1С-1/2022-12-06_09-12-23.png" alt="">
    <p>Итак, мы с вами имеем очень полезную возможность в нашей программе – установка цен на услуги и материалы. Поскольку цены хранятся с привязкой к дате, мы можем заранее установить новые цены и быть уверены в том, что новые цены вступят в действие не раньше указанного для них времени. Например, создам новую запись для услуги Диагностика с новой ценой 300 руб. Укажу дату 4 января 2023 года, так как у меня стоит в пределах месяца, то дата сбросится на 01.01.2023. И теперь когда услуга Диагностика будет выполнена в январе, то уже возьмётся стоимость этой услуге равной 300 р.</p>

    <p class="title-size16"><b id="reg-info-6">Автоматическая подстановка цены в документ при выборе номенклатуры. Используется объектная модель запроса</b>.</p>
    <p>Наша задача заключается в следующем. Цена номенклатуры у нас теперь хранится в отдельном регистре сведений. Когда мы создаём или изменяем документ ОказаниеУслуги и добавляем в табличную часть какую-либо номенклатуру, нам хочется, чтобы одновременно с этим в документ подставлялась бы сразу и актуальная цена этой номенклатуры, полученная из регистра сведений и соответствующая дате документа. Для этого сделаем 2 вещи.</p> 
    <p>Сначала напишем некую функцию, которая будет возвращать нам актуальную цену номенклатуры, а затем вызовем эту функцию в тот миг, когда в документ добавляется номенклатура, и подставляется в поле табличной части цена номенклатуры, которую вернет эта функция.</p> 
    <p>Поскольку такой код понадобится нам, скорее всего, не только в этом, но и в других документах, которые содержат в табличной части номенклатуру, мы поместим функцию в некоторое общедоступное место – в общий модуль.</p>
    <p>Создадим Общий модуль "РаботаСоСправочниками" и в нём создадим функцию ПолучитьРозничнуюЦену. В палитре свойств этого модуля мы видим, что стоит по умолчанию галочка <i style="text-decoration:underline">Сервер</i>, это значит что объекты данного модуля будут собраны и выполнены на стороне сервера. <b>(ВАЖНО)</b> Кроме этого, установим флажок <i style="text-decoration:underline">Вызов сервера</i> для того, чтобы экспортные процедуры и функции этого модуля можно было вызывать с клиента.</p>
    <img src="../img/1С-1/2022-12-06_10-04-16.png" alt="">
    <p>Вот такой код будет в функции ПолучитьРозничнуюЦену() общего модуля "РаботаСоСправочниками":</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Функция</span> ПолучитьРозничнуюЦену<span class="vue-r">(</span>УказаннаяДата<span class="vue-r">,</span> Номенклатура<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//создаём структуру Отбор, где укажем измерения, по которым хотим отобрать цены</span>
                Отбор <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"Номенклатура"</span><span class="vue-r">,</span> Номенклатура<span class="vue-r">);</span>

                <span class="vue-g">//Получаем значение ресурса регистра.</span>
                <span class="vue-g">//Регистр всегда по запросу возвращает значения ресурсов, не измерений</span>
                <span class="vue-g">//Также есть метод Получить(УказаннаяДата, Отбор). В чём разница? Допустим в регистре есть запись</span>
                <span class="vue-g">//на дату 01.12.2022, а мы указываем Получить('03.12.2022', Отбор), нам вернётся структура с пустыми значениями, потому что конкретно на эту дату нет ничего</span>
                <span class="vue-g">//а метод ПолучитьПоследнее('03.12.2022', Отбор) вернёт последнее значение цены, которое там есть рядом до этой даты</span>
                <span class="vue-g">//в ЗначениеРесурсов вернётся структура. В ключе - имя ресурса, в значении значение ресурса</span>
                ЗначенияРесурсов <span class="vue-r">=</span> РегистрыСведений<span class="vue-r">.</span>Цены<span class="vue-r">.</span>ПолучитьПоследнее<span class="vue-r">(</span>УказаннаяДата<span class="vue-r">,</span> Отбор<span class="vue-r">);</span>

                <span class="vue-r">Возврат</span> ЗначенияРесурсов<span class="vue-r">.</span>Цена<span class="vue-r">;
            КонецФункции</span></span>
        </pre>
    </div>
    <p>Для получения розничной цены мы будем передавать в функцию два параметра:</p>
    <ul class="list">
        <li>УказаннаяДата - параметр типа Дата, определяет точку на оси времени, в которой нас интересует значение розничной цены;</li>
        <li>Номенклатура - ссылка на элемент справочника Номенклатура, для которого мы хотим получить розничную цену.</li>
    </ul>
    <p>В теле функции мы сначала создаем вспомогательный объект Отбор. Это структура, содержащая отбор по измерениям регистра. С его помощью определяем, что нас будут интересовать записи регистра, в которых измерение регистра "Номенклатура" равно переданной в функцию ссылке на элемент справочника.</p>
    <p>Имя ключа структуры («Номенклатура») должно совпадать с именем измерения регистра, заданного в конфигураторе, а значение элемента структуры (Номенклатура) задает отбираемое по данному измерению значение. Во второй строке мы обращаемся к менеджеру регистра сведений Цены (РегистрыСведений.Цены) и выполняем метод ПолучитьПоследнее(), который возвращает нам значения ресурсов самой поздней записи регистра, соответствующей передаваемой в функцию дате (УказаннаяДата) и значениям измерений регистра (Отбор).</p>
    <p>Метод ПолучитьПоследнее() возвращает структуру, содержащую значения ресурсов, которая сохраняется в переменной ЗначенияРесурсов. Вообще говоря, у регистра может быть несколько ресурсов. В нашем регистре ресурс один, но все равно будет возвращена структура, содержащая единственный элемент. Поэтому в следующей строке мы получаем искомую нами розничную цену, просто указав имя нужного нам ресурса регистра через точку (ЗначенияРесурсов.Цена), и возвращаем ее при выполнении функции.</p>
    <p>Теперь эту функцию нужно вызвать в некоторый момент работы документа.</p>
    <p>Откроем форму документа ОказаниеУслуги и для поля Номенклатура табличной части ПереченьНоменклатуры задаим обработчик для события ПриИзменении на клиенте. В модуле формы появится процедура, внесём в неё такой код:</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ОказаниеУслуг"
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ПереченьНоменклатурыНоменклатураПриИзменении<span class="vue-r">(</span>Элемент<span class="vue-r">)</span>
                <span class="vue-g">// Получить текущую строку табличной части.</span>
                СтрокаТабличнойЧасти <span class="vue-r">=</span> Элементы<span class="vue-r">.</span>ПереченьНоменклатуры<span class="vue-r">.</span>ТекущиеДанные<span class="vue-r">;</span>
                СтрокаТабличнойЧасти<span class="vue-r">.</span>Цена <span class="vue-r">=</span>  РаботаСоСправочниками<span class="vue-r">.</span>ПолучитьРозничнуюЦену<span class="vue-r">(</span>Объект<span class="vue-r">.</span>Дата<span class="vue-r">,</span> СтрокаТабличнойЧасти<span class="vue-r">.</span>Номенклатура<span class="vue-r">);</span>

                <span class="vue-g">//Пересчитаем сумму строки табличной части</span>
                РаботаСДокументами<span class="vue-r">.</span>РассчитатьСумму<span class="vue-r">(</span>СтрокаТабличнойЧасти<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>


    <p class="title-size16"><b id="reg-info-7">Запись в регистр сведений из документа числовых значений</b></p>
    <p>Создадим регистр сведений "ЦеныПоставщиков", укажем переиодичность "в течении секунды" и укажем регистратором документ "ПоступлениеТоваров". Затем в документе во вкладке Движения через констркутор напишем код движений.</p>
    <div class="code-style">
        <pre>
            Процедура ОбработкаПроведения(Отказ, Режим)
            <span class="vue-b"><span class="vue-g">// регистр ЦеныПоставщиков 
            //Свойство Записывать указывает записать новую запись в инфобазу или нет</span>
            Движения.ЦеныПоставщиков.Записывать = Истина;
            Для Каждого ТекСтрокаТовары Из Товары Цикл
                <span class="vue-g">//Движения это коллекция наборов записей регистров
                //ЦеныПоставщиков это набор записей регистра с данным именем
                //Метод Добавить() добавляет в набор записей новую запись и возвращает ссылку на неё
                //Ну а далее мы заполняем эту новую запись Движение значениями</span>
                Движение = Движения.ЦеныПоставщиков.Добавить();
                Движение.Период = Дата;
                Движение.Номенклатура = ТекСтрокаТовары.Товар;
                Движение.Контрагент = Контрагент;
                Движение.Цена = ТекСтрокаТовары.Цена;
            КонецЦикла;
        КонецПроцедуры</span>
        </pre>
    </div>

    <p class="title-size16"><b id="reg-info-8">Запись в регистр сведений из документа не числовых значений</b></p>
    <p>Бывает когда переодические регистры используют не только для установления новых ЧИСЛОВЫХ значений во времени, но и других значений. Как пример, у нас есть сотрудники в справочнике Сотрудники и есть справочник Подразделения. Мы могли бы установить в Сотрудники реквизит Подразделения и указывать для каждого сотрудника где он работает, но сотрудники могут перемещаться внутри производства по разным подразделениям и тогда в справочнике мы сможем отследить только последние нахождение сотрудника в подразделении и будем лишены возможности проследить в каких подразделениях он работал в течении, например, месяца, что повлияет на зарплату и драугие отчёты. Поэтому нам нужна возможность отследить его перемещения во времени по подразделениям. Для этого можно завести новый регистр сведений и в Измерение добавить Сотрудник, а в ресурс добавить Подразделение и можно ещё в ресурс добавить Оклад. Также заводится документ, например, КадровыйПриказ, который записывает перемещение сотрудника и делает записи в регистре сведений. Добавим этому документу рекизиты - Сотрудник, Подразделение, Оклад, и ДатуПриёма(дата когда сотрудник перевёлся в новое подразделение). Чтобы делать записи в регистр сведений, в этом регистре нужно выбрать режим записи "подчинение регистратору" на вкладке Основные. Режим записи "независимый" позволяет пользователю открыть регистр и заполнять его от руки.</p>
    <p>Далее либо через конструктор , либо сам надо добавить код движения в модуле объекта документа. Там будет запись одного движения(записи). В пользовательской части мы теперь не увидим регистр, потому что режим "подчинение регистратору" скрыл его. Чтобы увидеть регистр откроем в подсистемах ту подсистуму, куда я установил регистр и правой кнопкой по полсистеме и выбираем "открыть командный интерфейс". В окне поставим галочку видимости нашего регистра.</p>
    <p>В регистре появились новые 2 поля - "Регистратор" и "Номер строки". Пока всё.</p>

    <p class="title-size16"><b id="reg-info-9">Запись или добавление в регистр сведений записей программно из обработки</b></p>
    <p>Допустим у нас есть Справочник Валюты, где перечисляются названия заграничных денег. И есть регистр сведений, где мы храним курсы и кратности этих денег во времени(переодический). Нам нужно как то читать и писать в этот регистр.Мы можем писать в него из пользовательской части, можем писать с помощью документа, а бывает нужно писать в него программно, например, из обработки, чтобы загрузить из инета курсы валют и записать в регистр. Создадим обработку, добавим в неё кнопку и по кнопке будем писать в регистр. Код находится в модуле формы обработки.</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//эти 2 процедуры обработчики кнопки ЗаписатьКурс</span>
            <span class="vue-b">&НаКлиенте
            Процедура ЗаписатьКурс(Команда)
                ЗаписатьКурсНаСервере();
            КонецПроцедуры

            &НаСервере
            Процедура ЗаписатьКурсНаСервере()
                <span class="vue-g">//НаборЗаписей теперь содержит некую коллекцию, которая содержит описание каждой записи регистра</span>
                НаборЗаписей = РегистрыСведений.КурсыВалют.СоздатьНаборЗаписей();

                <span class="vue-g">//метод Добавить() создаёт запись в этом наборе и возвращает ссылку на эту запись</span>
                Запись = НаборЗаписей.Добавить();

                <span class="vue-g">//заполняем запись</span>
                Запись.Период = Период;
                Запись.Валюта = Валюта;	
                Запись.Курс = Курс;
                Запись.Кратность = Кратность;

                <span class="vue-g">//даём команду записать запись в БД. У метода Записать() по умолчанию стоит</span>
                <span class="vue-g">//булево значение Истина(Замещать), т.е. при добавлении записи мы замещаем предыдущую запись</span>
                <span class="vue-g">//а нам надо добавлять, поэтому ставим Ложь</span>
                НаборЗаписей.Записать(Ложь);
            КонецПроцедуры</span>
        </pre>
    </div>

    <p class="title-size16"><b id="reg-info-10">Читаем данные из регистра сведений с помощью табличной модели(пишем запрос)</b></p>
    <p>Выше я уже описывал как читать данные из регистра через объектную модель, теперь тут опишу как с помощью запросов получить данные. Вот такой код всё для тех же курсов валют:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">&НаКлиенте
            Процедура ПолучитьКурсЗапросом(Команда)
                ПолучитьКурсЗапросомНаСервере();
            КонецПроцедуры


            &НаСервере
            Процедура ПолучитьКурсЗапросомНаСервере()
                Запрос = Новый Запрос;
                Запрос.Текст = 
                    "ВЫБРАТЬ
                    |	КурсыВалютСрезПоследних.Курс КАК Курс,
                    |	КурсыВалютСрезПоследних.Кратность КАК Кратность
                    |ИЗ
                    |	РегистрСведений.КурсыВалют.СрезПоследних(&Период, Валюта = &Валюта) КАК КурсыВалютСрезПоследних";
                
                Запрос.УстановитьПараметр("Валюта", Валюта);
                Запрос.УстановитьПараметр("Период", Период);
                РезультатЗапроса = Запрос.Выполнить();
                ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
                
                ВыборкаДетальныеЗаписи.Следующий();
                Курс = ВыборкаДетальныеЗаписи.Курс;
                Кратность = ВыборкаДетальныеЗаписи.Кратность;
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Для регистра сведений в БД вычисляются ещё 2 виртуальные таблицы: а)СрезПервых, б)СрезПоследних. Эти таблицы соответствуют методам объектной модели ПолучитьПервое() и ПолучитьПоследнее(). У виртуальных таблиц есть свои параметры и условия, задаются в скобках.</p>

    <p class="title-size16"><b id="reg-info-11">Дополнение от меня.</b></p>
    <p>Как я заметил, уникальность записей в непереодическом регистре сведений основывается только на полях измерения. Например есть 2 измерения: Номенклатура и Контрагент и ресурс Цена. Мы можем задать 2 записи: Холодильник от Поставщика1 и Холодильник от Поставщика2 и всё будет нормально, уникальность записей обеспечивается 2мя полями  - Номенклатура и Контрагент. А вот если взять и перенести Контрагент в ресурс и попробовать снова задать эти 2 записи, то уже не получится, потому что теперь уникальность записей обеспечивает только одно поле измерения Номенклатура. Мы в первой записи зададим Холодильник от Поставщика1, а на второй записи нам скажут, что запись с именем Холодильник уже есть.</p>
    <p>В переодическом регистре сведений такое прокатит(когда контрагента перенесу в ресурс)только если период выбран в "В пределах секунды", потому что тут уже уникальность записи обеспечивается датой(а дата будет каждую секунду разная) и полем измерения. Поэтому наверное измерений должно быть как минимум 2.</p>

    <p class="title-size16"><b id="reg-info-12">Виртуальная таблица РегистраСведений - СрезПервых и СрезПоследних</b>.</p>
    <p>Эта виртуальная таблица(будем брать СрезПоследних, потому что СрезПервых встречается крайне редко) возвращает данные на последнюю дату то, что мы запрашиваем. Таблица умеет принимать свои собственные параметры. <span class="vue-b">У этой вирт. таблицы всего 2 параметра - Период и Условие</span>.</p> 
    <p>Период имеет тип параметра: Дата, МоментВремени, Граница. Указывается дата, момент времени или граница, на которые будут получены сведения. Если параметр не задан, будут выбираться наиболее поздние записи, без ограничения по дате.</p>
    <p>По условию мы ограничиваем отбор записей по аргументу. Оба параметра не обязательны. Желательно для витруальных таблиц параметры задавать именно для них, потому что если параметры задавать через слово ГДЕ, то будет делаться лишняя работа. Сначала вирт. таблица построится, а потом к ней будут применены ограничения отбора и она снова будет перестраиваться. Вот пример такой таблицы.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">ВЫБРАТЬ
                Номенклатура,
                Контрагент,
                Цена,
                Период
            ИЗ
                РегистрСведений.ЦеныПоставщиков.СрезПоследних(
                    &Период,
                    Номенклатура = &Товар
                    //Контрагент = &Поставщик
                )</span>
        </pre>
    </div>

    <p class="title-size16"><b id="reg-info-13">Выводим текущие цены из регистра сведений на начальную страницу</b></p>
    <p>У нас есть регистр сведений "ЦеныПоставщиков" и мы хотим видеть в пользовательской части на начальной странице форму списка из текущих(последних) цен на товары. Вывести на начальную страницу можно только форму, поэтому создаём форму списка у этого регистра. У нас в форме есть оснойвной реквизит Список, который нам доставляет данные из БД. Если посмотреть его свойства в палитре во вкладке "Объект", то увидим такое свойство как <b>"ОсновнаяТаблица"</b>, там стоит значение РегистрСведений.ЦеныПоставщиков, это таблица, записи которой выводит этот список. Можем поменять таблицу вывода на РегистраСведений.ЦеныПоставщиков.СрезПоследних.</p>
    <p>Ну и дальше меню на главном объекте конфигурации и выбираем пункт "Открыть рабочую область начальной страницы" и в открывшемся окне указываем форму списка реигстра сведений "ЦеныПоставщиков".</p>
    <p class="vue-r">Важно! При создании формы списка в регистре нужно убрать галочку, что это основная форма списка, а то при открытии регистра "ЦеныПоставщиков" в другом месте кроме начальной страницы, тоже будет выводить срез последних, а не все записи из этого регистра.</p>
    <p>Там же рядом есть свойство "Произвольный запрос", который позволяет описать запрос по нашему смотрению.</p>

    <p class="title-size16"><b id="reg-info-14">Разница между методами Получить(), ПолучитьПервое() и ПолучитьПоследнее(). Также разница между ПолучитьПоследнее() и виртуальной таблице СрезПоследних</b>.</p>
    <p>Разница в том, что метод Получить() требует параметр Период обязательно и ищет ресурс именно на эту дату и если на эту дату ничего нет, то вернёт структуру с пустыми значениями. А вот метод ПолучитьПоследнее() не требует обязатально параметра Период, но даже если мы передали период и на него ничего нет, то метод всё равно вернёт ресурс на последнюю ближайшую дату, которая была записана до переданной даты. ПолучитьПервое() получает ресурс либо на переданную датуЮ либо на первую после этой даты.</p>
    <img src="../img/1С-1/2023-05-29_22-17-33.png" alt="">
    <img src="../img/1С-1/2023-05-29_22-18-09.png" alt="">
    <img src="../img/1С-1/2023-05-29_22-18-45.png" alt="">
    <p>По методу ПолучитьПоследнее() можно получить только один ресурс в его разрезе, а по виртуальной таблице СрезПоследних можно получить все последние ресурсы в своих разрезах.</p>

    <p class="title-size16"><b id="reg-info-15">Миг связанный с получением цены из регистра сведений при добавлении товара в табличной части документа.</b></p>
    <p>Есть документ "Поступление товара", в документе есть табличная часть, в ней мы при выборе Товара в поле Товар срабатывает наш обработчик, который раньше делал запрос к справочнику Номенклатура и получал цену из поля ЦенаТовара из этого справочника, но теперь есть периодический регистр сведений с ценами и нам надо получать из него цену. Для получения цены нам нужно передать дату документа, но есть одно замечание, когда мы создаём новый документ, то у него в поле Дата установленна текущая дата, а время стоит по нулям, потому что время подставляется в миг записи или проведения документа. Из-за этого когда мы начинаем заполнять товары, а ведь в миг выбора товара(выполняется обработчик) мы же делаем запрос в БД к таблице регистра сведений и нам нужна там дата с временем то мы там передаём дату документа с нулевым временем, что не очень хорошо. Мы можем сделать проверку в обработчике новый мы создали документ или нет. Если документ новый, то мы берём поле Ссылка(она нам на клиенте в обработчике доступна) и вызываем у неё метод Пустая(), если вернул Истина, то документ новый. Если документ новый, то можно передать дату с помощью метода ТекущаяДата() или просто передать вместо даты значение Неопределено. Система если увидить что переиод Неопределено, то она сама вернёт последнюю актуальную цену для товара, т.е. это то же самое, что мы ничего не передаём и система отрабатывает по умолчанию, возвращая последнее значение. Ну а если документ не новый, то передаём дату документа без проблем.</p>

    <p class="title-size16"><b id="reg-info-16">Изменяем данные в независимом переиодическом регистре сведений по отбору по поставщикам(по измерению)</b>.</p>
    <p>Ссылка на статью <a href="https://www.1s-up.ru/primenenie-otbora-v-nabore-zapisej-registra-svedenij/">вот</a>.</p>
    <p>Ссылка на статью <a href="https://www.koderline.ru/expert/programming/article-otbor-zapisey-registra-svedeniy-v-1s/">вот</a>.</p>

    <p class="title-size16"><b id="reg-info-17">Записываем и изменяем данные в периодическом зависимом регистре сведений в обработчике "ПриЗаписи". Что такое Отбор. Отбор по регистратору</b>.</p>
    <p>Тут я опишу, как мы читаем и записываем данные в регистр сведений без помощи платформы 1С. О какой помощи платформы я говорю? Когда мы пишем в регистр сведений в обработчике "ОбработкаПроведения", то там система берёт на себя часть функций. Она например сама определяет кто регистратор и сама записывает его в соответсвующее поле регистра. Мы же будем писать в регистр в другом обработчике события. Сначала немного теории. В конце статьи есть подраздел, в котором описано чем ещё отличаются эти 2 подхода записи в регистр.</p>
    <p>Есть <i>объектные данные</i>(справочники, документы) и <i>необъектные данные</i>(регистры).</p> 
    <p>Объектные данные можно сравнить с гостями, которых мы пригласили на свой день рождения. В этом случае для нас важно, чтобы к нам в гости пришёл именно Серёжа Соколов, который учится и работает вместе с нами. А не какой-то его тёзка и однофамилец. Который, может быть, и одет так же, и внешне на него похож. Каждый из таких гостей уникален и важен сам по себе. Даже если он оделся в другуюодежду и сильно вырос за то время, что вы его не видели. Всё равно он остался СерёжейСоколовым, а не стал кем-то другим. Каждый из таких гостей уникален и важен сам по себе. Даже если он оделся в другую одежду и сильно вырос за то время, что vы его не видели. Всё равно он остался Серёжей Соколовым, а не стал кем-то другим.</p>
    <p>Необъектные данные мы сравним с людьми в автобусе. Нам совершенно не важно, какие именно люди находятся в автобусе, как их зовут. Не важно, кто именно стоит в проходе с большими сумками, Сергей Николаевич или Марья Ивановна. Важно только то, что проход занят и дальше пройти нельзя.</p>
    <p>Как мы работаем с объектными данными? У каждого из них есть ссылка. По этой ссылке мы получаем объект. Изменяем его реквизиты. Записываем его в базу данных. То есть с каждым объектом мы "возимся" индивидуально. Каждому гостю, который пришёл к нам, мы уделяем внимание, называем его по имени, говорим: "Здравствуй, Серёжа Соколов, дорогой! Проходи, садись!".</p>
    <p>А в автобусе мы никого не называем по имени. Если проход занят и нам не хватает места, то мы обращаемся сразу ко всем, кто стоит в проходе: "Граждане, стоящие в проходе, пройдите дальше в салон". То же самое с необъектными данными. Когда нам нужно с ними что-то сделать, мы не работаем с каждой записью отдельно, а берём сразу несколько записей и изменяем их. Вот эти несколько записей называются <i>набор записей</i>. А чтобы платформа знала, какие именно записи нужно взять, у каждого набора записей есть <i>отбор</i>.</p>
    <p>Отбор - это условие, по которому нужно отобрать записи. Например, "граждане, стоящие в проходе" - это отбор. С таким отбором получится один набор записей. Он будет состоять из всех людей, которые стоят в проходе. А "женщины, сидящие на первом сиденье" - это тоже отбор. С таким отбором получится уже другой набор записей. Он будет состоять из двух женщин.</p>
    <p>Во встроенном языке, когда мы хотим ПРОЧИТАТЬ необъектные данные, нужно создать набор записей, установить ему какой-то отбор и прочитать этот набор записей. Платформа заполнит набор записей данными из базы данных.</p>
    <p>Когда мы хотим ЗАПИСАТЬ необъектные данные, тоже нужно создать набор записей и установить ему отбор. После этого заполнить набор теми записями, которые вам нужны,и записать этот набор записей. Платформа поместит ваши данные в базу данных.</p>
    <p>Я это писал из книги Радченко "1С программмирование для начинающих" и поэтому пример тоже будет из этой книги. Пример там дневник школьника. В конфигураторе есть документ "УчебныеДни", этот документ уже пишет в другие регистры инфу через событие "ОбработкаПроведения". Т.е. когда прошёл учебный день, оценки выставлены, мы проводим документ для изменения состояния учёта. Но нам нужно создать регистр сведений "ДомашнееЗадание" и писать в него задания на разные дни. Создаём этот регистр, у него будет одно измерение - "Предмет"(тип СправочникСсылка.Предметы) и 2 ресурса: "ДомашнееЗадание"(тип Строка) и "Выполнено"(тип Булево). Мы хотим знать домашнее задание и выполнено ли оно у такого то предмета. Вспоминаем вот это правило на картинке:</p>
    <img src="../img/1С-1/2023-05-02_20-49-39.png" alt="">
    <p>Ресурс "Выполнено" нам нужно для того, чтобы в будущем состовлять список домашних заданий, которые ещё нужно сделать.</p>
    <p>Отмечаем на закладке Регистраторы документ "УчебныеДни".</p>
    <p><i>Запись в регистр "ДомашниеЗадания"</i></p>
    <p>Теперь интересный вопрос. В какой миг информация должна записываться в этот регистр? До сих пор мы записывали данные в регистр в момент проведения документа. То есть тогда, когда учебный день фактически завершён. Все занятия прошли, все полученные оценки мы занесли в документ. Но домашние задания нужно записывать гораздо раньше, ещё до того, как начался соответствующий им учебный день. Единственный подходящий миг, который есть для этого, это запись документа. То есть мы узнали, что нам задали, занесли эту информацию в нужный учебный день и нажали кнопку "Записать". Вот в этот момент и нужно записать домашние задания в регистр.</p>
    <p>У объекта документа есть два подходящих события: <i>"ПередЗаписью"</i> и <i>"ПриЗаписи"</i>.</p>
    <img src="../img/1С-1/2023-05-04_16-48-20.png" alt="">
    <p>Событие "ПередЗаписью" возникает до того, как данные записываются в базу данных.А событие "ПриЗаписи" возникает уже после того, как данные записаны.</p>
    <p>Записывать домашние задания в регистр нужно уже после того, как записан сам документ. Потому что это дополнительная информация, связанная с этим документом. И она не имеет смысла без самого документа. Это значит, что если вдруг по каким-то причинам не удалось записать документ в базу данных, то и движения в регистрах, связанные с этим документом, тоже не должны быть записаны. Одно без другого не имеет смысла. Поэтому в событиях, которые выполняются до записи документа в базу, нужно подготовить все данные самого документа. А в событиях, которые выполняются после записи документа, нужно подготовить те данные, которые связаны с этим документом и зависят от него, например движения в регистрах.</p>
    <img src="../img/1С-1/2023-05-04_19-28-12.png" class="screen" alt="">
    <p>Если мы откроем описание любого из этих событий в синтакс-помощнике, то увидим, что везде говорится о том, что эти события выполняются в <i>транзакции</i> записи.Транзакция - это способ, которым изменяются данные в базе данных. Этот способ прекрасно известен нам из обычной жизни. Просто мы не знаем, что называется он именно так. Представьте, что база данных это автобус. А семья это данные. Как поступает семья, если ей нужно куда-то доехать на автобусе? Родители обязательно проконтролируют, чтобы дети сели в автобус вместе с ними. Не может такого быть, что родители зашли, а дети замешкались и остались на остановке. Наоборот, также не может быть, что дети сели в автобус, а родителям места не хватило и они остались. Если едут, то все вместе. Если у кого-то не получается, то все не едут и ждут следующего автобуса. Транзакция работает точно так же.</p>
    <p>Во-первых, не может случиться так, что документ не записался в базу данных, а движения записались. Если в процессе записи документа возникла какая-то проблема, то и все последующие события выполнены не будут, а именно события "ПриЗаписи" и "ОбработкаПроведения".</p>
    <p>Во-вторых, не может быть так, что документ записался в базу данных, а движения нет. Если проблема возникла в процессе записи движений (уже после того, как документ записан в БД), то все изменения, которые были сделаны в БД до этого в этой же транзакции (запись документа), будут отменены.</p>
    <p>Другими словами, будет записано либо всё, либо ничего. Выполнение транзакций обеспечивает база данных. Вам как разработчикам не нужно предпринимать никаких специальных действий для того, чтобы при записи данных началась транзакция. Платформа делает это автоматически. Единственное, что вам нужно,это правильно выбрать событие, в котором записывать данные в регистр.</p>
    <p>Поскольку при проведении документа уже поздно записывать домашние задания, мы будем записывать их при записи документа. Откроем модуль документа УчебныйДень и добавим в него обработчик события "ПриЗаписи". В этом обработчике нам нужно будет сначала создать набор записей, потом установить ему отбор, затем заполнить его нужными записями и в конце записать в базу данных. Создать набор записей можно с помощью менеджера регистра сведений. А добраться до менеджера регистра сведений можно так же, как и до менеджера документа. Через свойство глобального контекста и указание нужного регистра. Метод менеджера <i>СоздатьНаборЗаписей()</i> создаст нам пустой набор записей. Об этом мы можем прочитать в синтакс-помощнике.</p>
    <p>Если поставить точку останова на наборе записей и в отладчике посмотреть на этот объект, то увидим там свойство Отбор, которое является коллекцией значений. И в этой коллекции уже есть один элемент с именем Регистратор. Этот элемент платформа добавила самостоятельно, потому что знает, что регистр подчиняется регистратору. А раз так, то отбор должен быть установлен по регистратору и никак иначе.</p>
    <p>Заметка! Если бы регистр был независимым, то нам нужно было бы самостоятельно выбрать поля, по которым осуществляется отбор. Например, по каким-нибудь его измерениям. Такой пример находится в статье выше, там ссылка на статью в интернете про то как делать отбор по измерениям.</p>
    <p>Раз элемент отбора уже есть, нам осталось только установить правильное его значение. Как это сделать, мы можем посмотреть в синтакс-помощнике. Нажав на возвращаемое значение РегистрСведенийНаборЗаписей, мы перейдём к набору записей. Через его свойство Отбор к объекту Отбор. Этот объект является коллекцией, состоящей из объектов ЭлементОтбора. А у элемента отбора есть метод Установить().</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ПриЗаписи<span class="vue-r">(</span>Отказ<span class="vue-r">)</span>
                <span class="vue-g">// Регистр ДомашниеЗадания.</span>
                НаборЗаписей <span class="vue-r">=</span> РегистрыСведений<span class="vue-r">.</span>ДомашниеЗадания<span class="vue-r">.</span>СоздатьНаборЗаписей<span class="vue-r">();</span>
                НаборЗаписей<span class="vue-r">.</span>Отбор<span class="vue-r">.</span>Регистратор<span class="vue-r">.</span>Установить<span class="vue-r">(</span>Ссылка<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Здесь Ссылка это свойство документа. Того документа, в котором мы сейчас находимся. Теперь нужно обойти табличную часть документа и заполнить набор записями. Как добавить запись в набор? Набор записей это тоже коллекция значений, которая состоит из отдельных записей. Если мы посмотрим его описание в синтакс-помощнике то увидим, что у набора записей есть метод Добавить(). Он добавит пустую запись.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ПриЗаписи<span class="vue-r">(</span>Отказ<span class="vue-r">)</span>
                <span class="vue-g">// Регистр ДомашниеЗадания.</span>
                НаборЗаписей <span class="vue-r">=</span> РегистрыСведений<span class="vue-r">.</span>ДомашниеЗадания<span class="vue-r">.</span>СоздатьНаборЗаписей<span class="vue-r">();</span>
                НаборЗаписей<span class="vue-r">.</span>Отбор<span class="vue-r">.</span>Регистратор<span class="vue-r">.</span>Установить<span class="vue-r">(</span>Ссылка<span class="vue-r">);</span>

                <span class="vue-r">Для Каждого</span> СтрокаТабличнойЧасти <span class="vue-r">Из</span> Уроки <span class="vue-r">Цикл</span>
                    <span class="vue-r">Если</span> ЗначениеЗаполнено<span class="vue-r">(</span>СтрокаТабличнойЧасти<span class="vue-r">.</span>ДомашнееЗадание<span class="vue-r">) Тогда</span>
                        НоваяЗапись <span class="vue-r">=</span> НаборЗаписей<span class="vue-r">.</span>Добавить<span class="vue-r">();
                    КонецЕсли;
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Теперь вам нужно заполнить поля этой записи. Какие у неё есть поля, можем посмотреть в синтакс-помощнике или, для разнообразия, прямо в модуле в режиме отладки. Для этого не забудем поставить точку останова на конец инструкции Если. И в том документе, который вы будете записывать в режиме 1С:Предприятие, ввести какое-нибудь домашнее задание по одному из предметов.</p>
    <img src="../img/1С-1/2023-05-04_23-19-48.png" class="screen" alt="">
    <p>Поля Активность и НомерСтроки "служебные", их платформа заполнит сама. Поле Регистратор платформа тоже заполнит сама  она возьмёт то значение, которое мы установили в отборе. Предмет, ДомашнееЗадание и Выполнено это те данные, которые мы хотели записать в регистр. Остаётся поле Период. В это поле нам нужно будет записать дату документа. Причём, поскольку у нас не может быть нескольких документов в один день, удобнее будет записать дату начала дня, то есть с нулевым временем.</p>
    <p>И последнее действие, которое нужно выполнить, это запись набора данных в БД.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">Процедура</span> ПриЗаписи<span class="vue-r">(</span>Отказ<span class="vue-r">)</span>
                <span class="vue-g">// Регистр ДомашниеЗадания.</span>
                НаборЗаписей <span class="vue-r">=</span> РегистрыСведений<span class="vue-r">.</span>ДомашниеЗадания<span class="vue-r">.</span>СоздатьНаборЗаписей<span class="vue-r">();</span>
                НаборЗаписей<span class="vue-r">.</span>Отбор<span class="vue-r">.</span>Регистратор<span class="vue-r">.</span>Установить<span class="vue-r">(</span>Ссылка<span class="vue-r">);</span>
                
                <span class="vue-g">//если мы данные из регистра хотим прочиать, то используем метод Прочитать()
                //НаборЗаписей.Прочитать();</span>

                <span class="vue-r">Для Каждого</span> СтрокаТабличнойЧасти <span class="vue-r">Из</span> Уроки <span class="vue-r">Цикл</span>
                    <span class="vue-r">Если</span> ЗначениеЗаполнено<span class="vue-r">(</span>СтрокаТабличнойЧасти<span class="vue-r">.</span>ДомашнееЗадание<span class="vue-r">) Тогда</span>
                        НоваяЗапись <span class="vue-r">=</span> НаборЗаписей<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        НоваяЗапись<span class="vue-r">.</span>Период          <span class="vue-r">=</span> НачалоДня<span class="vue-r">(</span>Дата<span class="vue-r">);</span>
                        НоваяЗапись<span class="vue-r">.</span>Предмет         <span class="vue-r">=</span> СтрокаТабличнойЧасти<span class="vue-r">.</span>Предмет<span class="vue-r">;</span>
                        НоваяЗапись<span class="vue-r">.</span>ДомашнееЗадание <span class="vue-r">=</span> СтрокаТабличнойЧасти<span class="vue-r">.</span>ДомашнееЗадание<span class="vue-r">;</span>
                        НоваяЗапись<span class="vue-r">.</span>Выполнено       <span class="vue-r">=</span> СтрокаТабличнойЧасти<span class="vue-r">.</span>Выполнено<span class="vue-r">;</span>
                    КонецЕсли;
                КонецЦикла;

                НаборЗаписей<span class="vue-r">.</span>Записать<span class="vue-r">();</span>
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p><i>Отличия этого способа записи в регистр от того, как происходит запись при событии "ОбработкаПроведения"</i></p>
    <p>В обработке проведения почему-то не создаются и не записываются никакие наборы данных. Хотя средняя часть алгоритма очень похожа. В обработке проведения добавляется какое-то движение и присваиваются значения его полям. Здесь всё очень просто. Когда мы находимся в модуле документа, платформа знает, по каким регистрам документ может делать движения. Вы указывали это в дереве конфигурации. Поэтому платформа предоставляет нам услугу, облегчающую нашу работу. В свойстве документа Движения она уже хранит для нас пустые наборы данных для каждого из регистров, по которым мы можем захотеть записывать движения. И в этих наборах данных уже установлен нужный отбор. Таким образом, если мы используем эти наборы данных, то всё, что нам нужно сделать, это просто добавить в них те записи, которые нам нужны.</p>
    <p><span class="vue-r">ВАЖНО!!! К чему я рассказываю всё это? А к тому, что тот алгоритм, который мы написали в процедуре "ПриЗаписи", мы можем использовать в любом модуле конфигурации. Именно так и записываются данные в регистр. Но если мы находимся в модуле документа, мы можем поступить проще и использовать готовые наборы данных, которые есть в свойстве Движения. Т.е. даже а этом обработчике "ПриЗаписи", который находится в контексте текущего документа, мы можем спокойно воспользоваться свойством Движения и также как и в "ОбработкеПроведения" записать данные в регистр. Алгоритм, который мы написали в обработчике "ПриЗаписи" это лишь пример как можно в других модулях записывать в регистр, не имея под рукой свойство Движения. Ведь в других модулях не будет этого свойства и платформа уже не облегчит нам запись данных.</span></p>

    <p class="title-size16"><b id="reg-info-18">Отличие метода РегистрСведенийМенеджер.&lt;Имя регистра сведений>.СоздатьНаборЗаписей() от РегистрСведенийМенеджер.&lt;Имя регистра сведений>.СоздатьМенеджерЗаписи()</b>.</p>
    <p>Метод СоздатьМенеджерЗаписи() создает объект для управления записью регистра сведений. Этот объект будет создавать <i>уникальные</i> записи в регистре.</p>
    <p>Метод СоздатьНаборЗаписей() создает набор записей регистра сведений. У конкретного набора записей будет общий ключ, например, Регистратор, чтобы потом была возможность по этому ключу отобрать именно этот набор записей для редактирования.</p>


















    <h2 class="header-style" id="enumeration">Перечисления</h2>
    <p>Перечисления можно представить как те же справочники, но справочники дают возможность создавать, удалять, изменять свои элементы спрвочника, то перечисления не дают такой возможности. Разработчик как ввёл значения, так они и останутся.</p>
    <p>Для объяснения объекта конфигурации "Перечисления" продолжу тему из учебника Хрусталёвой "Пособие для разработчика". Все нижние статьи это одно целое повествование из книги. Хотя многое тут и не относится к перечислениям, но в той или иной мере связанно с ними.</p>
    <p>У нас есть справочник "Номенклатура", в справочнике есть и материалы и услуги, они разнесены по группам. Нам в дальнейшем нужно будет как то отличать материал от услуги. Можно было бы использовать для отличий группы, в которых они лежат, но это не надёжный способ, потому что группы можно удалить, переименовать, сгруппировать элементы по другим принципам и т.д.</p>
    <p>Поэтому нам требуется некоторый признак, позволяющий однозначно определять принадлежность элемента справочника к материалам или услугам, независимо от изменения иерархической структуры справочника.</p>
    <p>Для этого мы создадим у справочника Номенклатура ещё один реквизит, тип значения которого образуется объектом конфигурации Перечисление. Это поможет нам в дальнейшем легко определять, чем является элемент справочника Номенклатура: услугой или материалом.</p>

    <p class="title-size16"><b id="enumeration-1">Что такое Перечисление</b></p>
    <p>Объект конфигурации Перечисление предназначен для описания структуры хранения <i style="text-decoration:underline;">постоянных</i> наборов значений, не изменяемых в процессе работы конфигурации. На основе объекта конфигурации Перечисление платформа создает в базе данных таблицу, в которой может храниться набор некоторых постоянных значений.</p>
    <p>В настоящей жизни этому объекту может соответствовать, например, перечисление разновидностей указания цены - "включая НДС", "без НДС". Набор всех возможных значений, которые содержит перечисление, задается при конфигурировании системы, и пользователь не может изменять их, удалять или добавлять новые.</p>
    <p>Из этого следует важная особенность перечисления: значения  перечисления не "обезличены" для конфигурации, на них могут опираться алгоритмы работы программы. Это чем то похоже по работе на предопределеённые элементы справочника.</p>

    <p class="title-size16"><b id="enumeration-2">Добавление перечисления и привязка его значений к реквизиту "Вид номенклатуры" справочника "Номенклатура"</b></p>
    <p>Создадим новый объект конфигурации Перечисление с именем "ВидыНоменклатуры". На закладке Данные добавим два значения перечисления: Материал и Услуга.</p>
    <p>Далее в режиме Конфигуратор создадим у справочника Номенклатура реквизит "Вид номенклатуры" с типом данных - ПеречислениеСсылка.ВидыНоменклатуры, который будет хранить значение перечисления. В режиме 1С:Предприятие проставим нужные значения этого реквизита для всех элементов справочника Номенклатура.</p>
    <p><span class="vue-r">Напомню, у реквизита справочника "Вид номенклатуры" есть свойство в палитре свойств - <i style="text-decoration:underline;">"Значение запонения"</i>, которое позволяет в конфигураторе установить значение по умолчанию для этого реквизита. Насколько я знаю, если для реквизита установлен тип ПеречислениеСсылка, то в этом свойстве можно выбрать значения из этого перечисления, а если для реквизита установлен тип СправочникСссылка, то в значении этого свойства можно выбрать предопределённые элементы из этого справочника, если они есть конечно.</span></p>

    <p class="title-size16"><b id="enumeration-3">Произвольное представление номенклатуры</b></p>
    <p>Теперь, используя реквизит "Вид номенклатуры", зададим произвольное представление номенклатуры в интерфейсе "1С:Предприятия".</p>
    <p>Представление номенклатуры используется везде, где отображаются поля, ссылающиеся на элементы справочника Номенклатура. Такие поля мы видим в табличной части наших документов, в регистре сведений, регистре накопления и т.д.</p>
    <p>Стандартное представление номенклатуры (как и любого другого элемента справочника) определяется свойством справочника <i style="text-decoration:underline;">Основное представление</i>. По умолчанию это свойство установлено в значение <i style="text-decoration:underline;">В виде наименования</i>.</p>
    <img src="../img/1С-1/2023-08-05_12-53-30.png" class="screen" alt="">
    <p><span class="vue-r">Представление любой ссылки отображается в виде наименования, если задано в виде наименования. Просто тут идёт речь про ссылки на номенклатуру.</span></p>
    <p>Поэтому, например, в табличной части документов в колонке Номенклатура мы видим не ссылку(12:kj9d8f03rlsdif78923hkf что типо этого) на номенклатуру, а ее наименование.</p>
    <p>Было бы удобно, чтобы при отображении ссылок на номенклатуру в интерфейсе "1С:Предприятия" рядом с наименованием номенклатуры показывался бы и ее вид (материал или услуга).</p>
    <img src="../img/1С-1/2023-08-05_13-15-49.png" alt="">
    <p><b>Механизм формирования представления объекта</b></p>
    <p>Механизм формирования представления объекта конфигурации состоит из двух этапов: определение реквизитов, участвующих в формировании представления, и собственно формирование представления. Для формирования представления используются обработчики событий "ОбработкаПолученияПолейПредставления" и "ОбработкаПолученияПредставления" менеджера соответствующего объекта.</p>
    <p>Эти события срабатывают всегда при открытии любой формы, где будут показаны представления ссылки на элементы справочника Номенклатура. Вот при открытии формы документа "Оказание услуг" в табличной части отображаются представления ссылок на номенлатуру, значит при открытии формы отработают эти события.</p>
    <p>В конфигураторе, выделим в дереве объектов конфигурации справочник Номенклатура, вызовем контекстное меню и выберем пункт "Открыть модуль менеджера" и добавим эти обработчики.</p>
    <p>Первый обработчик имеет первым параметром массив, который мы заполняем теми реквизитами справочника Номенклатуры, значениями которых хотим составить представление для ссылки. Мы хотим составить представление в виде "Подключение воды(услуга)". "Подключение воды" это представление берётся из реквизита "Наименование", а слово "услуга" можно взять из реквизита "Вид номенклатуры". Значит массив Поля нужно заполнить строковыми названиями этих реквизитов:</p>
    <div class="code-style">
        <pre>
            --модуль менеджера
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПолученияПолейПредставления<span class="vue-r">(</span>Поля, СтандартнаяОбработка<span class="vue-r">)</span>
                <span class="vue-g">//указываем, что стандарное отображение в виде "наименования" не нужно</span>
                СтандартнаяОбработка <span class="vue-r">=</span> Ложь<span class="vue-r">;</span>

                <span class="vue-g">//добавляем в массив строковые имена полей справочника "Номенклатура",
                //значения которых и сформируют представление</span>
                Поля<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"Наименование"</span><span class="vue-r">);</span>
                Поля<span class="vue-r">.</span>Добавить<span class="vue-r">(</span><span class="vue-bl">"ВидНоменклатуры"</span><span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Во втором обработчике параметр структура Данные уже будет создана по полям из первого обработчика и будет содержать в ключе имя поля(реквизита), а в значении - значение поля. Вот в таком виде: Данные: "Наименование" -> "Подключение воды", "Вид номенклатуры" -> "Услуга". Если в табличной части несколько строк с номенклатурой, значит вторая процедура будет вызываться по кругу столько раз, сколько строк в табличной части. И на каждом круге в параметр Данные будут попадать соответствующие значения:</p>
    <div class="code-style">
        <pre>
            --модуль менеджера
            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПолученияПредставления<span class="vue-r">(</span>Данные, Представление, СтандартнаяОбработка<span class="vue-r">)</span>
                СтандартнаяОбработка <span class="vue-r">=</span> Ложь<span class="vue-r">;</span>

                <span class="vue-g">//мы хотим своё представление сформировать используя поле "ВидНоменклатуры", значение
                //которого хотим присоединить к наименованию, для этого и проверяем заполнени ли 
                //это поле значением, если да, то формируем с ним, если нет, без него</span>
                <span class="vue-r">Если</span> ЗначениеЗаполнено<span class="vue-r">(</span>Данные<span class="vue-r">.</span>ВидНоменклатуры<span class="vue-r">) Тогда</span>
                    <span class="vue-g">//параметр Представление это строка, в которую надо поместить конечную строку
                    //представляющую ссылку</span>
                    Представление <span class="vue-r">=</span> Данные<span class="vue-r">.</span>Наименование <span class="vue-r">+</span> <span class="vue-bl">" ("</span> <span class="vue-r">+</span>
                    НРег<span class="vue-r">(</span>Строка<span class="vue-r">(</span>Данные<span class="vue-r">.</span>ВидНоменклатуры<span class="vue-r">))</span> <span class="vue-r">+</span> <span class="vue-bl">")"</span><span class="vue-r">;
                Иначе</span>
                    Представление <span class="vue-r">=</span> Данные<span class="vue-r">.</span>Наименование<span class="vue-r">;
                КонецЕсли;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <img src="../img/1С-1/2023-08-05_20-15-26.png" class="screen" alt="">
    <p>В обработчике события ОбработкаПолученияПредставления мы описываем алгоритм получения параметра Представление из массива полей, заданных нами в предыдущем обработчике. Данные, необходимые для формирования представления, передаются с помощью параметра Данные типа Структура. Для этого сначала мы устанавливаем параметр СтандартнаяОбработка в значение Ложь, а затем получаем представление номенклатуры путем добавления к ее наименованию вида номенклатуры, заключенного в скобки. Если параметр СтандартнаяОбработка в обработчике не установлен в значение Ложь, то система попытается сформировать стандартное представление объекта, исходя из переданных данных.</p>
    <p>По аналогии с рассмотренным примером произвольные представления объектов конфигурации можно задавать не только для справочников, но и для документов, планов видов характеристик, планов счетов и т.п. </p>

    <p class="title-size16"><b id="enumeration-4">Запись в движения только той номенклатуры, которая является материалом</b></p>
    <p>В предыдущей статье мы научились создавать свои представления ссылок номенклатуры. Далее при проведении документа "Оказание услуг" нам нужно записывать в регистр накопления "Остатки материалов" только ту номенклатуру, которая является материалом, а не услугой. Ведь когда мы заполняем номенклатурой табличную часть документа, мы пишем всё подряд и услугу и материалы. Поэтому при проведении нам нужно отделить материалы и списывать их.</p>
    <p>В книге предлагается временное решение, которое по производительности не очень хорошое. Мы просто пишем условие, где берём на каждом круге цикла номенклатуру. Номенклатура это ссылка и по этой ссылке мы можем получить поле "ВидНоменклатуры", а в этом поле будет одно из значений перечисления "ВидыНоменклатуры". НО получение поля таким способом это неявный запрос в БД, а мы находимся в цикле. Вот по этой причине этот способ не очень производительный:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "Оказание услуги"

            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> Режим<span class="vue-r">)</span>
                Движения<span class="vue-r">.</span>ОстаткиМатериалов<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                <span class="vue-r">Для Каждого</span> ТекСтрокаПереченьНоменклатуры <span class="vue-r">Из</span> ПереченьНоменклатуры <span class="vue-r">Цикл</span>
                    <span class="vue-r">Если</span> ТекСтрокаПереченьНоменклатуры<span class="vue-r">.</span>Номенклатура<span class="vue-r">.</span>ВидНоменклатуры <span class="vue-r">=</span> Перечисления<span class="vue-r">.</span>ВидыНоменклатуры<span class="vue-r">.</span>Материал <span class="vue-r">Тогда</span>
                        Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиМатериалов<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Материал <span class="vue-r">=</span> ТекСтрокаПереченьНоменклатуры<span class="vue-r">.</span>Номенклатура<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                        Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> ТекСтрокаПереченьНоменклатуры<span class="vue-r">.</span>Количество<span class="vue-r">;
                    КонецЕсли;
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Более правильным способом было бы сделать запрос в БД, получить в результате только ту номенклатуру, которая является материалом и в цикле перебрать выборку из результата и записать в движения. Вот так:</p>
    <div class="code-style">
        <pre>
            --модуль объекта документа "Оказание услуги"

            <span class="vue-b"><span class="vue-r">Процедура</span> ОбработкаПроведения<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> Режим<span class="vue-r">)</span>
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	ОказаниеУслугиПереченьНоменклатуры.Номенклатура КАК Номенклатура,
                    |   ОказаниеУслугиПереченьНоменклатуры.Количество КАК Количество
                    |ПОМЕСТИТЬ ВТ
                    |ИЗ
                    |	Документ.ОказаниеУслуги.ПереченьНоменклатуры КАК ОказаниеУслугиПереченьНоменклатуры
                    |ГДЕ
                    |	ОказаниеУслугиПереченьНоменклатуры.Ссылка = &Ссылка
                    |;
                    |////////////////////////////////////////////////////////////////////////////////
                    |ВЫБРАТЬ
                    |	СправочникНоменклатура.Ссылка КАК Материал,
                    |   ВТ.Количество КАК Количество
                    |ИЗ  
                    |	ВТ КАК ВТ
                    |	ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК СправочникНоменклатура 
                    |	ПО ВТ.Номенклатура = СправочникНоменклатура.Ссылка
                    |ГДЕ
                    |	НЕ СправочникНоменклатура.ЭтоГруппа
                    |	И СправочникНоменклатура.ВидНоменклатуры = &ВидНоменклатуры"</span><span class="vue-r">;</span>

                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"ВидНоменклатуры"</span><span class="vue-r">,</span> Перечисления<span class="vue-r">.</span>ВидыНоменклатуры<span class="vue-r">.</span>Материал<span class="vue-r">);</span>
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>

                Движения<span class="vue-r">.</span>ОстаткиМатериалов<span class="vue-r">.</span>Записывать <span class="vue-r">=</span> Истина<span class="vue-r">;</span>

                Выборка <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>

                <span class="vue-r">Пока</span> Выборка<span class="vue-r">.</span>Следующий <span class="vue-r">Цикл</span>
                    Движение <span class="vue-r">=</span> Движения<span class="vue-r">.</span>ОстаткиМатериалов<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                    Движение<span class="vue-r">.</span>ВидДвижения <span class="vue-r">=</span> ВидДвиженияНакопления<span class="vue-r">.</span>Расход<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Период <span class="vue-r">=</span> Дата<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Материал <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Материал<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Склад <span class="vue-r">=</span> Склад<span class="vue-r">;</span>
                    Движение<span class="vue-r">.</span>Количество <span class="vue-r">=</span> Выборка<span class="vue-r">.</span>Количество<span class="vue-r">;
                КонецЦикла;
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Этот 2й способ с запросом писал сам, когда дойду в книге до мига, когда исправлять будут, то добавлю исправления если будут.</p>
    




















    <h3 class="header-style2" id="11b">Крестики-нолики</h3>
    <p class="title-size16"><b>Крестики-нолики</b></p>
    <p>Когда создаём форму мы добавляем в неё Команды, которые становятся кнопками при переносе команды в элементы формы. При клике по кнопке обычно выполняется код. Код пишется в модуле формы(правая вкладка снизу формы). Вот такой код говорит, что обращаемся к текущей нажатой кнопке и тут же меняем заголовок кнопки при нажатии:</p>
    <div class="code-style">
        <pre>
            <span class="vue-r">&НаКлиенте
            Процедура <span class="vue-b">НажатиеНаКнопку</span>()
                <span class="vue-g">//как только будет нажата кнопка с которой свазяна эта процедура
                //то процедура отработает и мы можем тут же обратиться к нажатому
                //элементу формы(кнопке) по объекту "ТекущийЭлемент" и запишем в кнопку новый заголовок
                //, это что то по типу this в js при срабатывании обработчика события</span>
                <span class="vue-b">ТекущийЭлемент</span>.<span class="vue-b">Заголовок</span> = <span class="vue-b">"0"</span>;
                

                <span class="vue-g">//чтобы обратиться к любому элементу-кнопке формы есть
                //такая коллекция как "Элементы" и в эту коллекуию как к массиву 
                //обращаемся к элементу через [] по имени элемента или через точку</span>
                <span class="vue-b">Элементы</span>[<span class="vue-b">ИмяЭлемента</span>].<span class="vue-b">Заголовок</span> = <span class="vue-b">"0"</span>;

                <span class="vue-g">//например у кнопки во вкладке "Элементы формы" имя "Кнопка1"
                //тогда обращение будет таким</span>
                <span class="vue-b">ИмяЭлемента <span class="vue-r">=</span> "Кнопка1"</span><span class="vue-r">;</span>
                <span class="vue-b">Элементы</span>[<span class="vue-b">ИмяЭлемента</span>].<span class="vue-b">Заголовок</span> = <span class="vue-b">"0"</span>;
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Вот пример обработчиков для кнопок крестики-нолики. На всех элементах кнопках висит один обработчик - НажатиеНаКнопку:</p>
    <img src="../img/1С-1/2022-10-19_11-25-06.png" class="screen" alt="">
    <p>Модуль формы</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Перем Поле;//тут хранятся наши ячейки


            &НаКлиенте
            Процедура ПриОткрытии(Отказ)
                //когда обработка "Крестики-нолики" откроется у пользователя
                //наступит событие и сработает этот обработчик
                
                //итак, присвоим начальное значение для переменной Поле
                //установим двухмерный массив 3х3
                Поле = Новый Массив;
                Поле.Добавить(Новый Массив(3));
                Поле.Добавить(Новый Массив(3));
                Поле.Добавить(Новый Массив(3));
                
                //пробежимся по массиву и в каждую его ячейку установим " "
                //это будет сигналом того, что ячейки свободны
                Для Шаг1 = 0 По 2 Цикл
                    Для Шаг2 = 0 По 2 Цикл
                        Поле[Шаг1][Шаг2] = " ";
                    КонецЦикла;
                КонецЦикла;
            КонецПроцедуры

            &НаКлиенте
            Процедура НажатиеНаКнопку(Команда)
                //эта процедура сработает как только будет нажата любая кнопка
                //связанная с этой процедурой, это 9 кнопок для крестиков-ноликов
                ТекущийЭлемент.Заголовок = "0";
                ИмяЭлемента = ТекущийЭлемент.Имя;
                Позиция1 = Сред(Прав(ИмяЭлемента, 2), 1, 1);
                Позиция2 =  Прав(ИмяЭлемента, 1);
                Поле[Число(Позиция1)][Число(Позиция2)] = "0";
                
                Если ИграОкончена() Тогда
                
                    Сообщить("Вы победили компьютер");
                
                Иначе
                    ХодКомпьютера();
                    Если ИграОкончена() Тогда
                        Сообщить("Компьютер победил");
                    КонецЕсли;
                КонецЕсли;
            КонецПроцедуры

            &НаКлиенте
            Процедура ХодКомпьютера()
                //тут 2 способа работы компа, это первый, он просто проверяет 
                //поле на пустоту и заполняет её, идёт последовательно
                //сделаем обход всех ячеек массива Поле
                //КомпПоходил = Ложь;
                //Для Шаг1 = 0 По 2 Цикл
                //	Если КомпПоходил Тогда
                //		Прервать
                //	КонецЕсли;
                //
                //	Для Шаг2 = 0 По 2 Цикл
                //		 //если в очередной ячейке массива хранится пустая строка
                //		 Если Поле[Шаг1][Шаг2] = " " Тогда
                //		    //это значит, что ячейка свободна и комп может 
                //			//в неё походить, записав "Х"
                //			Поле[Шаг1][Шаг2] = "Х";
                //			
                //			//составим имя кнопки прибавив текущий элемент массива
                //			ИмяКнопки = "Кнопка" + Шаг1 + Шаг2;
                //		 	Элементы[ИмяКнопки].Заголовок = "Х";
                //			КомпПоходил = Истина;
                //		    Прервать;
                //		 КонецЕсли;
                //	
                //	КонецЦикла;
                //
                //КонецЦикла;
                //КомпПоходил = Ложь;
                
                
                //это 2й способ работы компа, выбираются элементы поля случайно
                ГСЧ = Новый ГенераторСлучайныхЧисел;
                
                Пока Истина Цикл
                    СЧСтроки = ГСЧ.СлучайноеЧисло(0, 2);
                    СЧСтолбца = ГСЧ.СлучайноеЧисло(0, 2);
                    ИмяЭлемента = "Кнопка" + СЧСтроки + СЧСтолбца;
                    
                    Если Поле[СЧСтроки][СЧСтолбца] = " " Тогда
                        Поле[СЧСтроки][СЧСтолбца] = "Х";
                        Элементы[ИмяЭлемента].Заголовок = "Х";
                        Прервать;
                    КонецЕсли;
                КонецЦикла;	
            КонецПроцедуры


            &НаКлиенте
            Функция ИграОкончена()

                Если
                    Поле[0][0] &lt;> " " И
                    Поле[0][0] = Поле[0][1] И
                    Поле[0][0] = Поле[0][2]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[1][0] &lt;> " " И
                    Поле[1][0] = Поле[1][1] И
                    Поле[1][0] = Поле[1][2]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[2][0] &lt;> " " И
                    Поле[2][0] = Поле[2][1] И
                    Поле[2][0] = Поле[2][2]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[0][0] &lt;> " " И
                    Поле[0][0] = Поле[1][0] И
                    Поле[0][0] = Поле[2][0]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[0][1] &lt;> " " И
                    Поле[0][1] = Поле[1][1] И
                    Поле[0][1] = Поле[2][1]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[0][2] &lt;> " " И
                    Поле[0][2] = Поле[1][2] И
                    Поле[0][2] = Поле[2][2]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[0][0] &lt;> " " И
                    Поле[0][0] = Поле[1][1] И
                    Поле[0][0] = Поле[2][2]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[0][2] &lt;> " " И
                    Поле[0][2] = Поле[1][1] И
                    Поле[0][2] = Поле[2][0]
                Тогда
                    Возврат Истина;
                ИначеЕсли
                    Поле[0][1] &lt;> " " И
                    Поле[0][1] = Поле[1][0] И
                    Поле[0][1] = Поле[2][0]
                Тогда
                    Возврат Истина;
                Иначе
                    Возврат Ложь;
                КонецЕсли;
            КонецФункции
        </pre>
    </div>











    <h3 class="header-style2" id="12">Объектная модель запросов к БД</h3>
    <p>Существует 2 способа сделать запрос к БД. Это через объектную модель и через табличную модель. Тут про объектную модель.</p>
    <p>Если в конфигураторе зайти в синтакс помошник и набрать в поиске ДокументМенеджер.ИмяДокумента или СправочникМенеджер.ИмяСправочника, то найдём целую пачку методов запроса данных из этих объектов конфигурации.</p>
    <p>У объектной модели запросов есть существенные недостатки.</p>
    <ul class="list">
        <li>Нельзя с помощью одного метода получить данные из нескольких таблиц. Например, есть таблица с товарами и есть таблица с ценами этих товаров и нет такого метода, который за одно обращение к БД сможет прочитать данные из 2х этих таблиц. Чтобы получить данные этих таблиц нужно выполнить 2 запроса с выборкой из Справочники.Товары.Выбрать(); и РегистрыСведений.ЦеныТоваров.Выбрать();. И как следствие чем больше запросов к БД, тем дольше будет это всё работать.</li>
        <li>Ограниченные возможности фильтрации. Например, в табличной модели запросов есть разные способы выборки с разными условиями. При объектной модели такого не сделать. Вернее фильтры есть кое-какие, но их недостаточно</li>
        <li>Методы не позволяют группировать данные и формировать итоги.</li>
        <li>Избыточность чтения. То есть выборка будет всего что есть по указанному объекту, а нужно было всего лишь вернуть данные по одному полю.</li>
    </ul>















    <h3 class="header-style" id="common_obj"><b>Объекты из дерева "Общие"</b></h3>

    <p><b id="func_options">Функциональные опции</b></p>
    <p>Пишу из курса Чистова 8.2</p>
    <p>ФО влияют на интерфейс пользователя.</p>
    <p>Функциональные опции нужны, чтобы что-то включить или выключить в системе. Например, можно включать ведение многоскладского учёта или выключать. Допустим наша конфигурация будет испльзоваться на разных предприятиях и мы может на одном предприятии включить такой учёт, а на другом выключить. Мы можем создать настройку, с помощью которой пользователь сможет включать или выключать учёт.</p>
    <p>Нужно определить место, где можно включать или выключать. Настройку будем делать сразу для всей конфигурации. Хранить булево значение будем в константе. Добавим константу "СкладскойУчет" и выберем тип булево. Добавим новую функциональную опцию "СкладскойУчет", в поле "Хранение" укажем константу "СкладскойУчет". Поле "Хранение" означает место где эта опция будет хранится. На вкладке "Состав" мы выбираем те прикладные объекты, которые нужно включить или выключить. Ставим галочку на справочнике "Склады", у документа "ПоступлениеТоваров" реквизит Склад, у документа "ПродажаТоварв" реквизит Склад, на регистре "ОстаткиПоСкладам" измерение склад. Добавим константу в подсистему. Всё, в пользовательском режиме в меню Сервис доступна константа, включаем выключаем учёт. Если мы выключаем измерение Склад в регистре, то нужно заранее программно предусмаривать, есть такое измерение или нет.</p>
    <p>Функциональные опции могут быть более сложными. У нас есть в документах поступления и продажи реквизиты Контрагент и Договор, мы хотим добавить возможность учёта валюты в этих документах в зависимости от типа договора(доллары это будут или рубли). Заранее нужно добавить реквизит "Валюта" в документы приходные и расходные. В элементе справочника Договоры, при выборе договора, мы можем сделать поле с галочкой, по которой мы будем включать или выключать валютный учёт(показывать в документах приходная и расходная реквизит "Валюта"). Отсюда следует что хранить опцию мы будем в справочнике ДоговорыКонтрагентов. Добавим в этот справочник реквизит "ВалютныйУчет" с типом булево. Затем добавим новую функциональную опцию "ВалютныйУчетВДоговорах" и в поле хранение выберем реквизит "ВалютныйУчет" справочника "ДоговорыКонтрагентов". На вкладке Состав выберем реквизиты документов "Валюта". В таком виде, если мы включим галочку в каком то элементе договора, то включатся все реквизиты "Валюта" во всех этих документах. Нам же нужно, чтобы на каждый договор была отдельное включение или выключение учета в своём объекте документа. В этом нам поможет объект "Параметры функциональных опций", он находится под объектом "Функциональные опции".</p>
    <p>Добавим новый параметр опций и назовём его "Договор". В поле "Использование" палитры свойств указываем справочник "ДоговорыКонтрагентов". Теперь когда мы поставим галочку в элементе справочника(выберем договор), то потом при открытии формы документа надо, чтобы форма узнала нужно ли ей отобразить реквизит "Валюта" или нет. Для этого в модуле формы нам нужно событие "ПриСозданииНаСервере". Вот такой код пишем. В этом коде вообще не понятно что происходит, куда то передаём структуру:</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ПоступлениеТоваров"
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                ПараметрыФО <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"Договор"</span><span class="vue-r">,</span> Объект<span class="vue-r">.</span>ДоговорКонтрагента<span class="vue-r">);</span>
                УстановитьПараметрыФункциональныхОпцийФормы<span class="vue-r">(</span>ПараметрыФО<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Дальше нужно также создать обработчик события "ПриИзменении" у реквизита Договор и там такой же код, как и при создании формы на сервере.</p>
    <div class="code-style">
        <pre>
            --модуль формы документа "ПоступлениеТоваров"
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> ПриСозданииНаСервере<span class="vue-r">(</span>Отказ<span class="vue-r">,</span> СтандартнаяОбработка<span class="vue-r">)</span>
                ПараметрыФО <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"Договор"</span><span class="vue-r">,</span> Объект<span class="vue-r">.</span>ДоговорКонтрагента<span class="vue-r">);</span>
                УстановитьПараметрыФункциональныхОпцийФормы<span class="vue-r">(</span>ПараметрыФО<span class="vue-r">);
            КонецПроцедуры</span></span>

            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ДоговорКонтрагентаПриИзменении<span class="vue-r">(</span>Элемент<span class="vue-r">)</span>
                ПараметрыФО <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"Договор"</span><span class="vue-r">,</span> Объект<span class="vue-r">.</span>ДоговорКонтрагента<span class="vue-r">);</span>
                УстановитьПараметрыФункциональныхОпцийФормы<span class="vue-r">(</span>ПараметрыФО<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Теперь если в объекте документа при открытии формы выбора справочника выбрать какой то договор и поставить галочку "ВалютныйУчет", то сразу после выбора появится реквизит "Валюта". Ну мы например, работаем всё время в рублях, а тут выбрали договор с иностранцами и включили "Валютный учет", всё, появился реквизит "Валюта", где мы выбираем, например, EUR.</p>
    <p>Ещё Чистов упомянул, что можно эти опции использовать где то в регистре сведений, но примера не показал.</p>

    <p><b id="roli">Роли</b></p>

    <p>Пишу с курса Чистова 8.2. Видео - https://www.youtube.com/watch?v=CpnHPs4sX0I&list=PLkdnTy1CsgR0y5QgkDfsgYJsETriuKK3f&index=17   с 00:37:40</p>
    <p>Роли также влияют на интерфейс пользователя, от них зависит отображение данных. Роли разрешают или запрещают доступ к БД того или иного пользователя.</p>
    <p>Первая роль это администратор, которому доступно почти всё. Добавим новую роль - "АдминистративныеФункции", откроется конструктор роли. Слева вверху есть подменю "Действие", в ней выберем пункт "Установить все права" и ещё внизу поставим галочку "Устанавливать права для новых объектов".</p>
    <p>Ограничение или разрешение производится либо ко всей таблице, либо к её реквизитам по отдельности в окне "Объекты" слева, справа как раз права. Справа в правах "Чтение" от "Просмотр" отличаются тем, что одно из них интерактивное(Просмотр), другое программное(Чтение). Кроме таблиц права настраиваются также ко всей конфигурации. Далее Чистов рассказывает немного про пункты в правах для всей конфигурации.</p>
    <p>далее нет смысла всё записывать, лучше посмотреть видео, также можно посмотреть про роли в курсе Камкова, на временных метках найти про роли и посмотреть.</p>









    









    <h3 class="header-style" id="command">Справка по запросам</h3>

    <p class="title-size16"><b id="query1">Как в результате запроса сделать, чтобы в отсортированном списке одну нужную мне запись поставить вверху списка или внизу</b></p>
    <p>Для наглядности приведу пример. У нас есть регистр накопления с измерением "СрокГодности", в это измерение пишется из реквизита таб. части "Товары" документа "ПоступлениеТоваров". Это измерение своего рода партия, только вместо ссылки на документ, пишем срок годности товара в виде даты.</p>
    <p>Когда мы проводим документ "ПродажаТоваров", то при списании количества и себестоимости измпользуем партионное списание, а значит и результат запроса отсортирован по полю "СрокГодности", т.е. мы списываем сначала товары, у которых ранний срок годности и по возрастающей. Но у пользователя мы сделали поле в табличной части - "СрокГодности", в котором он может выбрать для товара срок годности на его усмотрение, из тех что имеются в БД для товара. Он выбирает этот срок годности и нужно при проведении списать сначала товар с этим сроком годности, а затем по остальным партиям в порядке возрастания. Как получить такой запрос, чтобы поле "СрокГодности" было отсортированно по возрастанию, но запись со сроком годности выбранной пользователем была вверху, чтобы списать её первой? Это можно сделать так. Добавим в запрос дополнительное поле "СрокГодностиВыбранный", это поле мы возьмём из левой таблицы с полями табличной части документа. Затем в языке запроса используем условие ВЫБОРКА КОНЕЦ:</p>
    <div class="code-style">
        <pre>
            ВЫБРАТЬ
                ПродажаСкоропортящихсяТоваровТовары.Товар КАК Товар,
                ПродажаСкоропортящихсяТоваровТовары.СрокГодности КАК СрокГодности,
                СУММА(ПродажаСкоропортящихсяТоваровТовары.Количество) КАК Количество,
                СУММА(ПродажаСкоропортящихсяТоваровТовары.Сумма) КАК Сумма
            ПОМЕСТИТЬ ВТ
            ИЗ
                Документ.ПродажаСкоропортящихсяТоваров.Товары КАК ПродажаСкоропортящихсяТоваровТовары
            ГДЕ
                ПродажаСкоропортящихсяТоваровТовары.Ссылка = &Ссылка

            СГРУППИРОВАТЬ ПО
                ПродажаСкоропортящихсяТоваровТовары.Товар,
                ПродажаСкоропортящихсяТоваровТовары.СрокГодности
            ;

            ////////////////////////////////////////////////////////////////////////////////
            ВЫБРАТЬ
                ВТ.Товар КАК Товар,
                ПРЕДСТАВЛЕНИЕ(ВТ.Товар) КАК ТоварП, 
                ВТ.СрокГодности КАК СрокГодностиВыбранный,
                ВТ.Количество КАК Количество,
                ВЫБОР
                    КОГДА ВТ.СрокГодности = ОстаткиСкоропортящихсяТоваровОстатки.СрокГодности ТОГДА
                        1
                    ИНАЧЕ
                        0
                КОНЕЦ КАК Поле1,
                ВТ.Сумма КАК Сумма,
                ОстаткиСкоропортящихсяТоваровОстатки.СрокГодности КАК СрокГодности,
                ЕСТЬNULL(ОстаткиСкоропортящихсяТоваровОстатки.КоличествоОстаток, 0) КАК КоличествоОстаток,
                ЕСТЬNULL(ОстаткиСкоропортящихсяТоваровОстатки.СебестоимостьОстаток, 0) КАК СебестоимостьОстаток
            ИЗ
                ВТ КАК ВТ
                    ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиСкоропортящихсяТоваров.Остатки(
                            &ДатаДокумента,
                            Товар В
                                (ВЫБРАТЬ
                                    ВТ.Товар КАК Товар
                                ИЗ
                                    ВТ КАК ВТ)) КАК ОстаткиСкоропортящихсяТоваровОстатки
                    ПО ВТ.Товар = ОстаткиСкоропортящихсяТоваровОстатки.Товар
            УПОРЯДОЧИТЬ ПО 
                Поле1 УБЫВ,
                СрокГодности
            ИТОГИ
                МИНИМУМ(Количество),
                МИНИМУМ(Сумма),
                СУММА(КоличествоОстаток)
            ПО
                Товар
        </pre>
    </div>
    <p>Через условие ВЫБОРКА КОНЕЦ мы указываем, что если сроки равны, то записываем 1 в новое поле с именем Поле1, если нет, то 0. Затем упорядычиваем сначала по Поле1 УБЫВ, а потом и по сроку и получится, что выбранный срок пользователем оказался первым, а ниже уже идут отсортированные по возрастанию:</p>
    <img src="../img/1С-1/2023-06-30_15-19-07.png" class="screen" alt="">

    <p class="title-size16"><b id="query2">Как получить 2 таблицы с данными в одном запросе</b></p>
    <p>Мы можем в кострукторе запроса сделать 2 пакета с запросом. Например, в одном пакете будет запрос к таблице документа, чтобы выбрать данные из шапки документа, а второй пакет будет с запросом к таблице табличной части этого документа. И получится текст запроса с двумя пакетами запроса:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b">Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
            Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                <span class="vue-bl">"ВЫБРАТЬ
                |	ПродажаТоваровИУслуг.Покупатель КАК Покупатель,
                |	ПродажаТоваровИУслуг.Склад КАК Склад
                |ИЗ
                |	Документ.ПродажаТоваровИУслуг КАК ПродажаТоваровИУслуг
                |ГДЕ
                |	ПродажаТоваровИУслуг.Ссылка = &Ссылка
                |;
                |
                |////////////////////////////////////////////////////////////////////////////////
                |ВЫБРАТЬ
                |	ПродажаТоваровИУслугТовары.Товар КАК Товар,
                |	ПродажаТоваровИУслугТовары.Количество КАК Количество,
                |	ПродажаТоваровИУслугТовары.Цена КАК Цена,
                |	ПродажаТоваровИУслугТовары.Сумма КАК Сумма
                |ИЗ
                |	Документ.ПродажаТоваровИУслуг.Товары КАК ПродажаТоваровИУслугТовары
                |ГДЕ
                |	ПродажаТоваровИУслугТовары.Ссылка = &Ссылка"</span><span class="vue-r">;</span>

            Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> Ссылка<span class="vue-r">);</span>
            РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>ВыполнитьПакет<span class="vue-r">();</span></span>            
        </pre>
    </div>
    <p>При методе Выполнить() у запроса мы получим только данные последнего запроса в пакете. А при методе ВыполнитьПакет() у нас появляется возможность обращаться как к данным первого запроса, так и к данным второго запроса. Метод ВыполнитьПакет() возвращает массив, в котором в первом элементе будет лежать РезультатЗапроса по первому пакету, а во втором элементе второй результат.</p>
















    <h3 class="header-style" id="command">Работа с командами</h3>
    <p>Более подробно про произвольные команды написано в разделе "Разработка интерфейса прикладного решения" -> Глава 1.11 Создаём произвольные команды</p>

    <p class="title-size16"><b id="command1">В общем о командах</b></p>
    <p><i>Команды</i> в дереве объектов конфигурации расположены в разных местах. Если команда выполняет общие действия, не связанные с конкретными объектами конфигурации, то такие команды вы можете добавлять в ветке Общие - Общие команды. Общие команды могут открыть общие формы, открыть браузер. А если команда связана с определённым объектом конфигурации, то такие команды добавляются в ветку <i>Команды</i>, которая есть у каждого объекта конфигурации.</p>

    <p class="title-size16"><b id="command2">Пример. Зададим команду(кнопку) в списке документов вида "ПоступлениеТоваров" для их копирования</b></p>
    <p>Мы хотим, чтобы по нажатию по кнопке у нас создалось автоматом несколько документов на всю следующую неделю. Предположим к нам каждую неделю привозять одни и те же товары в одном и том же количестве и лень заполнять документы. Если вдруг что то поменяется в привозе, то можно вручную подправить созданные документы.</p>
    <p>Итак, добавим новую команду в ветке документа "ПоступлениеТоваров" и назовём её "Заполнить документы". Платформа сразу же откроет модуль команды с обработчиком заготовкой и также откроется палитра свойств. В палитре нужно заполнить два важных свойства команды: <i>Группа</i> и <i>Тип параметра команды</i>.</p>
    <p>Дело в том, что платформа самостоятельно размещает команды в нужных местах интерфейса нашей программы. Чтобы понять, в каком месте нужно отобразить нашу команду, она анализирует именно эти два свойства. Свойство <i>Тип параметра команды</i> определяет, какие данные нужны нашей команде. Платформа поместит нашу команду в те формы, где есть данные этого типа. Например, если команда создаёт копию документа "ПоступлениеТоваров", то ей нужно знать, какой именно документ следует скопировать. То есть ей нужно знать ссылку на конкретный документ. Значит, в этом свойстве мы укажем тип ДокументСсылка.ПоступлениеТоваров. Тогда платформа поместит эту команду в те формы, где есть такие данные: в форму списка документов и в форму документа.</p>
    <p>Почему команде нужно указать это свойство? Потому, что у команды есть обработчик и 1й параметр этого обработчика это массив и когда мы жмём на кнопку, то автоматом в этот массив добавляется ссылка на документ, в котором эта кнопка находится или много ссылок если кнопка в форме списка и выделено несколько документов.</p>
    <p>Если мы нажмём её в форме документа, она скопирует нам этот документ. А если мы нажмём её в форме списка, то она скопирует тот документ, который в данный момент выделен в списке. Вот так это работает.</p>
    <p>Указав тип ДокументСсылка.ПоступлениеТоваров в этом свойстве система сама добавит кнопку на 2 формы документа. Но нам по логике кнопка нужна только в форме списка, потому как нет смысла размещать в форме документа. Нам удобно в форме списка выделить нужные элементы и скопировать. Пока оставим так как есть, уберем кнопку из формы документа чуть позднее.</p>
    <p>А пока узнаем про второе свойство <i>Группа</i>. В этом свойстве указываем место, где будет распологаться кнопка. Вот картинка того, что откроется по кнопке выбора в группе. Под цифрой 1 это расположение для общих команд, т.е. для команд не принадлежащих к конкретной форме, это например, панель команд основного раздела. Оставшиеся пункты это панель навигации и командная панель формы. Нам нужно указать "Командная панель формы.Важное". В панели навигации обычно располагают команды, которые "переносят" пользователя в другую точку программы: открывают ему список других объектов, показывают список вспомогательных данных и так далее. В командной панели обычно размещают команды, которые не меняют положение пользователя в программе, но выполняют какие-то действия с данными.</p>
    <p>Ну а теперь уберем отображение кнопки у формы документа. Для этого откроем форму документа и перейдём на закладку <i>Командный интерфейс</i> и в командной панали в разделе Важное найдём нашу команду и уберем ей видимость сняв галочку.</p>
    <p>Модуль команды, в отличие от других модулей, с которыми вы уже работали, существует и на клиенте, и на сервере. Поэтому в нём для каждой процедуры в отдельности нужно указывать, в каком контексте она будет исполняться указав директиву компиляции: &НаКлиенте, &НаСервере или &НаКлиентеНаСервере. Заготовку обработчик, которую платформа нам создала по умолчанию уже имеет директиву &НаКлиенте. Про директивы мы можем прочитать в синтакс-помощнике в разделе Общее описание встроенного языка - Директивы компиляции.</p>
    <p>Любая команда - это интерактивное действие, которое всегда инициируется пользователем. Это значит, что "начинается" команда на клиенте. Именно поэтому платформа и указала, что обработчик команды должен исполняться на клиенте. Но наша команда должна будет прочитать данные из базы данных и записать в неё новые документы. А с базой данных можно работать только на сервере. Поэтому первое, что нам нужно сделать, это передать исполнение программного кода на сервер. Делается это просто, мы в обработке команды на клиенте вызываем процедуру с директивой на сервере.</p>
    <p>Далее в серверной процедуре нужно написать программу, которая будет копировать выделенные документы.</p>

    <p class="title-size16"><b id="command3">Общая команда, которая открывает параметры учёта.</b></p>
    <p>Например, у нас есть константы, которые через функциональные опции включают или выключают разные учёты. Мы объединим эти константы в одно место и место назовём "ПараметрыУчета". Как объединить константы, выберем главный объект "Константы" в контекстном меню есть "Создать форму констант", так как у констант нет своих форм, то создастся общая форма. И общую команду, которую мы создадим и будет открывать эту общую форму "ПараметрыУчета".</p>
    <p>Итак, создадим форму констант, откроется конструктор общих форм, выбираем "Форма констант", жмём далее, выбираем все константы для отображения учёта и готово. Дальше создаём общую команду "ОткрытьПараметрыУчета". В палитре свойств задаём имя и есть поле Группа, которое позволяет задать место, куда будет входить команда. Выбираем панель действий "Сервис". У нас также открылся модуль команды и там уже есть заготовка процедуры "ОбработкаКоманды". В процедуре закоментирован код, который открывает общую форму, это частое действие общей команды, поэтому и вынесен сразу системой такой код. Раскоментируем, потому что мы и будем открывать общую форму "ФормаКонстант", параметры формы пропустим, их не будет, да и остальных аргументов не будет, поэтому уберем их:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ОбработкаКоманды<span class="vue-r">(</span>ПараметрКоманды<span class="vue-r">,</span> ПараметрыВыполненияКоманды<span class="vue-r">)</span>
                ОткрытьФорму<span class="vue-r">(</span><span class="vue-bl">"ОбщаяФорма.ФормаКонстант"</span><span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Добавим общую команду в подсистему, у меня это единственная подсистема Курс. Теперь эту команду мы найдём в меню "Сервис", куда мы её и определяли в поле Группа, нажав на команду откроется форма с теми константами, которые мы в неё поместили. Всё.</p>
    <p>С помощью общих команд можно запускать файлы, производственное оборудование, в общем выполнять какие то ощие действия.</p>

    <p class="title-size16"><b id="command4">Сделаем команду печать для документа "ПродажаТоваров" без конструктора.</b></p>
    <p>Пишу по курсу Чистова 8.2</p>
    <p>Когда мы добавим новую команду для документа "ПродажаТоваров", то откроется палитра свойств этой команды, в этой палитре есть свойство Группа, в нём нужно указать где размещать команду. Обычно команд для распечатывания разных документов несколько, поэтому создают меню-группу, в которую мы соберем все команды вместе для данного документа. Для таких целей есть объект "Группа команд" в дереве "Общие", создадим его, назовём "Печать" и разместим эту группу в "командной панели формы" свойства Категории. Это значит что теперь в командных панелях форм появилась группа Печать, пока она естественно не показывается в этих формах, но уже создался в системе такой путь как "Командндная панель формы.Печать".</p>
    <p>Дальше при создании подчинённой команды документа продажи откроется палитра свойств. У свойства Группа  появится тот самый путь "Командная панель формы.Печать", в него и разместим нашу команду. Назовём команду "ПечатьТорг12", синоним - "Печать накладной".</p>
    <p>Затем для свойства "Тип парметра команды" зададим тип ДокументСсылка.ПродажаТоваров. Это свойство указывает тип для первого параметра процедуры ОбработкаКоманды. Когда мы кликнем по кнопке печати в форме документа, то в этот параметр попадёт ссылка на этот документ, а если мы в форме списка нажмём на кнопку печати, то попадёт массив выделенных ссылок документов.</p>
    <p>Значение свойства "Тип параметра документа" говорит также системе, что нужно разместить кнопку именно в формах тех объектов конфигурации, у которых есть хоть один реквизит с таким же типом данных, в нашем случае тип данных - ДокументСсылка.ПродажаТоваров.</p>
    <p>Автоматом при создании команды у нас откроется модуль команды с заготовкой, открывать форму нам не нужно, удалим в заготовке закоментированный код.</p>
    <p><span class="vue-b">ВНИМАНИЕ!!!</span> Первый параметр процедуры ОбработкаКоманды - ПараметрыКоманды содержит источник, в котром находится эта команда, обычно это ссылка на объект данных справочника или документа или  массив с ссылкой, если в поле "Режим использования параметра" выбрано "Множественный". Да это тот самый массив со ссылками из формы списка. Почему то раньше где то встречал, что если создать команду в форме списка, то автоматом в ПарметрыКоманды попадал массив с ссылками выделенных в списке, а тут нужно именно включить этот множественный выбор, иначе даже в списке при выделении нескольких объектов попадёт в параметр только первая ссылка. Видимо система сама проставляет значение "Множественный" когда мы делаем печать через конструктор.</p>
    <p>Рядом создадим ещё одну процедуру "ПечатьТорг12", которая будет выполняться на сервере и запрашивать данные из БД и размещать их в табличном документе. Чтобы вручную всё не писать в конструкторе запроса поставим галочку "Выводить в табличный документ".</p>
    <p>Код модуля команды:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ОбработкаКоманды<span class="vue-r">(</span>ПараметрКоманды<span class="vue-r">,</span> ПараметрыВыполненияКоманды<span class="vue-r">)</span>
                ТабДок <span class="vue-r">= Новый</span> ТабличныйДокумент<span class="vue-r">;</span>
                ПечатьТорг12<span class="vue-r">(</span>ПараметрКоманды<span class="vue-r">,</span> ТабДок<span class="vue-r">);</span>
                ТабДок<span class="vue-r">.</span>Показать<span class="vue-r">();		
            КонецПроцедуры 

            &НаСервере
            Процедура</span> ПечатьТорг12<span class="vue-r">(</span>ПараметрКоманды<span class="vue-r">,</span> ТабДок<span class="vue-r">)</span>
                Макет <span class="vue-r">=</span> Документы<span class="vue-r">.</span>ПродажаТоваров<span class="vue-r">.</span>ПолучитьМакет<span class="vue-r">(</span><span class="vue-bl">"МакетТорг12"</span><span class="vue-r">);</span>
                Запрос <span class="vue-r">= Новый</span> Запрос<span class="vue-r">;</span>
                Запрос<span class="vue-r">.</span>Текст <span class="vue-r">=</span> 
                    <span class="vue-bl">"ВЫБРАТЬ
                    |	ПродажаТоваровТовары.Номенклатура КАК Номенклатура,
                    |	ПРЕДСТАВЛЕНИЕ(ПродажаТоваровТовары.Номенклатура) КАК НоменклатураПредставление,
                    |	ПродажаТоваровТовары.Цена КАК Цена,
                    |	ПродажаТоваровТовары.Количество КАК Количество,
                    |	ПродажаТоваровТовары.Всего КАК Всего
                    |ИЗ
                    |	Документ.ПродажаТоваров.Товары КАК ПродажаТоваровТовары
                    |ГДЕ
                    |	ПродажаТоваровТовары.Ссылка = &Ссылка"</span><span class="vue-r">;</span>
                
                <span class="vue-g">//если мы кликаем на кнопку "ПечатьТорг12" из формы документа, то в параметре
                //ПараметрКоманды лежит ссылка на этот объект документа</span>
                Запрос<span class="vue-r">.</span>УстановитьПараметр<span class="vue-r">(</span><span class="vue-bl">"Ссылка"</span><span class="vue-r">,</span> ПараметрКоманды<span class="vue-r">);</span> 
                РезультатЗапроса <span class="vue-r">=</span> Запрос<span class="vue-r">.</span>Выполнить<span class="vue-r">();</span>
                
                ОбластьЗаголовок <span class="vue-r">=</span> Макет<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"Заголовок"</span><span class="vue-r">);</span>
                ОбластьПодвал <span class="vue-r">=</span> Макет<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"Подвал"</span><span class="vue-r">);</span>
                ОбластьШапкаТаблицы <span class="vue-r">=</span> Макет<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"ШапкаТаблицы"</span><span class="vue-r">);</span>
                ОбластьПодвалТаблицы <span class="vue-r">=</span> Макет<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"ПодвалТаблицы"</span><span class="vue-r">);</span>
                ОбластьДетальныхЗаписей <span class="vue-r">=</span> Макет<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"Детали"</span><span class="vue-r">);</span>
                
                ТабДок<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>
                ТабДок<span class="vue-r">.</span>Вывести<span class="vue-r">(</span>ОбластьЗаголовок<span class="vue-r">);</span>
                ТабДок<span class="vue-r">.</span>Вывести<span class="vue-r">(</span>ОбластьШапкаТаблицы<span class="vue-r">);</span>
                ТабДок<span class="vue-r">.</span>НачатьАвтогруппировкуСтрок<span class="vue-r">();</span>
                
                ВыборкаДетальныеЗаписи <span class="vue-r">=</span> РезультатЗапроса<span class="vue-r">.</span>Выбрать<span class="vue-r">();</span>
                
                <span class="vue-r">Пока</span> ВыборкаДетальныеЗаписи<span class="vue-r">.</span>Следующий<span class="vue-r">() Цикл</span>
                    ОбластьДетальныхЗаписей<span class="vue-r">.</span>Параметры<span class="vue-r">.</span>Заполнить<span class="vue-r">(</span>ВыборкаДетальныеЗаписи<span class="vue-r">);</span>
                    ТабДок<span class="vue-r">.</span>Вывести<span class="vue-r">(</span>ОбластьДетальныхЗаписей<span class="vue-r">,</span> ВыборкаДетальныеЗаписи<span class="vue-r">.</span>Уровень<span class="vue-r">());
                КонецЦикла;</span>
                
                ТабДок<span class="vue-r">.</span>ЗакончитьАвтогруппировкуСтрок<span class="vue-r">();</span>
                ТабДок<span class="vue-r">.</span>Вывести<span class="vue-r">(</span>ОбластьПодвалТаблицы<span class="vue-r">);</span>
                ТабДок<span class="vue-r">.</span>Вывести<span class="vue-r">(</span>ОбластьПодвал<span class="vue-r">);
            КонецПроцедуры</span></span>
        </pre>
    </div>

    










    <h3 class="header-style" id="obj-data">Объектные и не объектные данные в БД</h3>
    <p>Все данные, которые 1С:Предприятие сохраняет в базе данных, можно разделить на две большие группы: <i>объектные данные</i> и <i>не объектные данные</i>. Разницу между ними легко будет понять, если взять пример с комнатами, в которых находятся люди. Каждая комната это объект конфигурации(Справочник, Документ), а люди в комнатах это объекты данных(Элемент справочника или объект документа). Так вот. Бывают ситуации, когда для вас важно, какие именно это люди. Например,вы позвали гостей на день рождения. В этом случае для вас важно, чтобы к вам в гости пришёл именно Серёжа Соколов, который учится или работает вместе с вами. А не какой-то его тёзка или однофамилец. Который, может быть, и одет так же, и внешне на негопохож. В этом случае ваши гости являются объектными данными. Каждый из них уникалени важен сам по себе. Даже если он оделся в другую одежду и сильно вырос за то время,что вы его не видели. Всё равно он остался Серёжей Соколовым, а не стал кем-то другим.</p>
    <p>Другая ситуация. Вы заходите в маршрутку или автобус, и вам нужно понять, много там пассажиров или нет. Поедете вы на этом автобусе или подождёте следующего. В этом случае вам совершенно не важно, какие именно люди находятся в автобусе, как их зовут. Не важно, кто именно стоит в проходе с большими сумками, Сергей Николаевич или Марья Ивановна. Важно только то, что проход занят и дальше пройти нельзя.В этом случае пассажиры автобуса являются не объектными данными. Их уникаль-ность не имеет для вас никакого значения. Важно лишь, что они есть и что они занимают место в автобусе.</p>
    <p>Какие данные в 1С:Предприятии объектные, а какие не объектные, понять очень просто. Это зависит от того объекта конфигурации, которому они принадлежат.Если это справочник или документ, то в них всегда хранятся только объектные данные.Если это регистр сведений или регистр накопления, то в них бывают только не объектные данные.</p>
    <p>Кроме справочников и документов для описания объектных данных используются планы видов характеристик, планы счетов, планы видов расчёта, бизнес-процессы, задачи, планы обмена. Для описания не объектных данных кроме перечисленных регистров используются регистры бухгалтерии, регистры расчёта, последовательности и перерасчёты регистров расчёта.
    </p>













    <h3 class="header-style" id="14">Объект встроенного языка УправляемаяФорма</h3>
    <p>Поскольку мы находимся в модуле формы, то в нём доступны все свойства и методы объекта встроенного языка <b>УправляемаяФорма</b>. Поэтому мы можем обращаться к ним напрямую. Чтобы получить коллекцию элементов формы, используем одно из свойств объекта УправляемаяФорма – свойство <b>Элементы</b>. Свойство Элементы содержит коллекцию всех элементов управляемой формы для прямого доступа вне зависимости от иерархии. Доступно только для чтения. Коллекция имеет тип - ВсеЭлементыФормы, содержащая все элементы формы. То есть это программный аналог корня дерева элементов формы. Каждый элемент формы можно получить, указав его имя в качестве свойства этого объекта, то есть через точку от него.</p>
    <p>Назначение обработчика для формы и её элементов может выполняться интерактивно, при работе с формой в конфигураторе, или программно, используя методы формы и ее элементов – <b>УстановитьДействие()</b>.</p>
    <p>Помимо того что форма внутри своего модуля предоставляет доступ к различным частям конфигурации, она также доступна из других частей конфигурации как программный объект. Например, если в модуле формы ФормаДокумента(имя созданной формы документа) документа ПриходнаяНакладная описана экспортируемая процедура ИмяПроцедуры(), то мы можем вызвать эту процедуру из других частей конфигурации. Ну например, откроем модуль управляемого приложения и там напишем вызов этой процедуры:</p>
    <p>Помимо описания переменных и основной программы, модуль формы может содержать описание процедур – обработчиков событий, связанных с формой. Основными событиями, которые могут обрабатываться в модуле формы, являются события открытия и закрытия окна формы.</p>
    <div class="code-style">
        <pre>
            //в переменную Форма вернётся объект УправляемаяФорма
            //и у этого объекта мы можем вызвать нашу пользовательскую процедуру, описанную в модуле формы
            <span class="vue-b"><b>Форма = ПолучитьФорму("Документ.ПриходнаяНакладная.Форма.ФормаДокумента");
            Форма.ИмяПроцедуры();
            </b></span>
        </pre>
    </div>
    <p>В примере ниже мы выбираем из коллекции элементов(сво-во Элементы объекта УправляемаяФорма) табличную часть и считываем из неё данные для работы с ними.</p>

    <p class="title-size16"><b id="14a">Получение данных полей табличной части из элементов формы документа</b></p>
    <p>Табличная часть документа представляет собой объект встроенного языка <b>ТаблицаФормы</b>. Получить ту строку, в которой в настоящее время осуществляется редактирование, можно при помощи свойства программного объекта ТаблицаФормы – <b>ТекущиеДанные</b>.</p>
    <p>Допустим создали объект конфигурации документ ПоступлениеТоваров. В пользовательской части мы хотели бы создать документ пришедшего товара, откуда и куда, его стоимость и количество, а также общая сумма. Таких полей у нас в форме документа пока нет. Идё во вкладку "Данные" и создадим 2 реквизита - Фирма(откуда) и Подразделение(Куда), ниже реквизитов добавим табличную часть и в ней добавим также поля - Товар, Цена, Количнство, Сумма. Всё, идём в пользовательскую часть и заполним первый товар. При заполнении табличной части мы указали Цена и Количество, но при заполнении Сумма нужно самому посчитать общую сумму товаров, т.е. цену нужно умножить на количество. Мы хотим автоматизировать этот участок, чтобы при изменении либо Цены, либо Количества Сумма менялась и подсчитывалась автоматом. Для этого идё в форму редактирования документа(не в форму списка документа) и во вкладке "Элементы" Находим нашу табличную часть, которая называется "ПереченьТоваров" и в ней находим элемент ПереченьТоваровКоличество(название поля табличной части автоматом добавляется именем табличной части), заходим в свойства этого элемента и в самом низу будут события элемента. Надо найти событие "ПриИзменении" и жмём лупу у него, откроется модуль формы.В процедуре на клиенте нужно получить данные поля Цена и Количества, посчитать их и записать в поле Сумма. Вот 2 способа найти эти данные:</p>
    <div class="code-style">
        <pre>
            <span class="vue-r">&НаКлиенте</span>
            <span class="vue-b"><b>Процедура ПереченьТоваровКоличествоПриИзменении(Элемент)
                <span class="vue-g"><b>//первый способ получение данных через элементы формы
                //в элементах есть табличная часть ПереченьТоваров, в этой таблице есть строки
                //с данными товара, при срабатывании события "ПриИзменении" мы будем находиться
                //на одной из этих строк, а значит нам надо получить данные текущей строки
                //и для этого есть свойство ТекущиеДанные
                //в итоге возвращается объект, который имеет тип ДанныеФормыЭлементКоллекции
                //Элементы.Материалы вернёт объект ТаблицаФормы, у которой вызываем свойство Текущие данные
                //какие ещё есть свойства и методы у ТаблицаФормы смотрим с помошнике</b></span>
                СтрокаТабЧасти = Элементы.ПереченьТоваров.ТекущиеДанные;
                СтрокаТабЧасти.Сумма = СтрокаТабЧасти.Цена * СтрокаТабЧасти.Количество;
                
                
                <span class="vue-g"><b>//второй способ через реквизиты	
                //Объект.ПереченьТоваров[0] также возвращает ДанныеФормыЭлементКоллекции
                //ВАЖНО!!! Этот способ не совсем верный. Как оказалось при добавлении в табличную
                //часть ещё одного товара и заполнении Цены и Количества Сумма уже автоматом не 
                //считается, потому как я получаю только первую строку из таблицы и считываю только в ней
                //можно конечно сделать цикл и пробежать по всем элементам и посчтитать
                //Для каждого СтрокаТабЧасти Из Объект.ПереченьТоваров Цикл
                //    СтрокаТабЧасти.Сумма = СтрокаТабЧасти.Количество * СтрокаТабЧасти.Цена;	
                //КонецЦикла;
                //Кстати у табличной части есть метод <span class="vue-b">Итог(колонка)</span>, который подсчитывает сумму значений переданной колонки.
                //Например, есть у нас колонка Количество или Цена и передав имя колонки нам метод сам подсчитает их сумму</b></span>
            КонецПроцедуры</b></span>
        </pre>
    </div>
    <p>Также не забываем повесить на элемент таблицы ПереченьТоваровЦена обработчик, который выше в процедуре по событию "ПриИзменении". Согласно стандартам 1С, то на каждое событие ннужно вешать свой обработчик, поэтому для поля Цена повесим также отдельный обработчик, но внутри у этой процедуры будет тоже что и для Количества.</p>

    <p class="title-size16"><b id="14b">Выносим процедуру подсчёта суммы в Общие Модули</b></p>
    <p>Так как такая процедура, подсчитывающая сумму может понадобиться не только для документа ПоступлениеТоваров, но также и для других объектов, то лучше всего вынести эту процедуру в Общие Модули.</p>
    <p>Зайдём в Общие Модули и добавим Общий Модуль, дадим имя ему "РаботаСДокументами", поставим галочку "Клиент(управляемое приложени)", а с "Сервер" галочку снимем. Это означает, что объекты этого модуля будут собраны в контексте тонкого клиента и веб-клиента(что это значит, пока не знаю, из учебника предложение взял). Напишем нашу процедуру:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><b>
                Процедура РассчитатьСумму(СтрокаТабЧасти) Экспорт
                    СтрокаТабЧасти.Сумма = СтрокаТабЧасти.Количество * СтрокаТабЧасти.Цена;
                КонецПроцедуры
            </b></span>
        </pre>
    </div>
    <p>Теперь перепишем нашу процедуру в форме документа:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><b>
                &НаКлиенте
                Процедура ПереченьТоваровКоличествоПриИзменении(Элемент)
                    СтрокаТабЧасти = Элементы.Материалы.ТекущиеДанные;
                    РаботаСДокументами.РассчитатьСумму(СтрокаТабЧасти);
                КонецПроцедуры

                &НаКлиенте
                Процедура ПереченьТоваровЦенаПриИзменении(Элемент)
                    СтрокаТабЧасти = Элементы.Материалы.ТекущиеДанные;
                    РаботаСДокументами.РассчитатьСумму(СтрокаТабЧасти);
                КонецПроцедуры

            </b></span>
        </pre>
    </div>

    <p class="title-size16"><b id="14c">Свойства и методы управляемой формы</b></p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//делает доступным или нет поле Контрагент</span>
            <span class="vue0b"><b>Элементы.Контрагент.Доступность = Истина</b></span>

            <span class="vue-g">//делает видимым или нет поле Контрагент</span>
            <span class="vue0b"><b>Элементы.Контрагент.Видимость = Истина</b></span>
        </pre>
    </div>



















    <h3 class="header-style" id="15">Модули</h3>
    <p class="title-size16"><b id="gc">Глобальный контекст</b></p>
    <p>Глобальный контекст это набор свойств, процедур и функций, которые доступны в любых модулях конфигурации. Какие то наборы доступны на клиенте, какие то на сервере, а какие то и там и там. На сервере, например, доступны такие свойства как Справочники, Документы, РегистрыНакопления и т.д. Эти свойства возвращают объект, который сам по себе практически никогда не используется. Он содержит в себе коллекцию менеджеров, управляющих конкретными справочниками, документами и так далее.</p>

    <p>В конфигурации существуют различные виды модулей. Они могут принадлежать некоторым объектам конфигурации (например, формам), а могут существовать сами по себе (принадлежать всей конфигурации в целом). Текст программы, содержащийся в модулях, будет использоваться платформой в заранее известные моменты работы системы «1С:Предприятие»</p>

    <p class="title-size16"><b id="15a">Модуль управляемого приложения.</b></p>
    <p>Модуль управляемого приложения выполняется при начале и окончании работы системы «1С:Предприятие» в режимах тонкого клиента и веб-клиента.</p>
    <p>В нем возможно объявление переменных, а также объявление и описание процедур и функций, которые будут доступны в любом модуле конфигурации (кроме модуля внешнего соединения). Их доступность также обеспечивается для неглобальных общих модулей с установленным свойством Клиент (управляемое приложение). В контексте модуля управляемого приложения доступны экспортируемые процедуры и функции общих модулей. В контексте модуля управляемого приложения доступны экспортируемые процедуры и функции общих модулей.</p>
    <p>Также модуль управляемого приложения всегда исполняется на клиенте(в контексте клиента)</p>

    <p class="title-size16"><b id="15b">Общие модули.</b></p>
    <p>В общих модулях хранятся процедуры и функции, которые вызываются из других модулей системы. Сам по себе общий модуль не исполняется. Исполняются отдельные его процедуры/ функции в момент их вызова из других модулей. </p>
    <p>Общие модули не существуют в конфигурации заранее. Мы их создаём сами. Столько, сколько нам нужно. Общие модули доступны из всех других модулей конфигурации. В общих модулях мы можем описывать собственные алгоритмы, которые мы используем в разных местах конфигурации. Общему модулю можно указать, где он будет исполняться: на клиенте или на сервере. Поэтому ещё одно назначение общих модулей заключается в том, что именно с их помощью вы можете перейти на сервер. Например, чтобы получить какие-то данные из базы данных.</p>
    <p>После добавления своего общего модуля мы хотим, чтобы он исполнялся на сервере, значит в палитре свойств нужно поставить галочку "Сервер". Также если нам нужно вызвать процедуру общего модуля из клиентского модуля, например, модуля управляемого приложения, то нужно ещё поставить галочку "Вызов сервера" в свойствах общего модуля(ЭТО ВАЖНО, иначе будет ошибка и мы не сможем вызвать процедуру из клиентского модуля). Для процедур общего модуля нужно указать слово <i>Экспорт</i>. Ключевое слово Экспорт позволяет расширить область видимости этой процедуры. Без этого слова процедура видна только в пределах этого модуля. А с этим словом процедура станет видна и из других модулей нашей конфигурации.</p>
    <p>Чтобы вызвать из клиентского модуля приложения процедуру из общего модуля нужно указать имя общего модуля, затем через точку имя процедуры.</p>
    <p>Вот пример работы с общим модулем - <a href="#konst2">сюда</a>.</p>

    <p class="title-size16"><b id="15c">Модуль объекта. Что такое ДокументМенеджер и ДокументОбъект</b></p>
    <p>Модули всех объектов существуют только на сервере. Поэтому в них можно использовать только те процедуры, функции и объекты встроенного языка, которые доступны в контексте сервера.</p>
    <p>Модуль объекта собирается и исполняется тогда, когда программно создается элемент справочника или документа средствами встроенного языка, например, методами <span class="vue-b"><b>СоздатьЭлемент()</b></span> менеджера справочника или <span class="vue-b"><b>СоздатьДокумент()</b></span> менеджера документа, либо когда пользователь создает новый элемент справочника или документа при нажатии на кнопку Создать в пользовательской части. Также модуль исполняется при открытии формы уже созданного документа, пометке/снятии документа на удаление в форме списка документа.</p>
    <p>При записи измененных данных объекта в базу данных вызываются различные обработчики событий, которые располагаются в модуле объекта. </p>
    <p>Также в модуле объекта документа мы можем просто описывать свои процедуры и функции. Указав этим процедурам ключевое слово Экспорт, эти процедуры становятся методами данного документа, который и вызвал этот модуль. Пока я понял это так, если не прав перепишу. Чтобы вызывать эти процедуры и функции из модуля, ну например, из формы документа, нам нужен сам документ объект. Как его получить в форме? Есть метод, который позволяет это сделать. Этому методу нужно передать в строке реквизит формы - Объект. Если в форме во вкладке реквизиты посмотреть тип реквизита Объект(справа написан), то там в скобках написано, что это ДокументОбъект.&lt;ИмяДокумента>, но это не так. На самом деле тип у этого реквизита - ДанныеФормыСтруктура. Так вот мы с помощью этого метода можем перевести этот реквизит Объект в настоящий тип ДокументОбъект:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//переводим ревизит в другой тип</span>
            <span class="vue-b">ДокументОбъект = РеквизитФормыВЗначение("Объект");

            <span class="vue-g">//затем вызываем нашу процедуру из модуля объекта
            //которая изменяет данные и записываем их в БД</span>
            ДокументОбъект.ЗаполнитьЦеныТоваровПоПоставщику();

            <span class="vue-g">//мы изменили табличную часть документа на сервере
            //и записали новые данные в таблицу
            //и нам нужно вернуть изменёные данные обратно на форму
            //для этого на сервере переводим реквизит Объект
            //назад в тип понятный форме(ДанныеФормыСтруктура) и возвращаем его форме с новыми данными</span>
            ЗначениеВРеквизитФормы(ДокументОбъект, "Объект");</span>
        </pre>
    </div>
    <p>Когда ещё появляется ДокументОбъект? Вроде на первый мой взгляд казалось, что можно получить ДокументОбъект через Документы.&lt;ИмяДокумента>, но возвращается объект типа ДокументМенеджер. Что такое ДокументМенеджер? Описываю как я пока понимаю. Вот создали мы новый объект конфигурации - документ "ПоступлениеТоваров", мы создали, если можно так выразиться, оболочку, которая называется ДокументМенеджер. Эта оболочка содержит свойства и методы для управления внутри себя объектами данных документа этого вида. Можно сказать, что ДокументМенеджер это таблица в целом, а документ объекты это записи(строки) в этой таблице. Отсюда вывод, что можно создать программно ДокументОбъект через встроенный метод ДокументМенеджера:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//этот ДокументОбъект, в отличии от примера выше, пустой и его можно заполнять</span>
            <span class="vue-b">ДокументОбъект = Документы.ПоступлениеТоваров.СоздатьДокумент();
            ДокументОбъект.Дата = ТекущаяДата();
            ДокументОбъект.Номер = "000000001";
            и т.д.
            ДокументОбъект.ЗаполнитьЦеныТоваровПоПоставщику();
            ДокументОбъект.Записать();  - если хотим просто записать в базу
            ДокументОбъект.Движения...;  -  если хотим начать записывать в регистр</span>
        </pre>
    </div>
    <p>Чтобы открыть модуль объекта, нужно в окне редактирования объекта конфигурации перейти на закладку Прочее и нажать кнопку Модуль объекта. Или, выделив нужный объект в дереве объектов конфигурации, вызвать из контекстного меню команду Открыть модуль объекта.</p>

    <p class="title-size16"><b id="15d">Модули форм.</b></p>
    <p>Каждая форма, определенная в конфигурации, имеет свой собственный модуль. Этот модуль исполняется при создании объекта от класса <i style="text-decoration:underline;">ФормаКлиентскогоПриложения</i> встроенного языка. Этот объект создается системой в режиме 1С:Предприятие в тот момент, когда мы программно (методами  <span class="vue-b"><b>ПолучитьФорму()</b></span> или <span class="vue-b"><b>ОткрытьФорму()</b></span>) или интерактивно открываем форму некоторого элемента.</p>

    <p class="title-size16"><b id="15e">Модуль сеанса</b>.</p>
    <p>Модулем сеанса называется модуль, который автоматически выполняется при старте системы «1С:Предприятие» в момент загрузки конфигурации. Модуль сеанса предназначен для инициализации параметров сеанса и отработки действий, связанных с сеансом работы. Модуль сеанса не содержит экспортируемых процедур и функций и может использовать процедуры из общих модулей конфигурации.</p>

    <p class="title-size16"><b id="15f">Модуль внешнего соединения</b></p>
    <p>Предназначен для размещения в нем текстов функций и процедур, которые могут вызываться в сессии внешнего соединения.</p>

    <p class="title-size16"><b id="15g">Модуль менеджера</b></p>
    <p>В этом модуле содержатся вспомогательные процедуры и функции.</p>
    <p> Для каждого прикладного объекта существует менеджер, предназначенный для управления этим объектом как объектом конфигурации. С помощью менеджера можно создавать объекты, работать с формами и макетами. Модуль менеджера позволяет расширить функциональность менеджеров, предоставляемых системой, за счет написания процедур и функций на встроенном языке.</p>
    <p>Фактически это позволяет описать собственные методы для объекта конфигурации (например, справочника), которые относятся не к конкретному экземпляру объекта базы данных, а к самому объекту конфигурации. Например, в модуле менеджера можно задать произвольное представление объекта в интерфейсе «1С:Предприятия».</p>
    <p>Открыть этот модуль можно там же где и модуль объекта - Прочее - Модуль менеджера.</p>
    <p>Тут ещё немного объясняется про модуль менеджера, прочитать там надо всё, чтобы понять. <a href="#21">Тут</a>.</p>

    <p class="title-size16"><b id="15h">Модуль команды</b>.</p>
    <p>Модуль команды, в отличие от других модулей, существует и на клиенте, и на сервере. Поэтому в нём для каждой процедуры в отдельности нужно указывать, в каком контексте она будет исполняться.</p>
    <p>Как в самой конфигурации, так и у многих прикладных объектов, могут существовать подчиненные объекты конфигурации – Команды. У каждой команды существует модуль команды, в котором можно описать предопределенную процедуру <span class="vue-b"><b>ОбработкаКоманды()</b></span> для выполнения этой команды. Чтобы открыть модуль команды, подчиненной некоторому объекту конфигурации, нужно в окне редактирования объекта конфигурации перейти на закладку Команды и дважды щелкнуть мышью на нужной команде. Или, выделив нужную команду в дереве объектов конфигурации, вызвать из контекстного меню команду Добавить.</p>
    <p>Если создать объект(кнопку) объекта конфигурации Команды у справочника Номенклатура и назвать его, например, Печать, то для этой команды есть событие "ОбработкаКоманды" и одноимённый обработчик, который мы можем описать в модуле этой команды. У этого обработчика по умолчанию есть 2 параметра - "ПараметрыКоманды" и "ПараметрыВыполненияКоманды". 2й параметр я пока не знаю, что там, а вот 1й парамет это массив, в который попадают ссылки. Например, открыли мы форму элемента справочника и там уже есть команда Печать, нажимаем на неё и срабатывает наш обработчик и в параметр "ПараметрыКоманды" в массив попадает ссылка на этот элемент справочника. Когда мы откроем форму списка этого справочника и выделим несколько элементов справочника в списке и нажмём Печать, то в параметр "ПараметрыКоманды" попадут все выделенные ссылки.</p>
















    <h3 class="header-style" id="17">Анализ кода с помощью синтакс-помощника</h3>
    <p>На странице 177 учебника Хрусталёвой есть описание того, как если бы мы увидели незнакомый код и как в нём разобраться с помощью синтакс помошника</p>









    <h3 class="header-style" id="18">Анализ кода с помощью отладчика</h3>
    <p>В том же учебнике, страница 192</p>







    <h3 class="header-style" id="19"></h3>





    









    
    <h3 class="header-style" id="21"></h3>











    
    <h3 class="header-style" id="23"></b></h3>
    













    <h3 class="header-style" id="24">Директивы &НаСервере, &НаСервереБезКонтекста</h3>
    <p>Когда мы вызываем процедуру с директивой &НаСервере, то на сервер система сама передаёт все данные формы. На сервере будут доступны свойства и методы объектов ЭтаФорма, Элементы и основного реквизита формы(Список, Объект, НаборКонстант и т.д.), на сервере операции применятся если нужно и форма вернётся уже обновлённой.</p>
    <p>Чтобы в синтакс помошнике отображать только те объекты, которые рабаотаеют на сервере или на клиенте можно нажать на "гаечный ключ" по середине в помошнике, либо Сервис - Параметры - Справка.</p>
    <p>Про директивы мы можем прочитать в синтакс-помощнике в разделе Общее описание встроенного языка - Директивы компиляции.</p>




</div>
