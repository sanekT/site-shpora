
<div class="wrap">

    <p>Перейти к оглавлению:</p>
    <ul class="list">
        <li><a href="#chap2">Часть 2</a></li>
        <li><a href="#chap3">Часть 3</a></li>
        <li><a href="#chap4">Часть 4</a></li>
    </ul>





    <h3 class="header-style2">Часть 1. Устройство системы компоновки данных.</h3>
    <ul class="list">
        <li><a href="#chapter1">Вступление</a></li>
        <li><a href="#chapter1.1">Схема компоновки данных</a>
            <ul class="list2">
                <li><a href="#chapter1.1.1">Наборы данных</a></li>
                <li><a href="#chapter1.1.2">Связи наборов данных</a></li>
                <li><a href="#chapter1.1.3">Вычисляемые поля</a></li>
                <li><a href="#chapter1.1.4">Ресурсы</a></li>
                <li><a href="#chapter1.1.5">Параметры</a></li>
                <li><a href="#chapter1.1.6">Макеты</a></li>
                <li><a href="#chapter1.1.7">Вложенные схемы</a></li>
                <li><a href="#chapter1.1.8">Настройки</a></li>
            </ul>
        </li>
    </ul>






    <h3 class="header-style2">Часть 2. Примеры разработки отчётов.</h3>
    <ul class="list">
        <li><a href="#chapter2">Вступление</a></li>
        <li><a href="#chapter2.1">Исходные данные для примеров</a></li>
        <li><a href="#chapter2.2">Пример 1. Набор данных - запрос</a>
            <ul class="list2">
                <li><a href="#chapter2.2.1">Наглядное составление отчёта</a></li>
                <li><a href="#chapter2.2.2">Варианты отчёта</a></li>
                <li><a href="#chapter2.2.3">Настройки отдельных группировок</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.3">Пример 2.</a>
            <ul class="list2">
                <li><a href="#chapter2.3.1">Вычисляемые поля</a></li>
                <li><a href="#chapter2.3.2">Парметры. Период отчёта</a></li>
                <li><a href="#chapter2.3.3">Быстрые пользовательские настройки</a></li>
                <li><a href="#chapter2.3.4">Системные поля</a></li>
                <li><a href="#chapter2.3.5">Обязательность использования параметров</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.4">Пример 3. Связь набора данных</a></li>
        <li><a href="#chapter2.5">Пример 4. Связь таблиц внутри набора данных</a>
            <ul class="list2">
                <li><a href="#chapter2.5.1">Связывание таблиц в запросе</a></li>
                <li><a href="#chapter2.5.2">Программный запуск отчёта</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.6">Пример 5. Набор данных  - объединение</a></li>
        <li><a href="#chapter2.7">Пример 6. Автоматическое формирование отчёта</a></li>
        <li><a href="#chapter2.8">Пример 7.</a>
            <ul class="list2">
                <li><a href="#chapter2.8.1">Передача параметров в запрос набора данных</a></li>
                <li><a href="#chapter2.8.2">Программная установка параметров отчёта</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.9">Пример 8.</a>
            <ul class="list2">
                <li><a href="#chapter2.9.1">Извлечение данных по периодам</a></li>
                <li><a href="#chapter2.9.2">Интерактивное оформление отчета</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.10">Пример 9. Свободная структура таблицы отчёта</a></li>
        <li><a href="#chapter2.11">Пример 10.</a>
            <ul class="list2">
                <li><a href="#chapter2.11.1">Связь наборов данных по периодам</a></li>
                <li><a href="#chapter2.11.2">Функциональные опции</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.12">Пример 11.</a>
            <ul class="list2">
                <li><a href="#chapter2.12.1">Характеристики в отчёте</a></li>
                <li><a href="#chapter2.12.2">Вывод данных в диаграмму</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.13">Пример 12.</a>
            <ul class="list2">
                <li><a href="#chapter2.13.1">Детализация в выбранном периоде</a></li>
                <li><a href="#chapter2.13.2">Выражения для представления полей</a></li>
                <li><a href="#chapter2.13.3">Характеристики в метаданных</a></li>
                <li><a href="#chapter2.13.4">Вывод всех дат в периоде</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.14">Пример 13.</a>
            <ul class="list2">
                <li><a href="#chapter2.14.1">Пользовательские поля</a></li>
                <li><a href="#chapter2.14.2">Вложенный отчет</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.15">Пример 14.</a>
            <ul class="list2">
                <li><a href="#chapter2.15.1">Расчет итогов по полям остатка</a></li>
                <li><a href="#chapter2.15.2">Вывод в диаграмму нескольких ресурсов</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.16">Пример 15.</a>
            <ul class="list2">
                <li><a href="#chapter2.16.1">Набор данных – объект</a></li>
                <li><a href="#chapter2.16.2">Программная компоновка</a></li>
                <li><a href="#chapter2.16.3">Общий макет оформления</a></li>
                <li><a href="#chapter2.16.4">Макет оформления в схеме компоновки</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.17">Пример 16.</a>
            <ul class="list2">
                <li><a href="#chapter2.17.1">Вывод иерархических данных</a></li>
                <li><a href="#chapter2.17.2">Вывод данных в собственной иерархии</a></li>
                <li><a href="#chapter2.17.3">Стандартная расшифровка полей отчета</a></li>
                <li><a href="#chapter2.17.4">Переопределение поля для расшифровки</a></li>
                <li><a href="#chapter2.17.5">Изменение действий расшифровки</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.18">Пример 17.</a>
            <ul class="list2">
                <li><a href="#chapter2.18.1">Язык выражений</a></li>
                <li><a href="#chapter2.18.2">Вывод отчета в общую форму</a></li>
                <li><a href="#chapter2.18.3">Фоновое выполнение отчета</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.19">Пример 18. Работа с системой компоновки данных из встроенного языка</a>
            <ul class="list2">
                <li><a href="#chapter2.19.1">Заполнение наборов данных и компоновка отчета</a></li>
                <li><a href="#chapter2.19.2">Настройка отчета</a></li>
                <li><a href="#chapter2.19.3">Описание схемы компоновки данных</a></li>
            </ul>
        </li>
        <li><a href="#chapter2.20">Пример 19. Консоль системы компоновки данных</a></li>
    </ul>



    <h3 class="header-style2">Часть 2. Примеры разработки отчётов.</h3>









    <h2 class="header-style" id="chapter1">Часть 1. Устройство системы компоновки данных.</h2>
    <p>В данной главе описывается общее устройство системы компоновки данных, рассматривается последовательность и назначение каждого этапа компоновки. Подробно описываются все составляющие схемы компоновки данных, структура отчета и его настроек.</p>
    <p><i>Система компоновки данных</i> – мощный и гибкий инструмент для создания отчетов на основе их декларативного описания. Использование декларативного описания отчетов позволяет воплотить следующие возможности:</p>
    <ul class="list">
        <li>создание отчета без программирования,</li>
        <li>возможность создания различных вариантов отчета,</li>
        <li>возможность задания различных вариантов пользовательских настроек,</li>
        <li>использование автоматически генерируемых форм просмотра и настройки отчета,</li>
        <li>разбиение исполнения отчета на этапы,</li>
        <li>исполнение отдельных этапов построения отчета на различных компьютерах,</li>
        <li>независимое использование отдельных частей системы компоновки данных,</li>
        <li>программное влияние на процесс выполнения отчета,</li>
        <li>настройки структуры отчета,</li>
        <li>совмещение в отчете нескольких таблиц,</li>
        <li>создание вложенных отчетов и др.</li>
    </ul>
    <p>Система компоновки данных состоит из набора элементов, каждый
     из которых имеет свое декларативное описание, возможность программного доступа и сериализации, то есть сохранения в XML или загрузки из XML. Это позволяет гибко управлять всеми этапами выполнения отчета.</p>
    <p>Формирование отчета с использованием системы компоновки данных разбивается на несколько этапов. При этом разбиение на этапы – не логическое, а физическое. То есть в каждый из этих этапов разработчик может вмешаться, программно или визуально, выполнить различные этапы компоновки данных в различных модулях и даже на различных компьютерах:</p>
    <img src="../img/1С-1/2024-05-02_08-35-56.png" alt="">
    <p>На схеме представлены следующие этапы формирования отчета:</p>
    <ol class="list">
        <li>Разработчик создает <i>схему компоновки данных</i> и <i>стандартные настройки компоновки</i>, которые содержат полную информацию о компоновке.</li>
        <li>На основе схемы компоновки данных и настроек компоновки <i>компоновщик макета</i> создает <i>макет компоновки данных</i>, который является уже готовым заданием для процессора компоновки. </li>
        <li><i>Процессор компоновки данных</i> в соответствии с макетом компоновки извлекает данные из информационной базы, агрегирует, оформляет эти данные и формирует результат компоновки. Результат компоновки состоит из массива элементов, которые можно получать последовательно, но в большинстве случаев результат компоновки получается целиком.</li>
        <li><i>Процессор вывода</i> обрабатывает <i>результат компоновки</i> и выводит его в различные форматы:
            <ul class="list">
                <li>табличный документ,</li>
                <li>HTML-документ,</li>
                <li>таблица значений,</li>
                <li>дерево значений.</li>
            </ul>
        </li>
    </ol>
    <p>Процесс разработки отчета с помощью системы компоновки данных и его дальнейшего использования на практике реализуется следующим образом.</p>
    <p>Исходя из прикладной задачи, для которой разрабатывается отчет, разработчик создает схему компоновки данных, в которой описывает наборы данных, связи между ними, определяет поля отчета, параметры получения данных и т.п., а также задает <i>стандартные настройки компоновки данных</i> – структуру отчета, порядок, отбор и другие.</p>
    <p>У каждого отчета разработчик может предусмотреть несколько вариантов настроек, представляющих данные в виде диаграммы, таблицы или группировок, имеющих различный состав полей, итогов и т. п. Разработчик может описать, какие настройки отчета будут доступны пользователю (пользовательские настройки) и какие из этих настроек будут присутствовать прямо в форме отчета (быстрые пользовательские настройки). С их помощью пользователь может настроить вариант отчета под себя и сохранить его для дальнейшего использования.</p>
    <p>Пользователь запускает отчет. При его формировании выполняется программная компоновка данных и вывод результатов компоновки пользователю. Данные в отчете выводятся в соответствии со стандартными настройками для основного варианта отчета.</p>
    <p>Пользователь может выбрать вариант отчета, являющийся с его точки зрения наиболее информативным, а может, при желании и соответствующей квалификации, задать собственные настройки и получить другой отчет, основанный на той же схеме компоновки данных. При этом данные будут представлены в соответствии с пользовательскими настройками.</p>
    <p>Таким образом, на основе одной схемы компоновки данных может быть получено множество различных отчетов. Применение настроек компоновки данных, созданных разработчиком или измененных пользователем, к схеме компоновки данных и определяет конечный результат. Этот процесс может быть представлен с помощью следующей схемы.</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_09-30-39.png" class="screen-2" alt="">




    <h3 class="header-style2" id="chapter1.1">Схема компоновки данных</h3>
    <p>Основой для компоновки отчета является <i>схема компоновки данных</i>. Создание схемы компоновки данных может быть выполнено:</p>
    <ul class="list">
        <li>наглядно при помощи конструктора схемы компоновки данных;</li>
        <li>наглядно при помощи любого редактора, позволяющего редактировать текст XML;</li>
        <li>программно при помощи объектов встроенного языка системы «1С:Предприятие».</li>
    </ul>
    <p>Схема компоновки данных содержит следующие разделы: наборы данных, связи наборов данных, вычисляемые поля, ресурсы, параметры, макеты, вложенные схемы, настройки.</p>

    <p><b id="chapter1.1.1">Наборы данных</b></p>
    <p>Наборы данных являются источниками данных для отчета и описывают способ получения этих данных. Данные можно получить из информационной базы или из некоторых объектов, находящихся в памяти (например, из таблицы значений). Один отчет может использовать одновременно несколько наборов данных, отбирая, объединяя и связывая между собой данные из разных наборов.</p>
    <p>Существуют различные виды наборов данных. Они отличаются тем, откуда получаются данные и как эти данные обрабатываются:</p>
    <ul class="list">
        <li><i>Запрос</i> – содержит запрос к базе данных на языке запросов с использованием дополнительных синтаксических элементов (расширений);</li>
        <li><i>Объект</i> – содержит информацию о внешнем наборе данных, например, таблице значений;</li>
        <li><i>Объединение</i> – объединяет информацию из нескольких наборов данных.</li>
    </ul>
    <p>Разработчик, создавая схему компоновки данных, может добавить в нее наборы данных такого вида и в таком количестве, которые ему необходимы. В зависимости от вида набора данных нужно выполнить различные действия для того, чтобы отчет мог использовать данные этого набора. Например, если используется набор данных – запрос, то в схеме компоновки данных нужно задать текст запроса, обращающегося к информационной базе «1С:Предприятия». Если используется набор данных – объект, то в схеме компоновки нужно описать поля этого набора данных, чтобы система компоновки знала, данные какого типа будут получены из этого набора, затем с помощью встроенного языка создать внешний набор данных и инициализировать им процессор компоновки данных. Если используется набор данных – объединение, то в схеме компоновки данных нужно описать наборы данных, которые входят в это объединение.</p>
    <p>Типичные сценарии использования наборов данных содержатся в первых четырех примерах второй главы.</p>

    <p><b id="chapter1.1.2">Связи наборов данных</b></p>
    <p>Схема компоновки данных может содержать несколько наборов данных. В случае, когда требуется получить связанную информацию из этих наборов, в схеме компоновки данных описывается их связь по какому-то полю. При связывании наборов данных в схеме компоновки используется <i>Левое соединение</i>.</p>
    <p>Однако в случае, если требуется вывести в отчет все записи из обоих наборов данных, используется набор данных – объединение. Такой набор содержит два или более подчиненных набора данных, но информация в них не связывается, а объединяется. По аналогии с языком запросов в этом случае используется <i>Объединение</i>.</p>
    <p>Отличие связывания и объединения наборов данных рассматривается во второй главе.</p>

    <p><b id="chapter1.1.3">Вычисляемые поля</b></p>
    <p>Отчет может содержать не только те поля, которые описаны в наборе данных, но и дополнительные поля, созданные разработчиком и вычисляющиеся на их основе. Значения этих полей получаются в результате вычисления выражений, написанных разработчиком в схеме компоновки данных, или в результате выполнения функций, описанных в общих модулях конфигурации. Напрмиер выводится вычисляемое поле "Прибыль" как разница между полями "СтоимостьПриход" и "СтоимостьРасход".</p>

    <p><b id="chapter1.1.4">Ресурсы</b></p>
    <p>При исполнении отчета с помощью системы компоновки данных из источника данных, например из информационной базы данных, извлекаются данные для отчета. В базе данных они представлены в виде таблиц. Соответственно, все эти данные можно построчно вывести в отчет. Это детальные записи. Но поскольку, как правило, эти данные привязаны к некоторым иерархическим данным (например, в отчет выводятся остатки номенклатуры, где номенклатура содержит многоуровневые группы), то возникает желание сгруппировать записи в отчете и показать остатки номенклатуры по группам (например, сколько на складе телевизоров определенной марки и сколько телевизоров в целом). Для этого система компоновки данных может рассчитывать и добавлять в отчет записи, которые называются итоговыми. Этих записей в явном виде нет в базе данных, но они получаются в результате исполнения отчета, на основании некоторой обработки детальных записей, которую выполняет система компоновки данных.</p>
    <p>Эти групповые итоговые данные называются ресурсами схемы компоновки данных. Обычно данные в отчете группируются по каким-то позициям, например по номенклатуре. Смысл группировки не только в определенном расположении данных, но и в выводе итоговых данных – ресурсов по этой группировке. На основании значений ресурсов формируются общие итоги отчета.</p>
    <p>В приведенном примере детальные записи группируются по складам и выводятся групповые и общие итоги отчета:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_10-03-37.png" class="screen-2" alt="">
    <p>В таблице ресурсы выводятся как бы на пересечении соответствующей строки и колонки таблицы, например остатки конкретного товара на конкретном складе. В приведенном примере в отчет выводится таблица, в которой в колонках данные сгруппированы по складам, а в строках – по номенклатуре:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_10-07-08.png" class="screen-2" alt="">
    <p>Таким образом, для вывода таблиц и диаграмм обязательно определять ресурсы для отчета. Отчет, выводящий данные в группировку, может и не содержать ресурсов. Например, в случае вывода простых списков, когда групповые итоги не нужны.</p>

    <p><b id="chapter1.1.5">Параметры</b></p>
    <p>Параметры являются критериями получения данных для отчета. Параметры могут быть явно определены в запросе, например вид номенклатуры (&ВидНоменклатуры), а могут быть параметрами виртуальных таблиц базы данных, например начало и конец отчетного периода. Как правило, параметры выводятся пользователю перед формированием отчета. Затем заданные пользователем значения параметров передаются в отчет, и отчет формируется заново, например с новым отчетным периодом:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_10-13-09.png" class="screen-2" alt="">

    <p><b id="chapter1.1.6">Макеты</b></p>
    <p>По умолчанию внешний вид отчета формируется системой автоматически. Но разработчик может задать собственное расположение и оформление различных областей отчета. Для этого в схеме компоновки данных создаются предопределенные макеты. В отличие от стандартных макетов оформления, предопределенные макеты привязаны к одному отчету, его конкретным полям и структуре. Можно создавать макеты отдельных полей, группировок, итоговых полей и ресурсов отчета. В приведенном примере группировка по номенклатуре оформлена с помощью предопределенного макета:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_10-15-28.png" class="screen-2" alt="">

    <p><b id="chapter1.1.7">Вложенные схемы</b></p>
    <p>Часто бывает нужно использовать данные одного отчета внутри другого. Разработав схему компоновки одного отчета, можно затем многократно использовать ее в других отчетах, связав родительский и вложенный отчеты по общему полю. В приведенном примере выводится список контрагентов с вложенными данными по продажам номенклатуры для каждого из них:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_10-18-07.png" class="screen-2" alt="">
    <p>Пример использования вложенного отчета рассматривается во второй главе.</p>

    <p><b id="chapter1.1.8">Настройки</b></p>
    <p>В схеме компоновки данных разработчик задает стандартные настройки, которые определяют, как первоначально будет выглядеть отчет, определяет его иерархическую структуру и настройки как отчета в целом, так и его отдельных элементов.</p>
    <p>На деле то же самое окно настроек, что и в схеме компоновки данных, будет доступно и пользователю при исполнении отчета в режиме 1С:Предприятие по команде "Еще" -> "Изменить вариант…". Но пользоваться этим окном советуется лишь очень опытному пользователю, понимающему, что он делает.</p>
    <p>Иерархическая структура отчета состоит из следующих элементов:</p>
    <ul class="list">
        <li><i>Группировка</i> – предназначена для вывода информации в виде обычного линейного отчета:
        <img src="../img/1С-Для книги по СКД/2024-10-31_10-28-22.png" class="screen-2" alt="">
        </li>
        <li><i>Таблица</i> – предназначена для вывода информации в виде таблицы:
        <img src="../img/1С-Для книги по СКД/2024-10-31_10-07-08.png" class="screen-2" alt="">
        </li>
        <li><i>Диаграмма</i> – предназначена для вывода информации в виде диаграммы:
        <img src="../img/1С-Для книги по СКД/2024-10-31_10-31-25.png" class="screen-2" alt="">
        </li>
        <li><i>Вложенный отчет</i> – предназначен для вывода вложенного отчета</li>
    </ul>
    <p>На первый взгляд элементы структуры отчета <i>Группировка</i> и <i>Таблица похожи</i>. Но в таблице информация группируется по строкам и по столбцам, а на их пересечении выводятся групповые итоговые данные – ресурсы. А также рассчитываются общие итоги по вертикали и горизонтали. В группировке данные группируются по строкам, и общие итоги рассчитываются только по вертикали. Группировку можно вывести в табличном виде (горизонтально), а можно – в виде вертикального списка.</p>
    <p>Для каждого элемента структуры отчета и для всего отчета в целом существуют следующие элементы настроек:</p>
    <ul class="list">
        <li><i>Выбранные поля</i> – с помощью этого элемента настроек разработчик или пользователь может определить список полей, выводящихся в отчет:
        <img src="../img/1С-Для книги по СКД/2024-10-31_10-36-32.png" class="screen-2" alt="">
        </li>
        <li><i>Отбор</i> – с помощью этого элемента настроек разработчик или пользователь может определить условия фильтрации записей в отчете:
        <img src="../img/1С-Для книги по СКД/2024-10-31_10-37-54.png" class="screen-2" alt="">
        </li>
        <li><i>Порядок</i> – с помощью этого элемента настроек разработчик или пользователь может определить порядок записей в отчете:
        <img src="../img/1С-Для книги по СКД/2024-10-31_10-40-03.png" class="screen-2" alt="">
        </li>
        <li><i>Параметры</i> – с помощью этого элемента настроек разработчик или пользователь может задать значения параметров отчета:
        <img src="../img/1С-Для книги по СКД/2024-10-31_10-41-22.png" class="screen-2" alt="">
        </li>
        <li><i>Пользовательские поля</i> – с помощью этого элемента настроек пользователь может создать собственные дополнительные поля:</li>
        <li>Условное оформление – с помощью этого элемента настроек разработчик или пользователь может задать условия оформления записей в отчете:
            <img src="../img/1С-Для книги по СКД/2024-10-31_10-43-18.png" class="screen-2" alt="">
        </li>
        <li><>Другие настройки</li> – с помощью этого элемента настроек разработчик или пользователь может задать значения параметров вывода, таких как макет оформления, заголовок, расположение итогов и др.</li>
    </ul>
    <p>В следующем разделе познакомимся с настройками более подробно на примере конкретного отчета.</p>









    <h2 class="header-style" id="chapter2">Часть 2. Примеры разработки отчётов</h2>
    <p>Данная глава содержит набор практических примеров, основанных на реальных задачах. Она будет полезна как для начинающих разработчиков, так и для специалистов, желающих углубить свои знания и навыки по разработке отчетов с помощью системы компоновки данных.</p>



    <h3 class="header-style2" id="chapter2.1">Исходные данные для примеров</h3>
    <p>Разрабатываемые нами отчеты будут основываться на данных о хозяйственной деятельности небольшой фирмы, которая оказывает услуги по сборке, ремонту и продаже компьютеров и комплектующих к ним.</p>
    <p>Приобретение комплектующих отражается в документах ПриходнаяНакладная. Предоставление компьютерных услуг, продажа комплектующих и собранных системных блоков отражаются в документах РасходнаяНакладная. Оба эти документа формируют движения в регистре накопления ОстаткиНоменклатуры, который имеет вид Остатки и содержит два измерения – "Номенклатура" и "Склад" и ресурсы – "Количество" и "Цена".</p>
    <p>Сборка готовых системных блоков отражается в документах СборкаКомпьютера, который формирует движения типа Приход в регистре накопления СобранныеСБ. Этот регистр имеет вид Остатки и содержит два измерения – СБ и Склад, ресурсы – Количество и Стоимость и реквизит – Мастер.</p>
    <p>Одновременно при проведении этого документа формируются движения типа Расход в регистре ОстаткиНоменклатуры. Здесь отражаются комплектующие, которые были израсходованы при сборке.</p>
    <p>Документы РасходнаяНакладная также формируют движения в регистре накопления Продажи. Этот регистр имеет вид Обороты и содержит два измерения – Номенклатура и Контрагент и ресурсы – Количество и Стоимость.</p>
    <p>Документы ПриходнаяНакладная также формируют движения в регистре сведений Цены. Этот регистр является периодическим и имеет измерение Номенклатура и ресурс Цена.</p>
    <p>В базе данных также содержится регистр сведений ДополнительныеХарактеристики для хранения значений характеристик объектов. Этот регистр является непериодическим и имеет два измерения – Объект и ВидХарактеристики и ресурс – ЗначениеХарактеристики.</p>




    <h3 class="header-style2" id="chapter2.2">Пример 1. Набор данных – запрос</h3>
    <p>Практическое знакомство с системой компоновки данных начнем с простого отчета, целиком созданного с помощью наглядных средств разработки. В этом примере подробно, шаг за шагом описываются действия разработчика по наглядному конструированию отчета с помощью системы компоновки данных. В следующих примерах эти действия будут лишь кратко перечисляться. Поэтому данный пример будет полезен для новичков, не знакомых с системой компоновки данных, а остальным просто позволит вспомнить некоторые моменты разработки отчетов.</p>
    <p>После создания отчета мы разработаем другой вариант этого же отчета и на нем покажем возможности настройки отдельных элементов отчета.</p>
    <p>Итак, разработаем отчет, который будет отражать приход, расход и остатки номенклатуры на складах:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_13-10-48.png" class="screen" alt="">

    <p><b id="chapter2.2.1">Наглядное составление отчёта</b></p>
    <p>Для наглядного составления отчётов с использованием системы компоновки данных предназначен объект конфигурации "Отчет". Выделим в дереве объектов конфигурации ветвь Отчеты и добавим новый отчет.</p>
    <p>В появившемся окне редактирования назовем отчет ОстаткиНоменклатуры и создадим схему компоновки данных отчета, нажав кнопку "Открыть" схему компоновки данных или кнопку открытия со значком лупы.</p>
    <p>Так как у нашего отчета еще нет схемы компоновки данных, платформа предложит создать новую схему и откроет конструктор макета. В открывшемся окне конструктора макета будет доступен для выбора единственный тип макета – Схема компоновки данных.</p>
    <p>Нажмем кнопку Готово. Платформа создаст макет отчета, содержащий схему компоновки данных, которая в дальнейшем будет доступна на закладке свойств отчета Макеты наряду с другими макетами отчета.</p>
    <p>Затем конструктор макета откроет окно конструктора схемы компоновки данных. В нем происходит основная работа по наглядному составлению отчета. Для этого конструктор предоставляет массу разнообразных возможностей. Но мы пока рассмотрим лишь те из них, которые понадобятся в нашем отчете. Остальные возможности по мере усложнения будут представлены в других примерах.</p>
    <p>Любой отчет основывается на данных, извлекаемых из каких-либо источников по определенным условиям и параметрам. Мы рассмотрим наиболее простой случай, когда используется один набор данных. Он будет содержать запрос к базе данных, сформулированный на специальном языке – <i>языке запросов</i>. </p>
    <p>Итак, на закладке "Наборы данных" добавим новый набор данных – запрос.</p>
    <p>В правом нижнем окне конструктора схемы компоновки данных мы можем создавать и редактировать текст запроса. Текст запроса можно написать вручную, но гораздо проще сделать это с помощью конструктора запроса, нажав кнопку "Конструктор запроса".</p>
    <p>Конструктор запроса позволяет также наглядно составить запрос. Даже пользователь, не знакомый с языком запросов, может с помощью конструктора создать синтаксически правильный запрос.</p>
    <p>Итак, соберём запрос и нажмём ОК, получится так:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_13-29-11.png" class="screen" alt="">
    <p>Итак, мы добавили набор данных – запрос и создали текст запроса, выбирающего данные из информационной базы «1С:Предприятия». Текст запроса отображается в поле Запрос. Здесь его можно вручную отредактировать или снова вызвать Конструктор запроса для внесения в него изменений. Так как свойство Автозаполнение включено, платформа автоматически заполнила список доступных полей текущего набора данных исходя из запроса.</p>
    <p>Пока мы не будем рассматривать другие возможности конструктора схемы компоновки данных, а приступим к настройке отчета, то есть к формированию его структуры и внешнего вида.</p>
    <p>Представим наш отчет в виде таблицы, где по строкам данные группируются по позициям номенклатуры, а в колонках – по позициям складов. Групповые итоговые данные – Ресурсы, например остаток конкретного товара на конкретном складе, выводятся в ячейках таблицы.</p>
    <p>Поэтому для того, чтобы увидеть какие-либо значения в таблице, мы должны определить ресурсы схемы компоновки данных.</p>
    <p>На закладке Ресурсы схемы компоновки данных в списке Доступные поля расположены все поля из текущего набора данных отчета. Нажмем кнопку >>, чтобы конструктор выбрал все доступные ресурсы, по которым можно вычислять итоги:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_21-26-15.png" class="screen" alt="">
    <p>В колонке "Выражение" здесь содержится выражение, по которому будет вычисляться значение ресурса. По умолчанию предлагается функция Сумма, но доступны и другие распространенные функции агрегирования данных.</p>
    <p>Теперь перейдем на закладку Настройки и создадим стандартные настройки, определяющие, как будет выводиться информация в отчет.</p>
    <p>Выделим корневой элемент Отчет и добавим в него новую таблицу. Для этого нужно нажать кнопку Добавить, расположенную в командной панели окна, или правой кнопкой мыши вызвать контекстное меню элемента Отчет:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_21-31-12.png" class="screen-2" alt="">
    <p>В структуре отчета появится элемент Таблица, включающий в себя Строки и Колонки. Выделим элемент Строки и нажмем кнопку Добавить в командной панели или клавишу Ins для добавления новой группировки или через контекстное меню. В появившемся окне выбора поля группировки выберем поле Номенклатура.</p>
    <p>Подобным образом в колонки таблицы добавим группировку по полю Склад. Таким образом мы указали, что в строках таблицы данные будут группироваться по позициям номенклатуры, а в колонках – по позициям складов.</p>
    <p>На закладке Выбранные поля перенесем мышью из списка доступных полей поля, которые будут выводиться в отчет:</p>
    <ul class="list">
        <li>КоличествоНачальныйОстаток,</li>
        <li>КоличествоПриход,</li>
        <li>КоличествоРасход,</li>
        <li>КоличествоКонечныйОстаток.</li>
    </ul>
    <p>Поля Номенклатура и Склад можно не переносить. Они все равно будут выводиться в отчет в составе автополей группировок.</p>
    <p>В результате окно настроек отчета должно принять вид:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_21-38-41.png" class="screen" alt="">
    <p>Запустим отчёт и посмотрим результат. Мы видим, что данные в отчете представлены в виде таблицы, строки которой сгруппированы по номенклатуре, а колонки – по складам, а также выведены общие итоги по вертикали и горизонтали.</p>
    <p>Заметьте, что при прокручивании отчета вниз и вправо положение шапки отчета и самой левой колонки остается зафиксированным. Для удобства пользователя платформа автоматически фиксирует табличный документ, в который выводится результат отчета, когда в отчет выводится одна таблица (ФиксацияСлева и ФиксацияСверху) или одна группировка (ФиксацияСверху).</p>
    <p>Таким образом, мы быстро и легко создали простой отчет Остатки номенклатуры, представив данные в виде таблицы. На этом примере мы научились создавать и настраивать схему компоновки данных для нового отчета и рассмотрели следующие ее возможности:</p>
    <ul class="list">
        <li>создание набора данных на основе запроса, используя конструктор
            запроса;</li>
        <li>создание иерархической структуры отчета – добавление таблицы и группировок в отчет;
        </li>
        <li>определение ресурсов для расчета групповых итогов отчета.</li>
    </ul>

    <p><b id="chapter2.2.2">Варианты отчёта</b></p>
    <p>Теперь покажем возможности различных настроек отчета. Настройки могут относиться как ко всему отчету в целом, так и к его отдельным элементам – группировкам, таблицам, диаграммам. Последнее может быть полезно, чтобы выделить разные элементы индивидуальными стилями оформления, установить для каждого элемента свой отбор, сортировку и т.д.</p>
    <p>При установке настроек отчета в средней части окна, под деревом структуры отчета, должна быть выделена кнопка, соответствующая режиму настроек. Кнопка Отчет – для настройки отчета в целом или кнопка с именем группировки, например Детальные записи, если настройки относятся только к ней.</p>
    <p>Создадим новый вариант отчета Остатки номенклатуры и на его примере покажем несколько вариантов настройки различных элементов структуры отчета.</p>
    <p>У одного и того же отчета может существовать несколько вариантов, представляющих одни и те же данные в различном виде. Например, для отчета Динамика продаж одним вариантом отчета может служить диаграмма, показывающая продажи товаров по периодам, а другим – табличный отчет, показывающий продажи товаров в разрезе покупателей. При этом каждый вариант отчета обладает своим набором пользовательских настроек.</p>
    <p>Вернемся в конфигуратор и откроем схему компоновки данных на закладке Настройки. В левой части окна находится список вариантов отчета. При создании настроек отчета в первый раз система компоновки данных по умолчанию создает Основной вариант настроек. Чтобы добавить новый вариант, нажмем кнопку Добавить над этим списком. Зададим имя варианта и его представление как Оформление:</p>
    <img src="../img/1С-Для книги по СКД/2024-10-31_21-53-11.png" class="screen-2" alt="">
    <p>Мы видим, что структура отчета и все его настройки очистились. Но они не пропали, а стали невидимы, так как относятся к основному варианту настроек. Если у отчета есть несколько вариантов, то мы видим и можем изменять настройки того варианта, который выделен в данный момент. Причем вся остальная информация в схеме компоновке данных (ресурсы, параметры, наборы данных) осталась без изменений. Данные для отчета будут получены с помощью того же запроса к базе данных. Изменятся лишь настройки, которые определят, как будет представлен отчет.</p>
    <p>Добавим в структуру отчета новый элемент Группировка и покажем возможности настройки отдельных элементов отчета. Элемент Группировка позволяет выводить в отчете не только сгруппированную каким-то образом информацию, но и обычные <i>детальные записи</i>, выбранные платформой из источников данных согласно нашему запросу.</p>
    <p>Выделим корневой элемент Отчет и добавим в него новую группировку. В появившемся окне выбора поля группировки оставим поле ввода Поле пустым, так как мы не хотим группировать записи в отчете. Такая группировка называется Детальные записи.</p>
    <p>На закладке Выбранные поля перенесем мышью из списка доступных полей поля, которые будут выводиться в отчет.</p>
    <p>Сначала покажем настройки отчета в целом. Дадим заголовок отчету. Перейдем на закладку Другие настройки. В средней части окна настроек выделим кнопку Отчет и введем остатки номенклатуры в строку Заголовок.</p>
    <p>Установим для параметра Макет оформления значение Море.</p>
    <p>Важным элементом настроек является присвоение более коротких и понятных для пользователя заголовков полей отчета. Это можно сделать на закладке Наборы данных.</p>
    <p>Мы видим, что так как свойство Автозаполнение включено, платформа автоматически заполнила колонки Поле, Путь и Заголовок полей текущего набора данных исходя из запроса. Поясним их назначение:</p>
    <ul class="list">
        <li></li>
        <li></li>
        <li></li>
    </ul>




</div>
