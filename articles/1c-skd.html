<div class="wrap">
   
    <h2 class="header-style">СКД. Разработка отчётов в 1С.</h2>

    <p>Информацию о СКД брал из книги Хрусталёвой "Пособоие для разработчиков". И отчёты строятся из объектов конфы из этой книги. Конфа называется "ПособиеДляНачинающих(Хрусталёва)".</p>

    <h3 class="header-style2">Оглавление</h3>
    <ol class="list">
        <li><a href="#1">Об отчётах</a></li>
        <li><a href="#2">Работа с запросами</a></li>
        <li><a href="#3">Система компоновки данных</a></li>
        <li><a href="#4">Выбор данных из одной таблицы</a></li>
        <li><a href="#5">Выбор данных из двух таблиц</a></li>
        <li><a href="#6">Как вывести заголовок для отчёта с форматированной датой</a></li>
        <li><a href="#7">Настройки в конфигураторе и в режиме "1С:Предприятие". "Условное оформление", "Пользовательские настройки", "Отбор"</a></li>
        <li><a href="#8">Вывод данных по всем дням в выбранный период</a></li>
        <li><a href="#9">Новый вариант отчета. Диаграмма</a></li>
        <li><a href="#10">Получение актуальных значений из периодического регистра сведений</a></li>
        <li><a href="#11">Тут буду записывать как строить диаграммы</a></li>
        <li><a href="#12"><b>"Пользовательские поля"</b> для отчёта</a></li>
        <li><a href="#resours">Вкладка <b>"Ресурсы"</b>.</a></li>
        <li><a href="#parameters">Вкладка <b>"Параметры"</b> в СКД. Язык выражений СКД.</a>
            <ul class="list2">
                <li><a href="#parameters-1">Поле <b>"Выражение"</b>. Указываем для даты остатка конец дня и добавляем 1 секунду</a></li>
                <li><a href="#parameters-2">Поле <b>"Выражение"</b>. Выбираем данные для отчёта периодами(месяц, неделя, квартал), а не датами начала и конца регистра в режиме "обороты"</a></li>
                <li><a href="#parameters-3">Поле <b>"Запрещать незаполненные значения"</b>.</a></li>
                <li><a href="#parameters-4">Поле <b>"Использование"</b>.</a></li>
                <li><a href=""></a></li>
                <li><a href=""></a></li>
            </ul>
        </li>
        <li><a href="#"></a></li>
        <li><a href="#recomented"><b>Советы по созданию отчётов:</b></a>
            <ul class="list2">
                <li><a href="#recomented-1">Отбор в запросе и сортировка с группировкой в СКД</a></li>
                <li><a href="#recomented-2">Псевдонимы для полей</a></li>
                <li><a href=""></a></li>
                <li><a href=""></a></li>
                <li><a href=""></a></li>
            </ul>
        </li>
        <li><a href="#how"><b>Разделы "Как":</b></a>
            <ul class="list2">
                <li><a href="#how-1">Как убрать заголовок ресурса из шапки отчёта</a></li>   
                <li><a href="#how-2">Как программно сформировать отчёт при его открытии не нажимая кнопки "Сформировать"</a></li>   
                <li><a href="#how-3">Как программно установить значения параметров "НачалоПериода" и "КонецПериода" и передать их в отчёт</a></li>   
                <li><a href="#how-4">Как программно установить значения параметров "НачалоПериода" и "КонецПериода", а также подправить элементы сортировки</a></li>   
                <li><a href="#how-5">Как программно вывести в табличный документ отчёт</a></li>   
                <li><a href="#how-6">Как отобразить в отчёте кросс-таблицу по данным справочника</a></li>   
            </ul>
        </li>
        <li><a href="#"></a></li>
        <li><a href="#"></a></li>
    </ol>





    <h2 class="header-style" id="1">Об отчётах.</h2>
    <p>Любой отчет, как правило, подразумевает получение сложной выборки данных, сгруппированных и отсортированных определенным образом. Система компоновки данных представляет собой мощный и гибкий механизм, позволяющий выполнить все необходимые действия – от получения данных из различных источников до представления этих данных в виде, удобном для пользователя.</p>
    <p>Чаще всего исходные данные, необходимые для отчета, находятся в базе данных. Для того чтобы указать системе компоновки данных, какая информация и откуда должна быть получена, используется язык запросов системы «1С:Предприятие».</p>
    <p>На этапе разработки отчета можно задать стандартные настройки отчета для того, чтобы пользователь мог сразу же запустить отчет на выполнение. В то же время пользователь может самостоятельно изменить настройки отчета и выполнить его. При этом система компоновки данных сгенерирует другой запрос и другим образом представит конечные данные – в соответствии с новыми настройками, заданными пользователем.</p>
    <p>Система «1С:Предприятие» поддерживает два способа доступа к данным, хранящимся в базе данных:</p>
    <ul class="list">
        <li>объектный (для чтения и записи);</li>
        <li>табличный (для чтения).</li>
    </ul>
    <p><b>Объектный способ</b> сделан посредством использования объектов встроенного языка. Важной особенностью объектного способа доступа к данным является то, что, обращаясь к какому-либо объекту встроенного языка, мы обращаемся к некоторой совокупности данных, находящихся в базе данных, как к единому целому. Т.е. тут говорится о том, что мы можем выбрать все или всю запись базы со всеми полями, у нас нет возможности выбрать по какому-то отдельному полю. Это как раз минус объектного способа. Например, объект ДокументОбъект.ОказаниеУслуги будет содержать значения всех реквизитов документа Оказание услуги и всех его табличных частей. Объектная техника обеспечивает сохранение целостности объектов, кеширование объектов, вызов соответствующих обработчиков событий и т.д</p>
    <p><b>Табличный доступ</b> к данным в «1С:Предприятии» сделан с помощью запросов к базе данных, которые составляются на языке запросов. В этой технике разработчик получает возможность оперировать отдельными полями таблиц базы данных, в которых хранятся те или иные данные. Табличная техника предназначена для получения информации из базы данных по некоторым условиям (отбор, группировка, сортировка, объединение нескольких выборок, расчет итогов и т.д.). Табличная техника оптимизирована для обработки больших объемов информации, расположенной в базе данных, и получения данных, отвечающих заданным критериям.</p>









    <h2 class="header-style" id="2">Работа с запросами.</h2>
    <p>Для работы с запросами используется объект встроенного языка Запрос. Он позволяет получать информацию, хранящуюся в полях базы данных, в виде выборки, сформированной по заданным правилам. Исходную информацию запрос получает из набора таблиц. Все таблицы, которыми оперирует язык запросов, можно разделить на две большие группы: реальные таблицы и виртуальные таблицы.</p>
    <img src="../img/1С-1/2023-03-06_08-34-00.png" alt="">
    <p>Посмотреть состав таблиц, доступных для запроса, и их описание можно в синтакс-помощнике в разделе Работа с запросами > Таблицы запросов.</p>
    <p>Алгоритм, по которому данные будут выбраны из исходных таблиц запроса, описывается на специальном языке – <b>языке запросов</b>. Итоги в запросе можно не писать, СКД сама умеет подсчитывать итоги.</p>










    <h2 class="header-style" id="3">Система компоновки данных.</h2>
    <p>Система компоновки данных предназначена для создания произвольных отчетов в системе «1С:Предприятие» и состоит из нескольких основных частей. Исходные данные для компоновки отчета содержит в себе <b>схема компоновки данных</b>. Это наборы данных и методы работы с ними:</p>
    <img src="../img/1С-1/2023-03-06_08-48-56.png" alt="">
    <p>Разработчик создает схему компоновки данных, в которой описывает текст запроса, наборы данных, связи между ними, доступные поля, параметры получения данных, и задает первоначальные настройки компоновки – структуру отчета, макет оформления данных и др.</p>
    <p>Отчёт системы компоновки данных, который получит пользователь, представляет собой не просто таблицу записей, удовлетворяющих условиям запроса. Отчёт системы компоновки имеет сложную иерархическую структуру и может состоять из различных элементов, таких как группировки, таблицы и диаграммы. При этом пользователь может изменить существующую структуру отчёта или вообще создать совершенно новую структуру отчёта. Может настроить необходимый ему отбор, оформление элементов структуры отчёта, получить расшифровку по каждому элементу и т.д</p>
    <p>Система компоновки данных представляет собой совокупность нескольких объектов. При формировании и исполнении отчёта происходит последовательная передача данных от одного объекта системы компоновки данных к другому, до получения конечного результата – документа, показанного пользователю.</p>
    <p>Алгоритм взаимодействия этих объектов выглядит следующим образом:</p>
    <ul class="list">
        <li>Разработчик создает <b>схему компоновки данных</b> и <b>настройки по умолчанию</b>. В общем случае на основе одной схемы компоновки данных может быть создано большое количество различных отчетов. Настройки компоновки данных, создаваемые разработчиком или изменяемые пользователем, определяют, какой именно отчет будет получен в конкретном случае.</li>
        <li>На основе схемы компоновки и имеющихся настроек <b>компоновщик макета создает</b> <b>макет</b>. Это этап подготовки к исполнению отчета. Макет компоновки данных является уже готовым заданием для выполнения процессором компоновки. Он содержит необходимые запросы, макеты областей отчета и др.</li>
        <li><b>Процессор компоновки</b> данных выбирает данные из информационной базы согласно макету компоновки, агрегирует и оформляет эти данные.</li>
        <li><b>Результат компоновки</b> обрабатывается <b>процессором вывода</b>, и в итоге пользователь получает результирующий табличный документ.</li>
    </ul>
    <p>Эту последовательность работы можно представить в виде следующей схемы:</p>
    <img src="../img/1С-1/2023-03-06_09-04-55.png" class="screen" alt="">










    <h2 class="header-style" id="4">Выбор данных из одной таблицы.</h2>
    <p>Создадим отчёт "Реестр документов оказание услуги". Реестр значит "перечень", т.е. отчёт с перечнем документов "ОказаниеУслуги". На примере этого отчёта мы покажем, как выбрать данные из одной таблицы базы данных и как вывести их в определенном порядке. Также мы познакомимся с тем, как использовать расшифровку в готовом отчёте. Этот отчёт будет выводить список существующих в базе данных документов "ОказаниеУслуги" в порядке их дат и номеров:</p>
    <img src="../img/1С-1/2023-03-06_09-32-49.png" class="screen" alt="">
    <p><b>В режиме "Конфигуратор"</b></p>
    <p>Добавим в конфигураторе объект конфигурации Отчет. На закладке "Основные" зададим имя отчёта – "РеестрДокументовОказаниеУслуги". Установим свойство Расширенное представление как "Список оказанных услуг" для представления отчета в интерфейсе программы. Создадим схему компоновки данных для отчёта. Для этого нажмём кнопку "Открыть схему компоновки данных" или кнопку открытия со значком лупы. В диалоговом окне нажмём "Готово". В конструкторе схемы компоновки данных создадим "Набор данных" – "запрос":</p>
    <img src="../img/1С-1/2023-03-06_09-41-14.png" alt="">
    <p><b>Запрос для набора данных</b></p>
    <p>Нажав кнопку Конструктор запроса, запустим конструктор запроса. В качестве источника данных для запроса выберем объектную (ссылочную) таблицу документа ОказаниеУслуги. Выберем в конструкторе таблицу и нужные нам поля, для поля "Ссылка" изменим псевдоним на "Документ". <span class="vue-b">Совет! Лучше изменять псевдонимы в конструкторе запроса, потому что когда закроется конструктор запроса, то в СКД эти имена полей попадут в колонки - Поле, Путь, Заголовок и если надо сменить псевдоним, то придётся менять в 3 колонках вместо одной в конструкторе.</span></p>
    <p>После этого перейдем на закладку Порядок в конструкторе запроса и укажем, что результат запроса должен быть упорядочен по значению поля Документ по возрастанию. Нажмём ОК и у нас появится текст запроса:</p>
    <p><span class="vue-b">Если мы выбираем ссылки, то представление для ссылок получать не нужно, потому что СКД сама их получит.</span></p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">ОказаниеУслуги</span><span class="vue-r">.</span>Склад,
                <span class="vue-g">ОказаниеУслуги</span><span class="vue-r">.</span>Мастер,
                <span class="vue-g">ОказаниеУслуги</span><span class="vue-r">.</span>Клиент,
                <span class="vue-g">ОказаниеУслуги</span><span class="vue-r">.</span>Ссылка <span class="vue-r">КАК</span> Документ
            <span class="vue-r">ИЗ</span>
                Документ<span class="vue-r">.</span>ОказаниеУслуги <span class="vue-r">КАК</span> <span class="vue-g">ОказаниеУслуги</span>
            <span class="vue-r">УПОРЯДОЧИТЬ ПО</span>
                Документ</span>
        </pre>
    </div>
    <p><b>Настройки СКД</b></p>
    <p>Перейдём на закладку "Настройки" и создадим стандартные настройки, определяющие, как будет выводиться информация в отчет. Иерархическая структура отчета может содержать в различных сочетаниях три основных элемента:</p>
    <ul class="list">
        <li><b>Группировка</b> – для вывода информации в виде обычного линейного отчета;</li>
        <li><b>Таблица</b> – для вывода информации в виде таблицы;</li>
        <li><b>Диаграмма</b> – для вывода информации в виде диаграммы.</li>
    </ul>
    <p>Для добавления нового элемента в нашем случае группировки выделим в дереве структуры отчёта корневой элемент Отчет и вызовем его контекстное меню. Можно также нажать кнопку "Добавить", расположенную в командной панели окна, или нажать клавишу "Ins". Выберем пункт меню <i>Новая группировка</i>. В окне выбора поля группировки просто нажмем ОK (тем самым мы указываем, что в группировке будут выводиться детальные записи из информационной базы). </p>
    <img src="../img/1С-1/2023-03-06_10-37-29.png" alt="">
    <p>В структуре отчёта появится группировка "Детальные записи":</p>
    <img src="../img/1С-1/2023-03-06_10-39-28.png" alt="">
    <p>Ниже на закладке "Выбранные поля" перенесем мышью из списка доступных полей те поля, которые будут выводиться в отчет:</p>
    <img src="../img/1С-1/2023-03-06_10-41-21.png" class="screen" alt="">
    <p>На этом создание отчета закончено.</p>











    <h2 class="header-style" id="5">Выбор данных из двух таблицы.</h2>
    <p><span class="vue-r">Я по началу понять не мог зачем мы соединяем 2 таблицы: справочник Номенклатуры и виртуальную таблицу Продажи.Обороты. Ведь для вывода номенклатуры для определения оценки услуг достаточно было бы и просто одной виртуальной таблицы, в ней есть и номенклатура и выручка. НО мы же хотим увидить в отчёте оценку услуг, а это значит нужно видеть все услуги и самую часто востребованную услугу и не востребованную. Не востребованная это значит что её документ "Оказание услуг" мог вообще ни разу не провести, значит этой услуги не будет в вирт. таблице, поэтому и нужно взять справоник Номенклатура и из этого справочника получить все услуги и соединить с вирт. таблицей.</span></p>
    <p>Создадим отчёт об оценке услуг(рейтинг услуг). Этот отчёт будет содержать информацию о том, выполнение каких услуг принесло предприятию ООО «На все руки мастер" больше всего прибыли. На примере отчёта "Оценка услуг" мы покажем, как отбирать данные в некотором периоде, как задавать параметры запроса, как  использовать в запросе данные из нескольких таблиц и как включать в результат запроса все данные одного из источников. Также мы узнаем, как работать с параметрами системы компоновки данных, как использовать стандартные даты, и познакомимся с быстрыми пользовательскими настройками отчетов. Кроме этого, мы научимся более детально настраивать отбор и условное оформление в отчетах.</p>
    <p>От меня. Вообще можно было бы и из одной таблицы выбрать всё что нам надо, это таблица регистра Продажи.Обороты, но по этой таблице в данном виде невозможно определить, какая номенклатура "услуга", а какая "материал", потому что представление ссылки на номенклатуры мы сделали из названия и вида номенклатуры. Можно конечно добавить доп. реквизит "ВидНоменклатуры" или доп. измерение и по нему определять и тогда можно было бы выбрать всё из этой одной таблицы. Но у нас немного по другому, поэтому и будем выбирать из 2х таблиц.</p>
    <p>В конфигураторе создадим новый объект конфигурции Отчет. Назовём его "Оценка услуг", создадим макет схемы компоновки данных и добавим "Набор данных" - "Запрос".</p>
    <p><b>Запрос для набора данных</b>. Левое соединение 2х таблиц.</p>
    <p>В качестве источника данных для запроса выберем объектную (ссылочную) таблицу Номенклатура и виртуальную таблицу регистра накопления Продажи.Обороты. Чтобы исключить неоднозначность имён в запросе, переименуем таблицу Номенклатура в спрНоменклатура, т.е. зададим её псевдоним. Для этого в конструкторе запроса из левой колонки "базы данных" выберем в среднюю колонку эти 2 таблицы и в средней колонке для таблицы Номенклатура вызовем контекстное меню и выберем "Переименовать таблицу".</p>
    <p>В правую колонку вынесем 2 поля это "ссылка" из таблицы спрНоменклатура и "ВыручкаОбороты" из Продажи.Обороты. Теперь нам надо связать эти 2 таблицы по общему полю. Общим полем будет "Ссылка" у спрНоменклатура и "Номенклатура" у Продажи.Обороты. По умолчанию конструктор так и свяжет, надо только снять галочку "Все" с таблицы Продажи и поставить её для "Все" у таблицы спрНоменклатура, чтобы мы выбирали все записи именно из этой таблицы. Вот как схематично выглядят эти таблицы:</p>
    <img src="../img/1С-1/2023-03-07_08-55-57.png" class="screen" alt="">
    <p>Как видно из картинки, то в общую таблицу попадают и группы и материалы из левой таблицы. Поэтому нам нужно ещё указать условие отбора, чтобы отсечь группы и материалы. Для группы условие будет: </p>
    <p><span class="vue-b">спрНоменклатура.ЭтоГруппа = ЛОЖЬ</span></p>
    <p>Получим такую таблицу без групп:</p>
    <img src="../img/1С-1/2023-03-07_09-06-28.png" class="screen" alt="">
    <p>Вторым условием мы должны отсечь "материалы", для этого воспользуемся полем "ВидНоменклатуры":</p>
    <p><span class="vue-b">ВидНоменклатуры = &ВидНоменклатуры</span></p>
    <p>В дальнейшем перед выполнением запроса мы передадим параметр "ВидНоменклатуры", который будет значением перечисления - "Услуга". Вот что остаётся в таблице:</p>
    <img src="../img/1С-1/2023-03-07_09-14-05.png" class="screen" alt="">
    <p><span class="vue-b">Совет! Отбор можно применять и в самом запросе, и в настройках отчета. То же касается сортировки и группировки. Отбор лучше применять в запросе, если записи, не удовлетворяющие условию запроса, наверняка не понадобятся в отчете. Сортировку и группировку лучше применять уже в настройках отчета, чтобы сделать его более гибким.</span></p>
    <p>Далее изменим псевдонимы для выбранных полей. "Ссылка" переименуем на "Услуга", а "ВыручкаОборот" на просто "Выручка".</p>
    <p>Перейдём на закладку "Порядок" и укажем, что результат запроса должен быть упорядочен по полю "Выручка" по убыванию. Закончим создание запроса, нажмём ОК. Вот такой запрос получился:</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">ВЫБРАТЬ</span>
                <span class="vue-g">СпрНоменклатура</span><span class="vue-r">.</span>Ссылка <span class="vue-r">КАК</span> Услуга<span class="vue-r">,</span>
                <span class="vue-g">ПродажиОбороты</span><span class="vue-r">.</span>ВыручкаОборот <span class="vue-r">КАК</span> Выручка
            <span class="vue-r">ИЗ</span>
                Справочник<span class="vue-r">.</span>Номенклатура <span class="vue-r">КАК</span> <span class="vue-g">СпрНоменклатура</span>
                    <span class="vue-r">ЛЕВОЕ СОЕДИНЕНИЕ</span> РегистрНакопления<span class="vue-r">.</span>Продажи<span class="vue-r">.</span>Обороты <span class="vue-r">КАК</span> <span class="vue-g">ПродажиОбороты</span>
                    <span class="vue-r">ПО</span> <span class="vue-r">(</span><span class="vue-g">ПродажиОбороты</span><span class="vue-r">.</span>Номенклатура <span class="vue-r">=</span> <span class="vue-g">СпрНоменклатура</span><span class="vue-r">.</span>Ссылка<span class="vue-r">)</span>
            <span class="vue-r">ГДЕ</span>
                <span class="vue-g">СпрНоменклатура</span><span class="vue-r">.</span>ЭтоГруппа <span class="vue-r">=</span> ЛОЖЬ
                <span class="vue-r">И</span> <span class="vue-g">спрНоменклатура</span><span class="vue-r">.</span>ВидНоменклатуры <span class="vue-r">=</span> <span class="vue-g">&</span>ВидНоменклатуры

            <span class="vue-r">УПОРЯДОЧИТЬ ПО</span>
                Выручка <span class="vue-r">УБЫВ</span></span>
        </pre>
    </div>
    <p>Теперь, когда мы закончили составлять текст запроса, продолжим формирование нашей схемы компоновки данных.</p>
    <p><b>Ресурсы</b></p>
    <p>В нашем отчете мы хотим видеть <i style="text-decoration:underline;">итоговые значения</i> выручки для каждой услуги. Для этого нам нужно определить поля ресурсов отчета.</p>
    <p>Под ресурсами в системе компоновки данных подразумеваются поля, значения которых рассчитываются на основании детальных записей, входящих в группировку. По сути ресурсы являются групповыми или общими итогами отчета. Итоговые данные формируются на закладке Ресурсы.</p>
    <p>Перейдём на эту закладку и нажмём на кнопку с двумя стрелочками, в прую сторону выбирутся все поля, для которых нужно подсчитать итоги. В нашем случае это одно поле "Выручка". Также система сама определить что нужно применить функцию суммы для этого поля, хотя мы можем и поменять функцию подсчёта.</p>
    <p><b>Параметры</b></p>
    <p>Пользователя, как правило, интересуют данные о хозяйственной деятельности за определенный период. Поэтому практически в любом отчете используются параметры, задающие начало и конец отчетного периода. Параметры отчета задают условия отбора записей в отчет. В схеме компоновки данных параметры отчета задаются на закладке Параметры:</p>
    <img src="../img/1С-1/2023-03-07_09-34-51.png" class="screen" alt="">
    <p>На этой закладке мы увидим три параметра: НачалоПериода, КонецПериода и ВидНоменклатуры. Вы можете спросить: почему параметра три, хотя в запросе мы задавали всего один – ВидНоменклатуры? Все дело в том, что система компоновки данных самостоятельно анализирует текст запроса и помимо тех параметров, которые указаны в нем в явном виде (ВидНоменклатуры), предоставляет возможность настроить также и параметры виртуальных таблиц, которые участвуют в запросе. Такими параметрами являются НачалоПериода и КонецПериода. Это первые два параметра виртуальной таблицы РегистрНакопления.Продажи.Обороты, которую мы использовали в запросе, в левом соединении. </p>
    <p>Здесь всегда следует помнить, что если мы передаем в качестве этих параметров дату (а в нашем случае так и будет), то дата содержит и время с точностью до секунды. Допустим, заранее известно, что пользователя не будут интересовать результаты работы отчета в периодах, указанных с точностью до секунды. В этом случае следует учесть две особенности.</p>
    <p>Во-первых, пользователя нужно избавить от необходимости указывать время при вводе даты периода, за который формируется отчет. Для этого мы изменим существующее описание типа для параметра НачалоПериода. Вернемся на закладку Параметры схемы компоновки данных и дважды щелкнем в ячейке Тип, соответствующей параметру НачалоПериода. Затем нажмем кнопку выбора и в нижней части окна редактирования типа данных установим Состав даты в значение Дата. Нажмем ОK</p>
    <p>Вторая особенность заключается в том, что по умолчанию время в дате установлено 00:00:00. Поэтому если пользователь задаст период отчета с 01.06.2023 по 11.06.2023, итоги регистра будут рассчитаны с начала дня 01.06.2013 00:00:00 по начало дня 11.06.2013, 00:00:00. Таким образом, данные за 11-е число в расчет не войдут, что сильно удивит пользователя.</p>
    <p>Для того чтобы исключить эту ситуацию, мы добавим еще один параметр ДатаОкончания, в который пользователь будет вводить дату окончания. А значение параметра КонецПериода будем рассчитывать автоматически таким образом, чтобы оно указывало на конец дня даты, введенной пользователем. Поэтому для параметра КонецПериода установим флажок Ограничение доступности. Если этот флажок не установлен, то параметр будет доступен для настройки пользователем. Если же установить этот флажок, то пользователь не увидит этот параметр:</p>
    <img src="../img/1С-1/2023-03-07_09-48-13.png" class="screen" alt="">
    <p>Затем с помощью кнопки Добавить в командной панели добавим новый параметр с именем ДатаОкончания. Для этого параметра платформа автоматически сформирует заголовок – Дата окончания. Оставим его без изменений. Зададим тип значения параметра – Дата. При этом, как и для параметра Начало Периода, укажем состав даты – Дата. А также для параметра НачалоПериода зададим заголовок, который будет отображаться пользователю, – Дата начала.</p>
    <p>Обратим внимание, что по умолчанию добавленный нами параметр доступен для пользователя (ограничение доступности в колонке снято). Нас это вполне устраивает.</p>
    <p>Перейдем к параметру КонецПериода. Для него мы установили флажок Ограничение доступности, поскольку значение этого параметра мы собираемся вычислять на основании значения, установленного пользователем для параметра ДатаОкончания. Чтобы задать формулу, по которой будет вычисляться значение параметра КонецПериода, воспользуемся языком выражений системы компоновки данных. В нем есть функция КонецПериода(), которая позволяет получить дату, соответствующую концу какого-либо периода, например, указанного дня. В ячейке Выражение зададим для параметра КонецПериода следующее выражение:</p>
    <p><span class="vue-b">КонецПериода(&ДатаОкончания, "День")</span></p>
    <p><span class="vue-b">Примечание! Подробное описание языка выражений системы компоновки данных содержится во встроенной справке системы в разделе Справка > Содержание справки > Система компоновки данных > Язык выражений системы компоновки данных.</span></p>
    <p>В результате перечисленных действий параметры компоновки будут иметь следующий вид:</p>
    <img src="../img/1С-1/2023-03-07_09-59-56.png" class="screen" alt="">
    <p>И в заключение настроим параметр ВидНоменклатуры. Поскольку отчет должен отображать выручку, полученную только от реализации услуг, значение параметра ВидНоменклатуры пользователь изменять не должен. Оно должно быть задано непосредственно в схеме компоновки как Перечисление.ВидыНоменклатуры.Услуга. Флажок Ограничение доступности у параметра ВидНоменклатуры платформа установила по умолчанию, поэтому нам остается только указать нужное значение перечисления ВидыНоменклатуры в ячейке Значение, соответствующей параметру ВидНоменклатуры. Воспользуемся кнопкой выбора и выберем это значение из списка перечисления видов номенклатуры – Услуга</p>
    <img src="../img/1С-1/2023-03-07_10-04-57.png" class="screen" alt="">
    <p><b>Настройки</b></p>
    <p>Перейдем к формированию структуры отчета. На закладке Настройки добавим группировку и снова не укажем поле группировки. На закладке "Выбранные поля" укажем поля Услуга и Выручка. Затем перейдем на закладку "Другие настройки" и зададим заголовок отчета – Оценка услуг.</p>
    <p><b>Быстрые пользовательские настройки</b></p>
    <p>В заключение мы должны предоставить пользователю возможность задавать отчетный период перед формированием отчета. То есть параметры Дата начала и Дата окончания должны быть включены в состав пользовательских настроек. Причем поскольку задавать отчетный период требуется практически всегда, эти настройки должны находиться непосредственно в форме отчета. </p>
    <p>На закладке Параметры мы видим параметры, для которых мы не устанавливали "ограничение доступности". Выделим по очереди каждый из параметров и нажмем кнопку Свойства элемента пользовательских настроек, расположенную в правом нижнем углу окна настроек. Установим флажок Включать в пользовательские настройки и оставим предложенное по умолчанию для свойства Режим редактирования значение Быстрый доступ:</p>
    <img src="../img/1С-1/2023-03-07_16-43-06.png" class="screen" alt="">
    <p>Поясним, что флажок Включать в пользовательские настройки означает, что эта настройка будет доступна пользователю в отдельном окне (2) при вызове из подменю Еще команды Настройки… (то есть такая настройка, которой он может пользоваться, но не очень часто. А режим редактирования, установленный в значение Быстрый доступ, означает, что эта настройка также будет автоматически отображаться непосредственно в отчетной форме (1). Это быстрая пользовательская настройка – такая настройка, которая нужна пользователю постоянно, чуть ли не при каждом запуске отчета. Поэтому она должна быть всегда «под рукой».</p>
    <img src="../img/1С-1/2023-03-07_16-48-08.png" class="screen" alt="">
    <p>Кроме того, чтобы улучшить интерфейс пользователя, зададим для параметров Дата начала и Дата окончания в качестве начальных значений соответственно Начало этого месяца и Начало этого дня</p>
    <p>Таким образом, при выполнении отчета даты начала и окончания отчетного периода будут динамически меняться и показывать период с начала текущего месяца по сегодняшнее число, и пользователю, возможно, не придется менять их вручную.</p>
    <p>Вот так будет выглядеть наш отчёт в пользовательском режиме, после нажатия кнопки "Сформировать":</p>
    <img src="../img/1С-1/2023-03-07_16-52-34.png" class="screen" alt="">








    <h2 class="header-style" id="6">Как вывести заголовок для отчёта с форматированной датой</h2>
    <p>Вот в этом видео показано - https://www.youtube.com/watch?v=vfAv7LEI3xk</p>












    <h2 class="header-style" id="7">Настройки в конфигураторе и в режиме "1С:Предприятие". "Условное оформление" и "Отбор"</h2>
    <p>Теперь на примере отчёта выше покажем создание и использование других настроек отчета – <i style="text-decoration:underline;">Условное оформление</i> и <i style="text-decoration:underline;">Отбор</i>.</p>
    <p>На самом деле всё то же самое, что мы будем настраивать в режиме Конфигуратор, можно настроить и в режиме 1С:Предприятие по команде "Еще -> Изменить вариант". При этом пользователю открывается окно настроек отчета, очень похожее на закладку "Настройки" в схеме компоновки данных.</p>
    <p>Различие состоит в том, что настройки, сделанные в конфигураторе, называются <i style="text-decoration:underline;">стандартными настройками</i> и будут сохранены в самой схеме компоновки данных, то есть будут являться частью конфигурации. Это означает, что любой пользователь конфигурации будет видеть отчёт именно в таком виде, как мы его настроили в конфигураторе.</p>
    <p>Все то же самое можно настроить и в режиме 1С:Предприятие, но эта настройка уже не будет являться частью конфигурации и будет доступна только одному конкретному пользователю конкретной информационной базы, который эту настройку произвёл.</p>
    <p>Возможность изменения варианта отчета в режиме 1С:Предприятие не предназначена для рядового пользователя (для него – быстрые настройки и пользовательские настройки). Она предназначена для разработчика, осуществляющего внедрение, или для администратора, или для очень опытного пользователя.</p>
    <p>Настройки, сделанные в режиме 1С:Предприятие, естественно "перекрывают" стандартные настройки. И если пользователь все перестроил в отчете так, что его не узнать, всегда можно вернуться к стандартным настройкам по команде "Еще -> Установить стандартные настройки".</p>
    <p>Итак, сейчас мы хотим настроить отчет для любых пользователей, которые будут им пользоваться, поэтому делаем это в конфигураторе.</p>
    <p>Но если завтра главный бухгалтер попросит вас "сделать отчет красивым", вы сможете повторить все то же самое, не меняя конфигурацию и прямо у неё на глазах.</p>
    <p><b>Условное оформление</b></p>
    <p>В таком отчете, как Рейтинг услуг, было бы удобно выделять цветом записи отчета, содержащие услуги с наименьшей или с наибольшей выручкой, или еще по какому-либо условию. Для этого вернемся в конфигуратор и откроем схему компоновки данных на закладке "Настройки". В нижней части окна перейдём на закладку "Условное оформление" и нажмём кнопку "Добавить", расположенную в правом верхнем углу окна настроек:</p>
    <img src="../img/1С-1/2023-08-08_20-07-11.png" class="screen" alt="">
    <p>Сначала укажем "Оформление", то есть то, каким образом должны выделяться интересующие нас поля. Нажмем кнопку выбора в поле "Оформление" и установим красный цвет текста. Нажмем ОК. Затем укажем "Условие", при наступлении которого будет применяться оформление, то есть когда в нашем случае текст будет становиться красным. Нажмём кнопку выбора в поле "Условие" и в появившемся окне добавим "Новый элемент отбора". Каждый элемент отбора задает одно условие. Условий может быть несколько:</p>
    <img src="../img/1С-1/2023-08-08_20-13-46.png" class="screen" alt="">
    <p>Нажмём кнопку "Добавить" и укажем в графе "Левое значение" – поле Выручка, в графе "Вид сравнения" – Меньше, а в графе "Правое значение" – 700. Нажмем ОК. То есть когда в поле "Выручка" окажется значение меньше 700, "что-то" будет выделено красным цветом текста. Теперь укажем это "что-то", т.е. зададим список  <i style="text-decoration:underline;">оформляемых полей</i>.</p>
    <p>Если мы хотим выделять всю строку отчета, то можно оставить этот список пустым. Или же нажать кнопку выбора в поле "Оформляемые поля", и в появившемся окне, нажимая кнопку "Добавить", можно выбрать поля "Услуга" и "Выручка":</p>
    <img src="../img/1С-1/2023-08-08_20-21-42.png" class="screen" alt="">
    <p>В нашем случае можно было бы этого не делать, так как "Услуга" и "Выручка" и есть вся строка записи в отчёте. Нажмем ОК.</p>
    <p>В заключение зададим в поле "Представление" условного оформления как "Непопулярная услуга". "Непопулярная услуга" – это то, что увидит пользователь в своих настройках. Также добавим это условное оформление в пользовательские настройки. Нажмем кнопку "Свойства" элемента пользовательских настроек, расположенную в правом нижнем углу окна настроек. Установим флажок "Включать в пользовательские настройки" и установим свойство "Режим редактирования" в значение "Обычный":</p>
    <img src="../img/1С-1/2023-08-08_20-26-42.png" class="screen" alt="">
    <p>То есть вместо пугающей строки «Выручка меньше 700…» пользователь увидит осмысленное выражение, которое задано в поле Представление:</p>
    <img src="../img/1С-1/2023-08-08_20-28-54.png" class="screen" alt="">
    <p>Однако данная настройка условного оформления задана жестко, и пользователь может лишь включить или выключить признак ее использования. Для неопытных пользователей этого, как правило, вполне достаточно. Но для более подготовленных пользователей мы можем предоставить более полную свободу в использовании настроек, то есть возможность, например, самостоятельно задавать настройки отчёта: отбор, порядок, условное оформление и пр.</p>
    <p><b>Пользовательские настройки</b></p>
    <p>На закладке "Настройки" СКД содержатся полные настройки отчета, которые задаёт разработчик. Часть из них может быть представлена пользователю для создания произвольного отбора, условного оформления отчета и пр. Для этого нажмём кнопку <i style="text-decoration:underline;">Свойства элемента пользовательских настроек</i>, расположенную вверху в командной панели окна настроек:</p>
    <img src="../img/1С-1/2023-08-09_08-00-52.png" class="screen" alt="">
    <p>В появившемся окне мы можем изменять состав пользовательских настроек отчета. Установим признак использования для настроек "Отбор" и "Условное оформление" и установим для них свойство "Режим редактирования" в значение "Обычный".</p>
    <p>Таким образом, мы включили настройки отбора и условного оформления в состав пользовательских настроек и предоставили пользователю возможность задавать их в отдельном окне по команде "Еще -> Настройки":</p>
    <img src="../img/1С-1/2023-08-09_08-06-12.png" class="screen" alt="">
    <p><b>Отбор</b></p>
    <p>Теперь создадим настройку отбора в отчёте. Для этого в нижней части окна настроек перейдём на закладку "Отбор". Слева мы видим список доступных полей отчёта. Раскроем поле "Услуга" и двойным щелчком мыши на поле "Родитель" перенесем его в список условий отбора в правой части окна:</p>
    <img src="../img/1С-1/2023-08-09_08-25-26.png" class="screen" alt="">
    <p>Затем в пользовательской части теперь можно сделать отбор, например по группе "Стиральные машины":</p>
    <img src="../img/1С-1/2023-08-09_08-30-49.png" class="screen" alt="">
    <img src="../img/1С-1/2023-08-09_08-31-44.png" class="screen" alt="">
    <p>При закрытии окна отчёта настройки, сделанные пользователем, запоминаются и становятся настройками по умолчанию для текущего пользователя. Таким образом, пользователь сможет при наличии определенной квалификации задавать многие настройки по своему желанию.</p>
    <p>Если же такого желания или соответствующих знаний у него нет, лучше задавать эти настройки жёстко, а пользователю останется только включать или выключать их использование. Да, собственно, часто достаточно только отчётного периода или ещё какой-то жизненно важной настройки, и такие настройки, конечно, нужно размещать непосредственно в отчётной форме.</p>
    <p>Если приоритеты пользователя по использованию настроек отличаются от того, как они заданы разработчиком в схеме компоновки данных, то пользователь может изменить состав настроек, выполнив команду "Еще -> Изменить состав настроек…".</p>









    <h2 class="header-style" id="8">Вывод данных по всем дням в выбранный период.</h2>
    <p>Пока не записана тема. Начинается на странице 371 начинается эта тема.</p>










    <h2 class="header-style" id="9">Новый вариант отчета. Диаграмма</h2>
    <p>Пока не записана тема. Начинается на странице 384 начинается эта тема.</p>









    <h2 class="header-style" id="10">Получение актуальных значений из периодического регистра сведений</h2>
    <p>Пока не записана тема. Начинается на странице 390 начинается эта тема.</p>









    <h2 class="header-style" id="11">Тут будут записи по постройке диаграмм</h2>
    <p>Есть задача построить отчёт "Оценка покупателей". Этот отчёт должен выводит в виде круговой объёмной диаграммы. У всех диаграмм есть точки и серии. Круговая объёмная не требует ввод серии, достаточно только точки. Для точки указываем группировку "Покупатель":</p>
    <img src="../img/1С-1/2023-08-23_08-43-17.png" class="screen-2" alt="">
    <p>Не забываем в поле "Выбранные поля" выбрать ресурс, это как раз то, чем заполнятся сектора в этой диаграмме.</p>
    <p>В быстрые настройки пользователя также можно включать смену диаграмм. Для этого выделяем строку с диаграммой в поле "Другие настройки" и справа как и для параметров жмём на кнопку добавления их в настройки пользователя.</p>
    <img src="../img/1С-1/2023-08-23_08-54-45.png" class="screen" alt="">










    <h2 class="header-style" id="12">Пользовательские поля в отчёте в пользователском режиме</h2>
    <p>Описал 2 примера, как пользователь может создать для отчёта свои поля и для него составить отбор или выражение. Посмотреть можно в разделе "1С программирование" -> Регистр накопления -> (Регистр "Взаиморасчеты" и отчёт по нему. "Пользователские поля" для отчёта).</p>












    <h2 class="header-style" id="resours">Вкладка "Ресурсы" в схеме компановки данных</h2>
    <p>Во вкладке "Ресурсы" выбираются из доступных поле числовие поля, по которым нужно подводить итоги. Эти поля можно выбрать нажам просто на кнопку с двумя стрелками, платформа сама выберет такие поля. Если не указывать для каждого выбранного поля выражение, то по умолчанию выберется агрегатная функция "СУММА".</p>









    <h2 class="header-style" id="parameters">Вкладка "Параметры" в схеме компановки данных</h2>
    <p>Тут буду описывать всякие разные случаи как можно задавать параметры для отчёта. У СКД есть свой язык выражений СКД.</p>
    <p><span class="vue-b">Примечание! Подробное описание языка выражений системы компоновки данных содержится во встроенной справке системы в разделе Справка > Содержание справки > Система компоновки данных > Язык выражений системы компоновки данных > Функции языка выражений системы компоновки данных > Работа с датами и временем.</span></p>
    <p><b id="parameters-1">Указываем для даты остатка конец дня и добавляем 1 секунду</b></p>
    <p>Допустим мы выбираем данные из виртуальной таблицы "остатки". У этой таблицы есть один параметр это дата, на которую нужно выбрать данные. Если не указать ничего, то выберутся данные на самую последнюю дату(11 октября 3999года). Ну а если мы указываем дату, то с помощью языка выражений мы можем вводимую дату пользователем подстроить как нам нужно.</p>
    <p>Например, ввёл пользователь сегодняшнее число(допустим 16 сентября), но система запишет это число так - 16.09.2023 00:00:00. Как видим это самое начало этой даты, а значит если сегодня кто то вводил какие то данные, то они не попадут в отчёт, потому что как видно из даты, данные попадут до этой даты. Значит нужно как то включить сегодняшние сутки в поиск и по ним. Нам нужно указать не 16.09.2023 00:00:00, а 16.09.2023 23:59:59. Для этого есть в языке выражений такое выражение как КонецПериода(&lt;параметр содержащий дату>, &lt;строковое обозначение конца чего(минуты, дня, недели) для даты>). Пишем такое выражение:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">КонецПериода(<span class="vue-r">&</span><span class="vue-b">Период</span>, <span class="vue-bl">"День"</span>)</span>
        </pre>
    </div>
    <p>Но остатки устроены так, что если у нас документ записал данные в 16.09.2023 23:59:59, то эти данные не войдёт в отчёт, потому что так устроенны остатки, берутся данные до указанной даты вполь до секунды, но данные на указанную секунду не берутся. Т.е. войдут данные все на 16.09.2023 23:59:58 включительно, а вот данные на 59 секунде не войдут. Нам нужно как добавить секунду к дате, чтобы данные вошли. Для этих случаев есть функция ДобавитьКДате(&lt;параметр содержащий дату>, &lt;числовое значение, сколько хотим добавить>, &lt;строковое значение, чего хотим добавить>):</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">ДобавитьКДате(КонецПериода(<span class="vue-r">&</span><span class="vue-b">Период</span>, <span class="vue-bl">"День"</span>), <span class="vue-bl">"Секунда"</span>, <span class="vue-b">1</span>)</span>
        </pre>
    </div>

    <p><b id="parameters-2">Выбираем данные для отчёта периодами(месяц, неделя, квартал), а не датами начала и конца регистра в режиме "обороты"</b></p>
    <p>Предположим мы делаем отчёт по продажам. Выбираем данные из регистра "Продажи" в режиме "обороты", а точнее из виртуальной таблицы "Продажи.Обороты". Как известно у этой таблицы есть 2 параметра на задание даты: дата начала и дата конца. Эти параметры СКД сама уже помещает на вкладке "Параметры". Мы хотим, чтобы у пользователя не было возможности указывать даты какие ему захочется, а была только возможность выбирать периодами. Например, выбрать за текущий месяц, неделю, квартал. Зададим ещё один параметр и назовём "ПериодОтчета", в колонке "Тип" тип данных зададим "СтандартныйПериод"(да, есть такой тип данных). В колонке "Значение" зададим период по умолчанию - "Этот месяц". А в колонках выражение для родных параметров таблицы зададим вот такие значения как на картинке. И ограничим отображение этих 2х параметров, а будем показывать только тот, что мы создали:</p>
    <img src="../img/1С-1/2023-09-16_08-38-44.png" class="screen" alt="">

    <p><b id="parameters-3">Галочка "Запрещать незаполненные значения".</b></p>
    <p>В форме отчёта у параметров можно не вводить значения дат, ошибки не будет, если не установлена галочка "Запрещать незаполненные значения" у параметра:</p>
    <img src="../img/1С-1/2024-04-30_21-10-24.jpg" class="screen" alt="">
    <p>Галочки использования параметров для отчёта оставляем, но значения этих параметров убираем и как видим отчёт будет пустой, но ошибок не будет. Отчёт пустой потому что, как я думаю, из-за того, что галочки указывают на то, что для отчёта нужно использовать именно те даты, которые будут в этих параметрах, а там даты пустые, т.е. даты начала и конца установлены на начало времён - 0001 01 01 00:00:00, а на эти даты нет никаких данных в базе.</p>

    <p><b id="parameters-4">Галочка "Использование".</b></p>
    <p>Если в этом поле установить значение "Всегда", то у параметров уберутся галочки слева, потому что параметры всегда будут применяться к отчёту:</p>
    <img src="../img/1С-1/2024-04-30_21-22-53.jpg" class="screen" alt="">
    <p>В этом случае флажок использования параметра в пользовательских настройках отсутствует, т.е. параметр используется всегда. Если дополнительно к этому установить также флажок "Запрещать незаполненные значения", то при формировании отчета с пустым значением параметра будет получена ошибка:</p>
    <img src="../img/1С-1/2024-04-30_21-29-04.jpg" class="screen" alt="">















    
    <h2 class="header-style" id="recomented">Советы:</h2>
    <p><b id="recomented-1">Отбор в запросе и сортировка с группировкой в СКД</b></p>
    <p>Отбор(вкладка "Условие" в конструкторе запроса) лучше делать в самом запросе, а вот сортировку и группировку лучше делать в настройке СКД, так как там можно гибче их настроить.</p>

    <p><b id="recomented-2">Псевдонимы для полей</b></p>
    <p>Псевдонимы для полей лучше сразу задать в запросе, потому что потом если нужно их поменять, то придётся менять в 3х местах схемы компоновки данных: "Поле", "Путь", "Автозаголовок" на закладке "Наборы данных".</p>












    <h2 class="header-style" id="how">Как:</h2>
    <p><b id="how-1">Как убрать заголовок ресурса из шапки отчёта</b></p>
    <p>Пока нашёл вот этот сайт - <a href="https://avditor.ru/index.php/programmirovanie-1s/70-1s-skd-kak-ubrat-zagolovok-resursa-iz-shapki-otchjota">тут</a>.</p>

    <p><b id="how-2">Как программно сформировать отчёт при его открытии</b></p>
    <p>Когда мы открываем отчёт, то потом жмём кнопку "Сформировать", чтобы отчёт сформировался. Но как сделать, чтобы отчёт сразу формировался при открытии. Как мы помним, у формы есть событие "ПриСозданииНаСервере". Вот в этом событии нам и нужно подправить стандарный параметр "СформироватьПриОткрытии" и поставить в него значение Истина:</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
                Параметры.СформироватьПриОткрытии = Истина;
            КонецПроцедуры
        </pre>
    </div>

    <p><b id="how-3">Как программно установить значения параметров "НачалоПериода" и "КонецПериода" и передать их в отчёт</b></p>
    <p>Встаёт вопрос, в каком модуле и в какой процедуре это делается? Для начала вот картинка последовательностей событий, которые возникают в модуле формы отчёта(конечно это не все события, которые есть у этой формы) и в модуле объекта отчёта:</p>
    <img src="../img/1С-1/2024-05-04_10-32-28.png" class="screen" alt="">
    <p>После события "ПриСозданииНаСервере" идут четыре события, поставляемые расширением формы для отчёта. Сначала выполняется загрузка настроек варианта отчёта (основного или выбранного пользователем при последнем запуске отчёта) в компановщик настроек. При этом вызываются события "ПередЗагрузкойВариантаНаСервере" и "ПриЗагрузкеВариантаНаСервере". Нам нужен обработчик "ПередЗагрузкойВариантаНаСервере", чтобы в нём изменить параметры настроек перед их загрузкой в компановщик:</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПередЗагрузкойВариантаНаСервере(Настройки)
                Настройки.ПараметрыВывода.УстановитьЗначениеПараметра("Заголовок", "Продажа системных блоков");
                Настройки.ПараметрыДанных.УстановитьЗначениеПараметра("НачалоПериода", '20240427');
                Настройки.ПараметрыДанных.УстановитьЗначениеПараметра("КонецПериода", '20240501');
            КонецПроцедуры 
        </pre>
    </div>
    <p>В параметре "Настройки" в обработчик передаются настройки варианта отчета, имеющие тип "НастройкиКомпоновкиДанных". В данном обработчике методом УстановитьЗначениеПараметра() изменен заголовок отчета, а также установлены значения параметров начала и конца отчетного периода.</p>
    <p>Однако если настройки являются пользовательскими, т.е. в конфигураторе для параметров "НачалоПериода" и "КонецПериода" была поставлена галочка в свойстве "Включать в пользовательские настройки":</p>
    <img src="../img/1С-1/2024-05-04_10-47-02.png" class="screen-2" alt="">
    <p>И пользователь хоть раз задавал их значения в форме отчета, то устанавливать их в этом обработчике бесполезно.</p>
    <p>Это происходит потому, что после загрузки настроек варианта отчета восстанавливаются пользовательские настройки, сделанные пользователем при последнем формировании отчета и самостоятельно сохранённые платформой. Пользовательские настройки накладываются на настройки варианта и загружаются в компоновщик настроек. При этом вызываются события "ПередЗагрузкойПользовательскихНастроекНаСервере" и "ПриЗагрузкеПользовательскихНастроекНаСервере".</p>
    <p>Поэтому если мы хотим изменить программно и настройки пользовательские, то нужно обработать и их тоже:</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПередЗагрузкойПользовательскихНастроекНаСервере(Настройки)
                Настройки.Элементы[0].Значение = '20111201';
                Настройки.Элементы[0].Использование = Истина;
                Настройки.Элементы[1].Значение = '20111231';
                Настройки.Элементы[1].Использование = Истина;
            КонецПроцедуры
        </pre>
    </div>
    <p>В параметре "Настройки" в обработчик передаются настройки варианта отчета, имеющие тип "ПользовательскиеНастройкиКомпоновкиДанных". Так как параметра всего два, то можно обращаться к ним по индексу (0, 1) в коллекции элементов пользовательских настроек. Мы устанавливаем значения параметров начала и конца отчетного периода и задаем для них признак использования. Эти настройки загружаются в компоновщик настроек, и отчет формируется с заданными параметрами.</p>
    <p>Дальше платформа автоматически вызывает метод СкомпоноватьРезультат(), и происходит событие отчета "ПриКомпоновкеРезультата". Отчет компонуется и выводится пользователю.</p>

    <p><b id="how-4">Как программно установить значения параметров "НачалоПериода" и "КонецПериода", а также подправить элементы сортировки</b></p>
    <p>Код взят из книги про составление отчётов Хрусталёвой - пример 7. Не буду тут описывать, добавлю только картинку кода с объяснениями:</p>
    <img src="../img/1С-1/2024-05-06_12-29-31.jpg" class="screen" alt="">

    <p><b id="how-5">Как программно вывести в табличный документ отчёт</b></p>
    <p>Допустим у нас есть справочник "Номенклатура". В форме списка справочника сделаем кнопку "ОстаткиНоменклатуры":</p>
    <img src="../img/1С-1/2024-05-02_08-29-34.png" class="screen-2" alt="">
    <p>По этой кнопке мы хотим открыть отчёт с остатками номенклатуры. Этот отчёт мы заранее создали. В нём использовались две таблицы: Остатки из регистра накопления "ОстаткиНоменклатуры" и таблилица справочник "Номенклатура".</p>
    <p>Можно было бы открыть этот отчёт просто вызвав метод ОткрытьФорму():</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ОстаткиНоменклатуры(Команда)   
                ПараметрыФормы = Новый Структура("СформироватьПриОткрытии", Истина);
                ОткрытьФорму("Отчет.СписокНоменклатуры.ФормаОбъекта", ПараметрыФормы, ЭтаФорма,,,,, РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);
            КонецПроцедуры
        </pre>
    </div>
    <p>Но тут покажем как по шагам нужно вызывать отдельные части механизма СКД и в итоге вывести точно также отчёт в табличный документ. Вот для напоминания картинка, из каких частей состоит механизм СКД:</p>
    <img src="../img/1С-1/2024-05-02_08-35-56.png" class="screen" alt="">
    <p>Вот код для кнопки открытия отчёта:</p>
    <div class="code-style">
        <pre>
            --модуль списка формы справочника "Номенклатура"

            &НаКлиенте
            Процедура ОстаткиНоменклатуры(Команда)
                Результат = ВывестиСписокНоменклатуры();
                Результат.ОтображатьСетку = Ложь;
                Результат.ОтображатьЗаголовки = Ложь;
                Результат.Показать();
            КонецПроцедуры

            &НаСервереБезКонтекста
            Функция ВывестиСписокНоменклатуры()
                <span class="vue-g">// В качестве схемы компоновки данных используем макет отчета "Список Номенклатуры".</span>
                СхемаКомпоновкиДанных =
                Отчеты.СписокНоменклатуры.ПолучитьМакет("ОсновнаяСхемаКомпоновкиДанных");

                <span class="vue-g">// Получим настройки по умолчанию.</span>
                Настройки = СхемаКомпоновкиДанных.НастройкиПоУмолчанию;

                <span class="vue-g">// Сформируем макет компоновки данных.</span>
                КомпоновщикМакета = <span class="vue-r">Новый</span> <span class="vue-b">КомпоновщикМакетаКомпоновкиДанных</span>;
                МакетКомпоновки = КомпоновщикМакета.Выполнить(СхемаКомпоновкиДанных, Настройки);

                <span class="vue-g">// Выполним компоновку данных.</span>
                ПроцессорКомпоновкиДанных = <span class="vue-r">Новый</span> <span class="vue-b">ПроцессорКомпоновкиДанных</span>;
                ПроцессорКомпоновкиДанных.Инициализировать(МакетКомпоновки);

                <span class="vue-g">// Выведем результат компоновки в табличный документ.</span>
                ДокументРезультат = Новый ТабличныйДокумент;
                ПроцессорВывода = <span class="vue-r">Новый</span> <span class="vue-b">ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент</span>;
                ПроцессорВывода.УстановитьДокумент(ДокументРезультат);
                ПроцессорВывода.Вывести(ПроцессорКомпоновкиДанных);

                Возврат ДокументРезультат;
            КонецФункции
        </pre>
    </div>
    <p>Между двумя этими способами открытия отчёта будет небольшая разница. Если открыть отчёт с помощью открытия формы, то пользователю будет доступны стандартные услуги - выбор варианта отчёта, открытие формы пользовательских настроек, работа с расшифровкой и т.д. Также при открытии формы отчёта отчёт выводится стандартно в табличный документ, а при способе вызова разных частей СКД, можно выводить не только в табличный документ, но и в таблицы значений, дерево значений и т.д.</p>

    <p><b id="how-6">Как отобразить в отчёте кросс-таблицу по данным справочника</b></p>
    <p>Дело в том, чтобы сделать пересечённую таблицу нужно указать группировку в строке, в колонке и на их пересечении нужно обязательно указать ресурс, но мы выводим данные справочника и там нет ресорсов как таковых, это же не регистр. Ресурс нам нужно самим указать.</p>
    <p>Например, выведем контактные данные контрагентов из типовой УТ 11.4. В этом справочнике есть табличная часть "КонтактнаяИнформация" и в ней есть такие поля как "Вид" и "Представление". Вид содержит ссылки на другой справочник и выглядт ссылка по типу: "Фактический адрес", "Юридический адрес", "Почта" и т.д. Это поле в кросс-таблице мы укажем в колонки, в строки укажем контрагента, выбрав поле ссылка в табличной части. Ну а что же будет ресурсом на пересечении колонок и строк. Как уже сказал есть ещё поле "Представление", оно содержит значения адресов, почт и прочее в виде строки, вот это и будет ресурсом.</p>
    <p>Мы когда в СКД дойдём до вкладки "Ресурсы", то выберем в правую сторону поле "Представление" и во вкладке "Выражение" оставим вместо функций просто поле:</p>
    <p><span class="vue-r">Вместо </span> Количество(Представление) <span class="vue-r">сделаем просто</span> Представление</p>
    <img src="../img/1С-1/2024-11-13_20-29-02.png" class="screen" alt="">

    

</div>
