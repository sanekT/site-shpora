<div class="wrap">
    <h2 class="header-style">HTTP-заголовки ответа сервера</h2>
    <p>Функция для посыла заголовка ответа это <b>header(). В видео Уровень 2 день 1 это можно посмотреть с 01:12:20</b></p>
    
    <h3 class="header-style2">Переадресация и презапрос ресурса</h3>
    <img class="screen" src="../img/php/7.png" alt="">
    <p>Заголовок <b>Location</b> переадресует пользователя на другой ресурс. Когда мы делаем запрос на сервер, то вместе с заголовком Location приходит и статус кода 302. Например у нас на сайте есть форма в которой есть список select:</p>
    <div class="code-style">
        <pre>
            &lt;select name="url">
                &lt;option value="https://www.google.com">Гугл&lt;/option>
                &lt;option value="https://www.yandex.ru">Яндекс&lt;/option>
                &lt;option value="https://www.vk.com">ВК&lt;/option>
            &lt;/select>
        </pre>
    </div>
    <p>Пользователь выбирает пункт и отправляет форму, данные формы приходят на файл обработчик, в файле код получает url и посылает браузеру заголовок Location с этим адресом:</p>
    <div class="code-style">
        <pre>
            $url = strip_tags($_GET["url"]);
            if($url){
                header("Location : $url");
                exit;
            }
        </pre>
    </div>
    <p>И браузер послушно переходит на присланный адрес. Конструкция exit нужна для того, чтобы php не исполнял дальше код, так как уже в нём нет необходимости, так как заголовок улетел и браузер уже не получит дальнейший результат кода.</p>
    <p><b>Ещё один полезный способ использование этого заголовка</b>. Например есть на странице форма, мы её заполняем и отправляем данные методом POST и хотим обновить страницу, а обновление страницы это повторное послание последнего запроса. И если ннажать обновить, то появится предупреждение о повторной отправке формы, а это повторная перезапись данных в базу данных или ещё что то. Чтобы не отправлялась повторно форма, то в обработчике после всех действий с данными посылаем Location браузеру, чтобы он без нашего участия обновил страницу методом GET:</p>
    <div class="code-style">
        <pre>
            //пришли данные методом post, мы их обработали и посылаем браузеру заголовок Location
            header("Location: " . $_SERVER["PHP_SELF"]);
        </pre>
    </div>
    <p>После прихода ответа от сервера сделались все свои дела, установились там куки например и браузер должен обновить страницу, то есть сделать запрос на ту страницу на которой и находимся, но уже методом get и уже получается что последний запрос это запрос методом get, значит получается мы отправили данные методом post запрос обработался и пришёл ответ, браузер обновил страницу автоматом и теперь если мы захотим сами вручную обновить страницу, то будет выполняться последний запрос методом get, а значит повторно уже форма отправлятся не будет.</p>
    <p><b>Как перенаправить пользователя на новый адрес сайта</b>. Есть 2 способа, первый это как показано на картинке отправить 2 заголовка или послать послать один заголовок, но с дополнительными аргументами. Если мы переадресуем пользователя на другой сайт, то надо вернуть браузеру статус 301 и адрес, куда надо перейти.</p>
    <p><b>Refresh</b> - этот заголовок заставляет браузер перезагружать страницу на которой находится, время через которое надо перезапустить указанны в его значении. Если через ; указать url адрес, то через указаное время перейти на этот адрес.</p>
    <h3 class="header-style2">Заголовок Content-Type</h3>
    <p>Когда браузер запрашивает страницу, то он не знает что там придёт, сервер для этого посылает заголовок Content-Type с указанием, какой он прислал формат данных. Часто можно увидеть там такое значение:</p>
    <p><b>Content-Type: text/html; charset=UTF-8</b></p>
    <p>Это значит что пришёл формат данных - HTML в кодировке utf-8.</p>
    
    
    
    
    
    <h3 class="header-style2">Как скачать страницу в .txt, .rtf</h3>
    <p>Когда мы делаем запрос на сервер, то он нам возвращает страницу-файл в виде байтов и браузер по умолчанию их выводит на экран, но мы можем сказать браузеру, чтобы он нам записал эти байты в какой то файл и дал скачать. Как это сделать? Для этого есть такие заголовки:</p>
    <p><b>header("Content-Type: file/octet-stream");</b></p>
    <p><b>header("Content-Disposition: attachment; filename='mytext.txt'");</b></p>
    <p>Если написать эти заголовки в начале какой нибудь html страницы и запросить эту страницу, то автоматом будет создан файл mytext.txt, куда запишутся все байты этой страницы и автоматом будет скачан ко мне на комп в папку Загрузки(ну это у меня так):</p>
    <img class="screen" src="../img/php/8.png" alt="">
    <p>Мы также можем скачивать файлы и в формате rtf, это формат для word документов, подробнее расскажет специалист c01:54:00</p>
    
    
    
    
    
    <h3 class="header-style2">Кеширование данных</h3>
    <p>Рассказывает с 01:54:00</p>
    <p>З ауправление кешированием отвечают следующие заголовки:</p>
    <div class="code-style">
        <pre>
            //запрет кеширования
            <span class="vue-b">header</span>(<span class="vue-r">"Cache-Control: no-cache, max-age=0"</span>);
            
            //полный запрет кеширования
            <span class="vue-b">header</span>(<span class="vue-r">"Cache-Control: no-store"</span>);
            
            //разрешение кеширование на 1 час относительно времени запроса
            <span class="vue-b">header</span>(<span class="vue-r">"Cache-Control: max-age=3600"</span>);
            
            //разрешение кеширования на 1 час
            <span class="vue-b">header</span>(<span class="vue-r">"Expires: " </span><span class="vue-b">. date("r", time() + 3600)</span>);
        </pre>
    </div>
    
    
    
    <h3 class="header-style2">Буферизация вывода</h3>
    <p>02:19:01</p>
    <p>Буферизация нужна для того чтобы не было ошибок, когда мы посылаем заголовки после вывода типа echo. Пока не буду описывать эти функции буферизации, если понадобится, вернусь к видео, время указано в начале. </p>
    
    
</div>
