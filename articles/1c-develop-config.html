<div class="wrap">
   
    <h3 class="header-style">Шпора по книге Хрусталёвой "Пособие разработчика"</h3>


    <ul class="list">
        <li><a href="#1">1. </a></li>
        <li><a href="#2">2. </a></li>
        <li><a href="#3">3. </a></li>
        <li><a href="#4">4. Документы </a></li>
        <li><a href="#5">5. Теоретическое</a></li>
        <li><a href="#6">6. Регистры накопления</a></li>
        <li><a href="#7">7. Простой отчёт</a></li>
        <li><a href="#8">8. Макеты. Редактирование макетов</a></li>
        <li><a href="#9">9. Периодические регистры сведений</a></li>
        <li><a href="#10">10. Перечисления</a></li>
        <li><a href="#11">11. Проведение документа по нескольким регистрам</a></li>
        <li><a href="#12">12. Оборотные регистры накопления</a></li>
        <li><a href="#13">13. Отчёты</a></li>
        <li><a href="#14">14. Оптимизация проведения документа "Оказание услуги"</a>
            <ul class="list2">
                <li><a href="#14.1">Теория: особенности использования ссылочных данных</a></li>
                <li><a href="#14.2">Повышение скорости проведения</a></li>
                <li><a href="#14.3">Автоматический расчёт стоимости</a></li>
                <li><a href="#14.4">Теория:</a>
                    <ul class="list2">
                        <li><a href="#14.4.1">Как быстро посмотреть результат запроса</a></li>
                        <li><a href="#14.4.2">Оперативное и неоперативное проведение</a></li>
                        <li><a href="#14.4.3">Понятие момента времени и оперативной отметки времени</a></li>
                    </ul>    
                </li>
                <li><a href="#14.5">Контроль остатков</a></li>
                <li><a href="#14.6">Блокировка данных, которые читаются и изменяются при проведении</a></li>
                <li><a href="#14.7">Выделение произвольных областей модуля</a></li>
                <li><a href="#14.8">Теория устройства кеша:</a>
                    <ul class="list2">
                        <li><a href="#14.8.1">Обычный кеш</a></li>
                        <li><a href="#14.8.2">Транзакционный кеш</a></li>
                    </ul>     
                </li>
                <li><a href="#14.9">Контрольные вопросы</a></li>
            </ul>
        </li>
        <li><a href="#15">15. План видов характеристик</a></li>
        <li><a href="#16">16. Бухгалтерский учёт. <span class="светло_красный">Описан почти полностью.</span></a>
            <ul class="list2">
                <li><a href="#16.1">ПВХ в бух учёте</a></li>
                <li><a href="#16.2">Добавление ПВХ</a></li>
                <li><a href="#16.3">Что такое "План счетов"</a></li>
                <li><a href="#16.4">Добавление плана счетов</a></li>
                <li><a href="#16.5">Что такое регистр бухгалтерии</a></li>
                <li><a href="#16.6">Добавление регистр бухгалтерии</a></li>
                <li><a href="#16.7">Доработка приходной накладной</a></li>
                <li><a href="#16.8">Доработка документа "ОказаниеУслуги"</a></li>
                <li><a href="#16.9">Оборотно-сальдовая ведомость</a></li>
                <li><a href="#16.10">Контрольные вопросы</a></li>
            </ul>
        </li>
        <li><a href="#17">17. План видов расчёта, регистры расчёта. <span class="светло_красный">Пока остановился на 559 стр</span></a>
            <ul class="list2">
                <li><a href="#17.1">Зачем нужен план видов расчёта и регистр расчёта?</a>
                    <ul class="list2">
                        <li>Зависимость по базовому периоду</li>
                        <li>Вытеснение по периоду действия</li>
                    </ul>
                </li>
                <li><a href="#17.2">Что такое план видов расчёта</a></li>
                <li><a href="#17.3">Добавление плана видов расчёта</a></li>
                <li><a href="#17.4">Что такое регистр расчёта?</a>
                    <ul class="list2">
                        <li>Периодичность</li>
                        <li>Вытеснение по периоду действия</li>
                        <li>Зависимость по базовому периоду</li>
                        <li>Зависимость по периоду действия</li>
                        <li>Зависимость по периоду регистрации</li>
                    </ul>
                </li>
                <li><a href="#17.5">Добавление регистра расчета</a></li>
                <li><a href="#17.6">В режиме «1С:Предприятие» </a></li>
            </ul>
        </li>
        <li><a href="#18">18. Использование регистра расчёта <span class="светло_красный">Пусто</span></a></li>
        <li><a href="#19">19. Поиск в базе данных</a>
            <ul class="list2">
                <li><a href="#19.1">Общие сведения о механизме полнотекстового поиска в данных</a></li>
                <li><a href="#19.2">Полнотекстовый индекс</a></li>
                <li><a href="#19.3">Варианты использования глобального поиска</a>
                    <ul class="list2">
                        <li><a href="#19.3.1">Интерактивный поиск</a></li>
                        <li><a href="#19.3.2">Программная настройка глобального поиска</a></li>
                    </ul>
                </li>
                <li><a href="#19.4">Контрольные вопросы</a></li>
            </ul>
        </li>
        <li><a href="#20">20. Выполнение заданий по расписанию</a>
            <ul class="list2">
                <li><a href="#20.1">Постановка задачи</a></li>
                <li><a href="#20.2">Что такое регламентное задание</a></li>
                <li><a href="#20.3">Создание регламентных заданий</a></li>
                <li><a href="#20.4">Запуск регламентных заданий</a></li>
            </ul>
        </li>
        <li><a href="#21">21. Редактирование движений в форме документа</a></li>
        <li><a href="#22">22. Список пользователей и их роли <span class="светло_красный">Описано полностью</span></a>
            <ul class="list2">
                <li><a href="#22.1">Что такое роль</a></li>
                <li><a href="#22.2">Создание ролей</a></li>
                <li><a href="#22.3">Добавление новых пользователей</a></li>
                <li><a href="#22.4">Ограничение доступа к данным на уровне записей и полей базы данных (RLS)</a></li>
            </ul>
        </li>
        <li><a href="#23">23. Начальная страница и настройка командного интерфейса <span class="светло_красный">Пусто</span></a></li>
        <li><a href="#24">24. Обмен данными</a></li>
        <li><a href="#25">25. Функциональные опции <span class="светло_красный">Пусто</span></a></li>
        <li><a href="#26">26. Организация подборов, особенности разработки в режиме без использования модальности и ввод данных на основании <span class="светло_красный">Пусто</span></a></li>
        <li><a href="#27">27. Приёмы разработки форм. <span class="светло_красный">Описан полностью.</span></a>
            <ul class="list2">
                <li><a href="#27.1">Данные и элементы формы</a></li>
                <li><a href="#27.2">Типы данных формы</a></li>
                <li><a href="#27.3">Связанные списки</a></li>
                <li><a href="#27.4">Оформление строк в форме списка</a></li>
                <li><a href="#27.5">Вычисляемые колонки в списках</a></li>
                <li><a href="#27.6">Список выбора для поля ввода</a></li>
                <li><a href="#27.7">Форма выбора для поля, содержащего ссылочный реквизит</a></li>
                <li><a href="#27.8">Проверка заполнения реквизитов</a></li>
                <li><a href="#27.9">Использование параметризованных команд</a></li>
                <li><a href="#27.10">Открыие формы списка с заданным отбором</a></li>
                <li><a href="#27.11">Контрольные вопросы</a></li>
            </ul>
        </li>
        <li><a href="#28">28. Приёмы редактирования форм</a>
            <ul class="list2">
                <li><a href="#28.1">Редактор формы.</a></li>
                <li><a href="#28.2">Разработка произвольной формы для редактирования документа «Оказание услуги»</a></li>
                <li><a href="#28.3">Как добавить в форму переключатель – тумблер</a></li>
                <li><a href="#28.4">Как сгруппировать данные в списке</a></li>
            </ul>
        </li>
        <li><a href="#1">1. </a></li>
    </ul>



    <h2 class="header-style2" id="4">Документы</h2>
    <p><b>Документ</b> - это объект конфигурации, который предназначен для описания информации о совершенных хозяйственных операциях или о событиях, произошедших в жизни организации вообще.</p>
    <p>Документ обладает способностью проведения. Факт проведения документа означает, что событие, которое он отражает, повлияло на состояние учета. Также документ имеет дату, которая фиксирует документ на оси времени. И ещё документ имеет механизм отслеживания правильности состояния учёта. Представлен в дереве конфигурации объектом Последовательности.</p>
    <p>У документа есть стандартные реквизиты и наиболее важные из них 2 - это Дата и Номер.</p>
    <p>У документа так же как и у справочника есть подчинённые объекты конфигурации - реквизиты и табличная часть. В отличии от справочника у документа есть вкладка Нумерация, где мы можем включить уникальность номеров.</p>
    <p>Реквизиты нужны для подробного описания документа, а табличные части для описания однородных данных, но разных по количеству.</p>
    <p>У документа есть 3 основных формы - форма документа, форма списка и форма выбора.</p>







    <h2 class="header-style2" id="5">Теоретическое</h2>
    <p><b>1</b>. Про механизм основных форм. Идёт рассказ про то, что у объектов конфигурации есть по несколько основных форм. Если разраб не назначил свою форму основной, то система по умолчанию создаёт свою.</p>
    <p>Форма создаётся на сервере тогда. когда происходит обращение к ней, причём неважно, интерактивное это обращнеи или программное.</p>
    <p><b>2</b>. Про обработчики событий. Следует различать два типа событий: события, связанные с формой и ее элементами, и все остальные. Разница заключается в том, что обработчики событий, связанных с формой и ее элементами, – назначаемые, а обработчики всех остальных событий – фиксированные.</p>
    <p>Назначение обработчика может выполняться интерактивно, при работе с формой в конфигураторе, или программно, используя методы формы и ее элементов – УстановитьДействие().</p>
    <p><b>3</b>. Про модули. </p>
    <p>Модуль управляемого приложения. Модуль выполняется при начале и при конце работы системы. В нём можно объявить переменную, приписать ей Экспорт и она станет доступна из любого другого модуля. Их доступность также обеспечивается для неглобальных общих модулей с установленным свойством Клиент. В контексте модуля управляемого приложения доступны экспортируемые процедуры и функции общих модулей.</p>
    <p>Общие модули. В общих модулях хранятся процедуры и функции, которые вызываются из других модулей системы. Сам по себе общий модуль не исполняется. Исполняются отдельные его процедуры/функции в момент их вызова из других модулей.</p>
    <p>Модули объектов. Эти модули вызываются тогда, когда программно создается этот объект средствами встроенного языка, например, методами СоздатьЭлемент() менеджеров справочников или СоздатьДокумент() менеджеров документов, либо когда пользователь создает новый элемент справочника или документ интерактивно.</p>
    <p>Модули форм. Этот модуль исполняется при создании объекта ФормаКлиентскогоПриложения встроенного языка. Этот объект создается системой в режиме 1С:Предприятие в тот момент, когда мы программно (методом ОткрытьФорму()) или интерактивно открываем форму некоторого элемента.</p>
    <p>Модуль сеанса. Модулем сеанса называется модуль, который автоматически выполняется при старте системы «1С:Предприятие» в момент загрузки конфигурации. Модуль сеанса предназначен для инициализации параметров сеанса и отработки действий, связанных с сеансом работы. Модуль сеанса не содержит экспортируемых процедур и функций и может использовать процедуры из общих модулей конфигурации.</p>
    <p>Модуль внешнего соединения предназначен для размещения в нем текстов функций и процедур, которые могут вызываться в сессии внешнего соединения.</p>
    <p>Модуль менеджера. Для каждого прикладного объекта существует менеджер, предназначенный для управления этим объектом как объектом конфигурации. С помощью менеджера можно создавать объекты, работать с формами и макетами. Модуль менеджера позволяет расширить функциональность менеджеров, предоставляемых системой, за счет написания процедур и функций на встроенном языке. Фактически это позволяет описать собственные методы для объекта конфигурации (например, справочника), которые относятся не к конкретному экземпляру объекта базы данных, а к самому объекту конфигурации. Например, в модуле менеджера можно задать произвольное представление объекта в интерфейсе «1С:Предприятия».</p>
    <p>Модуль команды. Как в самой конфигурации, так и у многих прикладных объектов, могут существовать подчиненные объекты конфигурации – Команды. У каждой команды существует модуль команды, в котором можно написать предопределенную процедуру ОбработкаКоманды() для выполнения этой команды.</p>
    <p><b>4</b>. Про контекст модуля формы.</p>
    <p>Каждый модуль связан с остальной частью конфигурации. Эта связь называется контекстом модуля. Контекст модуля определяет набор доступных во время выполнения модуля объектов, переменных, процедур и функций. Рассмотрим подробнее, из чего складывается контекст модуля формы:</p>
    <ul class="list">
        <li>локальным контекстом самого модуля формы;</li>
        <li>реквизитами формы, которой «принадлежит» модуль;</li>
        <li>свойствами и методами объекта ФормаКлиентскогоПриложения встроенного
            языка;</li>
        <li>свойствами и методами расширения формы, определяемого типом
            того объекта, данные которого содержатся в основном реквизите
            формы;</li>
        <li>глобальным контекстом, в том числе неглобальными общими
            модулями и экспортируемыми функциями и процедурами глобальных общих модулей;</li>
        <li>экспортируемыми переменными, процедурами и функциями
            модуля управляемого приложения.</li>
    </ul>
    <p>Про все пункты не буду расписывать. Единственное что хотел бы отметить, это про неглобальные и глобальные общие модули. Допустим если есть глобальный общий модуль и в нём экспортная функция, то вызвать её, например, из модуля формы можно просто сразу вызвав эту функцию. А вот если функция описана в неглобальном общем модуле, то вызов её осуществляется через написание имени общего модуля, а затем имя функции. Второй способ предпочтительней, т.к. глобальный общий модуль выполняестя сразу после запуска системы, а неглобальные запускаются на выполнение по мере их вызова.</p>
    <p><b>5</b>. Форма как программный объект.</p>
    <p>Помимо того что форма внутри своего модуля предоставляет доступ к различным частям конфигурации, она также доступна из других частей конфигурации как программный объект. При этом помимо стандартных свойств и методов объекта встроенного языка ФормаКлиентскогоПриложения у нее могут существовать и другие свойства и методы, определенные разработчиком. Только нужно не забывать про слово Экспорт у процедуры, которую хотим вызвать у программного объекта ФормаКлиентскогоПриложения</p>
    <div class="code-style">
        <pre>
            //модуль формы документа ПриходнаяНакладная
            &НаКлиенте
            Процедура МатериалыКоличествоПриИзменении(Элемент)
                СтрокаТабличнойЧасти = Элементы.Материалы.ТекущиеДанные;
                РаботаСДокументами.РассчитатьСумму(СтрокаТабличнойЧасти);
            КонецПроцедуры

            //где в другом модуле
            Форма = ПолучитьФорму("Документ.ПриходнаяНакладная.Форма.ФормаДокумента");
            Форма.МатериалыКоличествоПриИзменении();
        </pre>
    </div>
    <p><b>6</b>. <b>7</b>. <b>8</b>. Далее идёт объёмное описание процедур-обработчиков событий формы, как и где искать то что онаписано в коде. Также как пользоваться отладчиком кода, что такое окно выражений, табло и так далее.</p>
    <p><b>9</b>. Объекты, объекты, объекты....</p>
    <p>Как правило, термин объект употребляется в одном из трех контекстов:</p>
    <ul class="list">
        <li>конфигурация,</li>
        <li>база данных,</li>
        <li>встроенный язык.</li>
    </ul>
    <p>Говоря объект конфигурации мы обозначаем некоторую совокупность описания данных и алгоритмов работы с этими данными. На основании каждого объекта конфигурации в базе данных создается информационная структура(таблица), в которой будут храниться данные.</p>
    <p>Когда мы говорим о базе данных, термином «объект» мы обозначаем всего лишь некий элемент такой информационной структуры. Характерной особенностью такого элемента является то, что на него (как на совокупность данных) существует ссылка.</p>
    <p>Если же мы начинаем говорить о встроенном языке и о том, каким образом средствами встроенного языка работать со справочниками, то термином «объект» мы обозначаем тип данных, позволяющий получить доступ к данным и обладающий набором свойств и методов. Существует целый ряд объектов встроенного языка, позволяющих работать со справочниками (СправочникиМенеджер, СправочникМенеджер.&lt;имя>, СправочникСсылка.&lt;имя> и т.д.). Среди них есть один объект, который предоставляет доступ к объекту справочника в базе данных, – СправочникОбъект.&lt;имя> </p>
    <p><b>9</b>. Сервер и клиенты</p>
    <p>Система «1С:Предприятие» поддерживает два варианта работы системы: файловый и клиент-серверный.</p>
    <p>Основное назначение файлового варианта – быстро и легко установить систему и работать с ней.  В файловом варианте тоже можно вести реальную учетную работу, но при этом нужно понимать, что он не предоставляет абсолютно всех тех же возможностей по масштабируемости, защите данных, какие имеет клиент-серверный вариант.</p>
    <p>Клиент-серверный вариант предназначен для использования в рабочих группах или в масштабе предприятия. Он реализован на основе трехуровневой архитектуры «клиент-сервер». Клиентское приложение - Кластер серверов 1С - Сервер БД - БД. Главное, что пользователь не имеет непосредственного доступа к серверу баз данных, и это позволяет обеспечивать безопасность данных.</p>
    <p><b>10</b>. Компиляция общих модулей</p>
    <p>У общего модуля существует набор свойств: Клиент (управляемое приложение), Сервер и Внешнее соединение. Значения этих свойств (истина/ложь) определяют, где будут скомпилированы экземпляры этих модулей.</p>
    <p>В общем модуле РаботаСДокументами мы установили свойство Клиент (управляемое приложение). Это значит, что экземпляры этого модуля будут скомпилированы только на стороне клиента в контекстах тонкого клиента и веб-клиента.</p>
    <p>Тонкий клиент – это файл 1cv8c.exe. Именно его запускает платформа автоматически, когда мы начинаем отладку. Веб-клиент не существует в виде файла, потому что он исполняется не в среде операционной системы, а в среде интернет-браузера.</p>
    <p><b>10</b>. Директивы компиляции</p>
    <p>не буду описывать, понятно вроде.</p>






    <h2 class="header-style2" id="6">Регистры накопления</h2>
    <p>Регистры накопления учавствуют в создании механизма учёта накопления данных. Эти данные будут храниться в таблицах в виде отдельных записей, каждая из которых имеет одинаковую заданную в конфигураторе структуру. </p>
    <p>На основании таблицы движений регистра накопления система рассчитывает таблицу итогов регистра, которая хранит в базе данных итоги на момент времени последнего движения (актуальные итоги).</p>
    <p>Без создания регистра мы могли бы создать отчёты по документам, но представим, что в один прекрасный миг у нас появляется ещё один документ или несколько, придётся менять все отчёты. Но с регистрами нам не страшны добавления новых документов, всё равно все данные стекаются в конечную - в регистры и по ним уже строятся отчёты.</p>
    <p>К тому же отчёты строящиеся по документам будут работать медленее. Поэтому регистры созданы так, чтобы по ним было удобно собирать данные и предоставлять их пользователю.</p>
    <p>Отличительной особенностью регистра накопления является то, что он не предназначен для интерактивного редактирования пользователем. Изменять его предполагается на основе алгоритмов работы других объектов базы данных.</p>
    <p>Основным назначением регистра накопления является накопление числовой информации в разрезе нескольких измерений. Виды числовой информации, накапливаемой регистром накопления, называются ресурсами, также являются подчиненными объектами и описываются в конфигураторе. </p>
    <p>Изменение состояния регистра накопления происходит, как правило, при проведении документа и заключается в том, что в регистр добавляется некоторое количество записей. Каждая запись содержит значения измерений, значения приращений ресурсов, ссылку на документ, который вызвал эти изменения (регистратор), и «направление» приращения (приход или расход). Такой набор записей называется движениями регистра накопления. Каждому движению регистра накопления всегда должен соответствовать регистратор – объект информационной базы (как правило, документ), который произвел эти движения. </p>
    <p>Кроме этого, регистр накопления может хранить дополнительную информацию, описывающую каждое движение. Набор такой дополнительной информации задается разработчиком при помощи реквизитов объекта конфигурации Регистр накопления.</p>
    <p>Если документ является регистратором для регистра накопления,  то в форме документа в левой части окна редактора формы на закладке "Командный интерфейс" в пункте "Перейти" появится название этого регистра, мы можем сделать его видимым и тогда в форме документа в панели навигации появится ссылка для перехода в регистр накопления с записями этого документа.</p>
    <p>По книге мы сделали движения в созданный регистр накопления из документов "ПриходнаяНакладная" и "ОказаниеУслуги".</p>
    <p>В ходе создания движений по регистрам мы познакомились с коллекцией(табличная часть ПереченьНоменклатуры). Далее описание как в коде перебирать такие коллекции и как обратится к конкретному объекту коллекции через точку или квадратные скобки.</p>










    <h2 class="header-style2" id="7">Простой отчет</h2>
    <p>Объект конфигурации Отчет предназначен для описания алгоритмов, при помощи которых пользователь сможет получать необходимые ему выходные данные. Алгоритм формирования выходных данных описывается при помощи визуальных средств или с использованием встроенного языка. В реальной жизни объектам конфигурации Отчет соответствуют всевозможные таблицы выходных данных, сводных данных, диаграммы и пр.</p>
    <p>Далее идёт построение самого простого отчёта, описывать его нет смысла.</p>









    <h2 class="header-style2" id="8">Макеты. Редактирование макетов</h2>
    <p>Объект конфигурации Макет предназначен для хранения различных форм представления данных, которые могут потребоваться какимлибо объектам конфигурации или всему прикладному решению в целом.</p>
    <p>Макет может содержать табличный или текстовый документ, двоичные данные, HTML-документ или Active Document, графическую или географическую схему, схему компоновки данных или макет оформления схемы компоновки данных. </p>
    <p>Макеты могут существовать как сами по себе (общие макеты), так и быть подчинены какому-либо объекту конфигурации.</p>
    <p>Одно из предназначений макета, подчиненного объекту конфигурации и содержащего табличный документ, – создание печатной формы этого объекта. Создание печатной формы заключается в конструировании ее составных частей – именованных областей, из которых затем «собирается» готовая печатная форма.</p>
    <p>Далее мы через конструктор печати добавим кнопку Печать в документ ОказаниеУслуги и код, который выведет табличный документ с данными этого документа.</p>







    <h2 class="header-style2" id="9">Периодические регистры сведений</h2>
    <p>Нам нужно хранить для каждой услуги цену, но не просто последнюю цену, а чтобы мы могли хранить цены для услуги во времени. Тут нам поможет преиодический регистр сведений. Зачем нужно хранить цены во времени? Руководство может захотеть посмотреть как менялась прибыль от изменения цены на услугу.</p>
    <p>Объект конфигурации Регистр cведений предназначен для описания структуры хранения данных в разрезе нескольких измерений. На основе объекта конфигурации Регистр сведений платформа создает в базе данных таблицу, в которой может храниться произвольная информация, «привязанная» к набору измерений</p>
    <p>Принципиальное <b>отличие</b> регистра сведений от регистра накопления заключается в том, что каждое движение регистра сведений устанавливает новое значение ресурса, в то время как движение регистра накопления изменяет существующее значение ресурса. По этой причине регистр сведений может хранить любые данные (а не только числовые, как регистр накопления). </p>
    <p>Следующей важной особенностью регистра сведений является его способность (при необходимости) хранить данные с привязкой ко времени. Благодаря этому регистр сведений может хранить не только актуальные значения данных, но и историю их изменения во времени. Регистр сведений, использующий привязку ко времени, называют периодическим регистром сведений. </p>
    <p>Как и для других регистров, система контролирует уникальность записей для регистра сведений. Однако если для прочих регистров уникальным идентификатором записи является регистратор и номер строки, то для регистра сведений применяется другой принцип формирования ключевого значения.</p>
    <p>Ключом записи, однозначно идентифицирующим запись, является в данном случае совокупность значений измерений регистра и периода (в случае, если регистр сведений периодический). Например, для периодического регистра сведений с измерением Товар и ресурсом Цена ключом записи будет набор значений полей Период и Товар. Регистр сведений не может содержать несколько записей с одинаковыми ключами.</p>
    <p>Если продолжать сравнение с регистром накопления, то можно сказать, что регистр сведений предоставляет больше свободы в редактировании хранимых данных. Наряду с возможностью использования в режиме подчинения регистратору (когда записи регистра сведений «привязаны» к документу-регистратору) регистр сведений может применяться и в независимом режиме, в котором пользователю предоставляется полная свобода интерактивной работы с данными регистра. Регистр сведений, не использующий подчинение регистратору, называют независимым регистром сведений.</p>
    <p>Далее мы создаём регистр.</p>








    <h2 class="header-style2" id="10">Перечисления</h2>
    <p>Объект конфигурации Перечисление предназначен для описания структуры хранения постоянных наборов значений, не изменяемых в процессе работы конфигурации. На основе объекта конфигурации Перечисление платформа создает в базе данных таблицу, в которой может храниться набор некоторых постоянных значений. Значения перечисления не «обезличены» для конфигурации, на них могут опираться алгоритмы работы программы.</p>
    <p>Далее мы в модуле менеджера в событиях создаём своё представление номенклатуры, чтобы у нас в итоге номенклатура была с припиской - материал или услуга.</p>








    <h2 class="header-style2" id="11">Проведение документа по нескольким регистрам</h2>
    <p>Идёт рассказ, что нужно добавить ещё один регистр накопления, который учитывает себестоимость материалов. Проводим приходную накладную по 2м регистрам и документ ОказаниеУслуги.</p>
    <p>В данном случае на вопрос, для чего нам понадобилось создавать 2й регистр и проводить по нему 2 документа, можно ответить так - нам нужно учитывать не только количество товаров, но и их стоимость, чтобы знать на какую сумму у нас материалов на складе.</p>








    <h2 class="header-style2" id="12">Оборотные регистры накопления</h2>
    <p>До этого мы учитывали только материалы, их количество и стоимость, а услуги никак не учитываем. Вот для учёта услуг нужно добавить ещё один регистр накопления, но в режиме оборотов. Потому что учёт услуг осуществляется по другим критериям.</p>
    <p>Прежде всего, бессмысленно говорить о том, сколько услуг было и сколько их осталось, важна только сумма и количество услуг, которые были оказаны за определенный промежуток времени.</p>
    <p>В отличии от регистра в режиме остатков, оборотный регистр имеет всего одну вирт. таблицу - Обороты.</p>
    <p>Есть одна особенность в выборе данных для измерений. В оборотном регистре нет особой разницы какие данные должны являться измерениями, а вот в регистре с режимом Остатки, мы не можем спустя рукава подойти к выбору данных для измерений. Всё дело в том, что в этом режиме есть приход и расход, а значит нужно подбирать измерения так, чтобы и в приходе они были и в расходе, иначе нарушение этого принципа построения регистров накопления будет вести к непроизводительному использованию ресурсов системы и как следствие к замедлению работы и падению производительности.</p>
    <p>Для реквизитов же регистра этот принцип не важен. По реквизитам регистра ресурсы могут только приходоваться или только расходоваться.</p>
    <p>Далее создадим регистр Продажи, изменим обработку проведения документа ОказаниеУслуги, добавив туда 3й регистр.</p>








    <h2 class="header-style2" id="13">Отчёты</h2>
    <p><b>1.</b> Теория: способы доступа к данным</p>
    <p>Система «1С:Предприятие» поддерживает два способа доступа к данным, хранящимся в базе данных:</p>
    <ul class="list">
        <li>объектный(для чтения и записи);</li>
        <li>табличный(для чтения)</li>
    </ul>
    <p><i style="text-decoration: underline;">Объектный способ</i> доступа к данным воплощён посредством использования объектов встроенного языка.</p>
    <p>Важной особенностью объектного способа доступа к данным является то, что, обращаясь к какому-либо объекту встроенного языка, мы обращаемся к некоторой совокупности данных, находящихся в базе данных, как к единому целому. Например, объект ДокументОбъект.ОказаниеУслуги будет содержать значения всех реквизитов документа Оказание услуги и всех его табличных частей.</p>
    <p>Объектная техника обеспечивает сохранение целостности объектов, кеширование объектов, вызов соответствующих обработчиков событий и т.д.</p>
    <p><i style="text-decoration: underline;">Табличный способ</i> доступа к данным в «1С:Предприятии» воплощён с помощью запросов к базе данных, которые составляются на <i style="text-decoration: underline;">языке запросов</i>. В этой технике разработчик получает возможность оперировать отдельными полями таблиц базы данных, в которых хранятся те или иные данные.</p>
    <p>Табличная техника предназначена для получения информации из базы данных по некоторым условиям (отбор, группировка, сортировка, объединение нескольких выборок, расчет итогов и т.д.). Табличная техника оптимизирована для обработки больших объемов информации, расположенной в базе данных, и получения данных, отвечающих заданным критериям.</p>
    <p>Далее рассказ про реальные(ссылочные и не ссылочные таблицы) и виртуальные таблицы.</p>
    <p>Дальше идёт о строении языка запросов. Он состоит из нескольких частей:</p>
    <ul class="list">
        <li>описание запроса;</li>
        <li>объединение запросов;</li>
        <li>упорядочивание результатов;</li>
        <li>автоупорядочивание;</li>
        <li>описание итогов.</li>
    </ul>
    <p>Обязателен только первый пункт.</p>
    <p>Дальше пояснение что в каждой части находится.</p>
    <p>Затем про систему компановки данных. Из каких частей состоит она:</p>
    <ul class="list">
        <li><i style="text-decoration: underline;">схема компоновки данных</i>(состоит из текста запроса, набора данных, связи между ними, доступных полей, параметров получения данных и первоначальных настроек компоновки(структура отчёта, маке оформления и т.д.))</li>
        <li><i style="text-decoration: underline;">настройка компоновки данных</i></li>
    </ul>
    <p>Эти 2 части передаются в <i style="text-decoration: underline;">компановщик макета</i>, который создаёт макет. Это этап подготовки к исполнению отчета. Макет компоновки данных является уже готовым заданием для выполнения процессором компоновки. Он содержит необходимые запросы, макеты областей отчета и др.</p>
    <p>Затем <i style="text-decoration: underline;">процессор компоновки данных</i> выбирает данные из информационной базы согласно макету компоновки, агрегирует и оформляет эти данные/</p>
    <p>И <i style="text-decoration: underline;">результат компоновки</i> обрабатывается <i style="text-decoration: underline;">процессором вывода</i>, и в итоге пользователь получает результирующий табличный документ.</p>
    <p><b>2</b>. Выбор данных из одной таблицы</p>
    <p>Описывается создание отчёта "Список документов ОказаниеУслуги". Не буду переписывать, отчёт вполне простой. Выпишу только некоторые вещи.</p>
    <p>Имена полей лучше изменять в запросе, так как в этом случае в схему компоновки данных они перенесутся сразу в три колонки: Поле, Путь и Заголовок, и не нужно будет лишний раз их изменять.</p>
    <p>Упорядочим по окументу тоже в запросе. Дальше настройки и смотрим отчёт.</p>
    <p><b>3</b>. Выбор данных из двух таблиц</p>
    <p>Здесь делаем отчёт "Оценка услуг", который будет показывать, какие услуги принесли прибыли больше всего. Чтобы составить такой отчёт нам потребуются данные из 2х таблиц. В общем далее показано как создать такой отчёт, переписывать его смысла нет.</p>
    <p><b>4</b>.Вывод данных по всем дням в выбранном периоде</p>
    <p>Следующий отчет будет называться "Выручка мастеров". Тоже не буду описывать создание этого отчёта. Фишка этого отчёта в том, что тут показывают как вывести по всем дням в выбранном периоде.</p>
    <p><b>5</b>. Получение актуальных значений из периодического регистра сведений</p>
    <p>Следующий отчет – "Перечень услуг" – будет содержать информацию о том, какие услуги и по какой цене оказывает ООО «На все руки мастер». Фишка этого отчёта в том, чтобы показать как получать последние данные из регистра сведений на указанную дату.</p>
    <p><b>6</b>. Использование вычисляемого поля в отчете</p>
    <p>Следующий отчет – Рейтинг клиентов – будет показывать в графическом виде, каков доход от оказания услуг каждому из клиентов за все время работы ООО «На все руки мастер».</p>
    <p>На его примере мы покажем возможность использования вычисляемого поля и вывод результата в виде круговой диаграммы и в виде гистограммы.</p>
    <p><b>7</b>. Вывод данных в таблицу</p>
    <p>На примере создания универсального отчета мы покажем вывод данных в таблицу. Также создадим для пользователя все возможности для изменения структуры отчёта и внешнего вида, не обращаясь к полным настройкам отчёта(Ещё - Изменить вариант).</p>
    <p><b>8</b>. Теория: виртуальные таблицы запросов</p>
    <p>Виртуальные таблицы это по сути своей результат запросов системы при нашем запросе к ним. Мы и сами могли бы выбрать данные так как предоставляет их нам система в виде виртуальных таблиц, но у нас бы это получилось не отлаженно, чем это сделает система.</p>
    <p>Далее описывается 2 причины, почему система сделает это лучше.</p>









    <h2 class="header-style2" id="14">Оптимизация проведения документа "Оказание услуги"</h2>
    <p>В этой главе полностью будет переделываться обработкаПроведения документа "ОказаниеУслуги", потому что нам нужно самостоятельно рассчитывать стоимость материалов, ввести контроль остатков и убрать обращение к полю "ВидНоменклатуры" через точку.</p>
    <p><b id="14.1">1</b>. Теория: особенности использования ссылочных данных</p>
    <p>Доступ к ссылочным данным можно осуществить через объектную модель или через язык запросов.</p>
    <p>Термином «ссылочные данные» мы будем обозначать данные, хранящиеся в базе данных, доступ к которым возможен при помощи объектов встроенного языка вида Ссылка: СправочникСсылка.&lt;имя>, ДокументСсылка.&lt;имя> и т.д.</p>
    <p>Ну тут рассказ про это поле "ВидНоменклатуры", к которому мы обращаемся через точку. У нас в оперативной памяти на данный миг загружен полностью объект ДокументОбъект.ОказаниеУслуги со всеми данными. И в поле табличной части "Номенклатура" лежит всего лишь ссылка на номенклатуру и больше ничего, и когда мы обращаемся к виду номенклатуры через эту ссылку - Номенклатура.ВидНоменклатуры, то идёт дополнительный запрос в БД. Из БД загружается в оперативную память весь объект номенклатуры со всеми полями и табличными частями и только потом из оперативной памяти из этого загруженного объекта получаем значение поля "ВидНоменклатуры". Это всё очень замедлит работу, если в табличной части документа будем много номенклатур.</p>
    <p><b id="14.2">2</b>. Повышение скорости проведения</p>
    <p>Теперь на практике мы избавляемся от обращения к виду номенклатуры через точку. Используем для этого язык запросов.</p>
    <p><b id="14.3">3</b>. Автоматический расчет стоимости</p>
    <p>До сих пор стоимость расходуемых материалов мы вписывали в документ Оказание услуги вручную, при его создании.</p>
    <p>Теперь же будем определять стоимость номенклатуры по среднему: для каждой номенклатуры делить ее общую, суммарную стоимость на то количество этой номенклатуры, которое у нас имеется, и таким образом получать среднюю стоимость одной единицы этой номенклатуры.</p>
    <p>Для этого нам понадобятся данные 3х таблиц. Далее идёт долгое составление запроса с 3мя таблицами.</p>
    <p><b id="14.4.1">4.1</b>. Теория. Как быстро посмотреть результат запроса</p>
    <p>Не буду долго описавыть, в общем речь про инструкцию кода, которую можно посмотреть через окно выражений при отладке:</p>
    <div class="code-style">
        <pre>
            ТЗ = РезультатЗапроса.Выгрузить();
        </pre>
    </div>
    <p><b id="14.4.2">4.2</b>. Теория. Оперативное и неоперативное проведение документов</p>
    <p>Контроль остатков мы проверяем только тогда, когда документ проводится оперативно.</p>
    <p><i style="text-decoration: underline;">Оперативное проведение</i> нужно, когда мы ведём оперативный учёт(например, при складском учёте товаров) и позволяет организовать работу с документами в условиях настоящей действительности. Оперативный учёт в 1С простыми словами можно описать как систему поддержки текущей хозяйственной деятельности. Однако можно отключить этот механизм и воплотить собственные алгоритмы, проверять актуальность документов на оси событий и т.д.</p>
    <p>Оперативное проведение особо востребовано при многопользовательском режиме работы, где нужно осуществлять максимум проверок, способных исключить ошибки при вводе данных пользователями. Например, при оперативном проведении следует выполнять контроль остатков на складе списываемой номенклатуры с тем, чтобы исключить одновременную продажу одного товара несколькими продавцами.</p>
    <p><i style="text-decoration: underline;">Неоперативное проведение</i> документов подразумевает отражение в базе данных фактов, которые свершились в прошлом или которые точно будут совершены в будущем. Поэтому задача неоперативного проведения документов – просто отразить в информационной базе данные о совершенных операциях.</p>
    <p>При неоперативном проведении документов не имеет смысла производить целый ряд проверок, в частности контроль остатков. Подразумевается, что если в процессе неоперативного проведения документов были допущены ошибки (например, списано такое количество номенклатуры, которого не было на складе на дату проведения документа), то анализ полученного состояния базы данных является отдельной задачей, не относящейся к неоперативному проведению и выполняющейся не в момент проведения документа, а тогда, когда в базе имеются достаточные данные для анализа, например, когда введены более ранние документы, приходующие товары.</p>
    <p>Таким образом, оперативное проведение служит для того, чтобы в реальном режиме многопользовательской работы определить возможность или невозможность выполнения той или иной операции (и выполнить ее, если возможно). Неоперативное проведение предназначено для безусловного отражения в базе операций, которые уже были совершены (или точно будут совершены).</p>
    <p><b id="14.4.3">Понятие момента времени</b>. С оперативным проведением документов связано понятие оперативной отметки времени и понятие момента времени. Прямо сейчас нам эта информация не понадобится, но раз уж зашла речь об оперативном проведении, есть подходящий случай рассказать об этом.</p>
    <p>Для определения положения документа на оси времени используется реквизит документа Дата. Дата содержит время с точностью до секунды. Это позволяет контролировать последовательность записи документов. Однако при большом объеме создаваемых документов вероятна ситуация, когда несколько документов будут иметь одинаковое значение даты (т. е. будут созданы в течение одной секунды). Как в этом случае определить последовательность созданных документов?</p>
    <p>Для обработки подобных ситуаций было введено понятие момент времени. <i style="text-decoration: underline;">Момент времени</i> представляет собой совокупность даты, времени и ссылки на объект базы данных. Он позволяет однозначно идентифицировать любой объект ссылочного типа базы данных на оси событий, но имеет смысл в основном только для документов. Кроме того, момент времени позволяет идентифицировать и необъектные данные, например, записи регистров, подчиненных регистратору.</p>
    <p>Понятие момента времени реализовано во встроенном языке при помощи универсального объекта МоментВремени. Этот объект имеет свойства Дата и Ссылка, которые позволяют получить «составляющие» момента времени, и один метод – Сравнить(), при помощи которого возможно сравнение двух моментов времени между собой. Кроме этого, объект МоментВремени имеет конструктор и может быть создан в явном виде для любого объекта базы данных ссылочного типа.</p>
    <p><i style="text-decoration: underline;">Оперативная отметка времени</i>. В общем суть этой отметки в том, что система смотрит на дату проводимого документа и если дата сегодняшняя, то время для даты обновляется под текущее и без разницы, проводим или перепроводим документ. Но если дата уже вчерашняя, то документ проводится неоперативно, т.е. ни дата ни время не меняются.</p>
    <p><b id="14.5">5</b>. Контроль остатков</p>
    <p>Короче говоря, это "новая методика" контроля остатков.</p>
    <p>Общая методика контроля остатков при проведении документа заключается в следующем: сначала, не глядя ни на что, нужно записать движения документа, а затем, когда движения уже записаны, прочитать из базы данных остатки.</p>
    <p>Если появились отрицательные остатки, значит, такой документ проводить нельзя. Нужно сообщить пользователю, каких материалов не хватает, и отменить проведение документа.</p>
    <p>Далее мы дописываем в обработке проведения код, который проверяет остатки и если есть отрицательные, то сообщаем пользователю.</p>
    <p><b id="14.6">6</b>. Блокировка данных, которые читаются и изменяются при проведении</p>
    <p>Тут рассказывается про блокировку данных, которые мы выбираем из БД. Ничего особо там нвого нет, поэтому описывать не буду.</p>
    <p><b id="14.7">7</b>. Выделение произвольных областей модуля</p>
    <p>Тут мы процедуту "ОбработкаПроведения" документа "ОказаниеУслуги" разбиваем на области для понимания, что где находится в коде.</p>
    <p><b id="14.8">8</b>. Теория: устройство кеша</p>
    <p>Система «1С:Предприятие» использует механизм кеширования данных объектов, считанных из базы данных при использовании объектной техники. Таким образом, для получения реквизитов какого-либо объекта через ссылку выполняется обращение к кешу объектов, расположенному в оперативной памяти.</p>
    <p>Кеш объектов состоит из двух частей: транзакционного кеша и обычного кеша. В зависимости от того, происходит ли обращение в рамках транзакции или нет, в действие вступает тот или иной кеш.</p>
    <p>Все данные, находящиеся в кеше, предназначены только для чтения (ReadOnly). Таким образом, чтение любых данных, получаемых через ссылку, выполняется только через кеш объектов, а запись – механизмами самих программных объектов.</p>
    <p><i style="text-decoration: underline;" id="14.8.1">Обычный кеш</i>. </p>
    <p>Если при обращении к обычному кешу требуемых данных в нем нет, то выполняется чтение данных объекта из базы данных и сохранение их в кеше. Уникальным идентификатором для кеша в данном случае будет являться ссылка на объект базы данных. Поэтому данные каждого считанного объекта могут существовать в кеше в одном из двух видов: либо все данные объекта, либо представление объекта.</p>
    <p>Таким образом, если мы обратимся к кешу для получения представления объекта и в кеше есть информация для нашей ссылки, данные будут взяты из кеша (если в кеше весь объект, нужное представление будет получено из данных объекта).</p>
    <p>Если в кеше нет информации для нашей ссылки, из базы данных в кеш будут считаны только поля, необходимые для формирования представления объекта.</p>
    <p>Если мы обратимся к кешу для получения реквизита объекта и в кеше есть информация для нашей ссылки, дальнейшие действия будут зависеть от того, что находится в кеше.</p>
    <p>Если в кеше весь объект, значение реквизита будет получено из кеша. Если в кеше представление объекта, оно будет удалено из кеша, и в кеш будут считаны все данные объекта. Если же при получении реквизита объекта в кеше нет информации для нашей ссылки, из базы данных будут считаны все поля объекта.</p>
    <p>Считанные данные будут находиться в кеше до тех пор, пока не наступит одно из следующих событий:</p>
    <ul class="list">
        <li>считанные данные будут вытеснены из кеша другими считанными данными других объектов (переполнение кеша);</li>
        <li>при очередном обращении к кешу окажется, что считанные данные были изменены в базе данных;</li>
        <li>закончится интервал времени в 20 минут.</li>
    </ul>
    <p>Все считанные данные помещаются в последовательную очередь, и, поскольку объем кеша ограничен, наиболее старые данные будут вытесняться из кеша последними считанными.</p>
    <p>При повторном обращении к кешу за данными уже считанного объекта будет анализироваться интервал времени, прошедший с момента появления данных в кеше.</p>
    <p>Если обращение происходит в пределах 20 секунд после поступления данных в кеш, данные считаются верными (валидными). Если интервал превысил 20 секунд, будет выполняться проверка на соответствие версии данных, хранящихся в кеше, версии данных, находящихся в базе данных.</p>
    <p>Если окажется, что версии данных не совпадают (т. е. произошло изменение данных в базе данных), данные, находящиеся в кеше, будут удалены из него, и будет выполнено повторное считывание данных из базы данных. Начиная с этого момента, идет отсчет следующего 20-секундного интервала валидности этих данных.</p>
    <p>Кроме всех вышеперечисленных событий считанные данные будут удалены из кеша по истечении 20 минут после их последнего считывания из базы данных.</p>
    <p>Таким образом, при последовательном выполнении двух операторов где Номенклатура – это ссылка на объект справочника, на выполнение второго оператора будет тратиться гораздо меньше времени, поскольку в первом случае будет выполняться обращение к базе данных, а во втором – чтение из оперативной памяти (кеша объектов):</p>
    <div class="code-style">
        <pre>
            А = Номенклатура.Наименование;
            В = Номенклатура.ВидНоменклатуры;    
        </pre>
    </div>
    <p><i style="text-decoration: underline;" id="14.8.2">Транзакционный кеш</i>. </p>
    <p>Если обращение к данным происходит в рамках транзакции, то оно переадресуется транзакционному кешу. В рамках транзакции в «1С:Предприятии» выполняются все операции, приводящие к изменению данных в базе данных. Например, в рамках транзакции выполняется обработка проведения документа.</p>
    <p>Транзакция – это неделимая последовательность манипулирования данными, переводящая базу данных из одного целостного состояния в другое. Если по каким-то причинам одно из действий транзакции невыполнимо, база данных возвращается в то состояние, которое было до начала транзакции (происходит откат транзакции – Rollback).</p>
    <p>Транзакционный кеш по сути представляет собой ту же последовательную очередь, что и обычный кеш. Разница заключается в том, что все данные, находящиеся в транзакционном кеше, являются валидными (гарантированно актуальными).</p>
    <p>При считывании данных в транзакционный кеш устанавливается блокировка на данные в базе данных, поэтому они гарантированно не могут быть изменены до окончания транзакции.</p>
    <p>Транзакционный кеш хранит считанные данные до тех пор, пока они не будут вытеснены более поздними или пока не закончится транзакция. По окончании транзакции кеш очищается, однако действия, выполняемые при этом, зависят от состояния завершения транзакции.</p>
    <p>Если транзакция завершена успешно (Commit), данные всех объектов, содержащиеся в транзакционном кеше, переносятся в обычный кеш, а транзакционный кеш очищается. </p>
    <p>Если был выполнен отказ от изменений (Rollback), то просто очищается транзакционный кеш.</p>
    <p><b id="14.9">9</b>. Контрольные вопросы</p>
    <p><i style="text-decoration: underline;">Как система «1С:Предприятие» выполняет обращение к ссылочным данным?</i></p>
    <p>Через встроенные объекты типа Ссылка: СправочникСсылка.&lt;Имя> и т.д.</p>
    <p><i style="text-decoration: underline;">Как используется кеш объектов?</i></p>
    <p>Система «1С:Предприятие» использует механизм кеширования данных объектов, считанных из базы данных при использовании объектной техники.</p>
    <p><i style="text-decoration: underline;">Почему для доступа к массивам данных информационной базы предпочтительнее использовать запросы?</i></p>
    <p>Потому что при использовании объектной модели из БД берутся все поля объекта, а при запросе только те поля, которые мы указали.</p>
    <p><i style="text-decoration: underline;">Что такое момент времени?</i></p>
    <p>Момент времени это дата + время + ссылка на документ. Позволяет определить документ на оси времени относительно остальных документов в той же секунде.</p>
    <p><i style="text-decoration: underline;">Чем отличается оперативное проведение документов от неоперативного?</i></p>
    <p>Оперативное проводится текущим временем, не может проводится будущим временем</p>
    <p><i style="text-decoration: underline;">Что такое оперативная отметка времени?</i></p>
    <p>Это механизм, который отслеживает дату проведения документа и если она сегодняшняя, то время ставится текущее, при перепроведении то же самое.</p>
    <p><i style="text-decoration: underline;">Как запросом получить остатки регистра накопления?</i></p>
    <p>Нужно использовать в запросе виртуальную таблицу СрезПоследних</p>
    <p><i style="text-decoration: underline;">На что следует обращать внимание при указании параметров виртуальных таблиц запросов?</i></p>
    <p>Вот ответы из поиска:</p>
    <img src="../img/1С-1/2025-01-19_10-19-38.png" class="screen" alt="">
    <p><i style="text-decoration: underline;">Почему при неоперативном проведении документов не нужно контролировать остатки?</i></p>
    <p>Потому что задача неоперативного проведения просто отразить в информационной базе данные о совершенных операциях в прошлом или будущем</p>
    <p><i style="text-decoration: underline;">Что такое временные таблицы и зачем их использовать?</i></p>
    <p>Это таблицы, где мы временно храним промежуточные данные, которые нам могут понадобиться в других запросах.</p>
    <p><i style="text-decoration: underline;">Что такое менеджер временных таблиц?</i></p>
    <p>Это объект, в который мы можем поместить временные таблицы и использовать его для передачи этих таблиц в другие запросы.</p>
    <p><i style="text-decoration: underline;">Как и зачем можно использовать временные таблицы в параметрах виртуальных таблиц?</i></p>
    <p>В условии виртуальных таблиц. Используем в условии для того, чтобы виртуальная таблица вернула уже отобранные позиции по данным временной таблицы</p>
    <p><i style="text-decoration: underline;">Как программно блокировать данные?</i></p>
    <p>Используем свойство набора записей движений "БлокироватьДляИзменения".</p>
    <p><i style="text-decoration: underline;">Как посмотреть в отладчике результат запроса?</i></p>
    <p>Выгружаем из результата в таблицу значений и смотрим в отладчике</p>
    <p><i style="text-decoration: underline;">Как выделить произвольные области в тексте программного модуля?</i></p>
    <p>#Область ИмяОбласти .... #КонецОбласти</p>
    <p><i style="text-decoration: underline;"></i></p>










    <h2 class="header-style2" id="15">План видов характеристик</h2>
    <p>Не буду тут описывать этот механизм, проще посмотреть видео у Леонтьева</p>








    <h2 class="header-style2" id="16">БухУчёт</h2>
    <p>Для организации бухгалтерского учета мы используем уже знакомый нам объект конфигурации – план видов характеристик и два новых объекта – План счетов и Регистр бухгалтерии.</p>
    <p>Регистр бухгалтерии будет использоваться нами для накопления данных о совершенных хозяйственных операциях.</p>
    <p>С помощью плана счетов мы будем описывать счета, в разрезе которых ведется учет, а план видов характеристик будет служить для описания объектов аналитического учета, в разрезе которых должен вестись учет на счетах</p>
    <p>Сразу оговоримся, что план счетов, который мы будем использовать в нашей учебной конфигурации, очень сильно упрощен. Он содержит всего несколько условных счетов, которые, однако, позволят нам познакомиться с основными методами организации бухгалтерского учета средствами «1С:Предприятия».</p>
    
    <p><b id="16.1">1. ПВХ в бух учёте</b></p>
    <p>Бухгалтерский учет, как правило, подразумевает ведение аналитического учета на большинстве счетов. Для обозначения разрезов аналитического учета мы будем использовать термин <i style="text-decoration: underline;">виды субконто(виды аналитик, уточнений)</i>. То есть на каждом счете учет может вестись в разрезе нескольких видов субконто.</p>
    <p>А для обозначения конкретных объектов аналитического учета мы будем использовать термин <i style="text-decoration: underline;">субконто(аналитика, уточнение)</i>.</p>
    <p>Например, на 41 счете (Товары) учет ведется обычно в разрезе Номенклатуры и Складов, которые являются видами субконто.</p>
    <p>А вот конкретная номенклатура Паста шоколадная и конкретный склад Основной, указанные для некоторой проводки по 41 счету, – это субконто.</p>
    <p>Так вот, частным случаем использования плана видов характеристик является применение его для описания видов субконто. То есть все разрезы аналитического учета описываются в соответствующем плане видов характеристик, и там же задаются типы значений, которые могут принимать те или иные субконто.</p>

    <p><b id="16.2">2. Добавление ПВХ</b></p>
    <p>Приступим к созданию плана видов характеристик, который будет содержать описания разрезов аналитического учета – видов субконто.</p>
    <p>Откроем конфигуратор и добавим новый объект конфигурации "План видов характеристик". Зададим его имя – ВидыСубконто. На закладке Подсистемы укажем, что этот план будет отображаться в подсистеме Бухгалтерия.</p>
    <p>Поскольку нам понадобится некий вспомогательный справочник, в котором пользователи будут осуществлять «свободное творчество» по созданию значений новых объектов аналитического учета, добавим объект конфигурации Справочник и назовем его Субконто.</p>
    <p>Затем на закладке Владельцы укажем, что этот справочник будет подчинен плану видов характеристик ВидыСубконто.</p>
    <p>Закроем окно редактирования справочника и вернемся к нашему плану видов характеристик.</p>
    <p>На закладке Основные установим свойство "Тип значения характеристик". Нажмем кнопку выбора и зададим составной тип данных следующим образом:</p>
    <ul class="list">
        <li>СправочникСсылка.Клиенты,</li>
        <li>СправочникСсылка.Номенклатура,</li>
        <li>СправочникСсылка.Субконто.</li>
    </ul>
    <img src="../img/1С-1/2025-02-21_17-38-53.png" class="screen" alt="">
    <p>Бухгалтерия нашего ООО «На все руки мастер» ведет учет движения денежных средств только в разрезе материалов и клиентов, но не исключено, что в дальнейшем понадобится дополнительная аналитика (поэтому мы и используем справочник Субконто).</p>
    <p>Обратите внимание, что тот справочник, который будет использован в качестве дополнительных значений характеристик, тоже должен входить в составной тип данных типа значений характеристик, иначе конфигуратор выдаст сообщение об ошибке.</p>
    <p>Затем укажем, что дополнительные значения характеристик будут находиться в справочнике Субконто.</p>
    <p>После этого перейдем на закладку Прочее и, нажав кнопку Предопределенные, начнем ввод предопределенных значений плана видов характеристик. То есть тех видов аналитического учета, в разрезе которых мы будем вести учет.</p>
    <p>Нажимая кнопку Добавить, создадим предопределенный вид субконто Материалы с кодом 000000001 и типом СправочникСсылка.Номенклатура.</p>
    <p>Затем создадим вид субконто Клиенты с кодом 000000002 и типом СправочникСсылка.Клиенты.</p>
    <img src="../img/1С-1/2025-02-21_17-44-53.png" class="screen" alt="">
    <p>На этом создание видов субконто завершено, и мы можем перейти к знакомству со следующим объектом конфигурации, который будет использован нами, – План счетов.</p>

    <p><b id="16.3">3. Что такое "План счетов"</b></p>
    <p>Объект конфигурации "План счетов" предназначен для описания структуры хранения информации о совокупности синтетических счетов предприятия, которые созданы для группировки данных о его хозяйственной деятельности.</p>
    <p>На основе объекта конфигурации "План счетов" платформа создает в базе данных таблицы, в которых будет храниться информация о том, какие счета и каким образом будет использовать предприятие.</p>
    <p>Это может быть система бухгалтерских счетов, установленная государством, план управленческих счетов или произвольный набор счетов, используемых для анализа тех или иных видов деятельности предприятия.</p>
    <p>План счетов в системе «1С:Предприятие» поддерживает иерархию субсчетов: к каждому счету первого уровня может быть открыто несколько субсчетов, которые, в свою очередь, могут иметь свои субсчета, и так далее.</p>
    <p>Например, законодательно утвержденный план счетов для ведения бухучета в России имеет следующий вид:</p>
    <img src="../img/1С-1/2025-02-21_18-58-36.png" class="screen" alt="">
    <p>По любому счету или субсчету может вестись аналитический учет в разрезе субконто, описанных в плане видов характеристик. Связь между планом счетов и планом видов характеристик задается разработчиком на этапе конфигурирования.</p>
    <p>Для описания используемых субконто система создает в плане счетов специальную табличную часть ВидыСубконто, которая не видна в конфигураторе (но доступна средствами встроенного языка).</p>
    <p>Для каждого счета есть возможность задать несколько видов учета (например, количественный и валютный). Виды учета задаются при помощи подчиненных объектов конфигурации <i style="text-decoration: underline;">признак учета</i>.</p>
    <p>Также существует возможность определить несколько видов учета субконто (например, суммовой, валютный или количественный). Виды учета субконто задаются при помощи подчиненных объектов конфигурации <i style="text-decoration: underline;">признак учета субконто</i>.</p>
    <p>Помимо всего вышеперечисленного каждый счет может иметь набор свойств, которые задаются в качестве реквизитов объекта конфигурации План счетов. Они позволяют определять уникальные свойства элементов плана счетов (например, реквизит ЗапретитьИспользоватьВПроводках).</p>

    <p><b id="16.4">4. Добавление плана счетов</b></p>
    <p>Приступим к созданию плана счетов ООО «На все руки мастер». </p>
    <p>Как мы говорили в начале этого занятия, бухгалтерский учет в нашем ООО «На все руки мастер» сильно упрощен. Поэтому план счетов, по которому работает бухгалтерия, содержит всего четыре счета: Товары, "Расчеты с поставщиками", Капитал и "Дебиторская задолженность".</p>
    <p>Добавим новый объект конфигурации План счетов. Присвоим ему имя – Основной. Свойство Представление списка зададим как Основной план счетов. На закладке Подсистемы укажем, что план счетов будет отображаться в подсистеме Бухгалтерия. На закладке Данные выделим группу реквизитов Признаки учета и, нажав кнопку Добавить, создадим признак учета "Количественный":</p>
    <img src="../img/1С-1/2025-02-21_19-08-28.png" class="screen" alt="">
    <p>Перейдем на закладку Субконто и укажем, что виды субконто для этого плана счетов будут находиться в плане видов характеристик ВидыСубконто.</p>
    <p>Максимальное количество субконто на счете установим равным двум.</p>
    <p>Также создадим признак учета субконто Количественный:</p>
    <img src="../img/1С-1/2025-02-21_19-10-31.png" class="screen" alt="">
    <p>Затем откроем закладку Прочее. Нажмем кнопку Предопределенные и создадим четыре предопределенных счета (при создании каждого счета, перед тем как нажать кнопку Добавить, нужно выделить корень структуры счетов – строку Счета):</p>
    <ul class="list">
        <li>Товары, код 41, активный, с количественным учетом в разрезе материалов
        <img src="../img/1С-1/2025-02-21_19-12-59.png" class="screen" alt="">
        </li>
        <li>РасчетыСПоставщиками, код 60, активный/пассивный
            <img src="../img/1С-1/2025-02-21_19-15-21.png" class="screen" alt="">
        </li>
        <li>ДебиторскаяЗадолженность, код 62, активный/пассивный, в разрезе клиентов
            <img src="../img/1С-1/2025-02-21_19-16-21.png" class="screen" alt="">
        </li>
        <li>Капитал, код 90, активный/пассивный
            <img src="../img/1С-1/2025-02-21_19-17-16.png" class="screen" alt="">
        </li>
    </ul>
    <p>В результате план счетов нашего ООО «На все руки мастер» будет выглядеть следующим образом:</p>
    <img src="../img/1С-1/2025-02-21_19-18-12.png" class="screen" alt="">
    <p>Теперь мы можем перейти к знакомству с последним объектом конфигурации, который понадобится нам для организации бухгалтерского учета, – <i style="text-decoration: underline;">Регистром бухгалтерии</i>.</p>
    <p><span class="светло_красный">Для плана счетов можно установить свойство «Автопорядок по коду». Это свойство используется для того, чтобы указать системе, что упорядочивание по полю «Порядок» должно всегда подставляться в тех случаях, когда пользователь или разработчик выбирает упорядочивание по коду. Его нужно использовать прежде всего тогда, когда с точки зрения пользователя нужно упорядочивать план счетов по коду с учетом разделителей кода счета. Например, если счета 10.11 и 10.2 упорядочивать по коду счета, то счета будут располагаться так:<br>
    10.11<br>
    10.2<br>
    Это правильно с точки зрения сортировки строк, но не соответствует логическому смыслу кодов.<br>
    Но если заданы значения поля «Порядок» 10.11 и 10. 2 (перед 2 – пробел) и установлено свойство «Автопорядок по коду», то при выборе упорядочивания по коду пользователь будет фактически получать порядок, учитывающий разделители:<br>
    10.2<br>
    10.11<br>
    Если свойство не устанавливать, то нужно будет в явном виде выбирать упорядочивание по полю «Порядок».
    </span></p>

    <p><b id="16.5">5. Что такое регистр бухгалтерии</b></p>
    <p>Объект конфигурации Регистр бухгалтерии предназначен для описания структуры накопления данных, учет которых ведется исходя из некоторого плана счетов. На основе объекта конфигурации Регистр бухгалтерии платформа создает в базе данных таблицу, в которой будут накапливаться данные о хозяйственных операциях, отображаемых в бухгалтерском учете.</p>
    <p>По своему виду регистр бухгалтерии напоминает регистр накопления – он также имеет ресурсы, может иметь измерения и реквизиты.</p>
    <p>Измерения позволяют разделять ведение учета (например, используя измерение Организация, можно вести учет в разрезе нескольких юридических лиц).</p>
    <p>Реквизиты служат признаком, по которому одни записи регистра можно отделить от других (например, в качестве реквизита может использоваться номер журнала, что позволит отбирать проводки, имеющие одинаковый смысл).</p>
    <p>Значительное отличие от регистра накопления заключается в том, что регистр бухгалтерии имеет жесткую связь с используемым планом счетов. Поэтому каждая запись регистра бухгалтерии содержит дополнительные поля, определяемые настройкой используемого плана счетов.</p>
    <p>Например, запись регистра может содержать дополнительные поля для указания корреспондирующих счетов, сумм, объектов аналитического учета (субконто), количества, вида валюты и т.д.</p>
    <p>Кроме этого, отличительной чертой регистра бухгалтерии является возможность поддержки механизма двойной записи, при которой каждая запись регистра содержит обязательные поля для указания счета дебета и счета кредита.</p>

    <p><b id="16.6">6. Добавление регистр бухгалтерии</b></p>
    <p>Создадим новый объект конфигурации Регистр бухгалтерии. Зададим его имя – Управленческий. Свойство Расширенное представление списка зададим как Движения в регистре Управленческий. Укажем, что с ним будет связан план счетов Основной. Установим флажок Корреспонденция:</p>
    <img src="../img/1С-1/2025-02-21_19-52-21.png" class="screen" alt="">
    <p>Флажок Корреспонденция будет говорить о том, что создаваемый нами регистр поддерживает корреспонденцию. Это означает, что каждая запись регистра имеет дебетовую и кредитовую часть, что позволит нам получать информацию не только об остатках и оборотах по счетам, но и о корреспонденциях между счетами.</p>
    <p>Регистры, не поддерживающие корреспонденцию, применяются тогда, когда не нужно использовать принцип двойной записи, регламентированный в бухгалтерском учете, и, соответственно, контролировать баланс хозяйственных средств и их источников.</p>
    <p>На закладке Подсистемы укажем, что регистр будет отображаться в подсистеме Бухгалтерия.</p>
    <p>Теперь перейдем на закладку Данные и создадим два ресурса:</p>
    <ul class="list">
        <li>Сумма, длина 15, точность 2, Балансовый;</li>
        <li>Количество, длина 15, точность 3, Небалансовый, признак учета – Количественный, признак учета субконто – Количественный
            <img src="../img/1С-1/2025-02-21_20-06-44.png" class="screen-2" alt="">
        </li>
    </ul>
    <p>В заключение сделаем видимой команду для открытия списка регистра в разделе Бухгалтерия и расположим ее после всех созданных нами ранее регистров.</p>
    <p>Откроем командный интерфейс подсистемы Бухгалтерия из контекстного меню этой подсистемы, выделив ее в списке подсистем в дереве объектов конфигурации. В группе Панель навигации.Обычное включим видимость у команды Управленческий и мышью перетащим ее в группу Панель навигации.См. также.</p>
    <p>На этом создание нашего регистра бухгалтерии завершено.</p>
    <p>Теперь настало время познакомиться с тем, каким образом используется созданный нами регистр бухгалтерии Управленческий.</p>

    <p><b id="16.7">7. Доработка приходной накладной</b></p>
    <p>Сначала мы доработаем оба наши документа (ПриходнаяНакладная и ОказаниеУслуги) так, чтобы они «поставляли» данные не только для регистров накопления, но и для регистра бухгалтерии.</p>
    <p>Затем мы создадим бухгалтерский отчет Оборотно-сальдовая ведомость, который будет показывать нам состояние товародвижения в ООО «На все руки мастер», основываясь на данных регистра бухгалтерии.</p>
    <p>При проведении наши документы будут создавать следующие бухгалтерские проводки – записи в регистре бухгалтерии:</p>
    <img src="../img/1С-1/2025-02-21_20-21-04.png" class="screen" alt="">
    <p>Итак, сначала изменим процедуру проведения документа ПриходнаяНакладная, а затем в режиме 1С:Предприятие перепроведем все эти документы, чтобы отработал новый, измененный нами алгоритм проведения документа ПриходнаяНакладная.</p>
    <p>В окне редактирования объекта конфигурации Документ ПриходнаяНакладная перейдем на закладку Движения. В списке регистров отметим, что документ будет создавать теперь движения и по регистру бухгалтерии Управленческий. Перейдем на закладку Прочее и откроем модуль объекта. Откроем процедуру обработчика события ОбработкаПроведения. В самом конце цикла перед строкой КонецЦикла добавим строки кода, создающие движения регистра Управленческий:</p>
    <div class="code-style">
        <pre>
            <span class="зелёный">// Регистр Управленческий</span>
            Движение = Движения.Управленческий.Добавить();
            Движение.СчетДт = ПланыСчетов.Основной.Товары;
            Движение.СчетКт = ПланыСчетов.Основной.РасчетыСПоставщиками;
            Движение.Период = Дата;
            Движение.Сумма = ТекСтрокаМатериалы.Сумма;
            Движение.КоличествоДт = ТекСтрокаМатериалы.Количество;
            <span class="зелёный">//Движение.СубконтоДт это коллекция, в которой сейчас 2 элемента: Материалы и Клиенты</span>
            Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Материалы] = ТекСтрокаМатериалы.Материал;    
        </pre>
    </div>
    <p>Перед началом цикла установим свойство Записывать набора записей регистра Управленческий в значение Истина для записи изменений регистра в базу данных.</p>
    <p>Как видите, движения для регистра бухгалтерии формируются таким же образом, как и для регистра накопления.</p>
    <p>Но платформа (при создании таблицы хранения данных) добавила к созданным нами реквизитам регистра еще ряд полей, которые явились следствием использования плана счетов Основной.</p>
    <p>Прежде всего, это поля СчетДт и СчетКт. В этих полях указываются счета, дебет и кредит которых затрагивает данная проводка.</p>
    <p>Кроме этого, для измерений и ресурсов регистра, связанных с признаками учета, платформа создает пару полей для хранения значения каждого ресурса отдельно по дебету и отдельно по кредиту проводки – КоличествоДт и КоличествоКт. А также для счетов, по которым ведется учет в разрезе субконто, платформа создает коллекции СубконтоДт и СубконтоКт.</p>
    <p>Если обратиться к таблице на картинке выше, то при проведении приходной накладной счетом по дебету должен быть счет Товары (41), а счетом по кредиту – счет РасчетыСПоставщиками (60).</p>
    <p>К счету мы обращаемся с помощью свойства глобального контекста ПланыСчетов. Оно предоставляет доступ ко всем планам счетов, созданным в конфигурации. Через точку от него мы указываем имя нужного нам плана счетов – Основной. А далее, тоже через точку, указываем имя предопределенного счета в этом плане счетов – Товары. Этот счет (и три других) мы создали в конфигураторе.</p>
    <p>Так как количественный учет у нас ведется только для счета Товары (41), то поле регистра КоличествоДт заполняется количеством товара из табличной части документа. Поле регистра КоличествоКт не заполняется, так как по счету кредита проводки (РасчетыСПоставщиками) количественный учет не ведется.</p>
    <p>Теперь рассмотрим последнюю строку цикла, в которой присваивается значение субконто дебета.</p>
    <p>Дело в том, что количество субконто на счете дебета и на счете кредита в каждой проводке будет различное, в зависимости от того, как определены счета в используемом плане счетов. Поэтому для каждой записи движения регистра бухгалтерии платформа хранит две коллекции значений: коллекцию субконто дебета и коллекцию субконто кредита. Каждая из них содержит ровно столько элементов, сколько видов субконто указано использовать для соответствующего счета (дебета или кредита) в плане счетов.</p>
    <p>Обратиться к элементу коллекции можно, указав в квадратных скобках ссылку на соответствующий вид субконто (ПланыВидовХарактеристик.ВидыСубконто.Материалы).</p>
    <p>Другой способ – в явном виде указать имя предопределенного вида субконто через точку от коллекции субконто дебета.</p>
    <p>Другими словами, запись Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Материалы] равносильна записи Движение.СубконтоДт.Материалы.</p>
    <p>Коллекция регистра СубконтоКт не заполняется, так как по счету кредита проводки (РасчетыСПоставщиками) учет в разрезе субконто у нас не ведется.</p>
    <p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность переходить к списку записей регистра Управленческий, связанному с документом.</p>
    <p>Для этого откроем форму документа ПриходнаяНакладная. В левом верхнем окне перейдем на закладку Командный интерфейс. В разделе Панель навигации раскроем группу Перейти и установим видимость для команды открытия регистра бухгалтерии Управленческий.</p>
    <p>Далее мы проводим в пользовательском режиме приходные.</p>
    <p>Обратите внимание: поскольку на счете 60 (РасчетыСПоставщиками) отсутствует аналитика и ведется только суммовой учет, в записях движений регистра Субконто1Кт, Субконто2Кт и КоличествоКт не указаны.</p>
    <p>После этого перепроведем документ Приходная накладная № 2 и убедимся, что он тоже формирует правильные проводки по регистру бухгалтерии Управленческий.</p>
    <p>Теперь перейдем к более сложной задаче: добавлению движений по регистру Управленческий в документ ОказаниеУслуги.</p>

    <p><b id="16.8">8. Доработка документа "ОказаниеУслуги"</b></p>
    <p>Сначала мы изменим процедуру проведения документа ОказаниеУслуги, а затем в режиме 1С:Предприятие перепроведем все эти документы, чтобы отработал новый, измененный нами алгоритм проведения документов Оказание услуги.</p>
    <p>В отличие от документа ПриходнаяНакладная, который создавал всего одну бухгалтерскую проводку, документ ОказаниеУслуги будет создавать уже две.</p>
    <p>Напомним, что бухгалтерия нашего ООО «На все руки мастер» не совсем похожа на настоящую, потому что для облегчения своей работы она учитывает только движения материалов. Услуги, которые оказывает организация, для нее как бы не существуют.</p>
    <p>Поэтому документ ОказаниеУслуги будет формировать движения по регистру бухгалтерии только в той части, которая касается расходования материалов.</p>
    <p>В окне редактирования объекта конфигурации Документ ОказаниеУслуги перейдем на закладку Движения. В списке регистров отметим, что документ будет создавать теперь движения и по регистру Управленческий. Перейдем на закладку Прочее и откроем модуль объекта. Откроем процедуру обработчика события ОбработкаПроведения. </p>
    <p>Поскольку нас интересует только движение материалов, для внесения дополнений подойдет тело условия Если…, в котором мы формировали движения по регистрам ОстаткиМатериалов и СтоимостьМатериалов.</p>
    <p>Добавим в конец условия, перед строкой КонецЕсли, движения по регистру бухгалтерии Управленческий:</p>
    <div class="code-style">
        <pre>
            …
            Если ВыборкаДетальныеЗаписи.ВидНоменклатуры = Перечисления.ВидыНоменклатуры.Материал Тогда
                <span class="зелёный">// Регистр ОстаткиМатериалов Расход</span>
                …
                <span class="зелёный">// Регистр СтоимостьМатериалов Расход</span>
                …
                <span class="зелёный">// Регистр Управленческий
                // Первая проводка: Д 62(ДебиторскаяЗадолженность) – К 90 (Капитал)</span> Розничная сумма
                Движение = Движения.Управленческий.Добавить();
                Движение.СчетДт = ПланыСчетов.Основной.ДебиторскаяЗадолженность;
                Движение.СчетКт = ПланыСчетов.Основной.Капитал;
                Движение.Период = Дата;
                Движение.Сумма = ВыборкаДетальныеЗаписи.СуммаВДокументе;
                Движение.СубконтоДт[ПланыВидовХарактеристик.ВидыСубконто.Клиенты] = Клиент;

                <span class="зелёный">// Вторая проводка: Д 90 (Капитал) – К 41 (Товары) – себестоимость</span>
                Движение = Движения.Управленческий.Добавить();
                Движение.СчетДт = ПланыСчетов.Основной.Капитал;
                Движение.СчетКт = ПланыСчетов.Основной.Товары;
                Движение.Период = Дата;
                Движение.Сумма = СтоимостьМатериала * ВыборкаДетальныеЗаписи.КоличествоВДокументе;
                Движение.КоличествоКт = ВыборкаДетальныеЗаписи.КоличествоВДокументе;
                Движение.СубконтоКт[ПланыВидовХарактеристик.ВидыСубконто.Материалы] = ВыборкаДетальныеЗаписи.Номенклатура;
            КонецЕсли;
            …    
        </pre>
    </div>
    <p>В первой проводке мы указываем розничную сумму материала из документа и субконто дебета, поскольку на счете Дебиторская задолженность ведется учет в разрезе клиентов.</p>
    <p>Во второй проводке мы указываем стоимость материала, количество и субконто кредита, поскольку на счете Товары ведется количественный учет в разрезе материалов.</p>
    <p>Теперь в самом начале процедуры установим свойство Записывать регистра бухгалтерии в значение Истина для записи изменений регистров в базу данных</p>
    <p>В заключение отредактируем командный интерфейс формы документа, чтобы в панели навигации формы иметь возможность переходить к списку записей регистра Управленческий, связанному с документом. Для этого откроем форму документа ОказаниеУслуги. В левом верхнем окне перейдем на закладку Командный интерфейс. В разделе Панель навигации раскроем группу Перейти и установим видимость для команды открытия регистра бухгалтерии Управленческий.</p>

    <p><b id="16.9">9. Оборотно-сальдовая ведомость</b></p>
    <p>Описывать не буду. Если надо то можно посмотреть отчёт в базе "Практическое пособие разработчика (Хрусталёва, родное)".</p>









    <h2 class="header-style2" id="17">План видов расчёта и регистр растчёта</h2>
    <p>На этом занятии мы познакомимся с объектами конфигурации План видов расчета и Регистр расчета и узнаем об основных понятиях, используемых при создании сложных периодических расчетов.</p>
    <p>В конце занятия мы создадим план видов расчета и регистр расчета, на основе которых на следующем занятии покажем работу механизмов периодических расчетов.</p>
    
    <p><b id="17.1">Зачем нужен план видов расчета и регистр расчета?</b></p>
    <p>На этом занятии мы рассмотрим, какие возможности для автоматизации сложных периодических расчетов предоставляет система «1С:Предприятие».</p>
    <p>Такие расчеты используются прежде всего при расчете заработной платы. Поэтому дальнейшее их рассмотрение мы будем строить на примере расчета заработной платы сотрудников, которые работают в нашем ООО «На все руки мастер».</p>
    <p>Оклад — это фиксированная сумма, которую работник получает за определённый период времени, независимо от объёма выполненной работы.</p>
    <p>В общем случае сумма заработной платы сотрудника складывается из множества частей (например, оплата по окладу, премии, штрафы, оплаты по больничному листу, разовые выплаты и т.д.). Каждая из этих частей рассчитывается по некоторому алгоритму, присущему только этой части.</p>
    <p>Например, сумма штрафа может определяться просто фиксированной суммой, сумма вознаграждения(премии) может рассчитываться как процент от оклада, а сумма оплаты по окладу рассчитывается исходя из количества рабочих дней в месяце и количества дней, отработанных сотрудником. Поэтому для обозначения каждой такой части мы будем использовать термин <i style="text-decoration:underline;">вид расчета</i>.</p>
    <p>Алгоритм каждого вида расчета опирается в общем случае на две категории параметров: период, за который нужно получить конечные данные, и набор некоторых исходных данных, используемых при расчете.</p>
    <p>Как правило, в реальной жизни различные виды расчета существуют не сами по себе, а оказывают некоторое влияние на другие виды расчета. Исходя из того, что вид расчета опирается на две различные категории параметров, такое влияние тоже имеет двойственный характер.</p>
    <p><b>1. Зависимость по базовому периоду</b></p>
    <p>Это может быть влияние на исходные данные, используемые при расчете.</p>
    <p>В качестве примера можно привести начисление премии в виде процента от оплаты по окладу. При изменении оплаты по окладу размер премии тоже должен быть пересчитан, исходя из новой суммы начисленного оклада. Другими словами, сумма начисленного оклада является базой для расчета премии.</p>
    <p>Причем поскольку оклад рассчитывается за некоторый период, при расчете премии нам интересно знать не значение оклада вообще, а сумму, начисленную в том периоде, который влияет на расчет премии. Такой период мы будем называть <i style="text-decoration:underline;">базовым</i>, а подобную зависимость между видами расчета – <i style="text-decoration:underline;">зависимостью по базовому периоду</i>.</p>
    <p>В качестве примера рассмотрим начисление премии за апрель. Премия должна начисляться в размере 10 % от суммы, начисленной в качестве оплаты по окладу. Следовательно, необходимо проанализировать все записи о начислениях оплаты по окладу, которые попадают в интересующий нас базовый период, а именно апрель.</p>
    <p>Допустим, общая сумма таких начислений составила 8000 рублей – в этом случае премия должна быть начислена в размере 800 рублей.</p>
    <img src="../img/1С-1/2025-02-22_10-25-16.png" class="screen-2" alt="">
    <p><b>2. Вытеснение по периоду действия</b></p>
    <p>Это влияние может быть не на исходные данные, а на сам период, за который производится расчет.</p>
    <p>В качестве примера можно привести расчет оплаты по окладу и невыход на работу. Предположим, мы начислили сотруднику оплату по окладу за март. В этом случае период действия такого расчета будет с 01.03.2013 по 31.03.2013.</p>
    <p>После этого мы получили информацию от руководителя отдела, что, оказывается, сотрудник отсутствовал на работе с 1 по 10 марта по неизвестной причине. В этом случае нам нужно будет произвести расчет Невыход (в котором можно рассчитать какие-то удержания с сотрудника).</p>
    <p>Но кроме этого необходимо будет пересчитать и оклад сотрудника, исходя из того, что фактический период действия расчета Оклад стал теперь с 11.03.2013 по 31.03.2013.</p>
    <p>Такое влияние мы будем называть <i style="text-decoration:underline;">вытеснением по периоду действия</i>.</p>
    <p>В результате если за полный месяц работы сотруднику должно было быть начислено 9300 рублей, то теперь, за фактический период работы, начисление составит 6300 рублей</p>
    <img src="../img/1С-1/2025-02-22_10-40-48.png" class="screen" alt="">
    <p>Таким образом, исходя из двух видов взаимного влияния расчетов, можно сказать, что в общем случае с каждым видом расчета будет связано три периода: период действия, фактический период и базовый период:</p>
    <ul class="list">
        <li>Период действия является «запрашиваемым». То есть, указывая период действия, мы говорим: «Мы хотели бы, чтобы результат действовал в этом периоде».</li>
        <li>Фактический период – это то, что получилось из периода действия после анализа всех периодов действия расчетов, которые вытесняют наш по периоду действия. </li>
        <li>Базовый период – это период, в котором мы анализируем результаты других расчетов, влияющих на наш по базовому периоду.</li>
    </ul>
    <p>Как видите, взаимное влияние между видами расчетов может быть довольно разнообразным и, что самое сложное, многоуровневым. То есть один вид расчета может влиять на другой, который, в свою очередь, влияет на третий и т.д.</p>
    <p>Очевидно, что в этой ситуации требуется некий универсальный механизм, позволяющий описать каждый из видов расчетов (его алгоритм, влияние на другие виды расчетов, зависимость от других видов расчетов), обеспечить хранение данных, полученных в результате этих расчетов, и контроль необходимости перерасчета результатов зависимых расчетов в случае изменения результатов первичных расчетов.</p>
    <p>В системе «1С:Предприятие» такой универсальный механизм реализован при помощи планов видов расчета и регистров расчета.</p>
    <p>И первым объектом конфигурации, с которым мы начнем знакомиться на этом занятии, будет План видов расчета.</p>

    <p><b id="17.2">Что такое план видов расчета</b></p>
    <p>Объект конфигурации План видов расчета предназначен для описания структуры хранения информации о возможных видах расчетов. На основе объекта конфигурации План видов расчета платформа создает в базе данных таблицу, в которой будет храниться информация о том, какие существуют виды расчета и каковы взаимосвязи между ними.</p>
    <p>Отличительной особенностью плана видов расчета является то, что пользователь в процессе работы может добавлять новые виды расчета. Такая возможность делает механизм периодических расчетов более гибким и позволяет пользователю создавать собственные виды расчета, помимо тех, которые заданы разработчиком как предопределенные.</p>
    <p>Объект конфигурации "План видов расчета" имеет свойство "Использует период действия". С его помощью определяется, будут ли в этом плане находиться виды расчета, которые могут быть вытеснены по периоду действия.</p>
    <p>Если это свойство установлено, то разработчик получает возможность указать для каждого вида расчета те виды, которые вытесняют его по периоду действия.</p>
    <p>Следующим важным свойством объекта конфигурации "План видов расчета" является "Зависимость от базы". Оно определяет, будут ли в этом плане находиться зависимые по базовому периоду виды расчета.</p>
    <p>Если это свойство установлено, появляется возможность указать, в каком плане видов расчета будут находиться базовые виды расчета и, кроме этого, как будет определяться эта зависимость.</p>
    <p>Существует возможность указать один из двух видов зависимости от базы: "Зависимость по периоду действия" и "Зависимость по периоду регистрации". Оба вида этой зависимости подробно рассмотрены в разделе «Что такое регистр расчета» далее.</p>
    <p>Еще одной важной особенностью плана видов расчета является возможность создания предопределенных видов расчета и описания их взаимного влияния. При этом в общем случае разработчик имеет возможность указать три категории видов расчета, влияющих на предопределенный вид расчета:</p>
    <ul class="list">
        <li>Базовые – их результаты должны быть использованы при перерасчете этого вида расчета;</li>
        <li>Вытесняющие – вытесняют этот вид расчета по периоду действия;</li>
        <li>Ведущие – изменение их результатов должно приводить к необходимости перерасчета этого вида расчета.</li>
    </ul>
    <p>Здравый смысл подсказывает, что все базовые виды расчета должны быть включены и в категорию ведущих. Кроме этого, ведущие виды расчета могут содержать и некоторые другие виды, косвенно влияющие на данный вид расчета.</p>
    <p>Например, мы имеем три вида расчета: Невыход, Оклад и Премия. Невыход вытесняет Оклад по периоду действия, а Премия зависит от оклада по базовому периоду.</p>
    <p>В этом случае для премии следует указать базовым видом расчета оклад, а ведущими – оклад и невыход, поскольку изменение результата расчета невыхода приведет к изменению результата оклада, что, в свою очередь, должно привести к изменению результата премии</p>
    <img src="../img/1С-1/2025-02-22_20-16-26.png" class="screen-2" alt="">
    <p>Пока остаовился на 559 стр</p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>












    <h2 class="header-style2" id="19">Поиск в базе данных</h2>
    <p>Полнотекстовый поиск чрезвычайно удобен в тех случаях, когда мы не знаем точно, где находятся нужные нам данные (например, в каком справочнике). Также полнотекстовый поиск оказывается незаменим тогда, когда мы не знаем точно, что нужно искать (например, не помним точное название номенклатуры или контрагента).</p>
    <p>Кроме этих возможностей, полнотекстовый поиск позволяет находить данные там, где другие методы поиска крайне трудоемки или требуют создания специальных алгоритмов и обработок. Например, полнотекстовый поиск хорошо умеет работать с текстовыми полями большой длины и полями типа ХранилищеЗначения.</p>

    <p><b id="19.1">1. Общие сведения о механизме полнотекстового поиска в данных</b></p>
    <p>Механизм полнотекстового поиска «1С:Предприятия» основан на использовании двух составляющих:</p>
    <ul class="list">
        <li>полнотекстового индекса,</li>
        <li>средств выполнения полнотекстового поиска.</li>
    </ul>
    <p>Для того чтобы была возможность выполнять полнотекстовый поиск, обязательно должен существовать полнотекстовый индекс. Полнотекстовый индекс создается один раз и затем должен периодически обновляться.</p>
    <p>Поиск осуществляется по тем данным, которые содержатся в полнотекстовом индексе. Таким образом, если ведется интенсивная работа с базой данных (например, данные изменяются, добавляются новые), то полнотекстовый индекс следует обновлять как можно чаще. Если же объем изменяемых или новых данных невелик, то обновление полнотекстового индекса можно выполнять реже – например, раз в сутки, в период наименьшей загруженности системы.</p>
    <p>Создание и обновление полнотекстового индекса может выполняться как интерактивно, в режиме 1С:Предприятие, так и программно, средствами встроенного языка. На этом занятии мы рассмотрим возможности интерактивного индексирования, а на следующем вы узнаете, как можно обновлять полнотекстовый индекс в автоматическом режиме.</p>
    <p>В процессе работы информационной базы система отслеживает факт изменения данных в тех объектах конфигурации, которые могут участвовать в полнотекстовом поиске. Такими объектами являются, например, планы обмена, справочники, документы, планы видов характеристик, планы счетов, планы видов расчета, регистры (сведений, накопления, бухгалтерии, расчета), бизнес-процессы и задачи.</p>
    <p>Впоследствии при создании или обновлении полнотекстового индекса система анализирует данные, содержащиеся в реквизитах этих объектов, и включает эти данные в полнотекстовый индекс. При этом анализироваться могут не все реквизиты, а только те, которые имеют тип Строка, Число, Дата, ХранилищеЗначения или ссылочный тип (например, СправочникСсылка.Номенклатура).</p>
    <p>Немного забегая вперед, необходимо отметить, что полнотекстовый поиск выполняется в соответствии с правами пользователя. Таким образом, если какая-то информация недоступна данному пользователю, он не сможет получить ее и при помощи полнотекстового поиска.</p>
    <p>Теперь, когда мы в общем виде представляем себе, как работает полнотекстовый поиск, приступим к первой части необходимых действий – созданию полнотекстового индекса.</p>
    <p>Далее с помощью стандартного механизма платформы мы будем собственно выполнять полнотекстовый поиск, используя созданный нами индекс.</p>

    <p><b id="19.2">2. Полнотекстовый индекс</b></p>
    <p>Прежде всего познакомимся со свойствами конфигурации и ее объектов, которые отвечают за полнотекстовый поиск.</p>
    <p>Каждый объект конфигурации, данные которого могут участвовать в полнотекстовом индексировании, имеет свойство "Полнотекстовый поиск". По умолчанию при создании нового объекта это свойство установлено в значение "Использовать".</p>
    <p>Таким образом, в данный миг от нас не требуется вносить какие-либо изменения, тем не менее для знакомства откроем окно редактирования объекта конфигурации Справочник Номенклатура на закладке Прочее.</p>
    <p>Кроме объектов конфигурации свойство Полнотекстовый поиск существует и у реквизитов этих объектов. Таким образом, мы имеем возможность указывать конкретные реквизиты, данные которых должны участвовать в полнотекстовом индексировании.</p>
    <p>По умолчанию для новых реквизитов это свойство также устанавливается в значение Использовать, поэтому и в данном случае не требуется вносить какие-либо изменения.</p>
    <p>Таким образом, по умолчанию в нашей конфигурации полнотекстовый поиск используется для всех возможных реквизитов всех возможных объектов конфигурации.</p>
    <p>В 1С:Предприятие выполним команду главного меню приложения Функции для технического специалиста > Стандартные > Управление полнотекстовым поиском</p>
    <p>Эта обработка позволяет создавать и обновлять полнотекстовый индекс интерактивно. Кроме того, она позволяет разрешать или запрещать вообще все операции, связанные с полнотекстовым поиском: обновление, очистку полнотекстового индекса, полнотекстовый поиск.</p>
    <p>Как вы видите, по умолчанию полнотекстовый поиск стандартно включен.</p>
    <p>Также система сообщает нам о том, что требуется обновление полнотекстового индекса. Это действительно так, потому что в нашем случае индекс вообще отсутствует (дата актуальности индекса пуста). Для того чтобы создать (или обновить) полнотекстовый индекс, нажмем кнопку Обновить.</p>
    <p>Обратите внимание, что при больших размерах информационной базы создание и обновление полнотекстового индекса могут занимать несколько минут. Поэтому в процессе обновления индекса в нижнем правом углу экрана всплывает сообщение о том, какая часть данных в данный момент обрабатывается</p>
    <p>После того как создание полнотекстового индекса будет закончено, система сообщит об этом, и в обработке управления полнотекстовым поиском будет отображена дата актуальности полнотекстового индекса – дата, когда последний раз выполнялось обновление индекса.</p>
    <p>Итак, мы создали полнотекстовый индекс для нашей информационной базы. Теперь, используя этот индекс, выполним полнотекстовый поиск в базе данных.</p>

    <p><b id="19.3">3. Варианты использования глобального поиска</b></p>

    <p><b id="19.3.1">3.1 Интерактивный поиск</b></p>
    <p>Поиск в данных на основе полнотекстового индекса является стандартной функцией платформы «1С:Предприятие». Для начала поиска достаточно щёлкнуть мышью в строке поиска (со значком лупы) в заголовке приложения</p>
    <p>Попробуем найти все данные, содержащие фрагмент «диаг». Введем в строку поиска значение диаг, и сразу под ней появится окно с результатами поиска:</p>
    <img src="../img/1С-1/2025-01-21_08-42-20.png" class="screen-2" alt="">
    <p>Поиск выполняется по избранному, истории, по меню функций, по обсуждениям и сообщениям системы взаимодействия, по данным (полнотекстовый поиск) и по справке. При этом каждый найденный элемент обозначается соответствующей пиктограммой.</p>
    <p>Как правило, для получения наилучших результатов полнотекстового поиска рекомендуется использовать в поисковом выражении пару слов.</p>
    <p>Таким образом, стандартно механизм глобального поиска работает, что называется, «из коробки» и не требует от вас какой-либо настройки и программирования. В большинстве случаев его стандартное поведение покрывает все необходимые сценарии, но при желании вы можете настроить его на выполнение конкретных задач.</p>

    <p><b id="19.3.2">3.2 Программная настройка глобального поиска</b></p>
    <p>Во встроенном языке существует объектная модель для работы с глобальным поиском. Она позволяет перехватывать многие события глобального поиска и изменять его стандартное поведение.</p>
    <p>Например, можно исключить некоторые виды поиска.</p>
    <p>Как уже говорилось, глобальный поиск ищет везде, и количество элементов результата поиска (особенно при значительных объемах данных) может быть слишком большим, а сам поиск – существенно замедляться.</p>
    <p>Например, если ввести в поисковую строку выражение "продажи", будет найдено помимо нужных вам данных много разделов справки с пиктограммой «?»</p>
    <p>Чтобы отсечь ненужные результаты, вы можете при начале работы системы настроить менеджер глобального поиска. Менеджер доступен через свойство глобального контекста "ГлобальныйПоиск". У менеджера есть свойство "ПланПоиска" – это коллекция, которая содержит те виды поиска, которые будут выполняться.</p>
    <p>Если вы не хотите, чтобы выполнялся поиск в справке или где-то еще, просто удалите этот вид поиска из коллекции:</p>
    <div class="code-style">
        <pre>
            -- модуль приложения
            <span class="светло_синий">Процедура ПриНачалеРаботыСистемы()
                <span class="зелёный">// Получить существующий вид поиска.</span>
                ПланПоиска = ГлобальныйПоиск.ПолучитьПлан();  

                <span class="зелёный">// Удалить из плана поиска поиск в меню "Функции для технического специалиста" и поиск по справке.</span>
                ПланПоиска.Удалить(СтандартныйВидГлобальногоПоиска.ФункцииДляТехническогоСпециалиста);
                ПланПоиска.Удалить(СтандартныйВидГлобальногоПоиска.Справка);

                <span class="зелёный">// Вернуть план поиска "на место".</span>
                ГлобальныйПоиск.УстановитьПлан(ПланПоиска);
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Запустим «1С:Предприятие» и введем в поисковую строку выражение "продажи". После этого результат поиска будет уже без этих справок и функций</p>
    <p>Теперь попробуем решить более сложную задачу – выполнить собственный поиск по псевдокоманде.</p>
    <p>Например, в нашем прикладном решении довольно частой задачей является поиск документов об оказании услуг по фрагменту номера документа. </p>
    <p>Если вы просто введете в поисковую строку фрагмент номера, то получите очень много результатов (так как глобальный поиск ищет везде), и это может быть недостаточно быстро</p>
    <p>Чтобы устранить эту проблему, вы можете выделить задачу поиска по номеру документа в отдельный «вид поиска» и воплотить для него собственный алгоритм поиска «по псевдокоманде». </p>
    <p>Например, если пользователь хочет найти документ об оказании услуг по фрагменту номера, то первым символом в поисковую строку он должен ввести «№», а затем фрагмент того номера, который он ищет. Например: «№ 1».</p>
    <p>Для этого мы можем воспользоваться событием "ПриГлобальномПоиске". Это событие возникает тогда, когда в процессе набора текста в поле поиска сделана пауза. Это событие мы обработаем в модуле приложения.</p>
    <p>Если в строке поиска первый символ «№», мы удалим все элементы из плана поиска и добавим туда свой собственный элемент. Алгоритм его работы мы напишем в процедуре ПоискДокументовПоНомеру(), которую поместим в общем модуле ГлобальныйПоискВДанных.</p>
    <p>Создадим в модуле приложения обработчик события ПриГлобальномПоиске() и заполним его следующим образом:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Процедура ПриГлобальномПоиске(СтрокаПоиска, ПланПоиска)
                Если СтрНайти(СтрокаПоиска, <span class="серый">"№"</span>) = 1 Тогда
                    <span class="зелёный">//Установить собственный вид поиска, в котором есть только поиск по номеру документа.</span>
                    ПланПоиска.Очистить();
                    ПланПоиска.Вставить(0, <span class="серый">"ПоискДокументовПоНомеру"</span>, <span class="серый">"ГлобальныйПоискВДанных"</span>, Истина, Ложь);
                КонецЕсли;
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>Затем создадим в нашей конфигурации общий неглобальный серверный модуль ГлобальныйПоискВДанных (флажок Глобальный снят, а флажок Сервер установлен по умолчанию). Поместим в нем процедуру ПоискДокументовПоНомеру() и заполним ее следующим образом:</p>
    <div class="code-style">
        <pre>
            <span class="светло_синий">Процедура ПоискДокументовПоНомеру(СтрокаПоиска, РезультатПоиска, ДопПараметры) Экспорт
                ФрагментНомера = Прав(СтрокаПоиска, СтрДлина(СтрокаПоиска) - 1);

                <span class="зелёный">//Если в строке поиска только "№", то ничего не делать;</span>
                Если ФрагментНомера = <span class="серый">""</span> Тогда
                    Возврат;
                КонецЕсли;

                <span class="зелёный">// Выбрать документы об оказании услуг с номером, содержащим введенную строку.</span>
                Запрос = Новый Запрос(
                    <span class="серый">"ВЫБРАТЬ Ссылка, Номер, Представление
                    |ИЗ Документ.ОказаниеУслуги
                    |ГДЕ Номер ПОДОБНО &ФрагментНомера"</span>);

                Запрос.УстановитьПараметр(<span class="серый">"ФрагментНомера"</span>, <span class="серый">"%"</span> + ФрагментНомера + <span class="серый">"%"</span>);
                Результат = Запрос.Выполнить();
                Выборка = Результат.Выбрать();

                Пока Выборка.Следующий() Цикл
                    <span class="зелёный">// Создать элемент результата поиска и добавить его в коллекцию.</span>
                    ЭлементРезультата = Новый ЭлементРезультатаГлобальногоПоиска(Выборка.Ссылка, СтрНайтиИВыделитьОформлением(Выборка.Представление, ФрагментНомера));

                    РезультатПоиска.Добавить(ЭлементРезультата);
                КонецЦикла;
            КонецПроцедуры </span>  
        </pre>
    </div>
    <p>В этой процедуре запросом мы получаем только те документы об оказании услуг, в номере которых содержится искомый фрагмент строки. Затем в результат глобального поиска мы добавляем собственные элементы. Каждый из них содержит ссылку на найденный документ и представление, в котором выделен найденный фрагмент.</p>
    <p>Для выделения элементов используется функция СтрНайтиИВыделитьОформлением(), в которую мы первым параметром передаем строку, которая будет отображаться в результате поиска, а вторым параметром – тот фрагмент, который надо выделить в этой строке.</p>
    <p>Теперь в качестве заключительного штриха осталось только дополнить описание поиска новыми возможностями, которые мы только что воплотили.</p>
    <p>Глобальный поиск имеет описание, которое открывается по ссылке "Что искать". Мы можем изменить это описание.</p>
    <p>Для этого добавим в обработчик события ПриНачалеРаботыСистемы() в модуле приложения выделенный ниже фрагмент кода:</p>
    <div class="code-style">
        <pre>
            --добавить в модуль приложения
            
            ...
            <span class="зелёный">// Установить собственное описание поисковой строки.</span>
            ГлобальныйПоиск.УстановитьОписание( "Введите строку поиска, ссылку или арифметическое выражение." + Символы.ПС + "Для поиска документов об оказании услуг по номеру введите ""№"" и сразу за ним без пробела часть номера.");
        </pre>
    </div>
    <p>Запустим «1С:Предприятие» и введем в поисковую строку выражение «№ 1». </p>
    <p>Как вы видите, результат поиска будет содержать гораздо меньше элементов, а сам поиск будет выполнен значительно быстрее. Если же не вводить «№» первым символом в поисковую строку, глобальный поиск будет работать как обычно, «из коробки».</p>

    <p><b id="19.4">4. Контрольные вопросы</b></p>
    <p><i style="text-decoration: underline;">Для чего предназначен полнотекстовый поиск в данных?</i></p>
    <p>Чтобы облегчить поиск незнакомой информации в базе данных</p>
    <p><i style="text-decoration: underline;">Как интерактивно управлять полнотекстовым поиском?</i></p>
    <p>В 1С:Предприятие выполним команду главного меню приложения Функции для технического специалиста > Стандартные > Управление полнотекстовым поиском. Через эту стандартную обработку и можно управлять интерактивно.</p>
    <p><i style="text-decoration: underline;">Как программно настраивать глобальный поиск?</i></p>
    <p>Нужно воспользоваться свойством глобального контекста ГлобальныйПоиск или событием модуля приложения ПриГлобальномПоиске().</p>











    <h2 class="header-style2" id="20">20. Выполнение заданий по расписанию</h2>
    <p>Любая информационная база системы «1С:Предприятие» требует периодического выполнения определенного набора регламентных операций.</p>
    <p><i>Регламентные операции</i> — это перечень действий, выполняемых периодически и необходимых для закрытия счетов, формирования проводок, отображения финансового результата, расчёта налогов и формирования отчётности.</p>
    <p>Например, по мере изменения существующих данных или добавления новых необходимо выполнять резервное копирование. Тогда, если в результате сбоя информационная база окажется неработоспособной, основную часть данных можно будет восстановить из резервной копии. Поэтому чем чаще выполняется резервное копирование, тем меньшее количество данных придется вводить повторно в случае сбоя.</p>
    <p>Другой пример. Для того чтобы использовать полнотекстовый поиск в базе данных, необходимо, чтобы все данные, в которых предполагается выполнять поиск, были проиндексированы. А это значит, что полнотекстовый индекс нужно периодически обновлять. Как часто? Это зависит от интенсивности изменения данных и ввода новых данных. Но очевидно, что делать это нужно с некоторой периодичностью.</p>
    <p>Для того чтобы автоматизировать подобные операции, в «1С:Предприятии» существует механизм заданий. Этот механизм позволяет создавать задания, каждое из которых представляет собой некоторую последовательность действий, описанных с помощью встроенного языка. Для каждого задания может быть назначено расписание, в соответствии с которым это задание будет автоматически запущено на исполнение.</p>
    <p>На этом занятии мы рассмотрим использование механизма заданий на примере автоматизации двух регламентных операций, связанных с полнотекстовым поиском: операции полнотекстового индексирования и операции слияния индексов.</p>
    <p>Мы опишем эти операции средствами встроенного языка и установим расписание для их автоматического выполнения.</p>
    
    <p><b id="20.1">1 Постановка задачи</b></p>
    <p>На предыдущем занятии мы узнали, что для возможности выполнения полнотекстового поиска обязательно должен существовать полнотекстовый индекс. Полнотекстовый индекс создается один раз, и затем должен периодически обновляться</p>
    <p>На самом деле полнотекстовый индекс состоит из двух индексов: основного и дополнительного. При выполнении полнотекстового поиска поиск осуществляется как в одном, так и в другом индексе. Отличие их заключается в следующем. </p>
    <p>Основной индекс спроектирован так, чтобы обеспечивать максимальную скорость поиска при большом объеме данных. Однако оборотной стороной этого является то, что добавление данных в основной индекс осуществляется относительно медленно.</p>
    <p>Дополнительный индекс является полной противоположностью основному: добавление данных в дополнительный индекс осуществляется быстро, однако при значительном объеме данных в дополнительном индексе поиск будет выполняться относительно медленно.</p>
    <p>Наличие основного и дополнительного индексов предполагает следующую стратегию их использования. Основная масса данных находится в основном индексе, что позволяет выполнять поиск достаточно быстро. Новые данные, измененные или добавленные  в систему, добавляются в дополнительный индекс непосредственно в процессе работы пользователей с требуемой периодичностью (например, раз в час или раз в минуту). Такое добавление происходит быстро и оказывает незначительное влияние на производительность системы. Пока объем данных в дополнительном индексе невелик, поиск по нему также выполняется быстро</p>
    <p>В период малой активности пользователей или в период выполнения регламентных действий с информационной базой (например, ночью) выполняется слияние основного и дополнительного индекса (например, раз в сутки). Эта операция может оказывать видимую нагрузку на систему или занимать продолжительное время (в зависимости от накопленных данных). В результате новые данные помещаются в основной индекс, а дополнительный индекс при этом очищается и готов к быстрому приему следующих данных.</p>
    <p>Таким образом, чтобы пользователи могли искать во всех данных и не ощущали какого-либо замедления работы системы, дополнительный индекс необходимо обновлять относительно часто (например, раз в час или раз в минуту). В то же время чтобы пользователи выполняли поиск быстро, необходимо, чтобы дополнительный индекс содержал как можно меньше данных, т. е. нужно периодически выполнять слияние основного и дополнительного индексов (например, ночью, в период минимальной активности пользователей).</p>
    <p>В результате для автоматизации полнотекстового индексирования нам понадобится два задания. Первое задание будет выполнять индексирование без слияния и запускаться каждую минуту. Второе будет выполнять слияние индексов и запускаться один раз в сутки, ночью. </p>

    <p><b id="20.2">2 Что такое регламентное задание</b></p>
    <p>Регламентные задания располагаются в дереве объектов конфигурации, в ветке Общие. Каждое регламентное задание содержит два основных свойства: Имя метода и Расписание.</p>
    <p>Свойство "Имя метода" связывает регламентное задание с некоторой процедурой или функцией общего модуля, которая, собственно, и будет исполняться. Эта процедура должна содержать алгоритм на встроенном языке, описывающий все те операции, которые должны быть выполнены.</p>
    <p>Свойство "Расписание" позволяет задать периодичность выполнения этой процедуры.</p>
    <p>Кроме перечисленных свойств регламентное задание содержит и другие свойства, например "Интервал повтора при аварийном завершении" и "Количество повторов при аварийном завершении". Таким образом, если по какой-либо причине выполнение регламентного задания закончится неудачно, система «1С:Предприятие» может автоматически запустить это задание указанное количество раз по прошествии указанного периода времени.</p>

    <p><b id="20.3">3 Создание регламентных заданий</b></p>
    <p>Далее мы создаём оба регламентных задания и настраиваем их.</p>

    <p><b id="20.4">4 Запуск регламентных заданий</b></p>
    <p>Дальнейшее выполнение регламентных заданий не требует никаких дополнительных действий разработчика.</p>
    <p>Как мы уже говорили на теоретическом занятии в начале книги, система «1С:Предприятие» поддерживает два варианта работы: файловый и клиент-серверный.</p>
    <p>Наша демонстрационная информационная база работает в файловом варианте работы. При старте клиентского приложения запускается еще один поток с подключением к базе данных, последовательно выполняющий регламентные задания, инициированные клиентом.</p>
    <p>Если бы наша информационная база работала в клиент-серверном варианте, то для автоматического запуска и выполнения созданных нами заданий также не требовалось бы дополнительных действий. Можно было бы обновить конфигурацию базы данных, и менеджер кластера серверов «1С:Предприятия» начал бы самостоятельно выполнять задания в соответствии с указанным расписанием.</p>
    <p>Итак, проверим, как работают наши регламентные задания.</p>
    <p>Запустим «1С:Предприятие» и изменим состояние базы данных. Например, добавим новый элемент номенклатуры и затем удалим его. Подождем пару минут.</p>
    <p>Затем выполним команду главного меню приложения Функции для технического специалиста > Стандартные > Управление полнотекстовым поиском. Дата актуальности индекса будет соответствовать дате и времени нашей последней манипуляции с базой данных плюс еще минуту.</p>
    <p>Таким образом, мы видим, что задание обновления индекса запускается каждые 60 секунд, как мы и указали в расписании. Чтобы обеспечить выполнение обоих регламентных заданий, нужно не закрывать хотя бы один экземпляр приложения в течение суток.</p>









    <h2 class="header-style2" id="21">21. Редактирование движений в форме документа</h2>
    <p>Тут создаётся небольшой механизм для внесения первоначальных остатков в регистр накопления ОстаткиМатериалов. Для этого мы создадим документ, запретим ему проведение и отметим на закладке Движения галочкой регистр "ОстаткиМатериалов", чтобы потом в форме в реквизите Объект уже было свойство Движения, в которой будет лежать этот регистр.</p>
    <p>Кстати я такой приём ещё не встречал. Я бы наверно в форме создавал бы реквизит формы и в тип данных выбирал бы набор записей этого реигстра, а тут вот такой быстрый способ.</p>
    <p>Кстати почему мы через документ добавляем записи в регистр, потому что это регистр накопления  и он всегда подчинён документу, а значит у него даже кнопки добавить новую запись нету. Можно только через документ, когда набор записей становится таблицей формы и форма добавляет для таблиц по умолчанию кнопку "Добавить", где мы и можем добавить новые записи:</p>
    <img src="../img/1С-1/2025-01-21_16-24-13.png" class="screen" alt="">












    <h2 class="header-style2" id="22">22. Список пользователей и их роли</h2>
    <p>После того как созданы все основные объекты конфигурации, можно приступить к определению ролей пользователей. Администрирование списка пользователей «1С:Предприятия» и назначение им ролей в соответствии с их служебными обязанностями – очень важные моменты для организации интерфейса прикладного решения в целом и разграничения прав и действий его отдельных пользователей. Этому вопросу и будет посвящено данное занятие.</p>
    <p>До сих пор мы с вами имели полный доступ ко всем разделам приложения и ко всем объектам конфигурации и командам, используемым в этих разделах. Однако при реальной работе пользователей одной из главных возможностей, которую должно обеспечивать прикладное решение, является разграничение прав доступа пользователей к той или иной информации, хранящейся в информационной базе.</p>
    <p>Например, руководитель должен, очевидно, иметь доступ ко всей информации, которая содержится в базе данных, а вот кладовщик, напротив, должен иметь доступ только к информации, касающейся движения товаров на складах, и не иметь возможности просматривать бухгалтерскую или кадровую информацию.</p>
    <p>Кроме этого, должна существовать возможность ограничить пользователей в выполнении тех или иных действий с объектами базы данных. Например, кладовщик может создавать и изменять приходные накладные, поскольку он отвечает за учет материалов на предприятии. Мастеру может понадобиться просматривать приходные накладные для того, чтобы знать, какие материалы и когда были получены. Однако мастер не должен иметь возможности вносить какие-либо изменения в приходные накладные.</p>

    <p><b id="22.1">22.1 Что такое роль</b></p>
    <p>Для описания подобных разрешений используются объекты конфигурации Роль. С помощью такого объекта разработчик получает возможность описать набор прав на выполнение тех или иных действий над каждым объектом базы данных и над всей конфигурацией в целом.</p>
    <p>Как правило, роли создаются отдельно для каждого вида деятельности, и каждому пользователю системы ставится в соответствие одна или несколько ролей.</p>
    <p>Если пользователю поставлено в соответствие несколько ролей, предоставление доступа будет осуществляться по следующему алгоритму:</p>
    <ul class="list">
        <li>если хотя бы в одной роли есть разрешение, то доступ будет открыт;</li>
        <li>если во всех ролях разрешение отсутствует, то доступ будет закрыт</li>
    </ul>

    <p><b id="22.2">22.2 Создание ролей </b></p>
    <p>При создании ролей исходят, как правило, из того, какие полномочия требуются различным группам пользователей на доступ к информации. Для этого мы воспользуемся подсистемами, которые значительно облегчат нашу задачу.</p>
    <p><b>Администратор</b></p>
    <p>Первая роль, которую мы создадим, будет Администратор. Она должна включать в себя полные права на работу с данными информационной базы. Раскроем ветвь Общие дерева объектов конфигурации. Выделим строку Роли и добавим новый объект конфигурации Роль. Зададим его имя – Администратор.</p>
    <p>Откроется окно редактирования прав этой роли:</p>
    <img src="../img/1С-1/2025-03-08_09-09-54.png" class="screen" alt="">
    <p>Слева, в списке объектов, перечислены все объекты и виды объектов конфигурации, а справа, в окне "Права", – доступные права для выбранного объекта или видов объектов конфигурации.</p>
    <p>Администратор должен иметь права на все объекты и все виды объектов. Для этого выполним команду "Действия" > "Установить все права" в командной панели окна.</p>
    <p>После этого все права для всех объектов будут помечены.</p>
    <p>Однако можно поставить или снять отметку для прав конкретного объекта конфигурации, пользуясь кнопками "Отметить все элементы" и "Снять отметку со всех элементов", расположенными над окном прав.</p>
    <p>Теперь единственное, что следует сделать, – снять разрешение на интерактивное удаление для всех объектов. Это необходимо для того, чтобы администратор случайно не мог удалить какой-либо объект базы данных. Для этого пройдемся по всем видам объектов конфигурации (Справочники, Документы и т.д.) и снимем отметку с команды "Интерактивное удаление". Заметьте, что одновременно с отключением права на интерактивное удаление объектов снимается также отметка с права "Интерактивное удаление предопределенных".</p>
    <p>Для того чтобы наш Администратор мог работать с объектами, которые мы будем создавать после расстановки прав, зададим для него параметр "Устанавливать права для новых объектов".</p>
    <p>На этом создание роли Администратор закончено.</p>
    <p><b>Директор</b></p>
    <p>Следующей ролью, которую мы создадим, будет роль Директор.</p>
    <p>Создадим новый объект конфигурации Роль с именем Директор.</p>
    <p>Нас устраивает, что у новой роли нет прав на доступ ко всем объектам, за исключением тех видов объектов конфигурации, для которых не создано ни одного объекта. Для таких видов объектов конфигурации останутся установленными полные права.</p>
    <p>Убедимся, что право Вывод для всей конфигурации у этой роли установлено.</p>
    <p>Теперь нам останется лишь пройти по видам объектов конфигурации и установить для них право Просмотр (права Чтение и Использование при этом установятся автоматически).</p>
    <p>Затем раскроем ветвь Общие, выделим ветвь Подсистемы и отметим право Просмотр у всех подсистем. Тем самым мы предоставим директору возможность просматривать все данные информационной базы, а позднее с помощью установки видимости команд по ролям мы исключим из его интерфейса все действия, которые по логике нашей конфигурации не относятся к прикладной ее части.</p>
    <p>Вторая роль нашей конфигурации готова.</p>
    <p><b>Мастер</b></p>
    <p>Следующая роль, которую мы создадим, будет роль Мастер. Снова добавим новый объект конфигурации Роль с именем Мастер. Выполним команду "Действия" > "Установить по подсистемам…" и выберем подсистемы "УчетМатериалов" и "ОказаниеУслуг". Нажмем Установить.</p>
    <p>В результате будут установлены все права на объекты конфигурации, относящиеся к данным подсистемам.</p>
    <p>Если теперь установить фильтр объектов по подсистемам УчетМатериалов и ОказаниеУслуг, то можно при необходимости внести уточнения в установленные права:</p>
    <img src="../img/1С-1/2025-03-08_09-33-45.png" class="screen" alt="">
    <p>В частности, для справочника Сотрудники мы запретим права Добавление, Изменение и Удаление.</p>
    <p>Обратите внимание, что при запрете права Добавление исчезла отметка и у права Интерактивное добавление, так как оно является «уточнением» права Добавление. Точно так же уточненные права запрещаются и при отмене прав на изменение и удаление.</p>
    <p>Кроме этого, мы снова снимем разрешения на интерактивное удаление для всех объектов базы данных. Для этого пройдем по всем видам объектов конфигурации и снимем у всех право "Интерактивное удаление".</p>
    <p>Затем снимем фильтр и установим все права, кроме интерактивного удаления для следующих объектов конфигурации:</p>
    <ul class="list">
        <li>справочник ВариантыНоменклатуры,</li>
        <li>справочник ДополнительныеСвойстваНоменклатуры, </li>
        <li>план видов характеристик СвойстваНоменклатуры,</li>
        <li>регистр сведений ЗначенияСвойствНоменклатуры.</li>
    </ul>
    <p>Эти объекты мы не привязывали ни к каким подсистемам, но они будут нужны для работы с характеристиками номенклатуры.</p>
    <p>В заключение раскроем ветвь Общие, выделим ветвь Подсистемы и отметим право Просмотр у подсистемы Предприятие. Тем самым мы предоставим доступ к нормативно-справочной информации, которая будет находиться в этой подсистеме. А ненужную мастерам функциональность скроем с помощью видимости команд по ролям.</p>
    <p>Роль Мастер готова.</p>
    <p><b>Расчётчик</b></p>
    <p>В заключение нам с вами осталось создать две роли: Бухгалтер и Расчетчик. </p>
    <p>Мы разделим права по расчету зарплаты и по ведению бухгалтерского учета.</p>
    <p>Дело в том, что в ООО «На все руки мастер» есть бухгалтер и помощник бухгалтера. Помощник бухгалтера занят в основном расчетом зарплаты, но иногда это делает и главный бухгалтер.</p>
    <p>Поэтому главному бухгалтеру необходимо будет назначить обе роли, в то время как помощнику – только роль Расчетчик</p>
    <p>Создадим новый объект конфигурации Роль с именем Расчетчик.</p>
    <p>В окне редактирования прав установим их по подсистеме РасчетЗарплаты (и не забудем запретить интерактивное удаление). А также установим право Просмотр для объекта конфигурации: Регистр накопления Продажи и справочника Клиенты.</p>
    <p>В заключение установим право Просмотр у подсистемы Предприятие.</p>
    <p>Роль Расчетчик готова.</p>
    <p><b>Бухгалтер</b></p>
    <p>В заключение создадим объект конфигурации Роль с именем Бухгалтер. В окне редактирования прав установим их по подсистеме Бухгалтерия.</p>
    <p>После этого отфильтруем список объектов по этой подсистеме и для справочника Номенклатура запретим добавление, изменение и удаление.</p>
    <p>Также запретим интерактивное удаление для всех объектов.</p>
    <p>Затем снимем фильтр и установим все права, кроме интерактивного удаления для объекта конфигурации Справочник Субконто.</p>
    <p>А также установим право Просмотр для следующих объектов конфигурации:</p>
    <ul class="list">
        <li>Справочник Склады,</li>
        <li>Справочник ВариантыНоменклатуры,</li>
        <li>Справочник ДополнительныеСвойстваНоменклатуры,</li>
        <li>План видов характеристик СвойстваНоменклатуры,</li>
        <li>Регистр сведений ЗначенияСвойствНоменклатуры.</li>
    </ul>
    <p>В заключение установим право Просмотр у подсистемы Предприятие.</p>
    <p><b>Права на запуск клиентских приложений</b></p>
    <p>В заключение убедимся, что у каждой роли есть права на запуск клиентского приложения (тонкого клиента и веб-клиента).</p>
    <p>Для этого воспользуемся другим, более удобным инструментом – редактором "Все роли". В дереве объектов конфигурации выделим ветку Роли и в контекстном меню выполним команду "Все роли". Мы видим, что права Тонкий клиент и Веб-клиент включены для всех ролей:</p>
    <img src="../img/1С-1/2025-03-08_09-47-23.png" class="screen" alt="">
    <p>Администратор также имеет возможность подключаться и с помощью других клиентских приложений.</p>
    <p>Список прав для каждой роли можно получить, выполнив в окне редактирования прав команду Действия > Вывести список…</p>
    <p>Аналогичный список, можно получить из редактора "Все роли". Там можно выбрать как отдельно роль, так и все роли:</p>
    <img src="../img/1С-1/2025-03-08_09-50-59.png" class="screen" alt="">
    
    <p><b id="22.3">22.3 Добавление новых пользователей</b></p>
    <p>Для того чтобы иметь возможность отличать друг от друга пользователей, работающих с информационной базой, в системе «1С:Предприятие» существует "список пользователей".</p>
    <p>Можно создавать и удалять пользователей системы, назначать им роли и т.д.</p>
    <p>Прежде чем мы приступим к созданию пользователей, необходимо выполнить обновление конфигурации базы данных (Конфигурация > Обновить конфигурацию базы данных (F7) ), поскольку пользователю можно поставить в соответствие только те роли, которые существуют в конфигурации базы данных.</p>
    <p>После того как обновление произведено, выполним команду главного меню Администрирование > Пользователи.</p>
    <p>Откроется список пользователей системы. Пока что он пуст, поэтому добавим нового пользователя (Действия > Добавить) или нажмем кнопку Добавить в командной панели окна. Откроется окно редактирования пользователя:</p>
    <img src="../img/1С-1/2025-03-08_09-57-48.png" class="screen" alt="">
    <p><span class="светло_красный">Если вы используете учебную версию платформы «1С:Предприятие 8.3», то возможность задания паролей пользователей и аутентификация операционной системы будут недоступны. Это ограничения учебной версии</span>.</p>
    <p>Имя пользователя – это идентификатор, который будет появляться в окне выбора пользователей при запуске системы в режиме 1С:Предприятие.</p>
    <p>Полное имя – строка, которая может быть использована внутри конфигурации при выводе различной справочной информации. Хорошим стилем администрирования считается указание в качестве полного имени фамилии, имени и отчества пользователя (без сокращений).</p>
    <p>Следующие две области окна посвящены способам аутентификации пользователя.</p>
    <p>Аутентификация средствами «1С:Предприятия» подразумевает, что после запуска системы пользователю будет предложено выбрать имя одного из пользователей системы и ввести пароль. Если введенный пароль соответствует сохраненному в системе для этого идентификатора пользователя, система открывается с правами, которые указаны для этого пользователя. При этом он сможет поменять пароль, если флажок Пользователю запрещено изменять пароль не установлен</p>
    <p>Аутентификация операционной системы подразумевает, что при запуске системы «1С:Предприятие» от пользователя не требуется</p>
    <p>никакой дополнительной информации. Система «1С:Предприятие» определяет, под каким пользователем запущена операционная система, и затем обращается к своему списку пользователей. Если она находит в нем пользователя, которому поставлен в соответствие текущий пользователь операционной системы, информационная база открывается с правами, указанными для этого пользователя.</p>
    <p>Приступим к созданию пользователей.</p>
    <p>Зададим имя пользователя Администратор, полное имя тоже Администратор. Перейдем на закладку Прочие. Отметим роль Администратор и язык конфигурации выберем Русский. Нажмем ОК.</p>
    <p>После этого создадим остальных пользователей системы. Для всех них мы будем использовать аутентификацию «1С:Предприятия» и русский язык.</p>
    <p><span class="светло_красный">Если некоторые колонки, например Роли, не видны в списке пользователей, можно настроить список, выполнив команду Действия > Настройка списка…, и добавить нужные колонки.</span></p>
    <p>Обратите внимание, что главному бухгалтеру Назаровой поставлены в соответствие две роли: Расчетчик и Бухгалтер, поскольку она должна иметь возможность не только вести бухгалтерский учет, но и рассчитывать зарплату.</p>
    <p>Список пользователей, зарегистрированных в системе, можно получить, выполнив команду Действия > Вывести список…</p>

    <p><b id="22.4">22.4 Ограничение доступа к данным на уровне записей и полей базы данных </b></p>
    <p>В завершение занятия мы покажем, как можно ограничить доступ к данным более точно в зависимости от самих данных, которые хранятся в информационной базе.</p>
    <p>Для этого в системе «1С:Предприятие» используется механизм <i style="text-decoration: underline;">ограничения доступа на уровне записей и полей базы данных</i>. Этот механизм позволяет для четырех основных прав (чтение, добавление, изменение и удаление) уточнить, какие же именно данные информационной базы будут доступны пользователю.</p>
    <p>Такое уточнение записывается на специальном языке, являющемся подмножеством языка запросов.</p>
    <p>Далее на примере документа "Начисления сотрудникам" мы рассмотрим небольшой пример, когда мастерам нужно дать возможность просмотреть начисленную им зарплату, но руководство запрещает им доступ к информации о начисленной премии.</p>
    <p>Другими словами, мастерам нужно запретить просмотр тех документов Начисления сотрудникам, в которых есть записи о начислении премии.</p>
    <p>Для решения этой задачи сначала установим для роли Мастер право Просмотр для документа НачисленияСотрудникам.</p>
    <p>Поскольку этот документ принадлежит подсистеме РасчетЗарплаты, дадим право на просмотр этой подсистемы. Также дадим права на просмотр справочника ВидыГрафиковРаботы и плана видов расчета Основные начисления, т. к. ссылки на эти объекты используются в документе НачисленияСотрудникам. Вернемся к редактированию прав для документа НачисленияСотрудникам.</p>
    <p>Как мы видим, при установке права Просмотр право Чтение документа НачисленияСотрудникам установилось автоматически. Выделим его. В правой нижней части экрана находится поле "Ограничение доступа к данным". Нажмем кнопку Добавить:</p>
    <img src="../img/1С-1/2025-03-08_10-21-04.png" class="screen" alt="">
    <p>Мы хотим запретить доступ ко всем полям документа "Начисления сотрудникам".</p>
    <p>Поэтому мы не будем выбирать поля, а нажмем кнопку выбора в поле "Ограничение доступа"</p>
    <p>Откроется окно "Ограничение доступа", в котором можно задать текст на специальном языке, являющемся подмножеством языка запроса.</p>
    <p>Для облегчения работы мы воспользуемся конструктором запроса. Нажмем кнопку "Конструктор запроса". Откроется конструктор ограничений доступа к данным. Он похож на конструктор запросов. Таблица НачисленияСотрудникам автоматически попала на закладку "Таблицы и поля", а конструктор открылся на закладке "Условия".</p>
    <p>Перенесем в список условий поле ВидРасчета табличной части Начисления, установим флажок Произвольное и заполним правую часть условия, как показано:</p>
    <div class="code-style">
        <pre>
            НачисленияСотрудникам.Начисления.ВидРасчета &lt;> ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия)
        </pre>
    </div>
    <p>Текущий пользователь имеет право прочитать или изменить некоторый объект базы данных только в том случае, если ограничение доступа предоставляет ему такое право. То есть когда условие ограничения истинно.</p>
    <p>В нашем случае пользователь сможет прочитать документ Начисления сотрудникам НачисленияСотрудникам ГДЕ… только в том случае, если в его табличной части Начисления … ГДЕ НачисленияСотрудникам.Начисления … есть виды расчета … ГДЕ НачисленияСотрудникам.Начисления.ВидРасчета …, не являющиеся видом расчета Премия … &lt;> ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия). Нажмем ОК.</p>
    <p>Окно ограничений доступа к данным для роли Мастер будет выглядеть следующим образом:</p>
    <img src="../img/1С-1/2025-03-08_10-39-36.png" class="screen" alt="">
    <p>Обновим информационную базу, нажав F7, и запустим «1С:Предприятие» для пользователя с ролью Мастер, например, для пользователя Гусаков. В разделе "Расчет зарплаты" откроем список документов НачисленияСотрудникам:</p>
    <img src="../img/1С-1/2025-03-08_10-43-51.png" class="screen" alt="">
    <p>Как мы видим, в списке показаны только документы № 1 и № 3, так как в документе № 2 начисляется премия.</p>
    <p>Хотя это и не относится к вопросу ограничения доступа к данным, поясним по ходу еще один момент.</p>
    <p>На рисунке выше мы видим внизу окна приложения панель истории. Так получилось потому, что еще на третьем занятии, в момент заполнения данными первого справочника, мы задали ее отображение в конфигураторе. Затем мы убрали видимость этой панели, но уже в режиме 1С:Предприятие. Но, как уже говорилось, настройка панелей прикладного решения в режиме 1С:Предприятие относится только к тому пользователю, кто эту настройку выполнил, в то время как настройка отображения панелей в конфигураторе относится к конфигурации в целом. В тот момент у нас еще не было заведено пользователей, поэтому панель истории стала опять видна. И так будет для каждого нового пользователя.</p>
    <p>Чтобы этого не происходило, вернемся в конфигуратор и уберем видимость панели истории. Эта настройка будет действовать сразу для всех пользователей.</p>
    <p>Выделим корень дерева объектов конфигурации и из контекстного меню выберем пункт Открыть интерфейс клиентского приложения. В появившемся окне Интерфейс клиентского приложения выделим элемент Панель истории в левом списке и нажмем кнопку Удалить в командной панели окна</p>
    <p>Вернемся к вопросу ограничения доступа к данным.</p>
    <p>Немного усложним задачу. Мы все так же не хотим, чтобы мастер видел начисленные премии, но в то же время не хотим скрывать от него факт существования такого документа.</p>
    <p>Другими словами, в списке документов мастер должен его видеть, но не должен иметь возможности открыть его.</p>
    <p>Посмотрим на наше ограничение доступа к данным документа Начисления сотрудникам для роли Мастер.</p>
    <p>Мы не задавали никаких полей, поэтому ограничение применяется ко всем полям документа.</p>
    <p>Поэтому сейчас мы безусловно разрешим читать те поля документа, которые необходимы для отображения документа в списке.</p>
    <p>Тем самым мы разрешим документу отображаться в списке. Но поскольку существующее условие на прочие поля мы удалять не будем, то открыть документ, как и раньше, можно будет только в том случае, если в его табличной части есть виды расчета, отличные от Премия.</p>
    <p>Добавим к ограничениям доступа еще одно условие. В списке полей выберем поля: Ссылка, ПометкаУдаления, Номер, Дата, Проведен. В ограничении доступа напишем ГДЕ ИСТИНА:</p>
    <img src="../img/1С-1/2025-03-08_10-50-54.png" class="screen" alt="">
    <p>Закроем окно редактирования прав.</p>
    <p>Обновим информационную базу, нажав F7, и запустим «1С:Предприятие» для пользователя с ролью Мастер, например, для пользователя Гусаков.</p>
    <p>В разделе Расчет зарплаты откроем список документов НачисленияСотрудникам:</p>
    <img src="../img/1С-1/2025-03-08_10-51-52.png" class="screen" alt="">
    <p>В списке документов мы увидим все документы начислений. Документы № 1 и № 3 мы сможем открыть и просмотреть, но при попытке открыть документ № 2 мы получим сообщение о нарушении прав доступа</p>
    <p>То есть мы добились того, чего хотели.</p>
    <p>Теперь обратим внимание на следующий момент.</p>
    <p>Все хорошо, пока в документе № 2 содержатся записи только о расчете премии. Но вспомним, как формулируется наше ограничение доступа: пользователь сможет прочитать документ Начисления сотрудникам только в том случае, если в его табличной части Начисления есть виды расчета, не являющиеся видом расчета Премия.</p>
    <p>Это значит, что если в этом документе окажутся виды расчета, отличные от Премия, мастер сможет его открыть и просмотреть.</p>
    <p>Убедимся в этом.</p>
    <p>Запустим «1С:Предприятие» от имени пользователя Администратор.</p>
    <p>В разделе Расчет зарплаты откроем список документов НачисленияСотрудникам. Откроем документ № 2 и скопируем любую его строку. В новой строке изменим вид расчета на Оклад. Проведем и закроем документ. Завершим сеанс работы.</p>
    <p>Теперь запустим «1С:Предприятие» от имени пользователя Гусаков. Точно так же в разделе Расчет зарплаты откроем список документов НачисленияСотрудникам.</p>
    <p>Откроем документ № 2. Документ откроется, и мы увидим все его строки.</p>
    <p>Вернемся в конфигуратор.</p>
    <p>Для того чтобы документ невозможно было просмотреть и в этой ситуации, нам нужно будет изменить существующее условие ограничения доступа.</p>
    <p>Итак, откроем роль Мастер и перейдем на закладку Шаблоны ограничений</p>
    <p>Здесь добавим новый шаблон, назовем его ЕстьПремия.</p>
    <p>Текст шаблона будет выглядеть следующим образом:</p>
    <div class="code-style">
        <pre>
            ВЫБРАТЬ
                1
            ИЗ
                Документ.НачисленияСотрудникам.Начисления
            ГДЕ
                Документ.НачисленияСотрудникам.Начисления.ВидРасчета =
                ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия)
                И Документ.НачисленияСотрудникам.Начисления.Ссылка = #Параметр(1).Ссылка   
        </pre>
    </div>
    <p>По сути это запрос к табличной части документа НачисленияСотрудникам, который либо не вернет нам ничего, либо вернет одну запись с одним полем, в котором будет значение 1.</p>
    <p>Такую запись он вернет нам в том случае, если в табличной части документа есть вид расчета Премия.</p>
    <p>Второе условие в этом запросе нужно нам для того, чтобы указать, табличная часть какого именно документа нас интересует. В этом условии используется возможность указания параметров в шаблоне.</p>
    <div class="code-style">
        <pre>
            И Документ.НачисленияСотрудникам.Начисления.Ссылка = <b>#Параметр(1)</b>.Ссылка   
        </pre>
    </div>
    <p>Вместо #Параметр(1) будет подставлена та строка, которую мы укажем при вызове этого шаблона в условии ограничения доступа.</p>
    <p>Теперь вернемся на закладку Права.</p>
    <p>В имеющемся ограничении прав доступа для прочих полей (в первой строке списка ограничений) заменим старый текст новым:</p>
    <div class="code-style">
        <pre>
            ДокНачисления ГДЕ НЕ 1 В (#ЕстьПремия("ДокНачисления"))    
        </pre>
    </div>
    <p>Здесь с помощью конструкции #ЕстьПремия("ДокНачисления") мы обращаемся к нашему шаблону. Текст шаблона просто механически будет подставлен в это место, причем строка ДокНачисления заменит собой первый параметр шаблона (#Параметр(1)).</p>
    <p>Как мы уже говорили, если в табличной части есть начисление Премия, запрос в шаблоне вернет единственную запись со значением 1.</p>
    <p>Поэтому это условие разрешит нам прочитать ДокНачисления тогда, когда запрос из шаблона не возвращает 1:</p>
    <div class="code-style">
        <pre>
            ГДЕ НЕ 1 В (#ЕстьПремия(«ДокНачисления»))
        </pre>
    </div>
    <p>То есть тогда, когда в табличной части нет начисления Премия.</p>
    <p>Можно было бы записать это условие ограничения и без использования шаблонов.</p>
    <p>Но, во-первых, такая запись была бы менее читаемой (листинг 22.5), а во-вторых, использование шаблонов позволяет выделить и не дублировать части условий ограничений, которые могут использоваться в разных условиях:</p>
    <div class="code-style">
        <pre>
            ДокНачисления ГДЕ НЕ 1 В (
                ВЫБРАТЬ
                    1
                ИЗ
                    Документ.НачисленияСотрудникам.Начисления
                ГДЕ
                    Документ.НачисленияСотрудникам.Начисления.ВидРасчета =
                    ЗНАЧЕНИЕ(ПланВидовРасчета.ОсновныеНачисления.Премия)
                    И Документ.НачисленияСотрудникам.Начисления.Ссылка = ДокНачисления.Ссылка)   
        </pre>
    </div>
    <p>Закроем окно редактирования прав. Проверим, как это работает.</p>
    <p>Как вы помните, в документе № 2 есть строки и с видом расчета Премия, и с видом расчета Оклад. Раньше этот документ у нас открывался.</p>
    <p>Попробуем открыть его теперь.</p>
    <p>Мы получим сообщение о нарушении прав доступа, что нам и требовалось.</p>

















    <h2 class="header-style2" id="22">22. Список пользователей и их роли</h2>
    <h2 class="header-style2" id="22">22. Список пользователей и их роли</h2>
    <h2 class="header-style2" id="22">22. Список пользователей и их роли</h2>
    <h2 class="header-style2" id="22">22. Список пользователей и их роли</h2>










    <h2 class="header-style2" id="27">27. Приёмы разработки форм</h2>
    <p>На этом занятии мы рассмотрим несколько типичных приемов работы с формами объектов.</p>
    <p>Начнем занятие с рассказа о том, каким образом данные отображаются в формах, и о тех типах данных, которые при этом используются.</p>

    <p><b id="27.1">27.1 Данные и элементы формы</b></p>
    <p>Важной особенностью платформы «1С:Предприятие» является механизм представления данных в формах. Ключевым моментом здесь является то, что принадлежность формы к тому или иному объекту конфигурации никоим образом не определяет состав данных, которые форма будет отображать.</p>
    <p>Например, можно создать общую форму, которая не будет подчинена ни одному из объектов конфигурации, но которая, в зависимости от содержимого, будет либо отображать список справочника, либо позволять редактировать документ и т.п. Однако такую форму уже нельзя будет назначить основной для выполнения определенных действий.</p>
    <p>Форма сама по себе и ее элементы обособлены от объектов конфигурации. Для того чтобы форма отображала какие-либо данные, необходимо задать связь самой формы и ее элементов с данными. Если связь элементов формы с данными не задана, то элементы вообще не будут отображены в форме (кроме элементов оформления формы).</p>
    <p>При использовании конструктора форм конфигуратор создает такие связи автоматически. Если разработчик создает форму вручную, он может определить эти связи путем задания свойств формы и ее элементов</p>
    <img src="../img/1С-1/2025-02-22_20-32-01.png" class="screen" alt="">
    <p>Связь элементов формы с данными, которые они должны отображать, задается в свойстве ПутьКДанным.</p>
    <p>Связь формы и ее элементов с данными осуществляется при помощи реквизитов формы. Список существующих реквизитов формы доступен на закладке Реквизиты окна редактора формы.</p>
    <p>Среди всех реквизитов формы, как правило, существует один основной реквизит (он выделен жирным шрифтом). Он определяет источник данных для формы в целом. От типа значения основного реквизита формы зависит не только то, какие данные будут отображены в элементах формы, но и поведение самой формы.</p>
    <p>Например, если основному реквизиту формы указать тип значения ДокументОбъект.ПриходнаяНакладная, то при закрытии формы программа будет запрашивать подтверждение записи и проведения документа. Если же основному реквизиту формы указать тип значения СправочникОбъект.Клиенты, то подобного подтверждения при закрытии формы возникать не будет.</p>
    <p>Похожее влияние источники данных оказывают и на элементы формы.</p>
    <p>Например, состав колонок таблицы, источником данных которой является реквизит формы с типом значения ДинамическийСписок, будет различным в зависимости от того, какой объект используется в качестве основной таблицы этого динамического списка (например, РегистрНакопления.ОстаткиНоменклатуры или Справочник.Номенклатура).</p>
    <p>То же самое справедливо и для элемента формы Командная панель. При установленном свойстве командной панели Автозаполнение смена источника данных (а точнее говоря, источника действий) будет приводить к изменению состава команд, которые отображает командная панель.</p>
    <p>Возможность связать форму и ее элементы с различными данными является причиной того, что у формы и ее элементов существует несколько <i style="text-decoration: underline;">расширений</i>.</p>
    <p>Расширение представляет собой набор дополнительных свойств, методов и событий, появляющихся у формы или у элемента формы. Наличие того или иного расширения определяется либо типом данных, которые отображает форма/элемент, либо расположением элемента формы в других ее элементах. </p>
    <p>Чтобы подробнее познакомиться с этим механизмом, создадим основную форму списка справочника Номенклатура. При этом в конструкторе формы мы не будем сразу нажимать кнопку Готово, как делали раньше.</p>
    <p>Нажмем кнопку Далее > и кроме полей Наименование и Код включим в состав таблицы Список еще одно поле – ВидНоменклатуры. И затем уже нажмем Готово</p>
    <p>Итак, с механизмом расширений мы будем знакомиться на примере поля ВидНоменклатуры, расположенного в таблице Список формы списка справочника Номенклатура.</p>
    <p>Сама форма отображает данные объекта ДинамическийСписок. Поэтому к свойствам, методам и событиям объекта встроенного языка УправляемаяФорма добавляется Расширение динамического списка</p>
    <img src="../img/1С-1/2025-02-22_20-45-01.png" class="screen-2" alt="">
    <p>В результате этого у формы появляются такие параметры, как ТекущаяСтрока, Отбор и т.п.</p>
    <p>Теперь посмотрим на таблицу Список. Поскольку в таблице отображается динамический список, то к свойствам, методам и событиям объекта встроенного языка ТаблицаФормы добавляется Расширение динамического списка</p>
    <img src="../img/1С-1/2025-02-23_07-55-48.png" class="screen" alt="">
    <p>В результате у таблицы Список появляются такие свойства, как АвтоОбновление, ОтображатьКорень и т.д.</p>
    <p>И в заключение посмотрим на поле ВидНоменклатуры. Это поле связано с реквизитом типа ПеречислениеСсылка.ВидыНоменклатуры и является полем ввода. Поэтому к свойствам, методам и событиям объекта встроенного языка ПолеФормы добавляется Расширение поля ввода. В результате у поля ВидНоменклатуры появляются такие свойства, как БыстрыйВыбор, ВыделенныйТекст и т.д.</p>
    <img src="../img/1С-1/2025-02-23_07-58-15.png" class="screen-2" alt="">
    
    <p><b id="27.2">27.2 Типы данных формы</b></p>
    <p>В управляемой форме можно выделить следующие категории типов, с которыми она работает:</p>
    <ul class="list">
        <li>Типы встроенного языка, предназначенные для использования как в управляемых формах, так и вне них. Например, Число, СправочникСсылка.<имя>, ГрафическаяСхема, ТабличныйДокумент и т.д.</li>
        <li>Типы встроенного языка, предназначенные исключительно для того, чтобы представить в форме данные прикладных объектов (справочников, документов и т.д.). Это такие типы, как ДанныеФормыСтруктура, ДанныеФормыКоллекция и другие.</li>
        <li>Отдельно следует упомянуть тип ДинамическийСписок, который используется в управляемых формах для отображения списков прикладных объектов.</li>
    </ul>
    <p>Все типы прикладных объектов (такие как СправочникОбъект и т.д.) не существуют на стороне тонкого и веб-клиентов, они существуют только на сервере. Однако данные этих объектов нужно отображать в управляемых формах.</p>
    <p>Поэтому для представления в форме данных этих прикладных типов введены специальные типы данных, предназначенные для работы именно в управляемых формах. Используются следующие типы данных:</p>
    <ul class="list">
        <li><i style="text-decoration: underline;">ДанныеФормыСтруктура</i> – содержит набор свойств произвольного типа. Свойствами могут быть другие структуры, коллекции или структуры с коллекциями. Таким типом представляется, например, в форме СправочникОбъект.</li>
        <li><i style="text-decoration: underline;">ДанныеФормыКоллекция</i> – это список типизированных значений, похожий на массив. Доступ к элементу коллекции осуществляется по индексу или по идентификатору. Доступ по идентификатору может отсутствовать в некоторых случаях. Это обусловлено типом прикладного объекта, который представлен этой коллекцией. Идентификатором может быть любое целое число. Таким типом представляется, например, в форме табличная часть.</li>
        <li><i style="text-decoration: underline;">ДанныеФормыСтруктураСКоллекцией</i> – это объект, который представлен в виде структуры и коллекции одновременно. С ним можно обращаться как с любой из этих сущностей. Таким типом представляется, например, в форме набор записей.</li>
        <li><i style="text-decoration: underline;">ДанныеФормыДерево</i> – объект предназначен для хранения иерархических данных.</li>
    </ul>
    <p>Прикладной объект представлен либо одним, либо несколькими элементами данных формы. В общем виде иерархия и состав данных формы зависят от сложности и взаимосвязи прикладных объектов управляемой формы.</p>
    <p>Например, документ, содержащий табличную часть, будет представлен объектом типа ДанныеФормыСтруктура (собственно документ), которому подчинен объект типа ДанныеФормыКоллекция (табличная часть документа).</p>
    <p><span class="светло_красный">Во время разработки конфигурации важно помнить, что прикладные объекты доступны только на сервере, в то время как объектами данных форм можно пользоваться и на сервере, и на клиенте.</span></p>
    <p>Фактически можно сказать, что данные формы – это унифицированное представление данных различных прикладных объектов, с которыми форма работает единообразно и которые присутствуют и на сервере, и на клиенте.</p>
    <p>В редакторе формы (у реквизитов формы) вместо имен этих типов обычно отображаются те прикладные типы, данные которых содержит реквизит. </p>
    <p>Например, если реквизит Объект содержит данные элемента справочника Клиенты, то в колонке Тип отображается ненастоящий тип этого реквизита формы – ДанныеФормыСтруктура, а тип прикладного объекта, данные которого содержатся в этом реквизите – СправочникОбъект.Клиенты. Причем чтобы было понятно, что это «ненастоящий тип» реквизита, тип прикладного объекта показывается в круглых скобках.</p>
    <p>Таким образом форма содержит некоторую «проекцию» данных прикладных объектов в виде своих собственных типов данных и автоматически выполняет преобразование между ними при необходимости.</p>
    <p>Однако если разработчик конфигурации реализует свой алгоритм обработки данных, то преобразование данных (из специализированных типов в прикладные и обратно) он должен выполнять самостоятельно.</p>
    <p>Для конвертирования прикладных объектов в данные формы и обратно существует набор глобальных методов:</p>
    <ul class="list">
        <li><i style="text-decoration: underline;">ЗначениеВДанныеФормы()</i> – преобразует объект прикладного типа в данные формы;</li>
        <li><i style="text-decoration: underline;">ДанныеФормыВЗначение()</i> – преобразует данные формы в объект прикладного типа.</li>
    </ul>
    <p>Аналогичные методы, предназначенные для конвертирования значений реквизитов формы в прикладные объекты и обратно, существуют и у самой управляемой формы:</p>
    <ul class="list">
        <li><i style="text-decoration: underline;">ЗначениеВРеквизитФормы()</i> – преобразует объект прикладного типа в реквизит управляемой формы;</li>
        <li><i style="text-decoration: underline;">РеквизитФормыВЗначение()</i> – преобразует реквизит управляемой формы в значение прикладного типа.</li>
    </ul>
    <p>Методы, работающие с прикладными объектами, доступны только в серверных процедурах формы.</p>
    <p>При выполнении стандартных действий формы с основным реквизитом (открытие формы, выполнение стандартной команды Записать и т.д.) преобразование выполняется автоматически.</p>
    <p>Приведем пример преобразования данных, которое может потребоваться в собственных алгоритмах.</p>
    <p>Например, у нас есть особенная форма, в которой в качестве одного из реквизитов (ТоварДляМодификации) используются данные элемента справочника Товары. При создании формы на сервере мы по некоторому алгоритму определяем, какой именно это товар, и читаем его данные в реквизит формы. При этом используется преобразование данных ЗначениеВДанныеФормы()</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
                ОбъектТовар = Справочники.Товары.НайтиПоНаименованию("Кофейник").ПолучитьОбъект();
                ЗначениеВДанныеФормы(ОбъектТовар, ТоварДляМодификации);
            КонецПроцедуры

            &НаКлиенте
            Процедура Записать()
                ЗаписатьНаСервере();
            КонецПроцедуры

            &НаСервере
            Процедура ЗаписатьНаСервере()
                ОбъектТовар = ДанныеФормыВЗначение(ТоварДляМодификации, Тип(
                "СправочникОбъект.Товары"));
                ОбъектТовар.Записать();
            КонецПроцедуры   
        </pre>
    </div>
    <p>В некоторый момент работы формы мы решаем, что измененные данные нашего товара необходимо записать в базу данных, и тогда выполняем обратное преобразование данных формы в прикладной объект (ДанныеФормыВЗначение()) и записываем его.</p>
    <p>Как мы уже упомянули, у формы также есть методы, позволяющие преобразовать прикладные данные в реквизит формы и наоборот.</p>
    <p>Использование данных методов обычно удобнее, так как они имеют, например, информацию о типе реквизита формы. Кроме этого, метод РеквизитФормыВЗначение() выполняет установку соответствия данных формы и объекта, которая используется при формировании сообщений.</p>
    <p>Приведем пример использования этих методов. В серверной процедуре формы мы получаем прикладной объект из реквизита формы и выполняем метод этого прикладного объекта Пересчитать(). Затем данные объекта, измененные в результате пересчета, преобразуем обратно в реквизит формы:</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПересчитатьНаСервере()
                <span class="зелёный">// Преобразует реквизит Объект в прикладной объект.</span>
                Документ = РеквизитФормыВЗначение("Объект");

                <span class="зелёный">// Выполняет пересчет методом, определенным в модуле документа.</span>
                Документ.Пересчитать();

                <span class="зелёный">// Преобразует прикладной объект обратно в реквизит.</span>
                ЗначениеВРеквизитФормы(Документ, "Объект");
            КонецПроцедуры   
        </pre>
    </div>
    
    <p><b id="27.3">27.3 Связанные списки</b></p>
    <p>Тут не буду описывать. Речь идёт о списках, которые появляются в прикладных объектах справочника, документа и т.д. Например, подчинённый справочник будет отображаться в элементе справочника родителя, список набора записей регистра будет отображаться в документе, который делает в нём движения(если поставить галочку видимости) и т.д.</p>
    
    <p><b id="27.4">27.4 Оформление строк в форме списка</b></p>
    <p>Одним из полезных свойств формы списка является возможность настройки оформления его строк. Для наглядности этой возможности мы воспользуемся формой списка справочника Номенклатура и придадим ей нестандартный вид.</p>
    <p>Откроем в конфигураторе форму списка справочника Номенклатура и создадим обработчик события формы ПриСозданииНаСервере. Внесем в него следующий текст</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
                СписокСправочника = Элементы.Список;

                <span class="зелёный">// Задать режим отображения справочника.</span>
                СписокСправочника.Отображение = ОтображениеТаблицы.Список;

                <span class="зелёный">// Скрыть линии сетки.</span>
                СписокСправочника.ВертикальныеЛинии = Ложь;
                СписокСправочника.ГоризонтальныеЛинии = Ложь;
            КонецПроцедуры   
        </pre>
    </div>
    <p>В этой процедуре, выполняющейся при создании формы на сервере, мы сначала представляем список в виде обычного, а не иерархического списка. Это сделано для большей наглядности, чтобы материалы отображались вперемешку с услугами.</p>
    <p>Затем мы скрываем линии, разделяющие колонки и строки таблицы списка</p>
    <p>Теперь настроим условное оформление строк списка. Для этого вызовем палитру свойств основного реквизита формы Список. В строке Настройка списка нажмем Открыть</p>
    <img src="../img/1С-1/2025-02-23_08-16-40.png" class="screen-2" alt="">
    <p>Поскольку этот реквизит имеет тип ДинамическийСписок, который построен на основе системы компоновки данных, то мы можем настроить для него Отбор, Порядок, Группировку и УсловноеОформление аналогично тому, как это делалось в отчетах.</p>
    <p>В открывшемся окне настройки динамического списка перейдем на закладку Условное оформление и нажмем кнопку Добавить в командной панели окна.</p>
    <p>Сначала укажем Оформление для выделения полей.</p>
    <p>Нажмем кнопку выбора в поле Оформление и установим сиреневый цвет фона</p>
    <img src="../img/1С-1/2025-02-23_08-19-05.png" class="screen" alt="">
    <p>Нажмем ОК. Затем укажем условие, при наступлении которого будет применяться оформление, то есть когда строки списка будут сиреневыми.</p>
    <p>Нажмем кнопку выбора в поле Условие и в появившемся окне добавим Новый элемент отбора. Для этого нажмем кнопку Добавить и укажем в графе Левое значение – поле ВидНоменклатуры, в графе Вид сравнения – Равно, а в графе Правое значение выберем Перечисление.ВидыНоменклатры.Услуга.</p>
    <img src="../img/1С-1/2025-02-23_08-20-49.png" class="screen" alt="">
    <p>Таким образом, мы установили, что когда в списке номенклатуры будут отражаться услуги, эти строки будут выделены сиреневым фоном. Поскольку мы хотим выделить полностью строки, а не отдельные поля списка, то список оформляемых полей можно оставить пустым. Нажмем ОК.</p>
    <p>Запустим «1С:Предприятие» в режиме отладки и откроем список номенклатуры.</p>
    <p>Мы видим, что список имеет вид обычного неиерархического списка, услуги выделены сиреневым цветом, а также отсутствуют разделительные линии строк и колонок списка</p>
    <img src="../img/1С-1/2025-02-23_08-22-34.png" class="screen" alt="">
    <p>Рассмотрим также свойства пользовательских настроек списка, которые аналогичны для всех настроек динамического списка – Отбор, Порядок, Группировка и УсловноеОформление. Настройки динамических списков в платформе очень похожи на настройки отчетов, построенных с помощью системы компоновки данных.</p>
    <p>По умолчанию в окне настроек (внизу на каждой из закладок: Отбор, Порядок, Группировка, УсловноеОформление) динамического списка в конфигураторе установлен флажок Включать в пользовательские настройки, а также свойство Режим редактирования установлено свойство Обычный</p>
    <img src="../img/1С-1/2025-02-23_08-24-18.png" class="screen" alt="">
    <p>Это значит, что пользователь может изменить заданное оформление списка, выполнив команду Еще > Настроить список… При этом откроется окно настройки динамического списка, аналогичное окну пользовательских настроек отчетов, где он может задать свое условное оформление списка и/или другие настройки</p>
    <img src="../img/1С-1/2025-02-23_08-28-09.png" class="screen" alt="">
    <p>Если настройка требуется пользователю часто, то можно поместить настройку непосредственно в форме списка. Для этого нужно установить в окне настройки списка "Режим редактирования" в значение "Быстрый доступ".</p>
    <p>Мы видим, что настройка условного оформления доступна пользователю в самой форме списка, сразу над списком номенклатуры. Кроме того, он может вызвать окно пользовательских настроек по команде Еще > Настроить список… и редактировать там условное оформление и другие настройки списка.</p>
    <p>А также (как и в отчетах) пользователь может изменить состав настроек (Еще > Изменить состав настроек…) согласно своим предпочтениям. То есть перенести какие-то настройки из списка быстрых настроек в обычные и наоборот.</p>
    <img src="../img/1С-1/2025-02-23_08-31-38.png" class="screen" alt="">
    <p>Свойства Включать в пользовательские настройки, Представление и Режим редактирования могут относиться как в целом к настройкам отбора, порядка, группировки и условного оформления динамического списка, так и к отдельным элементам этих настроек. Например, одна настройка отбора может быть включена в пользовательские настройки, а другая – нет. Свойства отдельных элементов настроек, если они заданы, имеют больший приоритет. Они задаются по команде Свойства элемента пользовательских настроек нажатием соответствующей кнопки над списком настроек.</p>
    <p>Аналогичным образом можно настраивать условное оформление и для списков, источником которых является не динамический список, а другие типы данных. Например, условное оформление табличной части документа.</p>
    <p>Но выполняется это уже с помощью условного оформления самой формы. То есть в дереве элементов формы нужно выделить корневой элемент и в палитре свойств открыть ссылку УсловноеОформление.</p>
    <p>Если требуется выделить по некоторому условию полностью всю строку табличной части, то в список Оформляемые поля нужно добавить саму таблицу формы, содержащую табличную часть (например, Материалы), иначе нужно указать те поля таблицы, которые должны быть оформлены.</p>
    
    <p><b id="27.5">27.5 Вычисляемые колонки в списках</b></p>
    <p>Необходимость вывода произвольных данных в колонках списка возникает, когда вместе с элементом списка нужно отобразить некоторую вычисляемую информацию.</p>
    <p>Мы рассмотрим эту ситуацию на примере отображения актуальной цены в списке справочника Номенклатура.</p>
    <p>Эти данные мы можем получить из таблицы регистра сведений Цены.СрезПоследних. Следовательно, поле Цена из этой таблицы нам нужно добавить в динамический список Список, который является основным реквизитом формы списка номенклатуры и служит источником данных для таблицы списка.</p>
    <p>Откроем в конфигураторе форму списка справочника Номенклатура и вызовем палитру свойств основного реквизита формы Список. </p>
    <p>До сих пор в свойствах динамического списка была указана Основная таблица – Справочник.Номенклатура, и список формировался путем запроса к этой таблице.</p>
    <p>Теперь нам нужна еще связанная информация из таблицы регистра сведений Цены.СрезПоследних.</p>
    <p>Поэтому установим флажок ПроизвольныйЗапрос и в строке "Настройка списка" нажмем Открыть.</p>
    <p>Откроется окно настройки динамического списка. На закладке Запрос мы видим запрос, в котором выбираются все поля из таблицы Справочник.Номенклатура.</p>
    <p>Изменим его. Для этого нажмем кнопку Конструктор запроса.</p>
    <p>Добавим в список таблиц Цены.СрезПоследних и выберем из нее поле Цена</p>
    <img src="../img/1С-1/2025-02-23_08-58-38.png" class="screen" alt="">
    <p>На закладке Связи отредактируем связь между таблицами, созданную по умолчанию.</p>
    <p>Установим флажок Все у таблицы Справочник.Номенклатура и снимем его у таблицы Цены.СрезПоследних, и свяжем по полю Ссылка и Номенклатура.</p>
    <p>Тем самым мы задаем, что в списке номенклатуры будут отражены все позиции, даже те, по которым не установлены цены.</p>
    <p>Создание запроса закончено, нажмем ОК. Текст запроса нам уже знаком и понятен, поэтому не будем на нем останавливаться.</p>
    <p>Теперь колонка Цена, содержащая актуальную цену, будет отображаться в списке номенклатуры, когда мы поместим ее в форму списка.</p>
    <p>В окне настройки динамического списка перейдем на закладку Настройки и зададим условное оформление этой колонки так, чтобы низкие цены выделялись цветом.</p>
    <p>Для этого перейдем на закладку Условное оформление. Там мы видим созданное нами ранее условное оформление для строк списка. Нажмем кнопку Добавить в командной панели окна.</p>
    <p>Сначала укажем Оформление для выделения полей. Нажмем кнопку выбора в поле Оформление и установим синий цвет текста.</p>
    <p>Затем укажем условие, при наступлении которого будет применяться оформление, то есть когда текст в колонке Цена будет синим.</p>
    <p>Нажмем кнопку выбора в поле Условие и в появившемся окне добавим Новый элемент отбора. Для этого нажмем кнопку Добавить и укажем в графе Левое значение – поле Цена, в графе Вид сравнения – Меньше, а в графе Правое значение выберем 500.</p>
    <p>Затем укажем список оформляемых полей. Нажмем кнопку выбора в поле Оформляемые поля, затем нажмем Добавить и выберем поле Цена</p>
    <img src="../img/1С-1/2025-02-23_09-02-02.png" class="screen" alt="">
    <p>Нажмем ОК. Теперь нам осталось только перетащить поле Цена из окна реквизитов в окно элементов формы.</p>
    <p>Теперь зададим отдельно свойства для каждого созданного нами элемента настроек условного оформления.</p>
    <p>Для этого выделим каждую настройку и нажмем кнопку "Свойства элемента пользовательских настроек" над списком настроек. У обеих настроек установим флажок "Включать в пользовательские настройки". Зададим представление первой настройки как Услуги, второй – Низкая цена, а свойство Режим редактирования оставим без изменения в значении Быстрый доступ. Аналогичное свойство для настроек условного оформления в целом (внизу окна) вернем к значению Обычный</p>
    <img src="../img/1С-1/2025-02-23_09-04-23.png" class="screen" alt="">
    <p>Запустим «1С:Предприятие» в режиме отладки и откроем список номенклатуры. Мы видим, что вместе с номенклатурой выводится ее актуальная цена, причем цены на номенклатуру меньше 500 выделены синим цветом текста. А также строки номенклатуры, являющейся услугами, выделены сиреневым цветом фона. Обе настройки условного оформления расположены прямо над списком номенклатуры, они имеют понятное название, их можно включить или выключить (предварительно нужно удалить общую настройку оформления строк списка цветом фона, если она осталась в пользовательских настройках).</p>
    <img src="../img/1С-1/2025-02-23_08-22-34.png" class="screen" alt="">
    <p>В заключение обратим внимание на свойство динамического списка Автоматическое сохранение пользовательских настроек. Стандартно оно включено.</p>
    <p>Поэтому при закрытии формы все настройки списков автоматически сохраняются в системном хранилище и загружаются при открытии формы этим же пользователем. Кроме того, пользователь может сохранять настройки списков и вручную, задавая им понятные имена (Еще > Сохранить настройки…, Еще > Загрузить настройки…). В результате для одного и того же списка можно хранить несколько вариантов его настройки.</p>
    <p>Можно снова вернуться к настройкам списка, заданным разработчиком в конфигураторе, выполнив команду Еще > Восстановить стандартные настройки.</p>
    
    <p><b id="27.6">27.6 Список выбора для поля ввода</b></p>
    <p>Одним из полезных и удобных механизмов поля ввода является использование списка выбора для этих полей.</p>
    <p>Поля ввода, имеющие ссылочный тип, например, Склад, Сотрудник, по умолчанию имеют кнопку выбора. При нажатии этой кнопки открывается форма выбора объекта, на которую ссылается данное поле.</p>
    <p>Но для полей других типов тоже бывает нужно выполнять выбор из нескольких предопределенных значений.</p>
    <p>Рассмотрим совсем простой пример, когда пользователю нужно ввести адреса клиентов, начинающиеся с названия города.</p>
    <p>Сначала нужно добавить поле Адрес в форму элемента справочника Клиенты.</p>
    <p>Для этого откроем в конфигураторе окно редактирования объекта конфигурации Справочник Клиенты и на закладке Данные добавим реквизит Адрес с типом Строка, длиной 25. Затем откроем форму элемента справочника Клиенты. Раскроем основной реквизит формы Объект и перетащим поле Адрес из окна реквизитов в окно элементов формы.</p>
    <p>В открывшейся палитре свойств этого поля установим свойство РежимВыбораИзСписка. Затем нажмем кнопку выбора в строке СписокВыбора и, нажимая кнопку Добавить, создадим значения, например: Москва, Королев, Монино</p>
    <img src="../img/1С-1/2025-02-23_09-14-10.png" class="screen-2" alt="">
    <p>Запустим «1С:Предприятие» в режиме отладки и откроем форму редактирования клиента. В поле Адрес наберем «м», и система предложит на выбор два подходящих названия</p>
    <img src="../img/1С-1/2025-02-23_09-17-03.png" class="screen-2" alt="">
    <p>Аналогичные действия, которые мы выполнили в конфигураторе, можно выполнить и во встроенном языке. То есть в зависимости от некоторого алгоритма можно формировать список выбора для поля ввода динамически.</p>
    <p>Более того, разработчик из встроенного языка может изменять тот список выбора, который формируется платформой автоматически, например в автогенерируемых формах. Для этого используется обработчик события Обработка получения данных выбора, который располагается в модуле менеджера объекта. Например, в модуле менеджера справочника, когда в поле ввода подбирается один из элементов этого справочника.</p>
    
    <p><b id="27.7">27.7 Форма выбора для поля, содержащего ссылочный реквизит</b></p>
    <p>В процессе работы прикладного решения довольно распространенной является ситуация, когда данные вводятся в поля ссылочных реквизитов, то есть реквизитов, ссылающихся на какие-либо объекты конфигурации(разве на объекты конфигурации? больше похоже, что они ссылаются на объекты БД).</p>
    <p>Например, в документе Оказание услуги мы заполняем поля ссылочного типа Клиент (тип СправочникСсылка.Клиенты), Мастер (тип СправочникСсылка.Сотрудники) и др.</p>
    <p>При нажатии кнопки выбора в этих полях по умолчанию открывается основная форма выбора соответствующих объектов конфигурации (справочника Клиенты, справочника Сотрудники и др.).</p>
    <p>Но иногда бывает нужно открывать свою специальную форму для выбора ссылочного реквизита. Для этого в свойстве <i style="text-decoration: underline;">"Форма выбора" этого реквизита нужно указать эту специальную форму, и тогда она будет открываться для выбора данного реквизита в любой форме, где он находится.</p>
    <p>Для примера рассмотрим документ ОказаниеУслуги. Допустим, что в поле Мастер нам нужно открывать не стандартную форму выбора справочника Сотрудники, а специально разработанную для этого форму.</p>
    <p>Сначала эту форму нужно создать.</p>
    <p>Откроем окно редактирования справочника "Сотрудники" и перейдем на закладку Формы.</p>
    <p>Мы видим, что у него вообще еще нет ни одной формы. Это значит, что все формы справочника в режиме 1С:Предприятие, в том числе и форма выбора, генерировались системой автоматически.</p>
    <p>Нажмем кнопку Добавить.</p>
    <p>В открывшемся конструкторе формы выберем тип формы – "Произвольная форма" и зададим ее имя ФормаДляВыбора. Нажмем Готово.</p>
    <p>В открывшемся редакторе формы мы видим, что в форме нет ни одного элемента, и у формы нет данных, так как форма – произвольная, и мы можем наполнять ее данными и элементами по своему усмотрению.</p>
    <p>На закладке Реквизиты создадим основной реквизит формы с именем Список и типом ДинамическийСписок. В качестве основной таблицы выберем Справочник.Сотрудники</p>
    <img src="../img/1С-1/2025-02-23_09-26-03.png" class="screen-2" alt="">
    <p><span class="светло_красный">Не забудьте установить флажок "Основной реквизит" в свойствах реквизита Список. Если этого не сделать, то форма "не будет знать", откуда ей брать данные.</span></p>
    <p>Затем перетащим этот реквизит в окно элементов формы. Согласимся с предложением «Добавить колонки таблицы Список?». В форме появится таблица Список, отображающая список сотрудников.</p>
    <p>Теперь немного изменим внешний вид формы.</p>
    <p>В окне элементов формы раскроем таблицу Список и удалим поле Код.</p>
    <p>Затем удалим командную панель формы, так как таблица по умолчанию имеет свою командную панель. Для этого выделим корневой элемент Форма, откроем его палитру свойств и установим свойство ПоложениеКоманднойПанели в значение Нет</p>
    <img src="../img/1С-1/2025-02-23_09-30-00.png" class="screen-2" alt="">
    <p>Чтобы из таблицы, содержащей список сотрудников, можно было сделать выбор, откроем палитру свойств таблицы Список и установим флажок РежимВыбора:</p>
    <img src="../img/1С-1/2025-02-24_15-37-27.png" class="screen" alt="">
    <p>В командной панели таблицы сразу появится кнопка "Выбор" жёлтого цвета.</p>
    <p>И в заключение зададим заголовок формы "Выбор сотрудников", а флажок АвтоЗаголовок снимем, чтобы не отражался заголовок, заданный нами в расширенном представлении списка для справочника Сотрудники:</p>
    <img src="../img/1С-1/2025-02-24_15-40-43.png" class="screen" alt="">
    <p>В результате мы создали форму, очень похожую на форму выбора. Мы убрали из списка поле Код и изменили заголовок формы, чтобы наша форма внешне в чем-то отличалась от формы выбора.</p>
    <p>В действительности произвольная форма, конечно, будет отличаться своей функциональностью, иначе зачем ее назначать в качестве формы для выбора? Но это сейчас не входит в нашу задачу. Мы хотим только показать принцип использования произвольной формы в качестве формы выбора.</p>
    <p>Теперь откроем окно редактирования объекта конфигурации Документ ОказаниеУслуги.</p>
    <p>Вызовем палитру свойств реквизита Мастер и нажмем кнопку выбора в поле Форма выбора. Откроется список форм, созданных в конфигурации для объекта, на который ссылается данный реквизит. В данном случае для справочника Сотрудники, на который ссылается реквизит Мастер, создана одна форма – ФормаДляВыбора. Выберем ее:</p>
    <img src="../img/1С-1/2025-02-24_15-44-05.png" class="scree-2" alt="">
    <p>Запустим «1С:Предприятие» в режиме отладки и откроем один из документов Оказание услуги. Нажмем кнопку выбора в поле Мастер и в выпадающем списке, открывшемся под полем ввода, нажмем ссылку Показать все. Откроется созданная нами произвольная форма с заголовком "Выбор сотрудников":</p>
    <img src="../img/1С-1/2025-02-24_15-46-19.png" class="screen" alt="">
    <p>Если очистить свойство Форма выбора для реквизита Мастер в документе ОказаниеУслуги, то в режиме 1С:Предприятие при выборе в поле Мастер будет открываться основная форма выбора справочника Сотрудники, автоматически сгенерированная системой.</p>
    
    <p><b id="27.8">27.8 Проверка заполнения реквизитов</b></p>
    <p>Для реквизитов объектов конфигурации существует возможность как автоматической, так и программной проверки их заполнения. Причем делается это не на уровне форм, а на уровне свойств реквизитов или в модуле объекта, к которому относится данный реквизит. Таким образом, проверка заполнения реквизита будет производиться во всех формах, где используется этот реквизит.</p>
    <p><i style="text-decoration: underline;">Автоматическая проверка заполнения</i></p>
    <p>Для примера рассмотрим объект конфигурации Документ ОказаниеУслуги. Допустим, нам нужно контролировать заполнение реквизита НаборСвойств табличной части этого документа.</p>
    <p>Откроем окно редактирования объекта конфигурации Документ ОказаниеУслуги. Вызовем палитру свойств реквизита табличной части НаборСвойств и установим свойство "Проверка заполнения" в значение "Выдавать ошибку".</p>
    <p>Тем самым при записи документа этот реквизит будет проверяться на заполнение. Если значение реквизита не заполнено, будет выдано сообщение об ошибке, и документ не будет сохранен.</p>
    <p>Запустим «1С:Предприятие» в режиме отладки и откроем документ Оказание услуги № ЦБ000000001. В табличной части этого документа содержится одна строка с услугой Диагностика, для которой колонка Набор свойств не заполнена. При проведении этого документа будет выдано сообщение об ошибке, и документ не будет проведен.</p>
    <p><i style="text-decoration: underline;">Программная проверка заполнения</i></p>
    <p>Иногда бывает нужно самостоятельно производить проверку заполнения реквизита в соответствии с программной логикой. В этом случае, если для реквизита установлено свойство Проверка заполнения в значение Выдавать ошибку, нужно удалить этот реквизит из массива проверяемых реквизитов и выполнить проверку программным путем. Или же если для реквизита не установлена проверка заполнения, можно программно добавить реквизит в массив проверяемых реквизитов.</p>
    <p>Программная проверка заполнения объектов конфигурации выполняется в обработчике ОбработкаПроверкиЗаполнения(), который нужно поместить в модуле объекта. Этот обработчик вызывается автоматически при сохранении любой формы или при проведении документов. Программную проверку объектов интерактивного ввода нужно делать именно в этом обработчике, а не при записи объекта.</p>
    <p>Откроем модуль документа ОказаниеУслуги и поместим в нем следующую процедуру:</p>
    <div class="code-style">
        <pre>
            Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
                Индекс = ПроверяемыеРеквизиты.Найти("ПереченьНоменклатуры.НаборСвойств");

                Если Индекс &lt;> Неопределено Тогда
                    ПроверяемыеРеквизиты.Удалить(Индекс);
                КонецЕсли;
                Индекс = 0;

                Для Каждого ТекСтрокаПереченьНоменклатуры Из ПереченьНоменклатуры Цикл
                    Если ТекСтрокаПереченьНоменклатуры.Номенклатура.ВидНоменклатуры = Перечисления.ВидыНоменклатуры.Материал Тогда
                        Если Не ЗначениеЗаполнено(ТекСтрокаПереченьНоменклатуры.НаборСвойств) Тогда
                            Сообщение = Новый СообщениеПользователю();
                            Сообщение.Текст = "В строке " + Строка(Индекс+1) +" списка Перечень номенклатуры не заполнена колонка Набор свойств";
                            Сообщение.Поле = "ПереченьНоменклатуры[" + Строка(Индекс)
                            + "].НаборСвойств";
                            Сообщение.УстановитьДанные(ЭтотОбъект);
                            Сообщение.Сообщить();
                            Отказ = Истина;
                        КонецЕсли;
                    КонецЕсли;
                    Индекс = Индекс + 1;
                КонецЦикла;
            КонецПроцедуры
        </pre>
    </div>
    <p>Сначала мы находим реквизит табличной части НаборСвойств в массиве ПроверяемыеРеквизиты. Этот массив передается в обработчик и содержит массив проверяемых реквизитов, которым мы установили свойство Проверка заполнения в значение Выдавать ошибку во время разработки конфигурации. Если он найден, то удаляем его, так как мы будем выполнять проверку самостоятельно.</p>
    <p>Затем мы в цикле обходим строки табличной части документа и формируем сообщения об ошибке только в том случае, если номенклатура в табличной части является материалом и для нее не заполнена колонка НаборСвойств.</p>
    <p>Параметр Отказ мы устанавливаем в значение Истина. Это значит, что документ не будет проведен, если найден хоть один незаполненный реквизит НаборСвойств для номенклатуры, являющейся материалом. Если этот параметр закомментировать, сообщения об ошибке будут выдаваться, но документ будет проведен.</p>
    <p>Для упрощения примера мы опять здесь используем обращение ПереченьНоменклатуры.Номенклатура.ВидНоменклатуры, хотя оптимальнее использовать запрос. Об этом подробно рассказывалось на занятии № 14, поэтому мы не будем здесь рассматривать этот вопрос.</p>
    <p>Запустим «1С:Предприятие» в режиме отладки и откроем документ Оказание услуги № ЦБ000000001. В табличную часть этого документа добавим еще одну строку, содержащую какой-либо материал, и попробуем записать документ, нажав кнопку Провести. Для второй строки табличной части будет выдано сообщение об ошибке:</p>
    <img src="../img/1С-1/2025-02-24_16-01-38.png" class="screen" alt="">
    <p>Можно также программно добавить реквизит в массив проверяемых реквизитов:</p>
    <div class="code-style">
        <pre>
            ПроверяемыеРеквизиты.Добавить("ПереченьНоменклатуры.НаборСвойств");    
        </pre>
    </div>
    
    <p><b id="27.9">27.9 Использование параметризованных команд</b></p>
    <p>Использование параметризованных команд в формах объектов позволяет при выполнении команды передать в обработчик команды какой-либо параметр, например значение ссылочного реквизита. И затем использовать его, например, открыть с этим параметром форму отчета.</p>
    <p>Для примера создадим команду открытия отчета, показывающего остатки материалов по складу, указанному в документе. Отчет будет вызываться из формы документа ОказаниеУслуги, в него будет передаваться значение реквизита документа Склад, и при открытии отчета в настройки отчета будет добавляться отбор по параметру Склад.</p>
    <p>Сначала создадим параметризованную команду у объекта конфигурации отчета "Материалы".</p>
    <p>Для этого откроем окно редактирования этого объекта. На закладке Команды нажмем кнопку Добавить и создадим команду ОстаткиПоСкладу.</p>
    <p>В открывшейся палитре свойств зададим Тип параметра команды – СправочникСсылка.Склады. В свойстве Группа укажем Командная панель формы.Важное:</p>
    <img src="../img/1С-1/2025-02-24_17-27-24.png" class="screen" alt="">
    <p>Таким образом, мы создали команду с типом параметра СправочникСсылка.Склады, и теперь во всех формах, имеющих реквизит такого типа, эта команда автоматически будет добавлена в список параметризуемых команд, доступных в форме.</p>
    <p>В открывшемся модуле команды заполним обработчик для ее выполнения следующим образом:</p>
    <div class="code-style">
        <pre>
            <span class="светло-синий">&НаКлиенте
            Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
                <span class="зелёный">//"Отбор" это спецключ, который передаётся в параметрах для отбора. Параметр формы из расширения отчёта
                //"КлючНазначенияИспользования" этот спецключ определяет назначение использования формы. параметр самой формы
                //"СформироватьПриОткрытии" этот спецключ для формирования отчёта самостоятельно. Из расширения отчёта</span>

                ПараметрыФормы = Новый Структура(<span class="серый">"Отбор, КлючНазначенияИспользования, СформироватьПриОткрытии"</span>, Новый Структура(<span class="серый">"Склад"</span>, ПараметрКоманды), <span class="серый">"ОстаткиПоСкладу"</span>, Истина);
                ОткрытьФорму(<span class="серый">"Отчет.Материалы.Форма"</span>, ПараметрыФормы, ПараметрыВыполненияКоманды.Источник, Истина, ПараметрыВыполненияКоманды.Окно);
            КонецПроцедуры</span>
        </pre>
    </div>
    <p>В процедуру ОбработкаКоманды() передается ПараметрКоманды, содержащий значение типа СправочникСсылка.Склады. Затем создается структура параметров формы (ПараметрыФормы): Отбор, КлючНазначенияИспользования, СформироватьПриОткрытии.</p>
    <p>В параметр Отбор добавляется структура, содержащая элемент Склад со значением, содержащимся в параметре команды (ПараметрКоманды), параметр КлючНазначенияИспользования – "ОстаткиПоСкладу" определяет назначение использования формы, а параметру СформироватьПриОткрытии присваивается значение Истина, чтобы отчет формировался сразу после открытия.</p>
    <p>Затем структура параметров формы передается в глобальный метод ОткрытьФорму(), и форма, указанная в первом параметре метода, открывается с параметром Склад. Причем поскольку в четвертом параметре Уникальность этого метода передается Истина, то при открытии формы каждый раз будет открываться новая форма отчета и отчет будет заново сформирован с отбором по складу, переданному в параметре команды.</p>
    <p>Теперь поместим нашу команду в форму документа.</p>
    <p>Как мы уже говорили, в формах документов ПриходнаяНакладная и ОказаниеУслуги содержится команда ОстаткиПоСкладу, так как они имеют реквизит Склад типа СправочникСсылка.Склады. </p>
    <p>Откроем форму документа ОказаниеУслуги.</p>
    <p>На закладке Команды перейдем в раздел "Глобальные команды". Здесь мы видим список глобальных параметризуемых команд, доступных в форме. В группе Параметризуемые раскроем строку Объект и перетащим нашу команду Отчет.Материалы.Команда.ОстаткиПоСкладу(Объект.Склад) в командную панель элементов формы.</p>
    <p>В скобках у команды указано значение реквизита Склад (Объект.Склад), которое будет передаваться в команду при ее выполнении:</p>
    <img src="../img/1С-1/2025-02-24_17-49-06.png" class="screen" alt="">
    <p>Заметьте, что мы не создавали форму отчета и не добавляли в настройки отчета отбор по параметру формы Склад. Система сделает это сама при выполнении обработчика команды ОстаткиПоСкладу.</p>
    <p>Запустим «1С:Предприятие» в режиме отладки и откроем документ Оказание услуги № ЦБ000000001.</p>
    <p>Нажмем кнопку Остатки по складу и вызовем отчет Материалы. Форма отчета генерируется системой автоматически. Отчет будет выполнен сразу при открытии формы с отбором по складу Основной, указанному в форме документа.</p>
    <p>Закроем отчет. Если в форме документа мы изменим склад на Розничный, а затем выполним отчет нажатием кнопки Остатки по складу, то он будет сформирован с отбором по складу Розничный (в данном случае отчет будет пустой, так как у нас нет движений материалов по этому складу).</p>
    <p>Таким образом, мы создали для пользователя очень удобную возможность – открывать отчет, показывающий остатки материалов по складу, прямо из формы документа с отбором по указанному в документе складу.</p>
    
    <p><b id="27.10">27.10 Открыие формы списка с заданным отбором</b></p>
    <p>В заключение рассмотрим распространенный случай, когда требуется открыть форму списка с некоторым заранее установленным отбором. На этом же примере мы поясним различие между фиксированными (программными) пользовательскими настройками и настройками динамического списка, сделанными в конфигураторе.</p>
    <p>Предположим, из списка сотрудников нам нужно открыть список документов об оказании услуг, выполненных сотрудником, который выделен в форме списка.</p>
    <p>Похожую задачу мы уже решали с помощью критерия отбора и механизма ввода на основании (см. раздел «Получение объектов, введенных на основании»). Теперь выполним ее с помощью встроенного языка.</p>
    <p>Итак, нам нужно открыть форму списка документов Оказание услуги с отбором по мастеру, в котором поле Мастер будет равно ссылке на текущего сотрудника в списке сотрудников.</p>
    <p>Для этого создадим форму списка справочника Сотрудники, затем создадим в ней команду ОказаниеУслуг и перетащим ее в командную панель формы. В палитре свойств команды ОказаниеУслуг, в строке Действие создадим клиентский обработчик этой команды:</p>
    <img src="../img/1С-1/2025-02-25_20-00-56.png" class="screen" alt="">
    <p>В модуле формы заполним обработчик команды следующим образом:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ОказаниеУслуг(Команда)
                ПараметрыФормы = Новый Структура( "Отбор", Новый Структура("Мастер", Элементы.Список.ТекущаяСтрока));
                ОткрытьФорму("Документ.ОказаниеУслуги.ФормаСписка", ПараметрыФормы,, Истина);
            КонецПроцедуры
        </pre>
    </div>
    <p>Этот код очень похож на предыдущий листинг, в котором открывалась форма отчета с отбором по значению параметризованной команды. Только здесь в значение отбора для поля Мастер передается ссылка на текущий элемент списка сотрудников, которая содержится в свойстве ТекущаяСтрока таблицы формы Список, отображающей данные динамического списка. Затем этот отбор передается в параметры формы при открытии формы списка документов Оказание услуги.</p>
    <p>Запустим «1С:Предприятие» и откроем список сотрудников. В форме списка появилась кнопка Оказание услуг. При ее нажатии открывается список документов об оказании услуг, где мастером является текущий сотрудник:</p>
    <img src="../img/1С-1/2025-02-25_20-13-00.png" class="screen" alt="">
    <p>Однако не все так просто, как может показаться. Здесь есть одна тонкость, которую нужно знать и учитывать при создании настроек (в частности, отборов) динамических списков.</p>
    <p>Как уже говорилось, динамический список построен на основе системы компоновки данных. Настройки списка при открытии формы помещаются в свойство динамического списка КомпоновщикНастроек.</p>
    <p>Следует различать три вида настроек динамического списка:</p>
    <ul class="list">
        <li><i style="text-decoration: underline;">Фиксированные</i> настройки, сделанные программным путем, помещаются в свойство динамического списка КомпоновщикНастроек.ФиксированныеНастройки;</li>
        <li><i style="text-decoration: underline;">Настройки</i>, сделанные в конфигураторе, помещаются в свойство динамического списка КомпоновщикНастроек.Настройки;</li>
        <li><i style="text-decoration: underline;">Пользовательские</i> настройки, сделанные в режиме 1С:Предприятие, помещаются в свойство динамического списка КомпоновщикНастроек.ПользовательскиеНастройки.</li>
    </ul>
    <img src="../img/1С-1/2025-02-25_20-19-17.png" class="screen" alt="">
    <p>Пользовательские настройки загружаются из системного хранилища и накладываются на настройки, сделанные в конфигураторе. В случае пересечения этих настроек пользовательские настройки имеют больший приоритет, то есть «затирают» настройки конфигуратора.</p>
    <p>Затем к полученным настройкам применяются фиксированные настройки. Но в случае пересечения этих настроек будет выдаваться ошибка. Например, при открытии формы списка с отбором (в нашем случае по полю Мастер) этот отбор помещается в фиксированные настройки. Поэтому пользователь уже не сможет установить отбор списка по тому же полю.</p>
    <p>Таким образом, если пользователь должен иметь возможность создавать отбор по полю, участвующему в фиксированных настройках списка, нужно удалить отбор из коллекции фиксированных настроек (КомпоновщикНастроек.ФиксированныеНастройки.Отбор) и добавить этот отбор в коллекцию основных настроек списка (КомпоновщикНастроек.Настройки.Отбор). Т.е. мы как бы убираем настройки, сделанные программно, в настройки, которые как-будто сделаны в конфигураторе и тогда не будет ошибок.</p>
    <p>Чтобы решить поставленную задачу, откроем форму списка документа ОказаниеУслуги, которую мы создали ранее. В редакторе формы создадим реквизиты формы ПрограммныйОтбор типа Булево и два реквизита произвольного типа – ПолеОтбора и ЗначениеОтбора. Эти реквизиты будут хранить информацию о программном отборе в форме списка.</p>
    <p>Затем создадим обработчик события формы ПриСозданииНаСервере и заполним его следующим образом:</p>
    <div class="code-style">
        <pre>
            &НаСервере
            Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
                Если Параметры.Отбор.Свойство("Мастер") Тогда
                    ПрограммныйОтбор = Истина;
                    ПолеОтбора = Новый ПолеКомпоновкиДанных("Мастер");
                    Параметры.Отбор.Свойство("Мастер", ЗначениеОтбора);
                КонецЕсли
            КонецПроцедуры   
        </pre>
    </div>
    <p>При создании формы списка с помощью коллекции параметров формы мы проверяем, был ли установлен отбор по полю Мастер. Если такой отбор установлен, то мы устанавливаем признак того, что форма была открыта с программным отбором, реквизит ПолеОтбора устанавливаем как поле компоновки данных с именем Мастер, а в реквизит ЗначениеОтбора помещаем соответствующее значение отбора из коллекции параметров формы.</p>
    <p>Далее создадим обработчик события формы ПриОткрытии и заполним его следующим образом:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ПриОткрытии(Отказ)
                Если ПрограммныйОтбор = Истина Тогда
                    ПрограммныеНастройки = Список.КомпоновщикНастроек.ФиксированныеНастройки;
                    Для Каждого ЭлементНастроек Из ПрограммныеНастройки.Отбор.Элементы Цикл
                        Если ЭлементНастроек.ЛевоеЗначение = ПолеОтбора Тогда
                            ПрограммныеНастройки.Отбор.Элементы.Удалить(ЭлементНастроек);
                        КонецЕсли;
                    КонецЦикла;

                    Настройки = Список.КомпоновщикНастроек.Настройки;

                    ЭлементОтбора =
                    Настройки.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
                    ЭлементОтбора.ЛевоеЗначение = ПолеОтбора;
                    ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
                    ЭлементОтбора.ПравоеЗначение = ЗначениеОтбора;
                    Список.КомпоновщикНастроек.ЗагрузитьНастройки(Настройки);
                КонецЕсли;
            КонецПроцедуры   
        </pre>
    </div>
    <p>Код обработчика выполняется в случае, если форма была открыта с программным отбором.</p>
    <p>Сначала обходится коллекция элементов отбора фиксированных настроек компоновщика настроек динамического списка. Если в коллекции присутствует элемент отбора, в котором ЛевоеЗначение равно значению реквизита ПолеОтбора (т. е. установлен программный отбор по полю Мастер), то этот элемент удаляется.</p>
    <p>Затем этот же отбор добавляется в коллекцию настроек динамического списка КомпоновщикНастроек.Настройки.Отбор, и измененные настройки загружаются в компоновщик настроек.</p>
    <p>Теперь осталось только удалить созданный элемент отбора при закрытии формы списка документа ОказаниеУслуги.</p>
    <p>Для этого создадим обработчик события формы ПередЗакрытием и заполним его следующим образом:</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ПередЗакрытием(Отказ, СтандартнаяОбработка)
                Если ПрограммныйОтбор = Истина Тогда
                    Настройки = Список.КомпоновщикНастроек.Настройки;
                    Для Каждого ЭлементНастроек Из Настройки.Отбор.Элементы Цикл
                        Если ЭлементНастроек.ЛевоеЗначение = ПолеОтбора Тогда
                            Настройки.Отбор.Элементы.Удалить(ЭлементНастроек);
                        КонецЕсли;
                    КонецЦикла;

                    Список.КомпоновщикНастроек.ЗагрузитьНастройки(Настройки);
                КонецЕсли;
            КонецПроцедуры    
        </pre>
    </div>
    <p>Код обработчика выполняется в случае, если форма была открыта с программным отбором.</p>
    <p>Коллекция элементов отбора настроек компоновщика настроек динамического списка КомпоновщикНастроек.Настройки.Отбор обходится в цикле. Если в коллекции присутствует элемент отбора, в котором ЛевоеЗначение равно значению реквизита ПолеОтбора, то этот элемент удаляется. Затем измененные настройки загружаются в компоновщик настроек</p>
    <p>Запустим «1С:Предприятие», откроем список сотрудников и нажмем кнопку Оказание услуг. Откроется список документов об оказании услуг, где мастером является текущий сотрудник. Вызовем окно настройки списка, выполнив команду Еще > Настроить список… В открывшемся окне мы видим добавленный нами отбор по полю Мастер, который пользователь может изменить или очистить</p>
    <p>При закрытии формы списка этот отбор удаляется.</p>
    <p>Таким образом, мы рассмотрели, как открыть форму списка с заданным отбором и как предоставить пользователю возможность редактировать этот отбор.</p>









    <h2 class="header-style2" id="28">28. Приёмы редактирования форм</h2>
    <p></p>
    <p></p>

    <p><b id="28.1">28.1 Редактор формы.</b></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>

    <p><b id="28.2">28.2 Разработка произвольной формы для редактирования документа «Оказание услуги».</b></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>

    <p><b id="28.3">28.3 Как добавить в форму переключатель – тумблер.</b></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>

    <p><b id="28.4">28.4 Как сгруппировать данные в списке.</b></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <p></p>



    


</div>
