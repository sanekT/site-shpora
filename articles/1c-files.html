<div class="wrap">
   
    <h2 class="header-style">Работа с файлами. Диалоги выбора файла, цвета, шрифта и стандартных периодов</h2>

    <p>Цикл видео про работу с файлами - https://www.youtube.com/watch?v=K-4xNKBcFl8&list=PLnhTnXRFDQ7dJa-1DtA2bcKvK4pxV8GRP</p>

    <h3 class="header-style2">Оглавление</h3>
    <ul class="list">
        <li><a href="#dialod-select-files">Диалог файла</a></li>
        <li><a href="#dialog-select-color">Диалог выбора цвета</a></li>
        <li><a href="#dialog-select-font">Диалог выбора шрифта</a></li>
        <li><a href="#dialog-edit-period">Диалог выбора стандартного периода</a></li>
        <li><a href="#work-files">Подготовка к работе с файлами</a></li>
        <li><a href="#txt-base">Частоиспользуемые методы класса "ТекстовыйДокумент</a></li>
        <li><a href="#txt">Читаем текстовый файл TXT, пример 1(использование синхронных методов)</a></li>
        <li><a href="#txt2">Читаем текстовый файл TXT, пример 2(использование синхронных методов)</a></li>
        <li><a href="#txt3">Пишем в текстовый файл TXT пример 1(использование синхронных методов)</a></li>
        <li><a href="#txt4">Пишем в текстовый файл TXT пример 2(использование синхронных методов)</a></li>
        <li><a href="#txt5">Читаем текстовый файл TXT, пример 3(использование асинхронных методов)</a></li>
        <li><a href="#txt6">Пишем в текстовый файл TXT, пример 3(использование асинхронных методов)</a></li>
        <li><a href="#csv">Читаем текстовый файл CSV</a></li>
        <li><a href="#xlsx">Читаем файл Excel</a></li>
        <li><a href="#dbf">Читаем файл DBF</a></li>
        <li><a href="#xml">Читаем файл XML</a></li>
        <li><a href="#json">Читаем файл JSON</a></li>
        <li><a href="#read-file-on-server">Чтение файла на стороне сервера. Класс ДвоичныеДанные.</a></li>
        <li><a href="#abc">Чтение файла со списком контрагентов и запись их в справочник Контрагенты</a></li>
        <li><a href="#abcd">Выгрузка данных из 1С в XML</a></li>
        <li><a href="#"></a></li>
        <li><a href="#"></a></li>
    </ul>









    <h2 class="header-style" id="dialod-select-files">Диалог файла</h2>
    <p>Диалог выбора файла это окно выбора файла при нажатии команды на открытие этого окна. Диалоги бывают разные: выбор, сохраниение и выбор папки(каталога). Не буду всё описывать, я создам обработку "РаботаСДиалогами" в базе "Учебная база(Курс Камков - Основные объекты)". Там будут все примеры работы с диалогами не только файлов.</p>
    <p>Когда пользователь видит окно выбора файла и выбирает его, то диалог не загружает файл, а копирует путь до этого файла. Так как диалог это взаимодействие с пользователем, то код команды будет только на стороне клиента. Объект, с помощью которого и осуществляется выбор файла, называется ДиалогВыбораФайла. В справке его можно найти Общие объекты -> Работа с файлами -> ДиалогВыбораФайла.</p>
    <p>Нужно создать объект от класса ДиалогВыбораФайла и задать режим работы диалога(это системное перечисление(РежимДиалогаВыбораФайла) дающее на выбор 3 режима: открытие, выбор каталога и сохранение. У созданного объекта есть ряд настроек(свойств), например, Заголовок - это то что будет в заголовке окна выбора файла, Каталог - заранее можем спозиционировать окно в выбранном каталоге, Фильтр( <a href="#filter">подробнее</a> ) - это настройка по форматам файлов(только текстовые файлы, только картинки и т.д.) ну и т.д. Там в справке можно почитать про разные свойства.</p>
    <p>После того как мы создали объект от ДиалогВыбораФайла, нам нужно показать его пользователю. Для этого есть 3 метода: Выбрать(), ВыбратьАсинх() и Показать. Это вообще все методы, что есть у этого объекта. Использовать будем метод Показать(), почему не Выбрать(), потому что Выбрать() это синхронный метод, остальные 2 асинхронные, но будем использовать Показать(). Параметр у этого метода только 1 это ОписаниеОповещения(процедура отложенного вызова).</p>
    <div class="code-style">
        <pre>
            --Выбор файла
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ВыбратьФайл<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла.Открытие<span class="vue-r">)</span>;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span>"ПослеВыбораФайла", ЭтотОбъект<span class="vue-r">)</span>;
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;	
            <span class="vue-r">КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ПослеВыбораФайла<span class="vue-r">(</span>ВыбранныеФайлы, Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//переменная ВыбранныеФайлы это массив с путями до файлов/а, либо Неопределено
                //по умолчанию всегда будет возвращаться 1 файл в массиве, потому что
                //у объекта Проводник есть свойство МножественныйВыбор и у него стоит Ложь</span>
                <span class="vue-r">Если</span> ВыбранныеФайлы <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда
                    Возврат;
                КонецЕсли;</span>

                ПутьКФайлу <span class="vue-r">=</span> ВыбранныеФайлы<span class="vue-r">[</span>0<span class="vue-r">]</span>;
                Сообщить<span class="vue-r">(</span>ПутьКФайлу<span class="vue-r">)</span>;
                <span class="vue-g">//ну и далее что то делаем с этим файлом: читаем программно, записываем в него или ещё что то</span>
            <span class="vue-r">КонецПроцедуры</span></span>


            --Выбор каталога(папки)
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ВыбратьКаталог<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                <span class="vue-g">//применить фильтр к выбору папки мы не можем, папка она и в Африке папка</span>
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла<span class="vue-r">.</span>ВыборКаталога<span class="vue-r">)</span>;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span>"ПослеВыбораКаталога", ЭтотОбъект<span class="vue-r">)</span>;
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;	
            <span class="vue-r">КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ПослеВыбораКаталога<span class="vue-r">(</span>ВыбранныеПапки, Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//переменная ВыбранныеПапки это массив с путями до папок, либо Неопределено</span>
                <span class="vue-r">Если</span> ВыбранныеПапки <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат</span>;
                <span class="vue-r">КонецЕсли;</span>

                ПутьКПапке <span class="vue-r">=</span> ВыбранныеПапки<span class="vue-r">[</span>0<span class="vue-r">]</span>;
                Сообщить<span class="vue-r">(</span>ПутьКПапке<span class="vue-r">)</span>;
                <span class="vue-g">//ну и далее что то делаем с этим путём до папки</span>
            <span class="vue-r">КонецПроцедуры</span></span>



            --Сохранение файла
            --Что тут понимается под сохранением файла. При отработке этого кода, откроется окно
            --как и при выборе файла, только с кнопкой "Сохранить". В поле вводим имя файла и жмём Сохранить
            --и в переменную ПутьКФайлу попадает путь этого файла, куда мы сохранили. Пока не понимаю
            --для чего это нам нужно. Мы в файл что то можем записать и затем сохранять? Или мы так создаём новый
            --файл? Короче как станет более понятно допишу.
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> СохранитьФайл<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла<span class="vue-r">.</span>Сохранение<span class="vue-r">)</span>;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span>"ПослеСохранения", ЭтотОбъект<span class="vue-r">)</span>;
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;	
            <span class="vue-r">КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ПослеСохранения<span class="vue-r">(</span>ВыбранныеФайлы, Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//переменная ВыбранныеФайлы это массив с путями сохранённых файлов, либо Неопределено</span>
                <span class="vue-r">Если</span> ВыбранныеФайлы <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат</span>;
                <span class="vue-r">КонецЕсли;</span>

                ПутьКФайлу <span class="vue-r">=</span> ВыбранныеФайлы<span class="vue-r">[</span>0<span class="vue-r">]</span>;
                Сообщить<span class="vue-r">(</span>ПутьКФайлу<span class="vue-r">)</span>;
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>

    <p id="filter">Теперь более подробно поговорим про настройки объекта Проводник(выше в коде переменная) в режиме РежимДиалогаВыбораФайла.Открытие. Есть такое свойство как Фильтр, которое позволяет указать формат выбираемого файла. Когда открывается окно выбора файла, нам ОС показывает все файлы в текущей папке, но вверху справа есть поле поиска(Винда 10). Если в этом поле вписать маску "*.txt", то останутся файлы в папке только с таким расширением. Нам нужно программно в свойстве Фильтр задать такие маски. В Фильтр нужно передать строку из 2х частей: "имя фильтра|маска". Пример - "Текстовый документ (*.txt)|*.txt". Если же нам нужно несколько фильтров, то передаётся такая строка - "Текстовый документ (*.txt)|*.txt|Табличный документ (*.mxl)|*.mxl". Фильтры в строке между собой тоже отделяются прямой чертой. И теперь в окне выбора файла внизу справа над кнопками появится меню выбора фильтров. Там теперь можно выбирать какой фильтр применить к файлам, если фильтров больше 2х.</p>
    <p>Также есть возможность указать в одном фильтре несколько форматов. Для этого маски разделяются ";". Бывает нужно выбрать картинки, а картинки в разных форматах и хочется все картинки отобразить, в этом случае поможет такой способ задания масок: "Картинки|*.jpg;*.png;*.jpeg;*.gif".</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ВыбратьФайл<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла<span class="vue-r">.</span>Открытие<span class="vue-r">)</span>;
                ФильтрТекстовыхФайлов <span class="vue-r">=</span> <span class="vue-bl">"Текстовый документ (*.txt)|*.txt|CSV-файл|*.csv"</span>;
                ФильтрКартинок <span class="vue-r">=</span> <span class="vue-bl">"Картинки|*.jpg;*.png;*.jpeg;*.gif"</span>;
                Проводник.Фильтр <span class="vue-r">=</span> ФильтрТекстовыхФайлов;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВыбораФайла"</span>, ЭтотОбъект<span class="vue-r">)</span>;
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;	
            <span class="vue-r">КонецПроцедуры </span></span>

            --Далее там процедура оповещения
        </pre>
    </div>
















    
    <h2 class="header-style" id="dialog-select-color">Диалог выбора цвета</h2>
    <p>Когда мы для какого то объекта конфы создаём реквизит и задаём ему тип, то выбор типов один, но когда мы для этого же объекта создадим форму и в форме на закладке "Реквизиты" создадим реквизит и выберем ему тип, то тут типы более расширены. В этом расшеренном списке есть такой тип как "Цвет". Создам в обработке "РаботаСДиалогами" в форме реквизит ВыбратьЦвет и задам ему тип "Цвет". Это простой способ выбора цвета. Также мы можем программно открывать такое окно выбора по нажатию на кнопку "ВыбратьЦвет". Для этих целей есть класс "ДиалогВыбораЦвета".</p>
    <div class="code-style">
        <pre>
            --Выбор цвета программно
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ВыбратьЦветПрограммно<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ВыборЦвета <span class="vue-r">= Новый</span> ДиалогВыбораЦвета;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВыбораЦвета"</span>, ЭтотОбъект<span class="vue-r">)</span>;
                ВыборЦвета<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;	
            <span class="vue-r">КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПослеВыбораЦвета<span class="vue-r">(</span>ВыбранныйЦвет, Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//в переменную ВыбранныйЦвет попадает либо объект Цвет, либо Неопределено
                //объект Цвет имеет 4 свойства: Вид, Зеленый, Красный, Синий</span>	
                <span class="vue-r">Если</span> ВыбранныйЦвет <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат</span>;
                <span class="vue-r">КонецЕсли;</span>	
                
                <span class="vue-g">//если в окне мышкой выбрать цвет, то увидим в сообщении -1, -1, -1. Такой вид цвета называется "Элемент стиля"
                //если же руками вбить все 3 цвета, то покажет эти цифры какие мы вбили. Такой вид цвета называется "Абсолютным"
                //для чего так сделано пока не знаю. В видео тоже не рассказали </span> 
                Сообщить<span class="vue-r">(</span><span class="vue-bl">"Выбран цвет: "</span> <span class="vue-r">+</span> ВыбранныйЦвет<span class="vue-r">.</span>Красный <span class="vue-r">+</span> <span class="vue-bl">", "</span> <span class="vue-r">+</span> ВыбранныйЦвет<span class="vue-r">.</span>Зеленый <span class="vue-r">+</span> <span class="vue-bl">", "</span> <span class="vue-r">+</span> ВыбранныйЦвет<span class="vue-r">.</span>Синий<span class="vue-r">)</span>;
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>
















    <h2 class="header-style" id="dialog-select-font">Диалог вобора шрифта</h2>
    <p>Диалог цвета, диалог шрифта нужны в те моменты, когда пользователю нужно оформить содержимое какого то поля или каких то строк.</p>
    <div class="code-style">
        <pre>
            --Диалог шрифта
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ВыбратьШрифт<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ВыборШрифта <span class="vue-r">= Новый</span> ДиалогВыбораШрифта;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВыбораШрифта"</span>, ЭтотОбъект<span class="vue-r">)</span>;
                ВыборШрифта<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;
            <span class="vue-r">КонецПроцедуры  

            &НаКлиенте
            Процедура</span> ПослеВыбораШрифта<span class="vue-r">(</span>ВыбранныйШрифт<span class="vue-r">,</span> Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//в переменную ВыбранныйШрифт ложится также Объект Шрифт и он уже имеет побольше свойств
                //если что смотреть в справке</span>	
                <span class="vue-r">Если</span> ВыбранныйШрифт <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат</span>;
                <span class="vue-r">КонецЕсли</span>;	
                
                Сообщить<span class="vue-r">(</span><span class="vue-bl">"Выбран шрифт: "</span> <span class="vue-r">+</span> ВыбранныйШрифт<span class="vue-r">.</span>Имя <span class="vue-r">+</span> <span class="vue-bl">", размер: "</span> <span class="vue-r">+</span> ВыбранныйШрифт<span class="vue-r">.</span>Размер<span class="vue-r">)</span>;	
            КонецПроцедуры</span></span>
        </pre>
    </div>













    
    <h2 class="header-style" id="dialog-edit-period">Диалог выбора стандартного периода</h2>
    <p>Тут как и с цветом можно создать в форме реквизит и задать ему тип "Стандартный переод", а можно программно по кнопке вызывать этот диалог. Этот диалог позволяет пользователю выбирать начало и конец периода. Программно задать период позволяет класс ДиалогРедактированияСтандартногоПериода.</p>
    <div class="code-style">
        <pre>
            --Диалог стандартного периода
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ВыбратьПериодПрограммно<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ВыборПериода <span class="vue-r">= Новый</span> ДиалогРедактированияСтандартногоПериода<span class="vue-r">()</span>;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВыбораПериода"</span>, ЭтотОбъект<span class="vue-r">)</span>;
                ВыборПериода<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;
            <span class="vue-r">КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПослеВыбораПериода<span class="vue-r">(</span>ВыбранныйПериод, Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-r">Если</span> ВыбранныйПериод <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат</span>;
                <span class="vue-r">КонецЕсли</span>;	
                
                Сообщить<span class="vue-r">(</span><span class="vue-bl">"Выбран период: "</span> <span class="vue-r">+</span> ВыбранныйПериод<span class="vue-r">.</span>ДатаНачала <span class="vue-r">+</span> <span class="vue-bl">" - "</span> <span class="vue-r">+</span> ВыбранныйПериод<span class="vue-r">.</span>ДатаОкончания<span class="vue-r">)</span>;	
            <span class="vue-r">КонецПроцедуры</span></span>
        </pre>
    </div>













    work-files
    <h2 class="header-style" id="work-files">Подготовка к работе с файлами</h2>
    <p>Видео, с которого описываю эту тему 3 в списке проигрывания.</p>
    <p>На практике часто нужно работать с данными, которые храняться в фалах. Эти работы можно поделить на 2 типа. Первый это загрузка данных из файлов и второй это выгрузка данных в файлы. Начнём с первого.</p>
    <p>При загрузке данных из файлов нужно знать, что загружать данные можно несколькими способами. Пользователь может через диалог выбрать путь до файла и нажать загрузить и произойдёт загрузка в БД. А можно и без участия пользователя загружать, например, алгоритм сам в определённое время по заранее известному пути загрузит данные из файла и запишет в БД. Мы будем рассматривать способ с пользователем. Программный способ сильно не отличается, там просто не нужно работать с формой.</p>
    <p>Загрузка данных из файла происходит в 2 этапа: 1) прочитать файл, показать данные пользователю, 2) Записать данные в БД(только если пользователь согласился их записывать, вдруг файл не тот выбрал). НЕ ПРАВЛЬНО делать так, когда пользователь выбрал файл и нажал на кнопку и произошла запись в БД, потому что у пользователя нет способа отказаться от загрузки данных. Вот так правильно:</p>
    <img src="../img/1С-1/2023-02-01_21-46-13.png" class="screen" alt="">
    <p>Создадим обработку "ЧтениеРазныхФайлов" и в ней будем читать разные форматы файлов. Обработка также в базе Камкова "Основные объекты". Хочу отметить, что когда создавали табличную часть "ДанныеФайла", то убрали командную панль(панель где кнопка "Добавить, поиск и ещё что то"). Убрали так. Выделяем табличную часть слева в элементах формы и в свойствах убираем <span class="vue-b">галочку "Автозаполнение"</span>. Также у табличной части убрали поле "Номер строки", просто выделил поле в нижнем окне, где форма показана и через контекстное меню удалил. Ну и убрали командную панель у самой формы, это та панель где в пользовательской части вверху слева есть кнопка "Ещё", убрали точно также, сняв <span class="vue-b">галочку "Автозаполнение"</span>.</p>
    <p>Далее хочу ещё отметь как сделали так, чтобы у поля "ПутьКФайлу" появилась справа кнопка выбора. Для этого выделим это поле и в его свойствах найдём <span class="vue-b">параметр "КнопкаВыбора"</span> и поставим ей значение Да. Спрва от поля появится кнопочка с 3мя точками.</p>
    <p>Также у нас есть поле "ФорматФайла". Можно создать заранее Перечисление "ФорматыФайлов" и него указать 6 форматов, затем назначим тип для поля "ФорматФайла" ПеречислениеСсылка.ФорматыФайлов. Затем в свойствах поля в параметре "СписокВыбора" заполняем по кнопке "Заполнить" и из перечисления заполнятся все наши форматы. Ну и также выберем отображение в виде тумблера. Если же не делали объект Перечисление с форматами, то также в <span class="vue-b">параметре "СписокВыбора"</span> ручками заполняем форматы. Нажимает на полюсик, ввели имя формата, опять полюсик - имя и т.д.</p>
    <p>Ещё одно замечание. Нужно пользователю запретить добавлять новую строку в табличную часть, хотя как он может её добавить, если кнопка "Добавить" уже убрана? Ну всё равно упомяну эту возможность. Есть такой <span class="vue-b">параметр "ИзменитьСоставСтрок"</span> в свойствах табличной части, вот там тоже галочку снимаем.</p>
    <p>Продолжаем. У поля "Путь к файлу" есть событие "НачалоВыбора", оно и сработает при клике по кнопке "...", поэтому вешаем обработчик на это событие на клиенте.</p>
    <div class="code-style">
        <pre>
            --По клику на кнопку "..." поля "ПутьКФайлу" срабатывает событие НачалоВыбора 
            --и по этому событию отработает этот обработчик
            --Обработчик открывает диалог выбора файла и применяет фильтр. 
            --После выбора файла поле "ПутьКФайлу" сохраняет путь до файла в себе,
            --а поле "ФорматФайла" сохраняет в себе строку с форматом
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ПутьКФайлуНачалоВыбора<span class="vue-r">(</span>Элемент, ДанныеВыбора, СтандартнаяОбработка<span class="vue-r">)</span>
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла<span class="vue-r">.</span>Открытие<span class="vue-r">)</span>;
                Проводник<span class="vue-r">.</span>Заголовок <span class="vue-r">=</span> <span class="vue-bl">"Выберите файл с контрагентами"</span>; 
                
                <span class="vue-r">Если</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"TXT"</span> <span class="vue-r">Тогда</span>
                    ЗначениеФильтра <span class="vue-r">=</span> <span class="vue-bl">"Текстовый документ (*.txt)|*.txt"</span>;
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"CSV"</span> <span class="vue-r">Тогда</span>
                    ЗначениеФильтра <span class="vue-r">=</span> <span class="vue-bl">"Текстовый документ (*.csv)|*.csv"</span>;
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"XLS"</span> <span class="vue-r">Тогда</span>
                    ЗначениеФильтра <span class="vue-r">=</span> <span class="vue-bl">"Файл Excel (*.xls)|*.xls"</span>;
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"DBF"</span> <span class="vue-r">Тогда</span>
                    ЗначениеФильтра <span class="vue-r">=</span> <span class="vue-bl">"Таблица DBF (*.dbf)|*.dbf"</span>;
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"XML"</span> <span class="vue-r">Тогда</span>
                    ЗначениеФильтра <span class="vue-r">=</span> <span class="vue-bl">"Файл XML (*.xml)|*.xml"</span>;
                <span class="vue-r">Иначе</span>
                    Возврат;
                <span class="vue-r">КонецЕсли</span>;

                Проводник<span class="vue-r">.</span>Фильтр <span class="vue-r">=</span> ЗначениеФильтра;

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВыбораФайла"</span>, ЭтотОбъект<span class="vue-r">)</span>;
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">)</span>;	
            <span class="vue-r">КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ПослеВыбораФайла<span class="vue-r">(</span>ВыбранныеФайлы, Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//переменная ВыбранныеФайлы это массив с путями до файлов/а, либо Неопределено
                //по умолчанию всегда будет возвращаться 1 файл в массиве, потому что
                //у объекта Проводник есть свойство МножественныйВыбор и у него стоит Ложь</span>
                <span class="vue-r">Если</span> ВыбранныеФайлы <span class="vue-r">=</span> Неопределено <span class="vue-r">Тогда</span>
                    <span class="vue-r">Возврат</span>;
                <span class="vue-r">КонецЕсли</span>;

                <span class="vue-g">//мы записали путь до файла в поле ПутьКФайлу, дальше будем читать разные файлы
                //беря путь из этого поля</span>
                Объект<span class="vue-r">.</span>ПутьКФайлу <span class="vue-r">=</span> ВыбранныеФайлы<span class="vue-r">[</span>0<span class="vue-r">]</span>;
            <span class="vue-r">КонецПроцедуры</span></span>

            --у нас есть формат, у нас есть путь, теперь нужно прочитать файл по этому пути
            --Вызываем соответсвующие процедуры, они описаны ниже
            <span class="vue-b"><span class="r">&НаКлиенте
            Процедура</span> ПрочитатьФайл<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                <span class="vue-r">Если</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"TXT"</span> <span class="vue-r">Тогда</span>
                    ПрочитатьФайлTXT<span class="vue-r">()</span>;	
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"CSV"</span> <span class="vue-r">Тогда</span>
                    ПрочитатьФайлCSV<span class="vue-r">()</span>;
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"XLSX"</span> <span class="vue-r">Тогда</span>
                    ПрочитатьФайлXLSX<span class="vue-r">()</span>;
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"DBF"</span> <span class="vue-r">Тогда</span>
                    ПрочитатьФайлDBF<span class="vue-r">()</span>;
                <span class="vue-r">ИначеЕсли</span> Объект<span class="vue-r">.</span>ФорматФайла <span class="vue-r">=</span> <span class="vue-bl">"XML"</span> <span class="vue-r">Тогда</span>
                    ПрочитатьФайлXML<span class="vue-r">()</span>;
                <span class="vue-r">Иначе</span>
                    <span class="vue-r">Возврат</span>;
                <span class="vue-r">КонецЕсли</span>;	
            <span class="vue-r">КонецПроцедуры</span> </span>
        </pre>
    </div>










    <h2 class="header-style" id="txt-base">Частоиспользуемые методы класса "ТекстовыйДокумент"</h2>
    <p>Вот по этой ссылке показаны разные способы использования этого класса - <a href="https://helpme1s.ru/rabota-s-tekstovym-dokumentom-v-yazyke-1s-8-3-8-2-v-primerax">тут</a></p>











    <h2 class="header-style" id="txt">Читаем текстовый файл TXT, пример 1(использование синхронных методов)</h2>
    <p>Чтобы прочитать текстовый файл, во встроенном языке нам нужны 2 объекта.</p>
    <ul class="list">
        <li><b>ТекстовыйДокумент</b> - файл считывается целицом и далее с помощью цикла построчно можно обработать его. Подходит для работы с небольшими файлами. Про объект можно почитать в справочнике по пути Общие объекты -> Текстовый документ.</li>
        <li><b>ЧтениеТекста</b> - предназначен для последовательного чтения текстовых файлов большой длины.</li>
    </ul>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ПрочитатьФайлTXT<span class="vue-r">()</span>
                <span class="vue-g">//примером текстового файла будет Список контрагентов. В каждой строке файла задано
                //краткое наименование контрагентов, полное наименование и УМП контрагентов
                //все 3 части разделены ";" </span>

                Объект<span class="vue-r">.</span>ДанныеФайла<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>

                <span class="vue-g">//эта переменная будет выступать переключателем. Как читать файл челиком или по строчно</span>
                ПоследовательноеЧтение <span class="vue-r">=</span> Истина<span class="vue-r">;</span>
                
                <span class="vue-g">//тут 2 способа читать текстовый файл</span>
                <span class="vue-r">Если НЕ</span> ПоследовательноеЧтение <span class="vue-r">Тогда</span>
                    <span class="vue-g">//1й способ
                    //класс ТекстовыйДокумент позволяет считать файл целиком и далее в цикле разбирать по строкам</span>
                    Текст <span class="vue-r">= Новый</span> ТекстовыйДокумент<span class="vue-r">;</span>
                    
                    <span class="vue-g">//метод синхронный, не будет работать, если выключено использование синхронных методов в конфе
                    //1й параметр это путь до файла
                    //2й параметр это тип файла, указываем кодировку текста, в котором будет выполняться чтение. По умолчанию UTF8
                    //3й параметр это раздилитель строк</span>
                    Текст<span class="vue-r">.</span>Прочитать<span class="vue-r">(</span>Объект<span class="vue-r">.</span>ПутьКФайлу<span class="vue-r">);</span>

                    <span class="vue-g">//обход строк текста в цикле</span>
                    <span class="vue-r">Для</span> НомерСтроки <span class="vue-r">=</span> 1 <span class="vue-r">По</span> Текст<span class="vue-r">.</span>КоличествоСтрок<span class="vue-r">() Цикл</span>
                        ТекущаяСтрока <span class="vue-r">=</span> Текст<span class="vue-r">.</span>ПолучитьСтроку<span class="vue-r">(</span>НомерСтроки<span class="vue-r">);</span>
                        
                        <span class="vue-g">//нам нужно строку разделить по ";". Если в строке меньше 3х частей, то будем считать
                        //такую строку ошибочной и будем её пропускать</span>
                        МассивЧастей  <span class="vue-r">=</span> СтрРазделить<span class="vue-r">(</span>ТекущаяСтрока<span class="vue-r">,</span> ";"<span class="vue-r">);</span>
                        <span class="vue-r">Если</span> МассивЧастей<span class="vue-r">.</span>Количество<span class="vue-r">() &lt;</span> 3 <span class="vue-r">Тогда
                            Продолжить;	
                        КонецЕсли;</span> 
                        
                        <span class="vue-g">//в табличную часть добавляем новую строку
                        //и колонкам этой строки задаём части массива</span>
                        НоваяСтрока <span class="vue-r">=</span> Объект<span class="vue-r">.</span>ДанныеФайла<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        НоваяСтрока<span class="vue-r">.</span>КраткоеНаименование <span class="vue-r">=</span> МассивЧастей<span class="vue-r">[</span>0<span class="vue-r">];</span>
                        НоваяСтрока<span class="vue-r">.</span>ПолноеНаименование <span class="vue-r">=</span> МассивЧастей<span class="vue-r">[</span>1<span class="vue-r">];</span>
                        НоваяСтрока<span class="vue-r">.</span>УНП <span class="vue-r">=</span> МассивЧастей<span class="vue-r">[</span>2<span class="vue-r">];
                    КонецЦикла;
                Иначе</span>  
                    <span class="vue-g">//2й способ
                    //класс ЧтениеТекста предназначен для поледовательного чтения текстовых файлов большой длины</span>
                    Текст <span class="vue-r">= Новый</span> ЧтениеТекста<span class="vue-r">;</span>
                    Текст<span class="vue-r">.</span>Открыть<span class="vue-r">(</span>Объект<span class="vue-r">.</span>ПутьКФайлу<span class="vue-r">);</span>
                    
                    <span class="vue-g">//разделитель не указываем, по умолчанию разделяются строки по переносу строки(\r\n или \n)</span>
                    ТекущаяСтрока <span class="vue-r">=</span> Текст<span class="vue-r">.</span>ПрочитатьСтроку<span class="vue-r">();</span>
                    <span class="vue-g">//используем цикл Пока, потому что не известно число строк в файле</span>
                    <span class="vue-r">Пока</span> ТекущаяСтрока <span class="vue-r">&lt;> Неопределено Цикл</span>
                        МассивЧастей  <span class="vue-r">=</span> СтрРазделить<span class="vue-r">(</span>ТекущаяСтрока<span class="vue-r">,</span> ";"<span class="vue-r">);</span>
                        <span class="vue-r">Если</span> МассивЧастей<span class="vue-r">.</span>Количество<span class="vue-r">() &lt;</span> 3 <span class="vue-r">Тогда
                            Продолжить;	
                        КонецЕсли;</span> 
                        
                        НоваяСтрока <span class="vue-r">=</span> Объект<span class="vue-r">.</span>ДанныеФайла<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        НоваяСтрока<span class="vue-r">.</span>КраткоеНаименование <span class="vue-r">=</span> МассивЧастей<span class="vue-r">[</span>0<span class="vue-r">];</span>
                        НоваяСтрока<span class="vue-r">.</span>ПолноеНаименование <span class="vue-r">=</span> МассивЧастей<span class="vue-r">[</span>1<span class="vue-r">];</span>
                        НоваяСтрока<span class="vue-r">.</span>УНП <span class="vue-r">=</span> МассивЧастей<span class="vue-r">[</span>2<span class="vue-r">];</span>

                        <span class="vue-g">//считываем следующую строку</span>
                        ТекущаяСтрока <span class="vue-r">=</span> Текст<span class="vue-r">.</span>ПрочитатьСтроку<span class="vue-r">();	
                    КонецЦикла;
                КонецЕсли;	
            КонецПроцедуры</span></span>
        </pre>
    </div>











    <h2 class="header-style" id="txt2">Читаем текстовый файл TXT, пример 2(использование синхронных методов)</h2>
    <p>Продолжим тот же пример с обработкой "Консоль запросов", что я описал выше, где мы писали в файл текст запроса из текстового документа этой обработки. Теперь нужно ранее записанный в файл текст запроса вставить в поле текстовго документа в обработке.</p>
    <img src="../img/1С-1/2023-11-22_18-47-58.png" class="screen" alt="">
    <div class="code-style">
        <pre>
            --модуль формы обработки "Консоль запросов"

            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ЗагрузитьТекстЗапроса<span class="vue-r">(</span>Команда)
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла<span class="vue-r">.</span>Открытие<span class="vue-r">);</span>

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеОткрытия"</span><span class="vue-r">,</span> ЭтотОбъект<span class="vue-r">);</span>
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">);
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПослеОткрытия<span class="vue-r">(</span>ВыбранныеФайлы<span class="vue-r">,</span> Параметры<span class="vue-r">) Экспорт</span>
                ТекстовыйФайл <span class="vue-r">= Новый</span> ТекстовыйДокумент<span class="vue-r">;</span>
                
                <span class="vue-g">//Читаем с файла, в переменной ВыбранныеФайлы массив с 
                //путями выбранных файлов, в данном примере там только один элемент с путём</span>
                ТекстовыйФайл<span class="vue-r">.</span>Прочитать<span class="vue-r">(</span>ВыбранныеФайлы<span class="vue-r">[</span>0<span class="vue-r">]);</span>

                <span class="vue-g">//Очистим от предыдущих записей тестовый документ</span>
                ТекстЗапроса<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>

                <span class="vue-r">Для</span> НомерСтроки <span class="vue-r">=</span> 1 <span class="vue-r">По</span> ТекстовыйФайл<span class="vue-r">.</span>КоличествоСтрок<span class="vue-r">() Цикл</span>
                    ТекущаяСтрока <span class="vue-r">=</span> ТекстовыйФайл<span class="vue-r">.</span>ПолучитьСтроку<span class="vue-r">(</span>НомерСтроки<span class="vue-r">);</span>
                    
                    ТекстЗапроса<span class="vue-r">.</span>ДобавитьСтроку<span class="vue-r">(</span>ТекущаяСтрока<span class="vue-r">);	
                КонецЦикла;	
            КонецПроцедуры</span></span>
        </pre>
    </div>












    <h2 class="header-style" id="txt3">Пишем в текстовый файл TXT пример 1(использование синхронных методов)</h2>
    <p>Разберём такой пример, есть внешняя обработка "Консоль запросов" и в ней есть кнопка сохранения текста запроса в текстовый файл на компьюторе. Код будет работать так, мы жмём на кнопку сохранить и на компьютор в указанную папку в коде мы сохраняем текст запроса в также в указанный файл в коде. Т.е. у нас нет возможности выбрать папку и имя файла, мы пишем на рабочий стол в заранее определенную папку и в файл. Пока я не знаю как сделать так, чтобы вывести форму с полем ввода для ввода имени файла и записать в файл с введённым именем. Как узнаю изменю немного код.</p>
    <p><span class="vue-r">Узнал как сделать доп. форму с вводом имени файла и запись в этот файл текста запроса, описал этот пример в статье "Пишем в текстовый файл TXT способ 3"</span></p>
    <div class="code-style">
        <pre>
            --модуль формы обработки "Консоль запросов"

            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> СохранитьТекстЗапроса<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                <span class="vue-g">//я хочу сохранять в файл на рабочем столе, но на разных компах своё имя пользователя
                //Есть такой метод как  КаталогВРеменныхФайлов(), он возвращает путь до временной папки
                //пользователя, мы отрезает в конце путь до этой папки и подставляем рабочий стол
                //и получим, что где бы не запустилась обработка, мы сможем сохранить на рабочий стол. </span>
                Путь <span class="vue-r">=</span> КаталогВРеменныхФайлов<span class="vue-r">();</span> <span class="vue-g">//это синхронный метод</span>
                Путь <span class="vue-r">=</span> СтрЗаменить<span class="vue-r">(</span>Путь<span class="vue-r">,</span> <span class="vue-bl">"AppData\Local\Temp\"</span><span class="vue-r">,</span> <span class="vue-bl">"Desktop\"</span><span class="vue-r">);</span>
                Путь <span class="vue-r">=</span> Путь <span class="vue-r">+</span> <span class="vue-bl">"Тексты запросов"</span><span class="vue-r">;</span>

                <span class="vue-g">//этот метод создаёт папку по указанному пути, создаваемая папка также 
                //должны быть указана в пути, здесть это "Тексты запросов" папка</span>
                СоздатьКаталог<span class="vue-r">(</span>Путь<span class="vue-r">);</span><span class="vue-g">//это синхронный метод</span>

                ТекстовыйФайл <span class="vue-r">= Новый</span> ТекстовыйДокумент<span class="vue-r">;</span>
            
                <span class="vue-g">// Устанавливаем содержимое файла.</span>
                ТекстовыйФайл<span class="vue-r">.</span>УстановитьТекст<span class="vue-r">(</span>ТекстЗапроса<span class="vue-r">.</span>ПолучитьТекст<span class="vue-r">());</span>

                <span class="vue-g">// Записываем файл на диск.
                // Если такой файл уже существует - он будет перезаписан.</span>
                ТекстовыйФайл<span class="vue-r">.</span>Записать<span class="vue-r">(</span>Путь <span class="vue-r">+</span> <span class="vue-bl">"\ТекстЗапроса1.txt"</span><span class="vue-r">);<span class="vue-g">//это синхронный метод</span>
            КонецПроцедуры</span></span>
        </pre>
    </div>















    <h2 class="header-style" id="txt4">Пишем в текстовый файл TXT пример 2(использование синхронных методов)</h2>
    <p>Тут тот же пример записи текста запроса в файл, но уже с использованием диалога выбора файлов.</p>
    <div class="code-style">
        <pre>
            --модуль формы обработки "Консоль запросов"

            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> СохранитьТекстЗапроса<span class="vue-r">(</span>Команда<span class="vue-r">)</span>  
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла<span class="vue-r">.</span>Сохранение<span class="vue-r">);</span>

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеСохранения"</span><span class="vue-r">,</span> ЭтотОбъект<span class="vue-r">);</span>
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">);	
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПослеСохранения<span class="vue-r">(</span>ВыбранныеФайлы<span class="vue-r">,</span> Параметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//переменная ВыбранныеФайлы это массив с путями сохранённых файлов, либо Неопределено</span>
                <span class="vue-r">Если</span> ВыбранныеФайлы <span class="vue-r">= Неопределено Тогда
                    Возврат;
                КонецЕсли;</span>

                ТекстовыйФайл <span class="vue-r">= Новый</span> ТекстовыйДокумент<span class="vue-r">;</span>

                <span class="vue-g">// Устанавливаем содержимое файла.</span>
                ТекстовыйФайл<span class="vue-r">.</span>УстановитьТекст<span class="vue-r">(</span>ТекстЗапроса<span class="vue-r">.</span>ПолучитьТекст<span class="vue-r">());</span>

                <span class="vue-g">// Записываем файл на диск.
                // Если такой файл уже существует - он будет перезаписан.</span>
                ТекстовыйФайл<span class="vue-r">.</span>Записать<span class="vue-r">(</span>ВыбранныеФайлы<span class="vue-r">[</span>0<span class="vue-r">]);
            КонецПроцедуры</span></span>
        </pre>
    </div>










    <h2 class="header-style" id="txt5">Читаем текстовый файл TXT, пример 1(использование асинхронных методов)</h2>
    <p>Этот пример опять же из моей внешней обработки "Моя консоль запросов". Нужно прочитать текст запроса из текстового файла:</p>
    <div class="code-style">
        <pre>
            //получение текста запроса из файла и вставка его в поле текстового документа
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ЗагрузитьТекстЗапроса<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                Проводник <span class="vue-r">= Новый</span> ДиалогВыбораФайла<span class="vue-r">(</span>РежимДиалогаВыбораФайла<span class="vue-r">.</span>Открытие<span class="vue-r">);</span>

                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения<span class="vue-r">(</span><span class="vue-bl">"ПослеВыбораФайла"</span><span class="vue-r">,</span> ЭтотОбъект<span class="vue-r">);</span>
                Проводник<span class="vue-r">.</span>Показать<span class="vue-r">(</span>Оповещение<span class="vue-r">);
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ПослеВыбораФайла<span class="vue-r">(</span>ВыбранныеФайлы<span class="vue-r">,</span> ДопПараметры<span class="vue-r">) Экспорт</span> 
                <span class="vue-r">Если</span> ВыбранныеФайлы <span class="vue-r">= Неопределено Тогда
                    Возврат;
                КонецЕсли;</span>

                ТекстовыйФайл <span class="vue-r">= Новый</span> ТекстовыйДокумент<span class="vue-r">;</span> 

                ПараметрыЧтения <span class="vue-r">= Новый</span> Структура<span class="vue-r">(</span><span class="vue-bl">"ТекстовыйФайл"</span><span class="vue-r">,</span> ТекстовыйФайл<span class="vue-r">);</span>
                Оповещение <span class="vue-r">= Новый</span> ОписаниеОповещения(<span class="vue-bl">"ПослеЧтенияФайла"</span><span class="vue-r">,</span> ЭтаФорма<span class="vue-r">,</span> ПараметрыЧтения<span class="vue-r">);</span>
                
                <span class="vue-g">//Читаем с файла. Этот метод асинхронный. Первый параметр(оповещение) можно 
                //не передавать, но тогда мы не получим прочитанный текст из файла,
                //потому что если продолжить писать код вниз после этого метода, 
                //то там не увидим в объекте "ТекстовыйФайл" прочитанного запроса из файла.
                //Я так понимаю это из-за того, что он тупо ещё не успел прочитать его.
                //Метод начал своё выполнение, но и платформа не ждёт его завершения и идёт дальше по коду.
                //А вот когда метод полностью прочитает из файла, он вызовет процедуру из переданного
                //в него оповещения. Так что тут обязательно нужно передвать оповещение.
                //Также в оповещение нужно передать сам объект текстового документа, чтобы
                //внутри процедуры получить из него прочитанный текст и чтото с ним сделать.</span>
                ТекстовыйФайл<span class="vue-r">.</span>НачатьЧтение<span class="vue-r">(</span>Оповещение<span class="vue-r">,</span> ВыбранныеФайлы<span class="vue-r">[</span>0<span class="vue-r">]);	
            КонецПроцедуры  

            <span class="vue-g">//Вот эта та самая процедура, которая вызовется при окончании чтения из файла
            //У неё один единственный параметр это "ДопПараметры", через который мы и передаём из оповещения
            //объект текстового документа. И уже из этого объект построчно читаем запрос полученный из файла.</span>
            &НаКлиенте
            Процедура</span> ПослеЧтенияФайла<span class="vue-r">(</span>ДопПараметры<span class="vue-r">) Экспорт</span>
                <span class="vue-g">//очистим от предыдущих записей тестовый документ</span>
                ТекстЗапроса<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>

                <span class="vue-r">Для</span> НомерСтроки <span class="vue-r">=</span> 1 <span class="vue-r">По</span> ДопПараметры<span class="vue-r">.</span>ТекстовыйФайл<span class="vue-r">.</span>КоличествоСтрок<span class="vue-r">() Цикл</span>
                    ТекущаяСтрока <span class="vue-r">=</span> ДопПараметры<span class="vue-r">.</span>ТекстовыйФайл<span class="vue-r">.</span>ПолучитьСтроку<span class="vue-r">(</span>НомерСтроки<span class="vue-r">);</span>
                    
                    ТекстЗапроса<span class="vue-r">.</span>ДобавитьСтроку<span class="vue-r">(</span>ТекущаяСтрока<span class="vue-r">);	
                КонецЦикла;	
            КонецПроцедуры</span></span>
        </pre>
    </div>











    <h2 class="header-style" id="txt6">Пишем в текстовый файл TXT, пример 1(использование асинхронных методов)</h2>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура СохранитьТекстЗапроса(Команда)  
                Оповещение = Новый ОписаниеОповещения("ПослеЗакрытияФормы", ЭтотОбъект);
                ОткрытьФорму("ВнешняяОбработка.МояУчебнаяКонсольЗапросов.Форма.ФормаВведенияИмениФайла",,ЭтаФорма,,,,Оповещение, РежимОткрытияОкнаФормы.БлокироватьОкноВладельца);	
            КонецПроцедуры

            &НаКлиенте
            Процедура ПослеЗакрытияФормы(РезультатЗакрытия, Параметры) Экспорт
                <span class="vue-g">//переменная РезультатЗакрытия будет содержать то, что передастся
                //при вызове метода Закрыть() у подчинённой формы. В нашем случае
                //это имя файла, в который и надо записать текст запроса</span>
                Если РезультатЗакрытия = Неопределено Тогда
                    Возврат;
                КонецЕсли;
                
                <span class="vue-g">//хочу сохранить текст запроса в файл на рабочем столе пользователя.
                //пока нашёл такой способ, есть глоб. метод, который вернёт путь до
                //папки с верменными файлами в виндовс, с него и возьмём кусочек пути,
                //а дальше добавим путь до рабочего стола</span>
                Оповещение = Новый ОписаниеОповещения("ПоОкончаниюПолученияКаталога", ЭтотОбъект, РезультатЗакрытия);
                НачатьПолучениеКаталогаВременныхФайлов(Оповещение);
            КонецПроцедуры  


            &НаКлиенте
            Процедура ПоОкончаниюПолученияКаталога(ИмяКаталогаВременныхФайлов, ДопПараметры) Экспорт 
                <span class="vue-g">//создаём путь до папки </span>
                Путь = СтрЗаменить(ИмяКаталогаВременныхФайлов, "AppData\Local\Temp\", "Desktop\");
                Путь = Путь + "Тексты запросов\";

                <span class="vue-g">//этот метод создаёт папку по указанному пути, имя создаваемой папки также 
                //должно быть указано в пути, здесь это "Тексты запросов"</span>
                Оповещение = Новый ОписаниеОповещения("ПоОкончаниюСозданияКаталога", ЭтотОбъект, ДопПараметры);
                НачатьСозданиеКаталога(Оповещение, Путь);
            КонецПроцедуры


            &НаКлиенте
            Процедура ПоОкончаниюСозданияКаталога(ИмяКаталога, ДопПараметры)  Экспорт
                ТекстовыйФайл = Новый ТекстовыйДокумент;  

                <span class="vue-g">// Устанавливаем содержимое файла.</span>
                ТекстовыйФайл.УстановитьТекст(ТекстЗапроса.ПолучитьТекст());

                <span class="vue-g">//Записываем файл на диск.
                //Если такой файл уже существует - он будет перезаписан.
                //имя файла берём из "ДопПараметры", который мы перепрокинули сюда
                //из параметра "РезультатЗакрытия". В неё 
                //имя файла попадает из подчинённой формы, которая передаёт его 
                //при своём закрытии через метод Закрыть()</span> 
                Путь = ИмяКаталога + "\" + ДопПараметры.ИмяФайла + ".txt";

                <span class="vue-g">//Тут можно опустить первым параметров оповещение, я так полагаю из-за
                //того, что после этого метода никакой код больше не выполняется.</span>
                ТекстовыйФайл.НачатьЗапись(, Путь);	
            КонецПроцедуры
        </pre>
    </div>













    <h2 class="header-style" id="csv">Читаем текстовый файл CSV</h2>
    <p>Чтение этого формата ничем не отличается от чтения txt. Чтобы не было проблем с кодировкой, то создаю файл, даю ему расширение .csv и открываю его в excel и только потом копирую из текстового файла .txt контрагентов в эксель и сохраняю.</p>
    <p>Вот пример внутренней обработки, которая из файла CSV получает номенклатуру и добавляет их в справочник, если номенклатура повторяется пропускаем её, если нет группы, добавляем её. Эта обработка находится в базе Камков - Основные объекты. Называется "ЗагрузкаНоменклатурыИзCSV":</p>
    <div class="code-style">
        <pre>
            --модуль формы обработки 

            &НаКлиенте
            Процедура ПрочитатьФайлCSV(Команда)
                Проводник = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);

                Оповещение = Новый ОписаниеОповещения("ПослеОткрытия", ЭтотОбъект);
                Проводник.Показать(Оповещение);
            КонецПроцедуры

            &НаКлиенте
            Процедура ПослеОткрытия(ВыбранныеФайлы, Параметры) Экспорт 
                //после выбора файла в диалоговом окне в параметр
                //"ВыбранныеФайлы" попадает массив с путями до файлов
                //в виде строк, например - "C:\Users\Professional\Desktop\Примеры файлов для 1С\Номенклатура.csv"
                //Если элемент в массиве один, то первым элементов будет эта строка с путём    

                Если ВыбранныеФайлы = Неопределено Тогда
                    Возврат;
                КонецЕсли;
                
                ТекстовыйФайл = Новый ТекстовыйДокумент;
                
                //Читаем с файла, в переменной ВыбранныеФайлы массив с 
                //путями выбранных файлов, в данном примере там только один элемент с путём
                ТекстовыйФайл.Прочитать(ВыбранныеФайлы[0]);   

                Если ТекстовыйФайл.КоличествоСтрок() = 0 Тогда
                    Возврат;
                КонецЕсли;
                
                ПолучитьНоменклатуруНаСервере(ТекстовыйФайл);
                
            КонецПроцедуры     


            &НаСервереБезКонтекста
            Процедура ПолучитьНоменклатуруНаСервере(ТекстовыйФайл)
                //создадим 2 массива для хранения новой добавленной номенклатуры
                //и группы, чтобы обновлённые данные каждый раз не получать из БД
                МассивДобавленнойНоменклатуры = Новый Массив;
                МассивДобавленныхГрупп = Новый Массив;

                //запросом получаем имеющуюся номенклатуру
                Запрос = Новый Запрос;
                Запрос.Текст = "ВЫБРАТЬ
                            |	Номенклатура.Наименование КАК Наименование,
                            |	Номенклатура.ВидНоменклатуры КАК ВидНоменклатуры,
                            |	ПРЕДСТАВЛЕНИЕ(Номенклатура.Родитель) КАК ПРодитель,
                            |	Номенклатура.Родитель КАК Родитель
                            |ИЗ
                            |	Справочник.Номенклатура КАК Номенклатура
                            |ГДЕ
                            |	Номенклатура.ЭтоГруппа = ""Ложь"""; 
                
                Выборка = Запрос.Выполнить().Выбрать();
                
                
                Для НомерСтроки = 1 По ТекстовыйФайл.КоличествоСтрок() Цикл  
                    НоваяГруппа = Ложь;
                

                    //в первой строке находится заголовок, поэтому он нам не интересен
                    Если НомерСтроки = 1 Тогда
                        Продолжить;
                    КонецЕсли;
                    
                    //получаем из текстового файла очередную строку
                    ТекущаяСтрока = ТекстовыйФайл.ПолучитьСтроку(НомерСтроки);
                    
                    //провереям строку на пустоту
                    Если ПустаяСтрока(ТекущаяСтрока) Тогда
                        Продолжить;
                    КонецЕсли;   

                    //разбиваем строку по начертанию "|" как указано в файле CSV
                    МассивДанных = СтрРазделить(ТекущаяСтрока, "|");

                    НазваниеНоменклатуры = СокрЛП(МассивДанных[0]);
                    ВидНоменклатуры = СокрЛП(МассивДанных[1]);
                    ГруппаНоменклатуры = СокрЛП(МассивДанных[2]);
                    
                    ИндексВидаНоменклатуры = 0;
                    Если ВидНоменклатуры = "Услуга" Тогда
                        ИндексВидаНоменклатуры = 1;
                    ИначеЕсли ВидНоменклатуры = "Материал" Тогда	
                        ИндексВидаНоменклатуры = 2;
                    КонецЕсли;
                    
                    //в цикле ищем добавдяемую номенклатуру в выборке  
                    ЕстьТакаяНоменклатура = Ложь; 
                    Выборка.Сбросить();
                    Пока Выборка.Следующий() Цикл
                        Если НазваниеНоменклатуры = Выборка.Наименование Тогда
                            ЕстьТакаяНоменклатура = Истина;
                            Прервать;
                        КонецЕсли;
                    КонецЦикла; 

                    //в цикле ищем добавляемую номенклатуру в массиве добавленных номенклатур
                    Если ЕстьТакаяНоменклатура = Ложь Тогда
                        Для каждого Номенклатура Из МассивДобавленнойНоменклатуры Цикл
                            Если НазваниеНоменклатуры = Номенклатура Тогда
                                ЕстьТакаяНоменклатура = Истина;
                                Прервать;
                            КонецЕсли;	
                        КонецЦикла;
                    КонецЕсли;
                    
                    
                    //номенклатура есть такая в базе, дальше не продолжаем
                    Если ЕстьТакаяНоменклатура Тогда
                        Продолжить;	
                    КонецЕсли;
                    
                    //в цикле ищем добавляемую группу  в выборке
                    НетТакойГруппы = Ложь;     
                    Выборка.Сбросить();
                    Пока Выборка.Следующий() Цикл
                        Если Выборка.ПРодитель = ГруппаНоменклатуры Тогда
                            НетТакойГруппы = Ложь;
                            Прервать;
                        Иначе
                            НетТакойГруппы = Истина;
                        КонецЕсли;
                    КонецЦикла; 

                    //в цикле ищем добавляему группу в массиве групп
                    Если НетТакойГруппы = Истина Тогда
                        Для каждого Группа Из МассивДобавленныхГрупп Цикл
                            Если Группа = ГруппаНоменклатуры Тогда
                                НетТакойГруппы = Ложь;
                                Прервать;
                            Иначе
                                НетТакойГруппы = Истина;
                            КонецЕсли;
                        КонецЦикла;
                    КонецЕсли;
                    
                    
                    
                    Если НетТакойГруппы Тогда
                        ОбъектГруппыНоменклатуры = Справочники.Номенклатура.СоздатьГруппу();
                        ОбъектГруппыНоменклатуры.Наименование = ГруппаНоменклатуры;
                        Если ВидНоменклатуры = "Товар" Тогда
                            СсылкаНаГруппуТовары = Справочники.Номенклатура.НайтиПоНаименованию("Товары");
                        КонецЕсли;
                        ОбъектГруппыНоменклатуры.Родитель = СсылкаНаГруппуТовары;
                        ОбъектГруппыНоменклатуры.Записать();
                        НоваяГруппа = Истина;
                        МассивДобавленныхГрупп.Добавить(ГруппаНоменклатуры);
                    КонецЕсли;
                    

                    ОбъектНоменклатуры = Справочники.Номенклатура.СоздатьЭлемент(); 
                    ОбъектНоменклатуры.Наименование = НазваниеНоменклатуры;
                    ОбъектНоменклатуры.ВидНоменклатуры = Перечисления.ВидыНоменклатуры.Получить(ИндексВидаНоменклатуры);

                    Если НоваяГруппа Тогда
                        ОбъектНоменклатуры.Родитель = ОбъектГруппыНоменклатуры.Ссылка;
                    Иначе
                        ОбъектНоменклатуры.Родитель = Справочники.Номенклатура.НайтиПоНаименованию(ГруппаНоменклатуры);	
                    КонецЕсли;
                    
                    ОбъектНоменклатуры.Записать();
                    МассивДобавленнойНоменклатуры.Добавить(НазваниеНоменклатуры);    
                КонецЦикла;
            КонецПроцедуры 
        </pre>
    </div>














    <h2 class="header-style" id="xlsx">Читаем файл Excel</h2>
    <p><b>Пример 1</b></p>
    <p>Существует также несколько способов читать excel файл. Мы рассмотрим только один способ, который использует для чтения файла класс встроенного языка - ТабличныйДокумент. У класса есть метод <span class="vue-b">Прочитать()</span>, который позволяет прочитать данные в том числе и из формата excel. <span class="vue-r">Особенность этого метода в том, что он доступен только на сервере</span>.</p>
    <p>Также у класса есть метод - <span class="vue-b">ПолучитьОбласть()</span>, который получает данные табличного документа по указанному адресу, например, "R1C2" - 1я строка, 2я колонка.</p>
    <p>Есть свойство <span class="vue-b">ВысотаТаблицы</span>, которое позволяет получить количество строк в считанном файле.</p>
    <div class="code-style">
        <pre>
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ПрочитатьФайлXLSX<span class="vue-r">()</span>
                <span class="vue-g">//примером файла Excel будет Список контрагентов.xlsx.</span>
                ПрочитатьФайлXLSXНаСервере<span class="vue-r">();	
            КонецПроцедуры

            &НаСервере
            Процедура</span> ПрочитатьФайлXLSXНаСервере<span class="vue-r">()</span>
                ТабДок <span class="vue-r">= Новый</span> ТабличныйДокумент<span class="vue-r">;</span>

                <span class="vue-g">//чтобы при чтении файла исключить вылет ошибок обернём чтение в Попытка..Исключение</span>
                <span class="vue-r">Попытка</span>
                    <span class="vue-g">//из табличного файла данные можно считывать 2мя способами.Либо по типам значений - число считывается как число, строка как строка,
                    //либо всё считывать как текст, т.е. всё будет считываться как строки.
                    //Мы выбрали значение "Значение", т.е. считывать будем значения такие как они есть:
                    //число как число, строка как строка. Также, насколько я понимаю,
                    //метод Прочитать() получает строку с путём до файла на компьюторе клиента,
                    //значит этот метод идёт с сервера на клиент, по переданному пути получает содержимое файла
                    //и возвращается на сервер с этим файлом.</span>
                    ТабДок<span class="vue-r">.</span>Прочитать<span class="vue-r">(</span>Объект<span class="vue-r">.</span>ПутьКФайлу<span class="vue-r">,</span> СпособЧтенияЗначенийТабличногоДокумента<span class="vue-r">.</span>Значение<span class="vue-r">);</span>
                <span class="vue-r">Исключение</span>
                    <span class="vue-g">//ОписаниеОшибки() это метод Глобального контекста, который вернёт текст ошибки</span>
                    Сообщение <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                    Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не удалось прочитать указанный файл по причине "</span> <span class="vue-r">+</span> ОписаниеОшибки<span class="vue-r">();</span>
                    Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span>
                    Возврат<span class="vue-r">;
                КонецПопытки;</span>

                <span class="vue-g">//если ошибок нет, то можем двигаться дальше и нам нужно получить количество строк в табличном файле</span>
                КоличествоСтрок <span class="vue-r">=</span> ТабДок<span class="vue-r">.</span>ВысотаТаблицы<span class="vue-r">;</span>

                <span class="vue-g">//и далее в цикле будем считывать построчно табличный файл, начинать будем
                //со 2й строки, потому что в 1й строке шапка</span>
                <span class="vue-r">Для</span> НомерСтроки <span class="vue-r">=</span> 2 <span class="vue-r">По</span> КоличествоСтрок <span class="vue-r">Цикл</span>
                    <span class="vue-g">//в табличную часть добавляем новую строку
                    //и колонкам этой строки задаём части массива</span>
                    НоваяСтрока <span class="vue-r">=</span> Объект<span class="vue-r">.</span>ДанныеФайла<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 

                    <span class="vue-g">//метод ПолучитьОбласть() вернёт объект типа ТабличныйДокумент, нам же нужно получить содержимое ячейки
                    //у вернувшегося объекта есть подобъект ТекущаяОбласть, а унего есть свойство Текст, которое нам и даст
                    //содержимое ячейки </span>
                    НоваяСтрока<span class="vue-r">.</span>КраткоеНаименование <span class="vue-r">=</span> ТабДок<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"R"</span> <span class="vue-r">+</span> Формат<span class="vue-r">(</span>НомерСтроки<span class="vue-r">,</span> <span class="vue-bl">"ЧГ=0"</span><span class="vue-r">) +</span> <span class="vue-bl">"C1"</span><span class="vue-r">).</span>ТекущаяОбласть<span class="vue-r">.</span>Текст<span class="vue-r">;</span>
                    НоваяСтрока<span class="vue-r">.</span>ПолноеНаименование <span class="vue-r">=</span> ТабДок<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"R"</span> <span class="vue-r">+</span> Формат<span class="vue-r">(</span>НомерСтроки<span class="vue-r">,</span> <span class="vue-bl">"ЧГ=0"</span><span class="vue-r">) +</span> <span class="vue-bl">"C2"</span><span class="vue-r">).</span>ТекущаяОбласть<span class="vue-r">.</span>Текст<span class="vue-r">;</span>
                    НоваяСтрока<span class="vue-r">.</span>УНП <span class="vue-r">=</span> ТабДок<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"R"</span> <span class="vue-r">+</span> Формат<span class="vue-r">(</span>НомерСтроки<span class="vue-r">,</span> <span class="vue-bl">"ЧГ=0"</span><span class="vue-r">) +</span> <span class="vue-bl">"C3"</span><span class="vue-r">).</span>ТекущаяОбласть<span class="vue-r">.</span>Текст<span class="vue-r">;
                КонецЦикла;	
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p>Этот код чтения файла сработает только в структуре, когда БД находится на одном компьюторе вместе с клиентом. Если же сервер будет на другом компьюторе удалённо, то такого пути до файла там просто не будет, а потому будет ошибка.</p>

    <p><b>Пример 2</b></p>
    <p>Допустим мы хотим из файла эксель выбрать данные и записать их в регистр сведений. Вот так выглядит файл Контрагенты.xlsx:</p>
    <img src="../img/1С-1/2023-10-28_08-24-29.png" class="screen-2" alt="">
    <p>И вот так должен выглядеть регистр с уже записанными данными:</p>
    <img src="../img/1С-1/2023-10-28_08-26-13.png" class="screen" alt="">
    <p>В регистре ресурс это только "Значение", остальное измерение. Создадим обработку, с полемм вода для ввода пути к файлу и кнопкой для записи данных в регистр. Вот обработчик этой кнопки:</p>
    <div class="code-style">
        <pre>
            --модуль формы обработки
            <span class="vue-b"><span class="vue-r">&НаСервере
            Процедура</span> ЗагрузитьДанныеИзФайлаНаСервере<span class="vue-r">()</span>
                ТабДок <span class="vue-r">= Новый</span> ТабличныйДокумент<span class="vue-r">;</span>

                <span class="vue-g">//чтобы при чтении файла исключить вылет ошибок обернём чтение в Попытка..Исключение</span>
                <span class="vue-r">Попытка</span>
                    <span class="vue-g">//из табличного файла данные можно считывать 2мя способами.Либо по типам значений - число считывается как число, строка как строка,
                    //либо всё считывать как текст, т.е. всё будет считываться как строки.</span>
                    ТабДок<span class="vue-r">.</span>Прочитать<span class="vue-r">(</span>ПутьКФайлу<span class="vue-r">,</span> СпособЧтенияЗначенийТабличногоДокумента<span class="vue-r">.</span>Значение<span class="vue-r">);</span>
                <span class="vue-r">Исключение</span>
                    <span class="vue-g">//ОписаниеОшибки() это метод Глобального контекста, который вернёт текст ошибки</span>
                    Сообщение <span class="vue-r">= Новый</span> СообщениеПользователю<span class="vue-r">;</span>
                    Сообщение<span class="vue-r">.</span>Текст <span class="vue-r">=</span> <span class="vue-bl">"Не удалось прочитать указанный файл по причине "</span> <span class="vue-r">+</span> ОписаниеОшибки<span class="vue-r">();</span>
                    Сообщение<span class="vue-r">.</span>Сообщить<span class="vue-r">();</span>
                    Возврат<span class="vue-r">;
                КонецПопытки;</span>

                <span class="vue-g">//если ошибок нет, то можем двигаться дальше и нам нужно 
                //получить количество строк и колонок в табличном файле</span>
                КоличествоСтрок <span class="vue-r">=</span> ТабДок<span class="vue-r">.</span>ВысотаТаблицы<span class="vue-r">;</span>  
                КоличествоКолонок <span class="vue-r">=</span> ТабДок<span class="vue-r">.</span>ШиринаТаблицы<span class="vue-r">;</span>

                <span class="vue-g">//создаём пустой набор записей и делаем запись пустого набора для очистки ранее записанного</span>
                НаборЗаписей <span class="vue-r">=</span> РегистрыСведений<span class="vue-r">.</span>ДанныеФайла<span class="vue-r">.</span>СоздатьНаборЗаписей<span class="vue-r">();</span>
                НаборЗаписей<span class="vue-r">.</span>Записать<span class="vue-r">();</span>

                <span class="vue-g">//в цикле считываем построчно табличный файл</span>
                <span class="vue-r">Для</span> НомерСтроки = 1 <span class="vue-r">По</span> КоличествоСтрок <span class="vue-r">Цикл </span>
                    <span class="vue-g">//в цикле считываем поколоночно табличный файл</span>              
                    <span class="vue-r">Для</span> НомерКолонки = 1 <span class="vue-r">По</span> КоличествоКолонок <span class="vue-r">Цикл </span>
                        Запись <span class="vue-r">=</span> НаборЗаписей<span class="vue-r">.</span>Добавить<span class="vue-r">();</span> 
                        Запись<span class="vue-r">.</span>ИмяФайла <span class="vue-r">=</span> Сред<span class="vue-r">(</span>ПутьКФайлу<span class="vue-r">,</span> СтрНайти<span class="vue-r">(</span>ПутьКФайлу<span class="vue-r">,</span> <span class="vue-bl">"\"</span><span class="vue-r">,</span> НаправлениеПоиска<span class="vue-r">.</span>СКонца<span class="vue-r">) +</span> 1<span class="vue-r">);</span>
                        Запись<span class="vue-r">.</span>НомерСтрокиФайла <span class="vue-r">=</span> НомерСтроки<span class="vue-r">;</span>
                        Запись<span class="vue-r">.</span>НомерКолонкиФайла <span class="vue-r">=</span> НомерКолонки<span class="vue-r">;</span>
                        Значение <span class="vue-r">=</span> ТабДок<span class="vue-r">.</span>ПолучитьОбласть<span class="vue-r">(</span><span class="vue-bl">"R"</span> <span class="vue-r">+</span> Формат<span class="vue-r">(</span>НомерСтроки<span class="vue-r">,</span> <span class="vue-bl">"ЧГ=0"</span><span class="vue-r">) +</span> <span class="vue-bl">"C"</span> <span class="vue-r">+</span> Формат<span class="vue-r">(</span>НомерКолонки<span class="vue-r">,</span> <span class="vue-bl">"ЧГ=0"</span><span class="vue-r">)).</span>ТекущаяОбласть<span class="vue-r">.</span>Текст<span class="vue-r">;</span> 

                        <span class="vue-g">//преобразовываем данные файла в нужные типы</span>
                        <span class="vue-r">Попытка</span>
                            А <span class="vue-r">=</span> 0 <span class="vue-r">+</span> Значение<span class="vue-r">;</span>
                            <span class="vue-g">//если исключение не сработало, значит преобразовалось в число</span>
                            Запись<span class="vue-r">.</span>Значение <span class="vue-r">=</span>  А<span class="vue-r">;</span>
                        <span class="vue-r">Исключение</span>
                            Позиция <span class="vue-r">=</span> СтрНайти<span class="vue-r">(</span>Значение<span class="vue-r">,</span> <span class="vue-bl">"2023"</span><span class="vue-r">);</span>
                            <span class="vue-r">Если</span> Позиция <span class="vue-r">Тогда</span>
                                <span class="vue-g">//если заши сюда, значит значение дата</span>
                                МассивСтрок <span class="vue-r">=</span> СтрРазделить<span class="vue-r">(</span>Значение<span class="vue-r">,</span> "."<span class="vue-r">);</span>
                                                                            
                                ПеревёрнутыйМассив <span class="vue-r">= Новый</span> Массив<span class="vue-r">;</span>
                                Шаг <span class="vue-r">=</span> МассивСтрок<span class="vue-r">.</span>ВГраница<span class="vue-r">();</span>
                                <span class="vue-r">Пока</span> Шаг <span class="vue-r">>=</span> 0 <span class="vue-r">Цикл</span>
                                    ПеревёрнутыйМассив<span class="vue-r">.</span>Добавить<span class="vue-r">(</span>МассивСтрок<span class="vue-r">[</span>Шаг<span class="vue-r">]);</span>
                                    Шаг <span class="vue-r">=</span> Шаг <span class="vue-r">-</span> 1<span class="vue-r">;
                                КонецЦикла;</span>
            
                                СтрокаДаты <span class="vue-r">=</span> СтрСоединить<span class="vue-r">(</span>ПеревёрнутыйМассив<span class="vue-r">);</span>
                                Запись<span class="vue-r">.</span>Значение <span class="vue-r">=</span>  Дата<span class="vue-r">(</span>СтрокаДаты<span class="vue-r">);</span>
                            <span class="vue-r">Иначе</span>
                                <span class="vue-g">//ну и если мы тут, значит значение строка</span>
                                Запись<span class="vue-r">.</span>Значение <span class="vue-r">=</span>  Значение<span class="vue-r">;
                            КонецЕсли;
                        КонецПопытки;
                    КонецЦикла;
                КонецЦикла;</span> 

                НаборЗаписей<span class="vue-r">.</span>Записать<span class="vue-r">();
            КонецПроцедуры

            &НаКлиенте
            Процедура</span> ЗагрузитьДанныеИзФайла<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ЗагрузитьДанныеИзФайлаНаСервере<span class="vue-r">();
            КонецПроцедуры</span></span>
        </pre>
    </div>

    <p><b>Пример 3</b></p>
    <p>Вот на этом сайте показаны ещё способы как читать из эксель - <a href="https://ironskills.by/tpost/dgg1j0v4k1-kak-prochitat-excel-v-1s-4-sposoba">тут</a></p>


















    <h2 class="header-style" id="dbf">Читаем файл DBF</h2>
    <p>На сегодня работать с таким форматом файлов приходится не часто. Поэтому не буду описывать его. Если вдруг понадобится, то вот это видео - https://www.youtube.com/watch?v=bCA4KrLzHg8&list=PLnhTnXRFDQ7dJa-1DtA2bcKvK4pxV8GRP&index=7 , где описано как с ним работать.</p>


















    <h2 class="header-style" id="xml">Читаем файл XML</h2>
    <p>Существуют разные способы читать такие файлы. Рассмотрим 2 таких способа. Первый способ чтения это последовательный способ, который предпологает, что данные из xml документа считываются последовательно по одному узлу за раз. То есть считываем самый первый тег, за ним второй, за ним содержимое тега, за ним закрывающий второй тег, за ним 1й закрывающий тег.</p>
    <p>Вот такой xml будем разбирать:</p>
    <img src="../img/1С-1/2023-07-28_08-09-55.png" class="screen" alt="">
    <p><b>Для последовательного</b> чтения узлов xml используется <span class="vue-b">класс ЧтениеXML</span>:</p>
    <div class="code-style">
        <pre>
            --Способ 1й
            &НаКлиенте
            Процедура ПрочитатьФайлXML()
                ОбъектXML = Новый ЧтениеXML;

                //Если получили строку XML через HTTP
                //ОбъектXML.УстановитьСтроку("Строка xml полученная через http");

                //Если xml в файле
                ОбъектXML.ОткрытьФайл(Объект.ПутьКФайлу);

                <span class="vue-g">//для того чтобы прочитать очередной узел xml документа есть метод Прочитать(), который возвращает булево значение</span>
                Пока ОбъектXML.Прочитать() Цикл
                    <span class="vue-g">//при прочтении первого узла в ОбъектXML в свойство Имя попадает имя узла, в нашем случае "ContragentList"
                    //в свойство ТипУзла попадает значение НачалоЭлемента - это системное перечисление
                    //в свойство Значение попадает содержимое узла - "", этот тег в себе содержит другие теги, а потому считается содержимое пустым
                    //на следущем узле Имя - "Contragent", ТипУзла - НачалоЭлемента, Значение - ""
                    //на следущем узле Имя - "NAME", ТипУзла - НачалоЭлемента, Значение - ""
                    //на следущем узле Имя - "#text", ТипУзла - Текст, Значение - "Краткое наименование Контрагент1"
                    //на следущем узле Имя - "NAME", ТипУзла - КонецЭлемента, Значение - ""
                    // и так далее</span>	
                    Если ОбъектXML.Имя = "Contragent" И ОбъектXML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
                        <span class="vue-g">//для меня было удивлением, что переменная Новая строка созданная на 2м круге цикла и её содержимое
                        //будет существовать и на остальных кругах цикла. Переменная не удаляется на следующем круге
                        //даже если мы не зайдём в это условие и не создадим её заново. Т.е. тут действует принцип как в js
                        //при объявлении переменных через var, когда переменные всплывают и становятся доступными отовсюду в процедуре
                        //при объявлении переменных через let в js такое уже не прокатывает. Могу сделать вывод, что в 1с
                        //переменные всплывают, поэтому переменная НоваяСтрока на следующем круге видна</span>
                        НоваяСтрока = Объект.ДанныеФайла.Добавить();
                        Продолжить;
                    ИначеЕсли ОбъектXML.Имя = "NAME" И ОбъектXML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
                        ОбъектXML.Прочитать();
                        НоваяСтрока.КраткоеНаименование = ОбъектXML.Значение;
                        Продолжить;	
                    ИначеЕсли ОбъектXML.Имя = "FULL_NAME" И ОбъектXML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
                        ОбъектXML.Прочитать();
                        НоваяСтрока.ПолноеНаименование = ОбъектXML.Значение;
                        Продолжить;
                    ИначеЕсли ОбъектXML.Имя = "UNP" И ОбъектXML.ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
                        ОбъектXML.Прочитать();
                        НоваяСтрока.УНП = ОбъектXML.Значение;
                    КонецЕсли;	
                КонецЦикла;

                ОбъектXML.Закрыть();	
            КонецПроцедуры
        </pre>
    </div>
    <p><b>Второй способ</b> это <span class="vue-b">механизм XDTO(XML Data Transfer Objects)</span>. Этот механизм разработан фирмой 1С, который позволяет на уровне языка 1с оперировать не узлами XML, а прикладными понятиями "Контрагент", "Счёт" и привычными встроенными типами("ТаблицаЗначение", "СправочникСсылка" и т.д.)</p>
    <p>Объект.ДанныеФайла - это реквизит формы с типом (Таблица значений), настоящий тип - "ДанныеФормыКоллекция", но имеет примерно такие же методы как и тип "Таблица значений".</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ПрочитатьФайлXML()
                //способ с фабрикой XDTO
                ОбъектXML = Новый ЧтениеXML;
                ОбъектXML.ОткрытьФайл(Объект.ПутьКФайлу);

                КонтрагентыXDTO = ФабрикаXDTO.ПрочитатьXML(ОбъектXML);
                Для каждого Элемент Из КонтрагентыXDTO.Contragent Цикл
                    НоваяСтрока = Объект.ДанныеФайла.Добавить();
                    НоваяСтрока.КраткоеНаименование = Элемент.NAME;
                    НоваяСтрока.ПолноеНаименование = Элемент.FULL_NAME;
                    НоваяСтрока.УНП = Элемент.UNP;		
                КонецЦикла;		
            КонецПроцедуры
        </pre>
    </div>
    <p>Конечно это далеко не полные данные по этим способам чтения. В дальнейшем буду добавлять.</p>

















    <h2 class="header-style" id="json">Читаем файл JSON</h2>
    <p>Код будет в обработке "Чтение разных файлов" в базе "Учебная база(курс Камков - Основные объекты)". Для чтения json-объекта там отдельно я создал таблицу значений и поместил её на вторую вкладку. Так что выбираем в диалоге файл json и на второй вкладке жмём "Получить json файл".</p>
    <p>Видео по которому делаю - https://www.youtube.com/watch?v=OMhNFmqb8vI</p>
    <p>JSON(Javascript Objects Notation) - текстовый формат обмена данными, основанный на Javascript. Используется в REST API.</p>
    <img src="../img/1С-1/2023-07-30_07-34-03.png" class="screen" alt="">
    <p>JSON может быть в виде javascript объекта или в виде массива:</p>
    <div class="code-style">
        <pre>
            <span class="vue-g">//json-объект</span>
            {
                "name": "Ложкин ЕвгенийСтепанович",
                "age": 32
            }

            <span class="vue-g">//json-массив</span>
            ["Иванов", "Петров", "Сидоров"]
        </pre>
    </div>
    <p>JSON-объекты могут иметь глубокую вложенность. Например такую:</p>
    <img src="../img/1С-1/2023-07-30_07-48-35.png" class="screen" alt="">
    <p>Для примера мы будем читать файл Сотрудники.json, который лежит у меня на рабочем столе в папке "Примеры файлов для 1С". Чтобы проыитать json можно использовать следующие способы:</p>
    <p><span class="vue-d-b">Используем объект от класса ЧтениеJSON</span></p>
    <ul class="list">
        <li>Этот объект предназначен для последовательного(потокового) чтения JSON, т.е. читается каждый узел объекта json, начиная от открывающихся скобок и т.д. И в зависимости от того какой именно в данный миг находится в потоке узел, мы и принимаем решение что делать.</li>
    </ul>
    <p><span class="vue-d-b">ПрочитатьJSON()</span></p>
    <ul class="list">
        <li>Метод глобального контекста</li>
        <li>Позволяет преобразовать json в фиксированный набор типов платформы(например, json-объект может быть преобразован в Структура или в Соответствие, а json-массив в массив 1С).</li>
        <li>Работает в связке с объектом ЧтениеJSON.</li>
    </ul>
    <p><b>Опишем первый способ чтения</b>. Вот такой файл будем читать и добавлять в табличную часть формы обработки:</p>
    <img src="../img/1С-1/2023-07-30_08-56-31.png" class="screen" alt="">
    <p>Когда мы в потоке дойдём до скобки "{", значит мы начинаем читать нового сотрудника, поэтому надо добавить строку в таблицу значений и начать заполнять колонки.</p>
    <div class="code-style">
        <pre>
            --модуль формы обработки
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ПрочитатьJsonФайл<span class="vue-r">(</span>Команда<span class="vue-r">)</span>
                ПрочитатьФайлJSONПоследовательно<span class="vue-r">();
            КонецПроцедуры 

            &НаКлиенте
            Процедура</span> ПрочитатьФайлJSONПоследовательно<span class="vue-r">()</span>
                <span class="vue-g">//тут мы опишем как читать файл json последовательно через объект 
                //класса ЧтениеJSON</span>  
                ТаблицаДляJSON<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>

                ЧтениеJSON <span class="vue-r">= Новый</span> ЧтениеJSON<span class="vue-r">;</span>
                ЧтениеJSON<span class="vue-r">.</span>ОткрытьФайл<span class="vue-r">(</span>Объект<span class="vue-r">.</span>ПутьКФайлу<span class="vue-r">);</span>

                <span class="vue-g">//В Соответствии указываем те ключи свойства json-объекта,
                //значение которых хотим добавлять в таблицу значений
                //также ключам должны соответствовать поля таблицы значений  
                //т.е. значение свойства с ключом "name" мы запишем в поле "Содтрудник"
                //и т.д.</span>
                СоответствиеПолей <span class="vue-r">= Новый</span> Соответствие<span class="vue-r">;</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"name"</span><span class="vue-r">,</span> <span class="vue-bl">"Сотрудник"</span><span class="vue-r">);</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"inn"</span><span class="vue-r">,</span> <span class="vue-bl">"ИНН"</span><span class="vue-r">);</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"partner_type"</span><span class="vue-r">,</span> <span class="vue-bl">"ВидПартнёрства"</span><span class="vue-r">);</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"is_supplier"</span><span class="vue-r">,</span> <span class="vue-bl">"Поставщик"</span><span class="vue-r">);</span>

                <span class="vue-g">//Итак в объект ЧтениеJSON мы записали строку json из файла
                //теперь нужно начать читать файл, для этого есть 
                //метод Прочитать(). Он позволяет прочитать очередной
                //узел и возвращает Истина, если прочитали и Ложь, если нет
                //1й цикл как бы переключает json-объекты сотрудников</span> 
                <span class="vue-r">Пока</span> ЧтениеJSON<span class="vue-r">.</span>Прочитать<span class="vue-r">() Цикл</span>
                    <span class="vue-g">//внутри цикла, для понимания на каком узле мы сейчас находимся,
                    //у ЧтениеJSON есть свойство "ТипТекущегоЗначения". Для обозначения разных
                    //узлов json-объекта это свойство изпользует системное
                    //перечисление "ТипЗначенияJSON". В этом перечислении есть следующие значения
                    //"НачалоМассива" - это значит что мы в самом начале json-массива
                    //"НачалоОбъекта"  - это значит мы в начале json-объекта	
                    //"ИмяСвойства"  - это значит что мы читаем ключ свойства	
                    //"Строка", "Число", "Null" или "Булево" - это значит мы читаем значение свойства 	
                    //Также у ЧтениеJSON есть свойство "ТекущееЗначение", из него мы можем 	
                    //получить значение ключа свойства, когда поток стоит на узле "ИмяСвойства", 	
                    //либо получить значение свойства когда поток стоит на узлах "Строка", "Число", "Null" или "Булево"</span> 	
                    ТипУзлаJSON <span class="vue-r">=</span> ЧтениеJSON<span class="vue-r">.</span>ТипТекущегоЗначения<span class="vue-r">;</span>
                    
                    <span class="vue-r">Если</span> ТипУзлаJSON <span class="vue-r">=</span> ТипЗначенияJSON<span class="vue-r">.</span>НачалоОбъекта <span class="vue-r">Тогда</span> 
                        <span class="vue-g">//Тип узла "НачалоОбъекта", значит нужно добавить
                        //новую строку в таблицу значений и дальше заполнять её</span>
                        СтрокаТЗ <span class="vue-r">=</span> ТаблицаДляJSON<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                        
                        <span class="vue-g">//2й цикл, который бегает по внутреннему json-объекту и 
                        //достаёт из него данные</span>
                        <span class="vue-r">Пока</span> ЧтениеJSON<span class="vue-r">.</span>Прочитать<span class="vue-r">() Цикл</span> 
                            <span class="vue-r">Попытка</span>
                                ТекущееЗначениеУзла <span class="vue-r">=</span> ЧтениеJSON<span class="vue-r">.</span>ТекущееЗначение<span class="vue-r">;</span>
                            <span class="vue-r">Исключение</span> 
                                <span class="vue-r">Если</span> ЧтениеJSON<span class="vue-r">.</span>ТипТекущегоЗначения <span class="vue-r">=</span> ТипЗначенияJSON<span class="vue-r">.</span>КонецОбъекта <span class="vue-r">Тогда 
                                    Прервать;
                                КонецЕсли; 
                            КонецПопытки;</span> 
                        
                            ПолеТЗ <span class="vue-r">=</span> СоответствиеПолей<span class="vue-r">.</span>Получить<span class="vue-r">(</span>ТекущееЗначениеУзла<span class="vue-r">);</span>	
                            <span class="vue-r">Если</span> ПолеТЗ <span class="vue-r">&lt;></span> Неопределено <span class="vue-r">Тогда</span>
                                ЧтениеJSON<span class="vue-r">.</span>Прочитать<span class="vue-r">();</span>
                                СтрокаТЗ<span class="vue-r">[</span>ПолеТЗ<span class="vue-r">] =</span> ЧтениеJSON<span class="vue-r">.</span>ТекущееЗначение<span class="vue-r">;
                                Продолжить;				
                            КонецЕсли;</span>

                            ЧтениеJSON<span class="vue-r">.</span>Прочитать<span class="vue-r">();
                        КонецЦикла;
                    КонецЕсли;	
                КонецЦикла;</span> 

                ЧтениеJSON<span class="vue-r">.</span>Закрыть<span class="vue-r">();
            КонецПроцедуры</span></span>
        </pre>
    </div>
    <p><b>Опишем второй способ чтения</b>. Читать будем тот же файл, но через глобальный метод ПрочитатьJSON(). Нам также понадобится объект класса ЧтениеJSON. У метода ПрочитатьJSON() достаточно много параметров, но ключевые из них это первые 2. Первый параметр это как раз нужный нам объект класса ЧтениеJSON, а второй это булев параметр, который при Истине говорит, что json-объект будет прочитан в Соответствие, иначе в Структуру. В итоге метод ПрочитатьJSON() вернёт массив соответствий или структур. Читать в соответствие более универсально, потому что ключи могут содержать пробелы в названии, а структура не допускает такие ключи:</p>
    <div class="code-style">
        <pre>
            -модуль формы обработки
            <span class="vue-b"><span class="vue-r">&НаКлиенте
            Процедура</span> ПрочитатьФайлJSONГлобМетодом<span class="vue-r">()</span>
                <span class="vue-g">//тут мы опишем как читать файл json с помощью глобального 
                //метода ПрочитатьJSON()</span>  
                ТаблицаДляJSON<span class="vue-r">.</span>Очистить<span class="vue-r">();</span>

                ЧтениеJSON <span class="vue-r">= Новый</span> ЧтениеJSON<span class="vue-r">;</span>
                ЧтениеJSON<span class="vue-r">.</span>ОткрытьФайл<span class="vue-r">(</span>Объект<span class="vue-r">.</span>ПутьКФайлу<span class="vue-r">);</span>	

                МассивСотрудников <span class="vue-r">=</span> ПрочитатьJSON<span class="vue-r">(</span>ЧтениеJSON<span class="vue-r">);</span>
                
                <span class="vue-g">//тут также укажем соответствие для определения тех ключей
                //значения которых мы хотим достать из json-объекта</span>
                СоответствиеПолей <span class="vue-r">= Новый</span> Соответствие<span class="vue-r">;</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"name"</span><span class="vue-r">,</span> <span class="vue-bl">"Сотрудник"</span><span class="vue-r">);</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"inn"</span><span class="vue-r">,</span> <span class="vue-bl">"ИНН"</span><span class="vue-r">);</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"partner_type"</span><span class="vue-r">,</span> <span class="vue-bl">"ВидПартнёрства"</span><span class="vue-r">);</span>
                СоответствиеПолей<span class="vue-r">.</span>Вставить<span class="vue-r">(</span><span class="vue-bl">"is_supplier"</span><span class="vue-r">,</span> <span class="vue-bl">"Поставщик"</span><span class="vue-r">);</span>

                <span class="vue-r">Для каждого</span> Сотрудник <span class="vue-r">Из</span> МассивСотрудников <span class="vue-r">Цикл</span>
                    СтрокаТЗ <span class="vue-r">=</span> ТаблицаДляJSON<span class="vue-r">.</span>Добавить<span class="vue-r">();</span>
                    
                    <span class="vue-r">Для каждого</span> Свойство <span class="vue-r">Из</span> Сотрудник <span class="vue-r">Цикл</span>
                        ПолеТЗ <span class="vue-r">=</span> СоответствиеПолей<span class="vue-r">.</span>Получить<span class="vue-r">(</span>Свойство.Ключ<span class="vue-r">);</span>
                        <span class="vue-r">Если</span> ПолеТЗ <span class="vue-r">&lt;></span> Неопределено <span class="vue-r">Тогда</span>
                            СтрокаТЗ<span class="vue-r">[</span>ПолеТЗ<span class="vue-r">] =</span> Свойство<span class="vue-r">.</span>Значение<span class="vue-r">;
                        КонецЕсли;
                    КонецЦикла;
                КонецЦикла;</span>	

                ЧтениеJSON<span class="vue-r">.</span>Закрыть<span class="vue-r">();                
            КонецПроцедуры</span></span>
        </pre>
    </div>

















    
    <h2 class="header-style" id="read-file-on-server">Чтение файла на стороне сервера. Класс ДвоичныеДанные.</h2>
    <p>Если вспомнить процедуру чтения файла excel, то мы выполняли её на сервере, потому что метод Прочитать() не доступен на клиенте. В этот метод 1м параметром передаётся путь до файла. В нашем случае информационная база и клиент находятся на одном копьюторе, поэтому и путь до файла на стороне сервера нашёлся. Но что если сервер будет другой компьютер, путь уже не сработает, потому что на другом компьютере структура файлов другая и там нет того файла, который есть на нашем компе. И как вывод, если у нас будет клиент-серверная структура, то код который мы написали для чтения файла excel выше уже не стработает. Напишем другой код, который использует <b>временное хранилище</b>. Временное хранилище это место куда веб сервер временно ложит файлы прилетевшие с клиента. Как я понимаю на веб сервер установлен язык 1с, по типу php. Теперь 1с нужно забрать данные файла из временного хранилища веб сервера, но как узнать где лежат данные? А это нам скажет клиент, который когда ложил данные в хранилище обратно получил адрес этих данных. Клиент пересылает адрес на сервер в скрипт 1с и 1с по этому адресу забирает из хранилища данные и записывает их в фаёловою систему сервера. Ну а потом берёт из этой файловой системы сервера данные файла и что то с ними делает.</p>
    <p>Чтобы клиент смог поместить данные файла в хранилище, нам для начала нужно считать двоичные данные этого файла на клиенте. Потом поместить во временное хранилище.</p>
    <div class="code-style">
        <pre>
            &НаКлиенте
            Процедура ПрочитатьФайлXLSX()
                <span class="vue-g">//примером файла Excel будет Список контрагентов.xlsx


                //1с на веб сервере по переданному пути не найдёт файл, поэтому нужно передать файл на сервер
                //во временное хранилище. Передать файл нужно в виде двоичных данных, а для этого на клиенте
                //нужно файл получить в виде этих двоичных данных. Для этого есть класс ДвоичныеДанные
                //класс вернёт объект с двоичными данными</span>
                ДанныеФайла = Новый ДвоичныеДанные(Объект.ПутьКФайлу);

                <span class="vue-g">//Далее двоичные данные файла нужно поместить во временное хранилище используя глобальным метод
                //этот метод вернёт адрес места в хранилище, куда он положил данные файла </span>
                АдресДанных = ПоместитьВоВременноеХранилище(ДанныеФайла);
            
                <span class="vue-g">//далее адрес передадим на серверную сторону 1с</span>
                ПрочитатьФайлXLSXНаСервере(АдресДанных);	
            КонецПроцедуры

            &НаСервере
            Процедура ПрочитатьФайлXLSXНаСервере(АдресДанных)
                <span class="vue-g">//из-за того что метод Прочитать() доступен только на сервере мы и вынуждены выполнять код на сервере</span>
                ТабДок = Новый ТабличныйДокумент;

                <span class="vue-g">//теперь нам надо получить объект с двоичными данными файла из временного хранилища веб сервера
                //для этого используем метод глобального контекста</span>
                Данные = ПолучитьИзВременногоХранилища(АдресДанных);

                <span class="vue-g">//двоичные данные нужно теперь записать в файловой системе веб сервера
                //у объекта Данные есть метод Записать(), в качестве параметра надо передать имя файла, куда будем записывать данные
                //чтобы избежать совпадений имён мы вызовем глобальный метод для создания уникального временного имени для файла
                //в параметрах можно указать расширение файла</span> 
                ИмяВременногоФайла = ПолучитьИмяВременногоФайла("xlsx");
                <span class="vue-g">//метод Записать сам создаст файл в файловой системе веб сервера, даст ему имя из параметра и запишет в него двоичные данные</span>
                Данные.Записать(ИмяВременногоФайла);

                <span class="vue-g">//чтобы при чтении файла исключить вылет ошибок обернём чтение в Попытка..Исключение</span>
                Попытка
                    <span class="vue-g">//из табличного файла данные можно считывать 2мя способами.Либо по типам значений - число считывается как число, строка как строка,
                    //либо всё считывать как текст, т.е. всё будет считываться как строки.
                    //1м параметром передаём имя временного файла на сервере, в котором и лежит наш файл с клиента</span> 
                    ТабДок.Прочитать(ИмяВременногоФайла, СпособЧтенияЗначенийТабличногоДокумента.Значение);
                Исключение
                    <span class="vue-g">//ОписаниеОшибки() это метод Глобального контекста, который вернёт текст ошибки</span>
                    Сообщение = Новый СообщениеПользователю;
                    Сообщение.Текст = "Не удалось прочитать указанный файл по причине " + ОписаниеОшибки();
                    Сообщение.Сообщить();
                    Возврат;
                КонецПопытки;

                <span class="vue-g">//если ошибок нет, то можем двигаться дальше и нам нужно получить количество строк в табличном файле</span>
                КоличествоСтрок = ТабДок.ВысотаТаблицы;

                <span class="vue-g">//и далее в цикле будем считывать построчно табличный файл, начинать будем
                //со 2й строки, потому что в 1й строке шапка</span>
                Для НомерСтроки = 2 По КоличествоСтрок Цикл
                    <span class="vue-g">//в табличную часть добавляем новую строку
                    //и колонкам этой строки задаём части массива</span>
                    НоваяСтрока = Объект.ДанныеФайла.Добавить(); 

                    <span class="vue-g">//метод ПолучитьОбласть() вернёт объект типа ТабличныйДокумент, нам же нужно получить содержимое ячейки
                    //у вернувшегося объекта есть подобъект ТекущаяОбласть, а унего есть свойство Текст, которое нам и даст
                    //содержимое ячейки</span> 
                    НоваяСтрока.КраткоеНаименование = ТабДок.ПолучитьОбласть("R" + Формат(НомерСтроки, "ЧГ=0") + "C1").ТекущаяОбласть.Текст;
                    НоваяСтрока.ПолноеНаименование = ТабДок.ПолучитьОбласть("R" + Формат(НомерСтроки, "ЧГ=0") + "C2").ТекущаяОбласть.Текст;
                    НоваяСтрока.УНП = ТабДок.ПолучитьОбласть("R" + Формат(НомерСтроки, "ЧГ=0") + "C3").ТекущаяОбласть.Текст;
                КонецЦикла;	
            КонецПроцедуры
        </pre>
    </div>















    <h2 class="header-style" id="abc">Чтение файла со списком контрагентов и запись их в справочник Контрагенты</h2>
    <p>Использовать будем эту же обработку "ЧтениеРазныхФайлов". Напомню она находится в конфе "Курс Камкова Основные объекты". Рядом с кнопкой "Прочитать файл" добавим кнопку "Записать файл", которая будет создавать новые элементы справочника и записывать их в БД.</p>
    <p>Покажем 2 способа как это сделать, первый будет с ошибками, а второй с исправлением ошибок. Итак на кнопку "Записать в файл" повесим обработчик с клиентом и процедурой на сервере. Так как мы будем создавать новые элементы справочника, то такие работы идут только на сервере, потому что нужно работать с БД. Ниже в коде процедуры создания и записи новых элементов справочника, остальной код по чтению файлов описан выше:</p>
    <div class="code-style">
        <pre>
            --запись контрагентов в справочник
            --предполагается что файл уже прочитан и табличная часть ДанныеФайла заполнена
            &НаКлиенте
            Процедура ЗаписатьФайл(Команда)
                ЗаписатьФайлНаСервере();
            КонецПроцедуры

            &НаСервере
            Процедура ЗаписатьФайлНаСервере()
                <span class="vue-g">//нам нужно выполнить обход коллекции табличной части ДанныеФайла и для каждой строки создать новый 
                //элемент справочника Контрагенты</span>
                Для каждого СтрокаТабЧасти Из Объект.ДанныеФайла Цикл
                    <span class="vue-g">//далее нам надо проверить по полю УНП нет ли совпадений контрагентов из файла с контрагентами в справочнике
                    //если УНП совпало то не надо создавать новый элемент. Для этого будем использовать объектную модель запроса
                    //к БД. У менеджера справочников есть метод НайтиПоРеквизиту(). В цикле будем подставлять в этот метод
                    //имя реквизита и его значение и искать есть ли такой уже в базе.
                    //метод возвращает ссылку на найденный элемент, если не нашёл, то пустая ссылка вернётся.</span>
                    СсылкаЭлемента = Справочники.Контрагенты.НайтиПоРеквизиту("УНП", СтрокаТабЧасти.УНП);

                    <span class="vue-g">//сравним что нам вернулось, если пустая ссылка, то её нужно сравнить с пустой ссылкой
                    //если там не пустая ссылка, а вполне конкретная, то пропускаем данный круг цикла, потому что такой элемент 
                    //значит есть уже в справочнике</span>
                    Если СсылкаЭлемента &lt;> Справочники.Контрагенты.ПустаяСсылка() Тогда
                        Продолжить;	
                    КонецЕсли;

                    <span class="vue-g">//ну а если ссылка пустая, то создадим новый элемент справочника и зполним его</span>
                    НовыйЭлемент = Справочники.Контрагенты.СоздатьЭлемент();

                    <span class="vue-g">//в моём случае можно указать папку в которую запишем элементы</span>
                    НовыйЭлемент.Родитель = Справочники.Контрагенты.НайтиПоНаименованию("Поставщики");

                    НовыйЭлемент.Наименование = СтрокаТабЧасти.КраткоеНаименование;
                    НовыйЭлемент.НаименованиеПолное = СтрокаТабЧасти.ПолноеНаименование;
                    НовыйЭлемент.УНП = СтрокаТабЧасти.УНП;

                    <span class="vue-g">//далее нужно записать новый элемент справочника в базу</span>
                    НовыйЭлемент.Записать();
                КонецЦикла;

                Сообщить("Создание контрагентов завершено");
            КонецПроцедуры
        </pre>
    </div>
    <p><span class="vue-r">Напомню это мы описали сопособ с ошибками создания и записи элементов справочника</span>.</p>
    <p>Первая ошибка кроется в том, что разные типы у реквизита "УНП" в справочнике и в табличной части ДанныеФайла. В справочнике стоит Число, а в таб. части строка. И из-за этого при поиске реквизита "УНП" мы передаём УНП с типом строка, а сравнение внутри метода НайтиПоРеквизиту() идёт с реквизитом справочника "УНП" с типом число, поэтому сравнение не правильно сработает и у нас появятся повторные контрагенты. Решение простое, просто приводим 2й параметр этого метода к числу.</p>
    <p>Вторая ошибка в том, что у нас в цикле выполняется метод НайтиПоРеквизиту() и у меня ещё и метод НайтиПоНаименованию(). Эти методы делают запросы в базу. А вдруг у нас контрагентов 10 000, то будет сделано 20 000 запросов в базу. И это у меня файловый способ организации базы, а если это с настоящим веб сервером, который от себя ещё посылает переделанные запросы в СУБД. Это очень нагрузит все системы и СУБД и сервер, короче ОЧЕНЬ ПЛОХО делать запросы в цикле. Мы можем сделать один запрос, получить все значения реквизита "УНП" в оперативную память, поместить их в массив, а затем в цикле берём значение "УНП" из табличной части и ищем их в этом массиве, если не нашли значит создаём новый элемент. Вот обновлённый код:</p>
    <div class="code-style">
        <pre>
            --запись контрагентов в справочник
            --предполагается что файл уже прочитан и табличная часть ДанныеФайла заполнена
            &НаКлиенте
            Процедура ЗаписатьФайл(Команда)
                ЗаписатьФайлНаСервере();
            КонецПроцедуры

            &НаСервере
            Процедура ЗаписатьФайлНаСервере()  
                <span class="vue-g">//выберем все значения поля УНП и перепишем их в массив</span>
                Запрос = Новый Запрос;
                Запрос.Текст = 
                    "ВЫБРАТЬ
                    |	Контрагенты.УНП КАК УНП
                    |ИЗ
                    |	Справочник.Контрагенты КАК Контрагенты";
                
                РезультатЗапроса = Запрос.Выполнить();	
                ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
                
                МассивУНП = Новый Массив;
                Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
                    МассивУНП.Добавить(ВыборкаДетальныеЗаписи.УНП);
                КонецЦикла;

                <span class="vue-g">//также вынесем получение ссылки на элемент-папку Поставщики, чтобы указвать её
                //в качестве родителя для созданных элементов. Можно получить ссылку и на Покупатели если надо</span>
                СсылкаНаПоставщика = Справочники.Контрагенты.НайтиПоНаименованию("Поставщики");

                <span class="vue-g">//нам нужно выполнить обход коллекции табличной части ДанныеФайла и создать новые 
                //элементы справочника Контрагенты</span>
                Для каждого СтрокаТабЧасти Из Объект.ДанныеФайла Цикл
                    Если МассивУНП.Найти(Число(СтрокаТабЧасти.УНП)) &lt;> Неопределено Тогда
                        Продолжить;	
                    КонецЕсли;

                    <span class="vue-g">//если в массиве не найдено, то создадим новый элемент справочника и зполним его</span>
                    НовыйЭлемент = Справочники.Контрагенты.СоздатьЭлемент();

                    <span class="vue-g">//в моём случае можно указать папку в которую запишем элементы
                    //чтобы указать родителя не пойдёт просто записать строку "Поставщики", потому что Поставщики как и Покупатели
                    //это такие же эелементы справочника, а потому надо указать ссылку на элемент, чтобы её указать надо получить такую
                    //ссылку, найдём её по наименованию в базе</span>
                    НовыйЭлемент.Родитель = СсылкаНаПоставщика;

                    НовыйЭлемент.Наименование = СтрокаТабЧасти.КраткоеНаименование;
                    НовыйЭлемент.НаименованиеПолное = СтрокаТабЧасти.ПолноеНаименование;
                    НовыйЭлемент.УНП = СтрокаТабЧасти.УНП;

                    <span class="vue-g">//далее нужно записать новый элемент справочника в базу</span>
                    НовыйЭлемент.Записать();
                КонецЦикла;

                Сообщить("Создание контрагентов завершено");
            КонецПроцедуры
        </pre>
    </div>


















    <h2 class="header-style" id="abcd">Выгрузка данных из 1С в XML</h2>
    <p>Для выгрузки данных в файл XML есть класс <span class="vue-b">ЗаписьXML</span>. У объекта этого класса есть такие методы:</p>
    <ul class="list">
        <li><b>ОткрытьФайл()</b> - открывает файл для последующей записи в него.</li>
        <li><b>ЗаписатьОбъявлениеXML()</b> - добавляет первую строку(объявление) в XML-документ. Имеется в виду первая строка с тегом xml, где описывается версия, кодировка и т.д.</li>
        <li><b>ЗаписатьНачалоЭлемента(&lt;ИмяЭлемента>)</b> - записывает начало элемента в XML-документ(открывающий тег).</li>
        <li><b>ЗаписатьТекст(&lt;Текст>)</b> - записывает содержимое элемента.</li>
        <li><b>ЗаписатьКонецЭлемента()</b> - записывает конец элемента в XML-жокумент(закрывающий тег).</li>
    </ul>
    <div class="code-style">
        <pre>
            --предполагается что у нас в обработке есть табличная часть и мы из этой табличной части
            --выгружаем в файл
            --В табличную же часть можно по кнопке загрузить данные из базы
            &НаКлиенте
            Процедура ВыгрузитьДанныевФайлXML()
                ЗаписьXML = Новый ЗаписьXML;
                ЗаписьXML.ОткрытьФайл(&lt;ПутьКФайлу>);
                ЗаписьXML.ЗаписатьНачалоЭлемента("ContragentList");

                Для каждого СтрокаТабЧасти Из Объект.ДанныеФайла Цикл
                    ЗаписьXML.ЗаписатьНачалоЭлемента("Contragent");
                        //Краткое наименование
                        ЗаписьXML.ЗаписатьНачалоЭлемента("NAME");
                        ЗаписьXML.ЗаписатьТекст(СтрокаТабЧасти.КраткоеНаименование);
                        ЗаписатьКонецЭлемента();

                        //Полное наименование
                        ЗаписьXML.ЗаписатьНачалоЭлемента("LAST_NAME");
                        ЗаписьXML.ЗаписатьТекст(СтрокаТабЧасти.ПолноеНаименование);
                        ЗаписатьКонецЭлемента();

                        //УНП
                        ЗаписьXML.ЗаписатьНачалоЭлемента("UNP");
                        ЗаписьXML.ЗаписатьТекст(СтрокаТабЧасти.УНП);
                        ЗаписатьКонецЭлемента();
                    ЗаписатьКонецЭлемента("Contragent");
                КонецЦикла;

                ЗаписатьКонецЭлемента();

                //закрываем файл
                ЗаписьXML.Закрыть();
            КонецПроцедуры
        </pre>
    </div>












</div>
